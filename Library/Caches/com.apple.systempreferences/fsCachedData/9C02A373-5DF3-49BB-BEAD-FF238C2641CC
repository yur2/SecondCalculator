/*!
 * jQuery JavaScript Library v1.8.3
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright 2012 jQuery Foundation and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: Tue Nov 13 2012 08:20:33 GMT-0500 (Eastern Standard Time)
 */
/**
 * @license Portions of this software are copyright Yahoo, Inc, used under the following license:
 * Software License Agreement (BSD License)
 * Copyright (c) 2009, Yahoo! Inc.
 * All rights reserved.
 * Redistribution and use of this software in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
 *
 * Redistributions of source code must retain the above copyright notice, this list of conditions and the
 * following disclaimer.
 * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
 * Neither the name of Yahoo! Inc. nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission of Yahoo! Inc.
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * Sources of Intellectual Property Included in the YUI Library
 * Where not otherwise indicated, all YUI content is authored by Yahoo! engineers and consists of Yahoo!-owned intellectual property. YUI is issued by Yahoo! under the BSD license above. In some specific instances, YUI will incorporate work done by developers outside of Yahoo! with their express permission.
*/

/** @license
 * ==========================================================================
 * SproutCore -- JavaScript Application Framework
 * Copyright ©2008-2011 Apple Inc. All rights reserved.
 * Copyright 2006-2011, Strobe Inc. and contributors.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a
 * copy of this software and associated documentation files (the "Software"),
 * to deal in the Software without restriction, including without limitation
 * the rights to use, copy, modify, merge, publish, distribute, sublicense,
 * and/or sell copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
 * DEALINGS IN THE SOFTWARE.
 *
 * SproutCore and the SproutCore logo are trademarks of Strobe Inc.
 *
 * For more information about SproutCore, visit http://www.sproutcore.com
 *
 * ==========================================================================
 */

/*! @license
 * Raphael 1.5.2 - JavaScript Vector Library
 *
 * Copyright (c) 2010 Dmitry Baranovskiy (http://raphaeljs.com)
 * Licensed under the MIT (http://raphaeljs.com/license.html) license.
 */

/*! @license
 * URI.js - Mutating URLs
 *
 * Version: 1.6.0
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.com/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *   GPL v3 http://opensource.org/licenses/GPL-3.0
 *
 */

/*!
 * @license
 *
 * ]{ UUID - Ultra liteweight, blazing fast JavaScript UUID v4 generator
 * https://bitbucket.org/kodifica/uuid/
 *
 * Copyright 2009-2010 Massimo Lombardo
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */


function findClassNames(){if(SC._object_foundObjectClassNames)return;SC._object_foundObjectClassNames=!0;var e=[],t=!1,n=function(r,i,s){var o,u,a;s--;if(e.indexOf(i)>=0)return;e.push(i);for(var f in i){if(f=="__scope__")continue;if(f=="superclass")continue;f=="__SC__"&&(f="SC");if(!f.match(/^[A-Z0-9]/))continue;if(f=="SC"){if(t)continue;t=!0}o=r?[r,f].join("."):f,u=i[f];try{a=SC.typeOf(u)}catch(l){break}switch(a){case SC.T_CLASS:u._object_className||(u._object_className=o),s>=0&&n(o,u,s);break;case SC.T_OBJECT:s>=0&&n(o,u,s);break;case SC.T_HASH:(r||o==="SC")&&s>=0&&n(o,u,s);break;default:}}};window.__SC__=SC,n(null,window,2)}function main(){CoreFamily.set({exampleDataSource:"CreateFamily.FamilyDataSource",prefetchFamilyDetails:!1}),CreateFamily.run()}(function(e,t){function u(e){var t=o[e]={},n,r;e=e.split(/\s+/);for(n=0,r=e.length;n<r;n++)t[e[n]]=!0;return t}function c(e,n,r){if(r===t&&e.nodeType===1){var i="data-"+n.replace(l,"-$1").toLowerCase();r=e.getAttribute(i);if(typeof r=="string"){try{r=r==="true"?!0:r==="false"?!1:r==="null"?null:s.isNumeric(r)?+r:f.test(r)?s.parseJSON(r):r}catch(o){}s.data(e,n,r)}else r=t}return r}function h(e){for(var t in e){if(t==="data"&&s.isEmptyObject(e[t]))continue;if(t!=="toJSON")return!1}return!0}function p(e,t,n){var r=t+"defer",i=t+"queue",o=t+"mark",u=s._data(e,r);u&&(n==="queue"||!s._data(e,i))&&(n==="mark"||!s._data(e,o))&&setTimeout(function(){!s._data(e,i)&&!s._data(e,o)&&(s.removeData(e,r,!0),u.fire())},0)}function H(){return!1}function B(){return!0}function W(e){return!e||!e.parentNode||e.parentNode.nodeType===11}function X(e,
t,n){t=t||0;if(s.isFunction(t))return s.grep(e,function(e,r){var i=!!t.call(e,r,e);return i===n});if(t.nodeType)return s.grep(e,function(e,r){return e===t===n});if(typeof t=="string"){var r=s.grep(e,function(e){return e.nodeType===1});if(q.test(t))return s.filter(t,r,!n);t=s.filter(t,r)}return s.grep(e,function(e,r){return s.inArray(e,t)>=0===n})}function V(e){var t=$.split("|"),n=e.createDocumentFragment();if(n.createElement)while(t.length)n.createElement(t.pop());return n}function at(e,t){return s.nodeName(e,"table")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function ft(e,t){if(t.nodeType!==1||!s.hasData(e))return;var n,r,i,o=s._data(e),u=s._data(t,o),a=o.events;if(a){delete u.handle,u.events={};for(n in a)for(r=0,i=a[n].length;r<i;r++)s.event.add(t,n,a[n][r])}u.data&&(u.data=s.extend({},u.data))}function lt(e,t){var n;if(t.nodeType!==1)return;t.clearAttributes&&t.clearAttributes(),t.mergeAttributes&&t.mergeAttributes(e),n=t.nodeName.toLowerCase(),n==="object"?t.outerHTML=e.outerHTML:n!=="input"||e.type!=="checkbox"&&e.type!=="radio"?n==="option"?t.selected=e.defaultSelected:n==="input"||n==="textarea"?t.defaultValue=e.defaultValue:n==="script"&&t.text!==e.text&&(t.text=e.text):(e.checked&&(t.defaultChecked=t.checked=e.checked),t.value!==e.value&&(t.value=e.value)),t.removeAttribute(s.expando),t.removeAttribute("_submit_attached"),t.removeAttribute("_change_attached")}function ct(e){return typeof e.getElementsByTagName!="undefined"?e.getElementsByTagName("*"):typeof e.querySelectorAll!="undefined"?e.querySelectorAll("*"):[]
}function ht(e){if(e.type==="checkbox"||e.type==="radio")e.defaultChecked=e.checked}function pt(e){var t=(e.nodeName||"").toLowerCase();t==="input"?ht(e):t!=="script"&&typeof e.getElementsByTagName!="undefined"&&s.grep(e.getElementsByTagName("input"),ht)}function dt(e){var t=n.createElement("div");return ut.appendChild(t),t.innerHTML=e.outerHTML,t.firstChild}function kt(e,t,n){var r=t==="width"?e.offsetWidth:e.offsetHeight,i=t==="width"?1:0,o=4;if(r>0){if(n!=="border")for(;i<o;i+=2)n||(r-=parseFloat(s.css(e,"padding"+xt[i]))||0),n==="margin"?r+=parseFloat(s.css(e,n+xt[i]))||0:r-=parseFloat(s.css(e,"border"+xt[i]+"Width"))||0;return r+"px"}r=Tt(e,t);if(r<0||r==null)r=e.style[t];if(bt.test(r))return r;r=parseFloat(r)||0;if(n)for(;i<o;i+=2)r+=parseFloat(s.css(e,"padding"+xt[i]))||0,n!=="padding"&&(r+=parseFloat(s.css(e,"border"+xt[i]+"Width"))||0),n==="margin"&&(r+=parseFloat(s.css(e,n+xt[i]))||0);return r+"px"}function Bt(){return setTimeout(jt,0),Ht=s.now()}function jt(){Ht=t}function Ft(e,t){var n={};return s.each(Pt.concat.apply([],Pt.slice(0,t)),function(){n[this]=e}),n}function It(e){if(!Lt[e]){var t=n.body,r=s("<"+e+">").appendTo(t),i=r.css("display");r.remove();if(i==="none"||i===""){At||(At=n.createElement("iframe"),At.frameBorder=At.width=At.height=0),t.appendChild(At);if(!Ot||!At.createElement)Ot=(At.contentWindow||At.contentDocument).document,Ot.write((s.support.boxModel?"<!doctype html>":"")+"<html><body>"),Ot.close();r=Ot.createElement(e),Ot.body.appendChild(r),i=s.css(r,"display"),t.removeChild(At)}Lt[e]=i}return Lt[e]}function zt(e){return s.isWindow(e)?e:e.nodeType===9?
e.defaultView||e.parentWindow:!1}var n=e.document,r=e.navigator,i=e.location,s=function(){function H(){if(i.isReady)return;try{n.documentElement.doScroll("left")}catch(e){setTimeout(H,1);return}i.ready()}var i=function(e,t){return new i.fn.init(e,t,u)},s=e.jQuery,o=e.$,u,a=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,f=/\S/,l=/^\s+/,c=/\s+$/,h=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,p=/^[\],:{}\s]*$/,d=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,v=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,m=/(?:^|:|,)(?:\s*\[)+/g,g=/(webkit)[ \/]([\w.]+)/,y=/(opera)(?:.*version)?[ \/]([\w.]+)/,b=/(msie) ([\w.]+)/,w=/(mozilla)(?:.*? rv:([\w.]+))?/,E=/-([a-z]|[0-9])/ig,S=/^-ms-/,x=function(e,t){return(t+"").toUpperCase()},T=r.userAgent,N,C,k,L=Object.prototype.toString,A=Object.prototype.hasOwnProperty,O=Array.prototype.push,M=Array.prototype.slice,_=String.prototype.trim,D=Array.prototype.indexOf,P={};return i.fn=i.prototype={constructor:i,init:function(e,r,s){var o,u,f,l;if(!e)return this;if(e.nodeType)return this.context=this[0]=e,this.length=1,this;if(e==="body"&&!r&&n.body)return this.context=n,this[0]=n.body,this.selector=e,this.length=1,this;if(typeof e=="string"){e.charAt(0)==="<"&&e.charAt(e.length-1)===">"&&e.length>=3?o=[null,e,null]:o=a.exec(e);if(o&&(o[1]||!r)){if(o[1])return r=r instanceof i?r[0]:r,l=r?r.ownerDocument||r:n,f=h.exec(e),f?i.isPlainObject(r)?(e=[n.createElement(f[1])],i.fn.attr.call(e,r,!0)):e=[l.createElement(f[1])]:(f=i.buildFragment([o[1]],[l]),e=(f.cacheable?i.clone(f.fragment):f.fragment).childNodes),i.merge(this,e);u=n.getElementById(o[2]);if(u&&u.parentNode
){if(u.id!==o[2])return s.find(e);this.length=1,this[0]=u}return this.context=n,this.selector=e,this}return!r||r.jquery?(r||s).find(e):this.constructor(r).find(e)}return i.isFunction(e)?s.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),i.makeArray(e,this))},selector:"",jquery:"1.7.2",length:0,size:function(){return this.length},toArray:function(){return M.call(this,0)},get:function(e){return e==null?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e,t,n){var r=this.constructor();return i.isArray(e)?O.apply(r,e):i.merge(r,e),r.prevObject=this,r.context=this.context,t==="find"?r.selector=this.selector+(this.selector?" ":"")+n:t&&(r.selector=this.selector+"."+t+"("+n+")"),r},each:function(e,t){return i.each(this,e,t)},ready:function(e){return i.bindReady(),C.add(e),this},eq:function(e){return e=+e,e===-1?this.slice(e):this.slice(e,e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(M.apply(this,arguments),"slice",M.call(arguments).join(","))},map:function(e){return this.pushStack(i.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:O,sort:[].sort,splice:[].splice},i.fn.init.prototype=i.fn,i.extend=i.fn.extend=function(){var e,n,r,s,o,u,a=arguments[0]||{},f=1,l=arguments.length,c=!1;typeof a=="boolean"&&(c=a,a=arguments[1]||{},f=2),typeof a!="object"&&!i.isFunction(a)&&(a={}),l===f&&(a=this,--f);for(;f<l;f++)if((e=arguments[f])!=null)for(n in e){r=a[n],s=e[n];if(a===s)continue;c&&s&&(i.isPlainObject(s)||(o=
i.isArray(s)))?(o?(o=!1,u=r&&i.isArray(r)?r:[]):u=r&&i.isPlainObject(r)?r:{},a[n]=i.extend(c,u,s)):s!==t&&(a[n]=s)}return a},i.extend({noConflict:function(t){return e.$===i&&(e.$=o),t&&e.jQuery===i&&(e.jQuery=s),i},isReady:!1,readyWait:1,holdReady:function(e){e?i.readyWait++:i.ready(!0)},ready:function(e){if(e===!0&&!--i.readyWait||e!==!0&&!i.isReady){if(!n.body)return setTimeout(i.ready,1);i.isReady=!0;if(e!==!0&&--i.readyWait>0)return;C.fireWith(n,[i]),i.fn.trigger&&i(n).trigger("ready").off("ready")}},bindReady:function(){if(C)return;C=i.Callbacks("once memory");if(n.readyState==="complete")return setTimeout(i.ready,1);if(n.addEventListener)n.addEventListener("DOMContentLoaded",k,!1),e.addEventListener("load",i.ready,!1);else if(n.attachEvent){n.attachEvent("onreadystatechange",k),e.attachEvent("onload",i.ready);var t=!1;try{t=e.frameElement==null}catch(r){}n.documentElement.doScroll&&t&&H()}},isFunction:function(e){return i.type(e)==="function"},isArray:Array.isArray||function(e){return i.type(e)==="array"},isWindow:function(e){return e!=null&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return e==null?String(e):P[L.call(e)]||"object"},isPlainObject:function(e){if(!e||i.type(e)!=="object"||e.nodeType||i.isWindow(e))return!1;try{if(e.constructor&&!A.call(e,"constructor")&&!A.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}var r;for(r in e);return r===t||A.call(e,r)},isEmptyObject:function(e){for(var t in e)return!1;return!0},error:function(e){throw new Error(e)},parseJSON:function(t){if(typeof t!="string"||!
t)return null;t=i.trim(t);if(e.JSON&&e.JSON.parse)return e.JSON.parse(t);if(p.test(t.replace(d,"@").replace(v,"]").replace(m,"")))return(new Function("return "+t))();i.error("Invalid JSON: "+t)},parseXML:function(n){if(typeof n!="string"||!n)return null;var r,s;try{e.DOMParser?(s=new DOMParser,r=s.parseFromString(n,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n))}catch(o){r=t}return(!r||!r.documentElement||r.getElementsByTagName("parsererror").length)&&i.error("Invalid XML: "+n),r},noop:function(){},globalEval:function(t){t&&f.test(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(S,"ms-").replace(E,x)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toUpperCase()===t.toUpperCase()},each:function(e,n,r){var s,o=0,u=e.length,a=u===t||i.isFunction(e);if(r){if(a){for(s in e)if(n.apply(e[s],r)===!1)break}else for(;o<u;)if(n.apply(e[o++],r)===!1)break}else if(a){for(s in e)if(n.call(e[s],s,e[s])===!1)break}else for(;o<u;)if(n.call(e[o],o,e[o++])===!1)break;return e},trim:_?function(e){return e==null?"":_.call(e)}:function(e){return e==null?"":e.toString().replace(l,"").replace(c,"")},makeArray:function(e,t){var n=t||[];if(e!=null){var r=i.type(e);e.length==null||r==="string"||r==="function"||r==="regexp"||i.isWindow(e)?O.call(n,e):i.merge(n,e)}return n},inArray:function(e,t,n){var r;if(t){if(D)return D.call(t,e,n);r=t.length,n=n?n<0?Math.max(0,r+n):n:0;for(;n<r;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var r=e.length,i=0;if(typeof n.length=="number")for(var s=n.length;i<s;i++)e
[r++]=n[i];else while(n[i]!==t)e[r++]=n[i++];return e.length=r,e},grep:function(e,t,n){var r=[],i;n=!!n;for(var s=0,o=e.length;s<o;s++)i=!!t(e[s],s),n!==i&&r.push(e[s]);return r},map:function(e,n,r){var s,o,u=[],a=0,f=e.length,l=e instanceof i||f!==t&&typeof f=="number"&&(f>0&&e[0]&&e[f-1]||f===0||i.isArray(e));if(l)for(;a<f;a++)s=n(e[a],a,r),s!=null&&(u[u.length]=s);else for(o in e)s=n(e[o],o,r),s!=null&&(u[u.length]=s);return u.concat.apply([],u)},guid:1,proxy:function(e,n){if(typeof n=="string"){var r=e[n];n=e,e=r}if(!i.isFunction(e))return t;var s=M.call(arguments,2),o=function(){return e.apply(n,s.concat(M.call(arguments)))};return o.guid=e.guid=e.guid||o.guid||i.guid++,o},access:function(e,n,r,s,o,u,a){var f,l=r==null,c=0,h=e.length;if(r&&typeof r=="object"){for(c in r)i.access(e,n,c,r[c],1,u,s);o=1}else if(s!==t){f=a===t&&i.isFunction(s),l&&(f?(f=n,n=function(e,t,n){return f.call(i(e),n)}):(n.call(e,s),n=null));if(n)for(;c<h;c++)n(e[c],r,f?s.call(e[c],c,n(e[c],r)):s,a);o=1}return o?e:l?n.call(e):h?n(e[0],r):u},now:function(){return(new Date).getTime()},uaMatch:function(e){e=e.toLowerCase();var t=g.exec(e)||y.exec(e)||b.exec(e)||e.indexOf("compatible")<0&&w.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},sub:function(){function e(t,n){return new e.fn.init(t,n)}i.extend(!0,e,this),e.superclass=this,e.fn=e.prototype=this(),e.fn.constructor=e,e.sub=this.sub,e.fn.init=function(r,s){return s&&s instanceof i&&!(s instanceof e)&&(s=e(s)),i.fn.init.call(this,r,s,t)},e.fn.init.prototype=e.fn;var t=e(n);return e},browser:{}}),i.each("Boolean Number String Function Array Date RegExp Object"
.split(" "),function(e,t){P["[object "+t+"]"]=t.toLowerCase()}),N=i.uaMatch(T),N.browser&&(i.browser[N.browser]=!0,i.browser.version=N.version),i.browser.webkit&&(i.browser.safari=!0),f.test(" ")&&(l=/^[\s\xA0]+/,c=/[\s\xA0]+$/),u=i(n),n.addEventListener?k=function(){n.removeEventListener("DOMContentLoaded",k,!1),i.ready()}:n.attachEvent&&(k=function(){n.readyState==="complete"&&(n.detachEvent("onreadystatechange",k),i.ready())}),i}(),o={};s.Callbacks=function(e){e=e?o[e]||u(e):{};var n=[],r=[],i,a,f,l,c,h,p=function(t){var r,i,o,u,a;for(r=0,i=t.length;r<i;r++)o=t[r],u=s.type(o),u==="array"?p(o):u==="function"&&(!e.unique||!v.has(o))&&n.push(o)},d=function(t,s){s=s||[],i=!e.memory||[t,s],a=!0,f=!0,h=l||0,l=0,c=n.length;for(;n&&h<c;h++)if(n[h].apply(t,s)===!1&&e.stopOnFalse){i=!0;break}f=!1,n&&(e.once?i===!0?v.disable():n=[]:r&&r.length&&(i=r.shift(),v.fireWith(i[0],i[1])))},v={add:function(){if(n){var e=n.length;p(arguments),f?c=n.length:i&&i!==!0&&(l=e,d(i[0],i[1]))}return this},remove:function(){if(n){var t=arguments,r=0,i=t.length;for(;r<i;r++)for(var s=0;s<n.length;s++)if(t[r]===n[s]){f&&s<=c&&(c--,s<=h&&h--),n.splice(s--,1);if(e.unique)break}}return this},has:function(e){if(n){var t=0,r=n.length;for(;t<r;t++)if(e===n[t])return!0}return!1},empty:function(){return n=[],this},disable:function(){return n=r=i=t,this},disabled:function(){return!n},lock:function(){return r=t,(!i||i===!0)&&v.disable(),this},locked:function(){return!r},fireWith:function(t,n){return r&&(f?e.once||r.push([t,n]):(!e.once||!i)&&d(t,n)),this},fire:function(){return v.fireWith(this,arguments),this},fired
:function(){return!!a}};return v};var a=[].slice;s.extend({Deferred:function(e){var t=s.Callbacks("once memory"),n=s.Callbacks("once memory"),r=s.Callbacks("memory"),i="pending",o={resolve:t,reject:n,notify:r},u={done:t.add,fail:n.add,progress:r.add,state:function(){return i},isResolved:t.fired,isRejected:n.fired,then:function(e,t,n){return a.done(e).fail(t).progress(n),this},always:function(){return a.done.apply(a,arguments).fail.apply(a,arguments),this},pipe:function(e,t,n){return s.Deferred(function(r){s.each({done:[e,"resolve"],fail:[t,"reject"],progress:[n,"notify"]},function(e,t){var n=t[0],i=t[1],o;s.isFunction(n)?a[e](function(){o=n.apply(this,arguments),o&&s.isFunction(o.promise)?o.promise().then(r.resolve,r.reject,r.notify):r[i+"With"](this===a?r:this,[o])}):a[e](r[i])})}).promise()},promise:function(e){if(e==null)e=u;else for(var t in u)e[t]=u[t];return e}},a=u.promise({}),f;for(f in o)a[f]=o[f].fire,a[f+"With"]=o[f].fireWith;return a.done(function(){i="resolved"},n.disable,r.lock).fail(function(){i="rejected"},t.disable,r.lock),e&&e.call(a,a),a},when:function(e){function c(e){return function(n){t[e]=arguments.length>1?a.call(arguments,0):n,--o||f.resolveWith(f,t)}}function h(e){return function(t){i[e]=arguments.length>1?a.call(arguments,0):t,f.notifyWith(l,i)}}var t=a.call(arguments,0),n=0,r=t.length,i=new Array(r),o=r,u=r,f=r<=1&&e&&s.isFunction(e.promise)?e:s.Deferred(),l=f.promise();if(r>1){for(;n<r;n++)t[n]&&t[n].promise&&s.isFunction(t[n].promise)?t[n].promise().then(c(n),f.reject,h(n)):--o;o||f.resolveWith(f,t)}else f!==e&&f.resolveWith(f,r?[e]:[]);return l
}}),s.support=function(){var t,r,i,o,u,a,f,l,c,h,p,d,v=n.createElement("div"),m=n.documentElement;v.setAttribute("className","t"),v.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",r=v.getElementsByTagName("*"),i=v.getElementsByTagName("a")[0];if(!r||!r.length||!i)return{};o=n.createElement("select"),u=o.appendChild(n.createElement("option")),a=v.getElementsByTagName("input")[0],t={leadingWhitespace:v.firstChild.nodeType===3,tbody:!v.getElementsByTagName("tbody").length,htmlSerialize:!!v.getElementsByTagName("link").length,style:/top/.test(i.getAttribute("style")),hrefNormalized:i.getAttribute("href")==="/a",opacity:/^0.55/.test(i.style.opacity),cssFloat:!!i.style.cssFloat,checkOn:a.value==="on",optSelected:u.selected,getSetAttribute:v.className!=="t",enctype:!!n.createElement("form").enctype,html5Clone:n.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,pixelMargin:!0},s.boxModel=t.boxModel=n.compatMode==="CSS1Compat",a.checked=!0,t.noCloneChecked=a.cloneNode(!0).checked,o.disabled=!0,t.optDisabled=!u.disabled;try{delete v.test}catch(g){t.deleteExpando=!1}!v.addEventListener&&v.attachEvent&&v.fireEvent&&(v.attachEvent("onclick",function(){t.noCloneEvent=!1}),v.cloneNode(!0).fireEvent("onclick")),a=n.createElement("input"),a.value="t",a.setAttribute("type","radio"),t.radioValue=a.value==="t",a.setAttribute("checked","checked"),a.setAttribute
("name","t"),v.appendChild(a),f=n.createDocumentFragment(),f.appendChild(v.lastChild),t.checkClone=f.cloneNode(!0).cloneNode(!0).lastChild.checked,t.appendChecked=a.checked,f.removeChild(a),f.appendChild(v);if(v.attachEvent)for(p in{submit:1,change:1,focusin:1})h="on"+p,d=h in v,d||(v.setAttribute(h,"return;"),d=typeof v[h]=="function"),t[p+"Bubbles"]=d;return f.removeChild(v),f=o=u=v=a=null,s(function(){var r,i,o,u,a,f,c,h,p,m,g,y,b,w=n.getElementsByTagName("body")[0];if(!w)return;h=1,b="padding:0;margin:0;border:",g="position:absolute;top:0;left:0;width:1px;height:1px;",y=b+"0;visibility:hidden;",p="style='"+g+b+"5px solid #000;",m="<div "+p+"display:block;'><div style='"+b+"0;display:block;overflow:hidden;'></div></div>"+"<table "+p+"' cellpadding='0' cellspacing='0'>"+"<tr><td></td></tr></table>",r=n.createElement("div"),r.style.cssText=y+"width:0;height:0;position:static;top:0;margin-top:"+h+"px",w.insertBefore(r,w.firstChild),v=n.createElement("div"),r.appendChild(v),v.innerHTML="<table><tr><td style='"+b+"0;display:none'></td><td>t</td></tr></table>",l=v.getElementsByTagName("td"),d=l[0].offsetHeight===0,l[0].style.display="",l[1].style.display="none",t.reliableHiddenOffsets=d&&l[0].offsetHeight===0,e.getComputedStyle&&(v.innerHTML="",c=n.createElement("div"),c.style.width="0",c.style.marginRight="0",v.style.width="2px",v.appendChild(c),t.reliableMarginRight=(parseInt((e.getComputedStyle(c,null)||{marginRight:0}).marginRight,10)||0)===0),typeof v.style.zoom!="undefined"&&(v.innerHTML="",v.style.width=v.style.padding="1px",v.style.border=0,v.style.overflow="hidden",v.style
.display="inline",v.style.zoom=1,t.inlineBlockNeedsLayout=v.offsetWidth===3,v.style.display="block",v.style.overflow="visible",v.innerHTML="<div style='width:5px;'></div>",t.shrinkWrapBlocks=v.offsetWidth!==3),v.style.cssText=g+y,v.innerHTML=m,i=v.firstChild,o=i.firstChild,a=i.nextSibling.firstChild.firstChild,f={doesNotAddBorder:o.offsetTop!==5,doesAddBorderForTableAndCells:a.offsetTop===5},o.style.position="fixed",o.style.top="20px",f.fixedPosition=o.offsetTop===20||o.offsetTop===15,o.style.position=o.style.top="",i.style.overflow="hidden",i.style.position="relative",f.subtractsBorderForOverflowNotVisible=o.offsetTop===-5,f.doesNotIncludeMarginInBodyOffset=w.offsetTop!==h,e.getComputedStyle&&(v.style.marginTop="1%",t.pixelMargin=(e.getComputedStyle(v,null)||{marginTop:0}).marginTop!=="1%"),typeof r.style.zoom!="undefined"&&(r.style.zoom=1),w.removeChild(r),c=v=r=null,s.extend(t,f)}),t}();var f=/^(?:\{.*\}|\[.*\])$/,l=/([A-Z])/g;s.extend({cache:{},uuid:0,expando:"jQuery"+(s.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?s.cache[e[s.expando]]:e[s.expando],!!e&&!h(e)},data:function(e,n,r,i){if(!s.acceptData(e))return;var o,u,a,f=s.expando,l=typeof n=="string",c=e.nodeType,h=c?s.cache:e,p=c?e[f]:e[f]&&f,d=n==="events";if((!p||!h[p]||!d&&!i&&!h[p].data)&&l&&r===t)return;p||(c?e[f]=p=++s.uuid:p=f),h[p]||(h[p]={},c||(h[p].toJSON=s.noop));if(typeof n=="object"||typeof n=="function")i?h[p]=s.extend(h[p],n):h[p].data=s.extend(h[p].data,n);return o=u=h[p],i||(u.data||(u
.data={}),u=u.data),r!==t&&(u[s.camelCase(n)]=r),d&&!u[n]?o.events:(l?(a=u[n],a==null&&(a=u[s.camelCase(n)])):a=u,a)},removeData:function(e,t,n){if(!s.acceptData(e))return;var r,i,o,u=s.expando,a=e.nodeType,f=a?s.cache:e,l=a?e[u]:u;if(!f[l])return;if(t){r=n?f[l]:f[l].data;if(r){s.isArray(t)||(t in r?t=[t]:(t=s.camelCase(t),t in r?t=[t]:t=t.split(" ")));for(i=0,o=t.length;i<o;i++)delete r[t[i]];if(!(n?h:s.isEmptyObject)(r))return}}if(!n){delete f[l].data;if(!h(f[l]))return}s.support.deleteExpando||!f.setInterval?delete f[l]:f[l]=null,a&&(s.support.deleteExpando?delete e[u]:e.removeAttribute?e.removeAttribute(u):e[u]=null)},_data:function(e,t,n){return s.data(e,t,n,!0)},acceptData:function(e){if(e.nodeName){var t=s.noData[e.nodeName.toLowerCase()];if(t)return t!==!0&&e.getAttribute("classid")===t}return!0}}),s.fn.extend({data:function(e,n){var r,i,o,u,a,f=this[0],l=0,h=null;if(e===t){if(this.length){h=s.data(f);if(f.nodeType===1&&!s._data(f,"parsedAttrs")){o=f.attributes;for(a=o.length;l<a;l++)u=o[l].name,u.indexOf("data-")===0&&(u=s.camelCase(u.substring(5)),c(f,u,h[u]));s._data(f,"parsedAttrs",!0)}}return h}return typeof e=="object"?this.each(function(){s.data(this,e)}):(r=e.split(".",2),r[1]=r[1]?"."+r[1]:"",i=r[1]+"!",s.access(this,function(n){if(n===t)return h=this.triggerHandler("getData"+i,[r[0]]),h===t&&f&&(h=s.data(f,e),h=c(f,e,h)),h===t&&r[1]?this.data(r[0]):h;r[1]=n,this.each(function(){var t=s(this);t.triggerHandler("setData"+i,r),s.data(this,e,n),t.triggerHandler("changeData"+i,r)})},null,n,arguments.length>1,null,!1))},removeData:function(e){return this.each(function(
){s.removeData(this,e)})}}),s.extend({_mark:function(e,t){e&&(t=(t||"fx")+"mark",s._data(e,t,(s._data(e,t)||0)+1))},_unmark:function(e,t,n){e!==!0&&(n=t,t=e,e=!1);if(t){n=n||"fx";var r=n+"mark",i=e?0:(s._data(t,r)||1)-1;i?s._data(t,r,i):(s.removeData(t,r,!0),p(t,n,"mark"))}},queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=s._data(e,t),n&&(!r||s.isArray(n)?r=s._data(e,t,s.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=s.queue(e,t),r=n.shift(),i={};r==="inprogress"&&(r=n.shift()),r&&(t==="fx"&&n.unshift("inprogress"),s._data(e,t+".run",i),r.call(e,function(){s.dequeue(e,t)},i)),n.length||(s.removeData(e,t+"queue "+t+".run",!0),p(e,t,"queue"))}}),s.fn.extend({queue:function(e,n){var r=2;return typeof e!="string"&&(n=e,e="fx",r--),arguments.length<r?s.queue(this[0],e):n===t?this:this.each(function(){var t=s.queue(this,e,n);e==="fx"&&t[0]!=="inprogress"&&s.dequeue(this,e)})},dequeue:function(e){return this.each(function(){s.dequeue(this,e)})},delay:function(e,t){return e=s.fx?s.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){function h(){--u||r.resolveWith(i,[i])}typeof e!="string"&&(n=e,e=t),e=e||"fx";var r=s.Deferred(),i=this,o=i.length,u=1,a=e+"defer",f=e+"queue",l=e+"mark",c;while(o--)if(c=s.data(i[o],a,t,!0)||(s.data(i[o],f,t,!0)||s.data(i[o],l,t,!0))&&s.data(i[o],a,s.Callbacks("once memory"),!0))u++,c.add(h);return h(),r.promise(n)}});var d=/[\n\t\r]/g,v=/\s+/,m=/\r/g,g=/^(?:button|input)$/i,y=/^(?:button|input|object|select|textarea)$/i
,b=/^a(?:rea)?$/i,w=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,E=s.support.getSetAttribute,S,x,T;s.fn.extend({attr:function(e,t){return s.access(this,s.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){s.removeAttr(this,e)})},prop:function(e,t){return s.access(this,s.prop,e,t,arguments.length>1)},removeProp:function(e){return e=s.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,o,u,a;if(s.isFunction(e))return this.each(function(t){s(this).addClass(e.call(this,t,this.className))});if(e&&typeof e=="string"){t=e.split(v);for(n=0,r=this.length;n<r;n++){i=this[n];if(i.nodeType===1)if(!i.className&&t.length===1)i.className=e;else{o=" "+i.className+" ";for(u=0,a=t.length;u<a;u++)~o.indexOf(" "+t[u]+" ")||(o+=t[u]+" ");i.className=s.trim(o)}}}return this},removeClass:function(e){var n,r,i,o,u,a,f;if(s.isFunction(e))return this.each(function(t){s(this).removeClass(e.call(this,t,this.className))});if(e&&typeof e=="string"||e===t){n=(e||"").split(v);for(r=0,i=this.length;r<i;r++){o=this[r];if(o.nodeType===1&&o.className)if(e){u=(" "+o.className+" ").replace(d," ");for(a=0,f=n.length;a<f;a++)u=u.replace(" "+n[a]+" "," ");o.className=s.trim(u)}else o.className=""}}return this},toggleClass:function(e,t){var n=typeof e,r=typeof t=="boolean";return s.isFunction(e)?this.each(function(n){s(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if(n==="string"){var i,o=0,u=s(this),a=t,f=e.split(v);while(
i=f[o++])a=r?a:!u.hasClass(i),u[a?"addClass":"removeClass"](i)}else if(n==="undefined"||n==="boolean")this.className&&s._data(this,"__className__",this.className),this.className=this.className||e===!1?"":s._data(this,"__className__")||""})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;n<r;n++)if(this[n].nodeType===1&&(" "+this[n].className+" ").replace(d," ").indexOf(t)>-1)return!0;return!1},val:function(e){var n,r,i,o=this[0];if(!arguments.length){if(o)return n=s.valHooks[o.type]||s.valHooks[o.nodeName.toLowerCase()],n&&"get"in n&&(r=n.get(o,"value"))!==t?r:(r=o.value,typeof r=="string"?r.replace(m,""):r==null?"":r);return}return i=s.isFunction(e),this.each(function(r){var o=s(this),u;if(this.nodeType!==1)return;i?u=e.call(this,r,o.val()):u=e,u==null?u="":typeof u=="number"?u+="":s.isArray(u)&&(u=s.map(u,function(e){return e==null?"":e+""})),n=s.valHooks[this.type]||s.valHooks[this.nodeName.toLowerCase()];if(!n||!("set"in n)||n.set(this,u,"value")===t)this.value=u})}}),s.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r,i,o=e.selectedIndex,u=[],a=e.options,f=e.type==="select-one";if(o<0)return null;n=f?o:0,r=f?o+1:a.length;for(;n<r;n++){i=a[n];if(i.selected&&(s.support.optDisabled?!i.disabled:i.getAttribute("disabled")===null)&&(!i.parentNode.disabled||!s.nodeName(i.parentNode,"optgroup"))){t=s(i).val();if(f)return t;u.push(t)}}return f&&!u.length&&a.length?s(a[o]).val():u},set:function(e,t){var n=s.makeArray(t);return s(e).find("option").each(function(){this.selected=s.
inArray(s(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(e,n,r,i){var o,u,a,f=e.nodeType;if(!e||f===3||f===8||f===2)return;if(i&&n in s.attrFn)return s(e)[n](r);if(typeof e.getAttribute=="undefined")return s.prop(e,n,r);a=f!==1||!s.isXMLDoc(e),a&&(n=n.toLowerCase(),u=s.attrHooks[n]||(w.test(n)?x:S));if(r!==t){if(r===null){s.removeAttr(e,n);return}return u&&"set"in u&&a&&(o=u.set(e,r,n))!==t?o:(e.setAttribute(n,""+r),r)}return u&&"get"in u&&a&&(o=u.get(e,n))!==null?o:(o=e.getAttribute(n),o===null?t:o)},removeAttr:function(e,t){var n,r,i,o,u,a=0;if(t&&e.nodeType===1){r=t.toLowerCase().split(v),o=r.length;for(;a<o;a++)i=r[a],i&&(n=s.propFix[i]||i,u=w.test(i),u||s.attr(e,i,""),e.removeAttribute(E?i:n),u&&n in e&&(e[n]=!1))}},attrHooks:{type:{set:function(e,t){if(g.test(e.nodeName)&&e.parentNode)s.error("type property can't be changed");else if(!s.support.radioValue&&t==="radio"&&s.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}},value:{get:function(e,t){return S&&s.nodeName(e,"button")?S.get(e,t):t in e?e.value:null},set:function(e,t,n){if(S&&s.nodeName(e,"button"))return S.set(e,t,n);e.value=t}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,r){var i,o,u,a=e.nodeType;if(!e||a===3||a===8||a===2)return;return u=
a!==1||!s.isXMLDoc(e),u&&(n=s.propFix[n]||n,o=s.propHooks[n]),r!==t?o&&"set"in o&&(i=o.set(e,r,n))!==t?i:e[n]=r:o&&"get"in o&&(i=o.get(e,n))!==null?i:e[n]},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):y.test(e.nodeName)||b.test(e.nodeName)&&e.href?0:t}}}}),s.attrHooks.tabindex=s.propHooks.tabIndex,x={get:function(e,n){var r,i=s.prop(e,n);return i===!0||typeof i!="boolean"&&(r=e.getAttributeNode(n))&&r.nodeValue!==!1?n.toLowerCase():t},set:function(e,t,n){var r;return t===!1?s.removeAttr(e,n):(r=s.propFix[n]||n,r in e&&(e[r]=!0),e.setAttribute(n,n.toLowerCase())),n}},E||(T={name:!0,id:!0,coords:!0},S=s.valHooks.button={get:function(e,n){var r;return r=e.getAttributeNode(n),r&&(T[n]?r.nodeValue!=="":r.specified)?r.nodeValue:t},set:function(e,t,r){var i=e.getAttributeNode(r);return i||(i=n.createAttribute(r),e.setAttributeNode(i)),i.nodeValue=t+""}},s.attrHooks.tabindex.set=S.set,s.each(["width","height"],function(e,t){s.attrHooks[t]=s.extend(s.attrHooks[t],{set:function(e,n){if(n==="")return e.setAttribute(t,"auto"),n}})}),s.attrHooks.contenteditable={get:S.get,set:function(e,t,n){t===""&&(t="false"),S.set(e,t,n)}}),s.support.hrefNormalized||s.each(["href","src","width","height"],function(e,n){s.attrHooks[n]=s.extend(s.attrHooks[n],{get:function(e){var r=e.getAttribute(n,2);return r===null?t:r}})}),s.support.style||(s.attrHooks.style={get:function(e){return e.style.cssText.toLowerCase()||t},set:function(e,t){return e.style.cssText=""+t}}),s.support.optSelected||(s.propHooks.selected=s.extend(s.propHooks.selected
,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),s.support.enctype||(s.propFix.enctype="encoding"),s.support.checkOn||s.each(["radio","checkbox"],function(){s.valHooks[this]={get:function(e){return e.getAttribute("value")===null?"on":e.value}}}),s.each(["radio","checkbox"],function(){s.valHooks[this]=s.extend(s.valHooks[this],{set:function(e,t){if(s.isArray(t))return e.checked=s.inArray(s(e).val(),t)>=0}})});var N=/^(?:textarea|input|select)$/i,C=/^([^\.]*)?(?:\.(.+))?$/,k=/(?:^|\s)hover(\.\S+)?\b/,L=/^key/,A=/^(?:mouse|contextmenu)|click/,O=/^(?:focusinfocus|focusoutblur)$/,M=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,_=function(e){var t=M.exec(e);return t&&(t[1]=(t[1]||"").toLowerCase(),t[3]=t[3]&&new RegExp("(?:^|\\s)"+t[3]+"(?:\\s|$)")),t},D=function(e,t){var n=e.attributes||{};return(!t[1]||e.nodeName.toLowerCase()===t[1])&&(!t[2]||(n.id||{}).value===t[2])&&(!t[3]||t[3].test((n["class"]||{}).value))},P=function(e){return s.event.special.hover?e:e.replace(k,"mouseenter$1 mouseleave$1")};s.event={add:function(e,n,r,i,o){var u,a,f,l,c,h,p,d,v,m,g,y;if(e.nodeType===3||e.nodeType===8||!n||!r||!(u=s._data(e)))return;r.handler&&(v=r,r=v.handler,o=v.selector),r.guid||(r.guid=s.guid++),f=u.events,f||(u.events=f={}),a=u.handle,a||(u.handle=a=function(e){return typeof s=="undefined"||!!e&&s.event.triggered===e.type?t:s.event.dispatch.apply(a.elem,arguments)},a.elem=e),n=s.trim(P(n)).split(" ");for(l=0;l<n.length;l++){c=C.exec(n[l])||[],h=c[1],p=(c[2]||"").split(".").sort(),y=s.event.special[h]||{},h=(o?y.delegateType:
y.bindType)||h,y=s.event.special[h]||{},d=s.extend({type:h,origType:c[1],data:i,handler:r,guid:r.guid,selector:o,quick:o&&_(o),namespace:p.join(".")},v),g=f[h];if(!g){g=f[h]=[],g.delegateCount=0;if(!y.setup||y.setup.call(e,i,p,a)===!1)e.addEventListener?e.addEventListener(h,a,!1):e.attachEvent&&e.attachEvent("on"+h,a)}y.add&&(y.add.call(e,d),d.handler.guid||(d.handler.guid=r.guid)),o?g.splice(g.delegateCount++,0,d):g.push(d),s.event.global[h]=!0}e=null},global:{},remove:function(e,t,n,r,i){var o=s.hasData(e)&&s._data(e),u,a,f,l,c,h,p,d,v,m,g,y;if(!o||!(d=o.events))return;t=s.trim(P(t||"")).split(" ");for(u=0;u<t.length;u++){a=C.exec(t[u])||[],f=l=a[1],c=a[2];if(!f){for(f in d)s.event.remove(e,f+t[u],n,r,!0);continue}v=s.event.special[f]||{},f=(r?v.delegateType:v.bindType)||f,g=d[f]||[],h=g.length,c=c?new RegExp("(^|\\.)"+c.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null;for(p=0;p<g.length;p++)y=g[p],(i||l===y.origType)&&(!n||n.guid===y.guid)&&(!c||c.test(y.namespace))&&(!r||r===y.selector||r==="**"&&y.selector)&&(g.splice(p--,1),y.selector&&g.delegateCount--,v.remove&&v.remove.call(e,y));g.length===0&&h!==g.length&&((!v.teardown||v.teardown.call(e,c)===!1)&&s.removeEvent(e,f,o.handle),delete d[f])}s.isEmptyObject(d)&&(m=o.handle,m&&(m.elem=null),s.removeData(e,["events","handle"],!0))},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(n,r,i,o){if(!i||i.nodeType!==3&&i.nodeType!==8){var u=n.type||n,a=[],f,l,c,h,p,d,v,m,g,y;if(O.test(u+s.event.triggered))return;u.indexOf("!")>=0&&(u=u.slice(0,-1),l=!0),u.indexOf(".")>=0&&(a=u.split("."),u=a.shift(),a.sort
());if((!i||s.event.customEvent[u])&&!s.event.global[u])return;n=typeof n=="object"?n[s.expando]?n:new s.Event(u,n):new s.Event(u),n.type=u,n.isTrigger=!0,n.exclusive=l,n.namespace=a.join("."),n.namespace_re=n.namespace?new RegExp("(^|\\.)"+a.join("\\.(?:.*\\.)?")+"(\\.|$)"):null,d=u.indexOf(":")<0?"on"+u:"";if(!i){f=s.cache;for(c in f)f[c].events&&f[c].events[u]&&s.event.trigger(n,r,f[c].handle.elem,!0);return}n.result=t,n.target||(n.target=i),r=r!=null?s.makeArray(r):[],r.unshift(n),v=s.event.special[u]||{};if(v.trigger&&v.trigger.apply(i,r)===!1)return;g=[[i,v.bindType||u]];if(!o&&!v.noBubble&&!s.isWindow(i)){y=v.delegateType||u,h=O.test(y+u)?i:i.parentNode,p=null;for(;h;h=h.parentNode)g.push([h,y]),p=h;p&&p===i.ownerDocument&&g.push([p.defaultView||p.parentWindow||e,y])}for(c=0;c<g.length&&!n.isPropagationStopped();c++)h=g[c][0],n.type=g[c][1],m=(s._data(h,"events")||{})[n.type]&&s._data(h,"handle"),m&&m.apply(h,r),m=d&&h[d],m&&s.acceptData(h)&&m.apply(h,r)===!1&&n.preventDefault();return n.type=u,!o&&!n.isDefaultPrevented()&&(!v._default||v._default.apply(i.ownerDocument,r)===!1)&&(u!=="click"||!s.nodeName(i,"a"))&&s.acceptData(i)&&d&&i[u]&&(u!=="focus"&&u!=="blur"||n.target.offsetWidth!==0)&&!s.isWindow(i)&&(p=i[d],p&&(i[d]=null),s.event.triggered=u,i[u](),s.event.triggered=t,p&&(i[d]=p)),n.result}return},dispatch:function(n){n=s.event.fix(n||e.event);var r=(s._data(this,"events")||{})[n.type]||[],i=r.delegateCount,o=[].slice.call(arguments,0),u=!n.exclusive&&!n.namespace,a=s.event.special[n.type]||{},f=[],l,c,h,p,d,v,m,g,y,b,w;o[0]=n,n.delegateTarget=this;if(a.preDispatch&&
a.preDispatch.call(this,n)===!1)return;if(i&&(!n.button||n.type!=="click")){p=s(this),p.context=this.ownerDocument||this;for(h=n.target;h!=this;h=h.parentNode||this)if(h.disabled!==!0){v={},g=[],p[0]=h;for(l=0;l<i;l++)y=r[l],b=y.selector,v[b]===t&&(v[b]=y.quick?D(h,y.quick):p.is(b)),v[b]&&g.push(y);g.length&&f.push({elem:h,matches:g})}}r.length>i&&f.push({elem:this,matches:r.slice(i)});for(l=0;l<f.length&&!n.isPropagationStopped();l++){m=f[l],n.currentTarget=m.elem;for(c=0;c<m.matches.length&&!n.isImmediatePropagationStopped();c++){y=m.matches[c];if(u||!n.namespace&&!y.namespace||n.namespace_re&&n.namespace_re.test(y.namespace))n.data=y.data,n.handleObj=y,d=((s.event.special[y.origType]||{}).handle||y.handler).apply(m.elem,o),d!==t&&(n.result=d,d===!1&&(n.preventDefault(),n.stopPropagation()))}}return a.postDispatch&&a.postDispatch.call(this,n),n.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return e.which==null&&(e.which=t.charCode!=null?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,r){var i,s,o,u=r.button,a=r.fromElement;return e.pageX==null&&r.clientX!=null&&(i=e.target.ownerDocument||n,s=i.documentElement,o=i.body,e.pageX=r.clientX+(s&&s.scrollLeft||o&&o.scrollLeft||0)-(s&&s.clientLeft||o&&o.clientLeft||0),e.pageY=r.clientY+
(s&&s.scrollTop||o&&o.scrollTop||0)-(s&&s.clientTop||o&&o.clientTop||0)),!e.relatedTarget&&a&&(e.relatedTarget=a===e.target?r.toElement:a),!e.which&&u!==t&&(e.which=u&1?1:u&2?3:u&4?2:0),e}},fix:function(e){if(e[s.expando])return e;var r,i,o=e,u=s.event.fixHooks[e.type]||{},a=u.props?this.props.concat(u.props):this.props;e=s.Event(o);for(r=a.length;r;)i=a[--r],e[i]=o[i];return e.target||(e.target=o.srcElement||n),e.target.nodeType===3&&(e.target=e.target.parentNode),e.metaKey===t&&(e.metaKey=e.ctrlKey),u.filter?u.filter(e,o):e},special:{ready:{setup:s.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(e,t,n){s.isWindow(this)&&(this.onbeforeunload=n)},teardown:function(e,t){this.onbeforeunload===t&&(this.onbeforeunload=null)}}},simulate:function(e,t,n,r){var i=s.extend(new s.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?s.event.trigger(i,null,t):s.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},s.event.handle=s.event.dispatch,s.removeEvent=n.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){e.detachEvent&&e.detachEvent("on"+t,n)},s.Event=function(e,t){if(!(this instanceof s.Event))return new s.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?B:H):this.type=e,t&&s.extend(this,t),this.timeStamp=e&&e.timeStamp||s.now(),this[s.expando]=!0},s.Event.prototype={preventDefault:function(){this.isDefaultPrevented=B;var e=
this.originalEvent;if(!e)return;e.preventDefault?e.preventDefault():e.returnValue=!1},stopPropagation:function(){this.isPropagationStopped=B;var e=this.originalEvent;if(!e)return;e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=B,this.stopPropagation()},isDefaultPrevented:H,isPropagationStopped:H,isImmediatePropagationStopped:H},s.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){s.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n=this,r=e.relatedTarget,i=e.handleObj,o=i.selector,u;if(!r||r!==n&&!s.contains(n,r))e.type=i.origType,u=i.handler.apply(this,arguments),e.type=t;return u}}}),s.support.submitBubbles||(s.event.special.submit={setup:function(){if(s.nodeName(this,"form"))return!1;s.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=s.nodeName(n,"input")||s.nodeName(n,"button")?n.form:t;r&&!r._submit_attached&&(s.event.add(r,"submit._submit",function(e){e._submit_bubble=!0}),r._submit_attached=!0)})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&s.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){if(s.nodeName(this,"form"))return!1;s.event.remove(this,"._submit")}}),s.support.changeBubbles||(s.event.special.change={setup:function(){if(N.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")s.event.add(this,"propertychange._change",function(e){e.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),s.event.add(this,"click._change",function(
e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1,s.event.simulate("change",this,e,!0))});return!1}s.event.add(this,"beforeactivate._change",function(e){var t=e.target;N.test(t.nodeName)&&!t._change_attached&&(s.event.add(t,"change._change",function(e){this.parentNode&&!e.isSimulated&&!e.isTrigger&&s.event.simulate("change",this.parentNode,e,!0)}),t._change_attached=!0)})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||t.type!=="radio"&&t.type!=="checkbox")return e.handleObj.handler.apply(this,arguments)},teardown:function(){return s.event.remove(this,"._change"),N.test(this.nodeName)}}),s.support.focusinBubbles||s.each({focus:"focusin",blur:"focusout"},function(e,t){var r=0,i=function(e){s.event.simulate(t,e.target,s.event.fix(e),!0)};s.event.special[t]={setup:function(){r++===0&&n.addEventListener(e,i,!0)},teardown:function(){--r===0&&n.removeEventListener(e,i,!0)}}}),s.fn.extend({on:function(e,n,r,i,o){var u,a;if(typeof e=="object"){typeof n!="string"&&(r=r||n,n=t);for(a in e)this.on(a,n,r,e[a],o);return this}r==null&&i==null?(i=n,r=n=t):i==null&&(typeof n=="string"?(i=r,r=t):(i=r,r=n,n=t));if(i===!1)i=H;else if(!i)return this;return o===1&&(u=i,i=function(e){return s().off(e),u.apply(this,arguments)},i.guid=u.guid||(u.guid=s.guid++)),this.each(function(){s.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){if(e&&e.preventDefault&&e.handleObj){var i=e.handleObj;return s(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this}if(typeof e=="object"){
for(var o in e)this.off(o,n,e[o]);return this}if(n===!1||typeof n=="function")r=n,n=t;return r===!1&&(r=H),this.each(function(){s.event.remove(this,e,r,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},live:function(e,t,n){return s(this.context).on(e,this.selector,t,n),this},die:function(e,t){return s(this.context).off(e,this.selector||"**",t),this},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return arguments.length==1?this.off(e,"**"):this.off(t,e,n)},trigger:function(e,t){return this.each(function(){s.event.trigger(e,t,this)})},triggerHandler:function(e,t){if(this[0])return s.event.trigger(e,t,this[0],!0)},toggle:function(e){var t=arguments,n=e.guid||s.guid++,r=0,i=function(n){var i=(s._data(this,"lastToggle"+e.guid)||0)%r;return s._data(this,"lastToggle"+e.guid,i+1),n.preventDefault(),t[i].apply(this,arguments)||!1};i.guid=n;while(r<t.length)t[r++].guid=n;return this.click(i)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),s.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){s.fn[t]=function(e,n){return n==null&&(n=e,e=null),arguments.length>0?this.on(t,null,e,n):this.trigger(t)},s.attrFn&&(s.attrFn[t]=!0),L.test(t)&&(s.event.fixHooks[t]=s.event.keyHooks),A.test(t)&&(s.event.fixHooks[t]=s.event.mouseHooks)}),function(){function S(e,t,n,i,s,o){for(var u=0,a=i.length;u<a;u++){var f=i[u];if(f
){var l=!1;f=f[e];while(f){if(f[r]===n){l=i[f.sizset];break}f.nodeType===1&&!o&&(f[r]=n,f.sizset=u);if(f.nodeName.toLowerCase()===t){l=f;break}f=f[e]}i[u]=l}}}function x(e,t,n,i,s,o){for(var u=0,a=i.length;u<a;u++){var f=i[u];if(f){var l=!1;f=f[e];while(f){if(f[r]===n){l=i[f.sizset];break}if(f.nodeType===1){o||(f[r]=n,f.sizset=u);if(typeof t!="string"){if(f===t){l=!0;break}}else if(h.filter(t,[f]).length>0){l=f;break}}f=f[e]}i[u]=l}}}var e=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,r="sizcache"+(Math.random()+"").replace(".",""),i=0,o=Object.prototype.toString,u=!1,a=!0,f=/\\/g,l=/\r\n/g,c=/\W/;[0,0].sort(function(){return a=!1,0});var h=function(t,r,i,s){i=i||[],r=r||n;var u=r;if(r.nodeType!==1&&r.nodeType!==9)return[];if(!t||typeof t!="string")return i;var a,f,l,c,p,m,g,b,w=!0,E=h.isXML(r),S=[],x=t;do{e.exec(""),a=e.exec(x);if(a){x=a[3],S.push(a[1]);if(a[2]){c=a[3];break}}}while(a);if(S.length>1&&v.exec(t))if(S.length===2&&d.relative[S[0]])f=T(S[0]+S[1],r,s);else{f=d.relative[S[0]]?[r]:h(S.shift(),r);while(S.length)t=S.shift(),d.relative[t]&&(t+=S.shift()),f=T(t,f,s)}else{!s&&S.length>1&&r.nodeType===9&&!E&&d.match.ID.test(S[0])&&!d.match.ID.test(S[S.length-1])&&(p=h.find(S.shift(),r,E),r=p.expr?h.filter(p.expr,p.set)[0]:p.set[0]);if(r){p=s?{expr:S.pop(),set:y(s)}:h.find(S.pop(),S.length!==1||S[0]!=="~"&&S[0]!=="+"||!r.parentNode?r:r.parentNode,E),f=p.expr?h.filter(p.expr,p.set):p.set,S.length>0?l=y(f):w=!1;while(S.length)m=S.pop(),g=m,d.relative[m]?g=S.pop():m="",g==null&&(g=r),d.relative
[m](l,g,E)}else l=S=[]}l||(l=f),l||h.error(m||t);if(o.call(l)==="[object Array]")if(!w)i.push.apply(i,l);else if(r&&r.nodeType===1)for(b=0;l[b]!=null;b++)l[b]&&(l[b]===!0||l[b].nodeType===1&&h.contains(r,l[b]))&&i.push(f[b]);else for(b=0;l[b]!=null;b++)l[b]&&l[b].nodeType===1&&i.push(f[b]);else y(l,i);return c&&(h(c,u,i,s),h.uniqueSort(i)),i};h.uniqueSort=function(e){if(w){u=a,e.sort(w);if(u)for(var t=1;t<e.length;t++)e[t]===e[t-1]&&e.splice(t--,1)}return e},h.matches=function(e,t){return h(e,null,null,t)},h.matchesSelector=function(e,t){return h(t,null,null,[e]).length>0},h.find=function(e,t,n){var r,i,s,o,u,a;if(!e)return[];for(i=0,s=d.order.length;i<s;i++){u=d.order[i];if(o=d.leftMatch[u].exec(e)){a=o[1],o.splice(1,1);if(a.substr(a.length-1)!=="\\"){o[1]=(o[1]||"").replace(f,""),r=d.find[u](o,t,n);if(r!=null){e=e.replace(d.match[u],"");break}}}}return r||(r=typeof t.getElementsByTagName!="undefined"?t.getElementsByTagName("*"):[]),{set:r,expr:e}},h.filter=function(e,n,r,i){var s,o,u,a,f,l,c,p,v,m=e,g=[],y=n,b=n&&n[0]&&h.isXML(n[0]);while(e&&n.length){for(u in d.filter)if((s=d.leftMatch[u].exec(e))!=null&&s[2]){l=d.filter[u],c=s[1],o=!1,s.splice(1,1);if(c.substr(c.length-1)==="\\")continue;y===g&&(g=[]);if(d.preFilter[u]){s=d.preFilter[u](s,y,r,g,i,b);if(!s)o=a=!0;else if(s===!0)continue}if(s)for(p=0;(f=y[p])!=null;p++)f&&(a=l(f,s,p,y),v=i^a,r&&a!=null?v?o=!0:y[p]=!1:v&&(g.push(f),o=!0));if(a!==t){r||(y=g),e=e.replace(d.match[u],"");if(!o)return[];break}}if(e===m){if(o!=null)break;h.error(e)}m=e}return y},h.error=function(e){throw new Error("Syntax error, unrecognized expression: "+
e)};var p=h.getText=function(e){var t,n,r=e.nodeType,i="";if(r){if(r===1||r===9||r===11){if(typeof e.textContent=="string")return e.textContent;if(typeof e.innerText=="string")return e.innerText.replace(l,"");for(e=e.firstChild;e;e=e.nextSibling)i+=p(e)}else if(r===3||r===4)return e.nodeValue}else for(t=0;n=e[t];t++)n.nodeType!==8&&(i+=p(n));return i},d=h.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(e){return e.getAttribute("href")},type:function(e){return e.getAttribute("type")}},relative:{"+":function(e,t){var n=typeof t=="string",r=n&&!c.test(t),i=n&&!r;r&&(t=t.toLowerCase());for(var s=0,o=e.length,u;s<o;s++)if(u=e[s]){while((u=u.previousSibling)&&u.nodeType!==1);e[s]=i||u&&u.nodeName.toLowerCase()===t?u||!1:u===t}i&&h.filter(t,e,!0)},">":function(e,t){var n,r=typeof t=="string",i=0,s=e.length;if(r&&!c.test(t)){t=t.toLowerCase();for(;i<s;i++){n=e[i];if(n){var o=n.parentNode;e[i]=o.nodeName.toLowerCase()===t?o:!1}}}else{for(;i<s;i++)n=e[i],n&&(e[
i]=r?n.parentNode:n.parentNode===t);r&&h.filter(t,e,!0)}},"":function(e,t,n){var r,s=i++,o=x;typeof t=="string"&&!c.test(t)&&(t=t.toLowerCase(),r=t,o=S),o("parentNode",t,s,e,r,n)},"~":function(e,t,n){var r,s=i++,o=x;typeof t=="string"&&!c.test(t)&&(t=t.toLowerCase(),r=t,o=S),o("previousSibling",t,s,e,r,n)}},find:{ID:function(e,t,n){if(typeof t.getElementById!="undefined"&&!n){var r=t.getElementById(e[1]);return r&&r.parentNode?[r]:[]}},NAME:function(e,t){if(typeof t.getElementsByName!="undefined"){var n=[],r=t.getElementsByName(e[1]);for(var i=0,s=r.length;i<s;i++)r[i].getAttribute("name")===e[1]&&n.push(r[i]);return n.length===0?null:n}},TAG:function(e,t){if(typeof t.getElementsByTagName!="undefined")return t.getElementsByTagName(e[1])}},preFilter:{CLASS:function(e,t,n,r,i,s){e=" "+e[1].replace(f,"")+" ";if(s)return e;for(var o=0,u;(u=t[o])!=null;o++)u&&(i^(u.className&&(" "+u.className+" ").replace(/[\t\n\r]/g," ").indexOf(e)>=0)?n||r.push(u):n&&(t[o]=!1));return!1},ID:function(e){return e[1].replace(f,"")},TAG:function(e,t){return e[1].replace(f,"").toLowerCase()},CHILD:function(e){if(e[1]==="nth"){e[2]||h.error(e[0]),e[2]=e[2].replace(/^\+|\s*/g,"");var t=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(e[2]==="even"&&"2n"||e[2]==="odd"&&"2n+1"||!/\D/.test(e[2])&&"0n+"+e[2]||e[2]);e[2]=t[1]+(t[2]||1)-0,e[3]=t[3]-0}else e[2]&&h.error(e[0]);return e[0]=i++,e},ATTR:function(e,t,n,r,i,s){var o=e[1]=e[1].replace(f,"");return!s&&d.attrMap[o]&&(e[1]=d.attrMap[o]),e[4]=(e[4]||e[5]||"").replace(f,""),e[2]==="~="&&(e[4]=" "+e[4]+" "),e},PSEUDO:function(t,n,r,i,s){if(t[1]==="not"){if(!((e.exec(t[3
])||"").length>1||/^\w/.test(t[3]))){var o=h.filter(t[3],n,r,!0^s);return r||i.push.apply(i,o),!1}t[3]=h(t[3],null,null,n)}else if(d.match.POS.test(t[0])||d.match.CHILD.test(t[0]))return!0;return t},POS:function(e){return e.unshift(!0),e}},filters:{enabled:function(e){return e.disabled===!1&&e.type!=="hidden"},disabled:function(e){return e.disabled===!0},checked:function(e){return e.checked===!0},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},parent:function(e){return!!e.firstChild},empty:function(e){return!e.firstChild},has:function(e,t,n){return!!h(n[3],e).length},header:function(e){return/h\d/i.test(e.nodeName)},text:function(e){var t=e.getAttribute("type"),n=e.type;return e.nodeName.toLowerCase()==="input"&&"text"===n&&(t===n||t===null)},radio:function(e){return e.nodeName.toLowerCase()==="input"&&"radio"===e.type},checkbox:function(e){return e.nodeName.toLowerCase()==="input"&&"checkbox"===e.type},file:function(e){return e.nodeName.toLowerCase()==="input"&&"file"===e.type},password:function(e){return e.nodeName.toLowerCase()==="input"&&"password"===e.type},submit:function(e){var t=e.nodeName.toLowerCase();return(t==="input"||t==="button")&&"submit"===e.type},image:function(e){return e.nodeName.toLowerCase()==="input"&&"image"===e.type},reset:function(e){var t=e.nodeName.toLowerCase();return(t==="input"||t==="button")&&"reset"===e.type},button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&"button"===e.type||t==="button"},input:function(e){return/input|select|textarea|button/i.test(e.nodeName)},focus:function(e){return e===
e.ownerDocument.activeElement}},setFilters:{first:function(e,t){return t===0},last:function(e,t,n,r){return t===r.length-1},even:function(e,t){return t%2===0},odd:function(e,t){return t%2===1},lt:function(e,t,n){return t<n[3]-0},gt:function(e,t,n){return t>n[3]-0},nth:function(e,t,n){return n[3]-0===t},eq:function(e,t,n){return n[3]-0===t}},filter:{PSEUDO:function(e,t,n,r){var i=t[1],s=d.filters[i];if(s)return s(e,n,t,r);if(i==="contains")return(e.textContent||e.innerText||p([e])||"").indexOf(t[3])>=0;if(i==="not"){var o=t[3];for(var u=0,a=o.length;u<a;u++)if(o[u]===e)return!1;return!0}h.error(i)},CHILD:function(e,t){var n,i,s,o,u,a,f,l=t[1],c=e;switch(l){case"only":case"first":while(c=c.previousSibling)if(c.nodeType===1)return!1;if(l==="first")return!0;c=e;case"last":while(c=c.nextSibling)if(c.nodeType===1)return!1;return!0;case"nth":n=t[2],i=t[3];if(n===1&&i===0)return!0;s=t[0],o=e.parentNode;if(o&&(o[r]!==s||!e.nodeIndex)){a=0;for(c=o.firstChild;c;c=c.nextSibling)c.nodeType===1&&(c.nodeIndex=++a);o[r]=s}return f=e.nodeIndex-i,n===0?f===0:f%n===0&&f/n>=0}},ID:function(e,t){return e.nodeType===1&&e.getAttribute("id")===t},TAG:function(e,t){return t==="*"&&e.nodeType===1||!!e.nodeName&&e.nodeName.toLowerCase()===t},CLASS:function(e,t){return(" "+(e.className||e.getAttribute("class"))+" ").indexOf(t)>-1},ATTR:function(e,t){var n=t[1],r=h.attr?h.attr(e,n):d.attrHandle[n]?d.attrHandle[n](e):e[n]!=null?e[n]:e.getAttribute(n),i=r+"",s=t[2],o=t[4];return r==null?s==="!=":!s&&h.attr?r!=null:s==="="?i===o:s==="*="?i.indexOf(o)>=0:s==="~="?(" "+i+" ").indexOf(o)>=0:o?s==="!="?i!==o:s==="^="?
i.indexOf(o)===0:s==="$="?i.substr(i.length-o.length)===o:s==="|="?i===o||i.substr(0,o.length+1)===o+"-":!1:i&&r!==!1},POS:function(e,t,n,r){var i=t[2],s=d.setFilters[i];if(s)return s(e,n,t,r)}}},v=d.match.POS,m=function(e,t){return"\\"+(t-0+1)};for(var g in d.match)d.match[g]=new RegExp(d.match[g].source+/(?![^\[]*\])(?![^\(]*\))/.source),d.leftMatch[g]=new RegExp(/(^(?:.|\r|\n)*?)/.source+d.match[g].source.replace(/\\(\d+)/g,m));d.match.globalPOS=v;var y=function(e,t){return e=Array.prototype.slice.call(e,0),t?(t.push.apply(t,e),t):e};try{Array.prototype.slice.call(n.documentElement.childNodes,0)[0].nodeType}catch(b){y=function(e,t){var n=0,r=t||[];if(o.call(e)==="[object Array]")Array.prototype.push.apply(r,e);else if(typeof e.length=="number")for(var i=e.length;n<i;n++)r.push(e[n]);else for(;e[n];n++)r.push(e[n]);return r}}var w,E;n.documentElement.compareDocumentPosition?w=function(e,t){return e===t?(u=!0,0):!e.compareDocumentPosition||!t.compareDocumentPosition?e.compareDocumentPosition?-1:1:e.compareDocumentPosition(t)&4?-1:1}:(w=function(e,t){if(e===t)return u=!0,0;if(e.sourceIndex&&t.sourceIndex)return e.sourceIndex-t.sourceIndex;var n,r,i=[],s=[],o=e.parentNode,a=t.parentNode,f=o;if(o===a)return E(e,t);if(!o)return-1;if(!a)return 1;while(f)i.unshift(f),f=f.parentNode;f=a;while(f)s.unshift(f),f=f.parentNode;n=i.length,r=s.length;for(var l=0;l<n&&l<r;l++)if(i[l]!==s[l])return E(i[l],s[l]);return l===n?E(e,s[l],-1):E(i[l],t,1)},E=function(e,t,n){if(e===t)return n;var r=e.nextSibling;while(r){if(r===t)return-1;r=r.nextSibling}return 1}),function(){var e=n.createElement
("div"),r="script"+(new Date).getTime(),i=n.documentElement;e.innerHTML="<a name='"+r+"'/>",i.insertBefore(e,i.firstChild),n.getElementById(r)&&(d.find.ID=function(e,n,r){if(typeof n.getElementById!="undefined"&&!r){var i=n.getElementById(e[1]);return i?i.id===e[1]||typeof i.getAttributeNode!="undefined"&&i.getAttributeNode("id").nodeValue===e[1]?[i]:t:[]}},d.filter.ID=function(e,t){var n=typeof e.getAttributeNode!="undefined"&&e.getAttributeNode("id");return e.nodeType===1&&n&&n.nodeValue===t}),i.removeChild(e),i=e=null}(),function(){var e=n.createElement("div");e.appendChild(n.createComment("")),e.getElementsByTagName("*").length>0&&(d.find.TAG=function(e,t){var n=t.getElementsByTagName(e[1]);if(e[1]==="*"){var r=[];for(var i=0;n[i];i++)n[i].nodeType===1&&r.push(n[i]);n=r}return n}),e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!="undefined"&&e.firstChild.getAttribute("href")!=="#"&&(d.attrHandle.href=function(e){return e.getAttribute("href",2)}),e=null}(),n.querySelectorAll&&function(){var e=h,t=n.createElement("div"),r="__sizzle__";t.innerHTML="<p class='TEST'></p>";if(t.querySelectorAll&&t.querySelectorAll(".TEST").length===0)return;h=function(t,i,s,o){i=i||n;if(!o&&!h.isXML(i)){var u=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(t);if(u&&(i.nodeType===1||i.nodeType===9)){if(u[1])return y(i.getElementsByTagName(t),s);if(u[2]&&d.find.CLASS&&i.getElementsByClassName)return y(i.getElementsByClassName(u[2]),s)}if(i.nodeType===9){if(t==="body"&&i.body)return y([i.body],s);if(u&&u[3]){var a=i.getElementById(u[3]);if(!a||!a.parentNode)return y([],s);
if(a.id===u[3])return y([a],s)}try{return y(i.querySelectorAll(t),s)}catch(f){}}else if(i.nodeType===1&&i.nodeName.toLowerCase()!=="object"){var l=i,c=i.getAttribute("id"),p=c||r,v=i.parentNode,m=/^\s*[+~]/.test(t);c?p=p.replace(/'/g,"\\$&"):i.setAttribute("id",p),m&&v&&(i=i.parentNode);try{if(!m||v)return y(i.querySelectorAll("[id='"+p+"'] "+t),s)}catch(g){}finally{c||l.removeAttribute("id")}}}return e(t,i,s,o)};for(var i in e)h[i]=e[i];t=null}(),function(){var e=n.documentElement,t=e.matchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.msMatchesSelector;if(t){var r=!t.call(n.createElement("div"),"div"),i=!1;try{t.call(n.documentElement,"[test!='']:sizzle")}catch(s){i=!0}h.matchesSelector=function(e,n){n=n.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!h.isXML(e))try{if(i||!d.match.PSEUDO.test(n)&&!/!=/.test(n)){var s=t.call(e,n);if(s||!r||e.document&&e.document.nodeType!==11)return s}}catch(o){}return h(n,null,null,[e]).length>0}}}(),function(){var e=n.createElement("div");e.innerHTML="<div class='test e'></div><div class='test'></div>";if(!e.getElementsByClassName||e.getElementsByClassName("e").length===0)return;e.lastChild.className="e";if(e.getElementsByClassName("e").length===1)return;d.order.splice(1,0,"CLASS"),d.find.CLASS=function(e,t,n){if(typeof t.getElementsByClassName!="undefined"&&!n)return t.getElementsByClassName(e[1])},e=null}(),n.documentElement.contains?h.contains=function(e,t){return e!==t&&(e.contains?e.contains(t):!0)}:n.documentElement.compareDocumentPosition?h.contains=function(e,t){return!!(e.compareDocumentPosition(t)&16)}:h.contains=function(
){return!1},h.isXML=function(e){var t=(e?e.ownerDocument||e:0).documentElement;return t?t.nodeName!=="HTML":!1};var T=function(e,t,n){var r,i=[],s="",o=t.nodeType?[t]:t;while(r=d.match.PSEUDO.exec(e))s+=r[0],e=e.replace(d.match.PSEUDO,"");e=d.relative[e]?e+"*":e;for(var u=0,a=o.length;u<a;u++)h(e,o[u],i,n);return h.filter(s,i)};h.attr=s.attr,h.selectors.attrMap={},s.find=h,s.expr=h.selectors,s.expr[":"]=s.expr.filters,s.unique=h.uniqueSort,s.text=h.getText,s.isXMLDoc=h.isXML,s.contains=h.contains}();var j=/Until$/,F=/^(?:parents|prevUntil|prevAll)/,I=/,/,q=/^.[^:#\[\.,]*$/,R=Array.prototype.slice,U=s.expr.match.globalPOS,z={children:!0,contents:!0,next:!0,prev:!0};s.fn.extend({find:function(e){var t=this,n,r;if(typeof e!="string")return s(e).filter(function(){for(n=0,r=t.length;n<r;n++)if(s.contains(t[n],this))return!0});var i=this.pushStack("","find",e),o,u,a;for(n=0,r=this.length;n<r;n++){o=i.length,s.find(e,this[n],i);if(n>0)for(u=o;u<i.length;u++)for(a=0;a<o;a++)if(i[a]===i[u]){i.splice(u--,1);break}}return i},has:function(e){var t=s(e);return this.filter(function(){for(var e=0,n=t.length;e<n;e++)if(s.contains(this,t[e]))return!0})},not:function(e){return this.pushStack(X(this,e,!1),"not",e)},filter:function(e){return this.pushStack(X(this,e,!0),"filter",e)},is:function(e){return!!e&&(typeof e=="string"?U.test(e)?s(e,this.context).index(this[0])>=0:s.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var n=[],r,i,o=this[0];if(s.isArray(e)){var u=1;while(o&&o.ownerDocument&&o!==t){for(r=0;r<e.length;r++)s(o).is(e[r])&&n.push({selector:e[r],elem:o,level
:u});o=o.parentNode,u++}return n}var a=U.test(e)||typeof e!="string"?s(e,t||this.context):0;for(r=0,i=this.length;r<i;r++){o=this[r];while(o){if(a?a.index(o)>-1:s.find.matchesSelector(o,e)){n.push(o);break}o=o.parentNode;if(!o||!o.ownerDocument||o===t||o.nodeType===11)break}}return n=n.length>1?s.unique(n):n,this.pushStack(n,"closest",e)},index:function(e){return e?typeof e=="string"?s.inArray(this[0],s(e)):s.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(e,t){var n=typeof e=="string"?s(e,t):s.makeArray(e&&e.nodeType?[e]:e),r=s.merge(this.get(),n);return this.pushStack(W(n[0])||W(r[0])?r:s.unique(r))},andSelf:function(){return this.add(this.prevObject)}}),s.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return s.dir(e,"parentNode")},parentsUntil:function(e,t,n){return s.dir(e,"parentNode",n)},next:function(e){return s.nth(e,2,"nextSibling")},prev:function(e){return s.nth(e,2,"previousSibling")},nextAll:function(e){return s.dir(e,"nextSibling")},prevAll:function(e){return s.dir(e,"previousSibling")},nextUntil:function(e,t,n){return s.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return s.dir(e,"previousSibling",n)},siblings:function(e){return s.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return s.sibling(e.firstChild)},contents:function(e){return s.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:s.makeArray(e.childNodes)}},function(e,t){s.fn[e]=function(n,r){var i=s.map(this,t,n);return j.test(e)||(r=n),r&&typeof r=="string"&&(i=s.filter
(r,i)),i=this.length>1&&!z[e]?s.unique(i):i,(this.length>1||I.test(r))&&F.test(e)&&(i=i.reverse()),this.pushStack(i,e,R.call(arguments).join(","))}}),s.extend({filter:function(e,t,n){return n&&(e=":not("+e+")"),t.length===1?s.find.matchesSelector(t[0],e)?[t[0]]:[]:s.find.matches(e,t)},dir:function(e,n,r){var i=[],o=e[n];while(o&&o.nodeType!==9&&(r===t||o.nodeType!==1||!s(o).is(r)))o.nodeType===1&&i.push(o),o=o[n];return i},nth:function(e,t,n,r){t=t||1;var i=0;for(;e;e=e[n])if(e.nodeType===1&&++i===t)break;return e},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)e.nodeType===1&&e!==t&&n.push(e);return n}});var $="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",J=/ jQuery\d+="(?:\d+|null)"/g,K=/^\s+/,Q=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,G=/<([\w:]+)/,Y=/<tbody/i,Z=/<|&#?\w+;/,et=/<(?:script|style)/i,tt=/<(?:script|object|embed|option|style)/i,nt=new RegExp("<(?:"+$+")[\\s/>]","i"),rt=/checked\s*(?:[^=]|=\s*.checked.)/i,it=/\/(java|ecma)script/i,st=/^\s*<!(?:\[CDATA\[|\-\-)/,ot={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},ut=V(n);ot.optgroup=ot.option,ot.tbody=ot.tfoot=ot.colgroup=ot.caption=ot.thead,ot.th=ot.td,s.support.htmlSerialize||(ot._default=
[1,"div<div>","</div>"]),s.fn.extend({text:function(e){return s.access(this,function(e){return e===t?s.text(this):this.empty().append((this[0]&&this[0].ownerDocument||n).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(s.isFunction(e))return this.each(function(t){s(this).wrapAll(e.call(this,t))});if(this[0]){var t=s(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&e.firstChild.nodeType===1)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return s.isFunction(e)?this.each(function(t){s(this).wrapInner(e.call(this,t))}):this.each(function(){var t=s(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=s.isFunction(e);return this.each(function(n){s(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){s.nodeName(this,"body")||s(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){this.nodeType===1&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){this.nodeType===1&&this.insertBefore(e,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this)});if(arguments.length){var e=s.clean(arguments);return e.push.apply(e,this.toArray()),this.pushStack(e,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this.nextSibling)
});if(arguments.length){var e=this.pushStack(this,"after",arguments);return e.push.apply(e,s.clean(arguments)),e}},remove:function(e,t){for(var n=0,r;(r=this[n])!=null;n++)if(!e||s.filter(e,[r]).length)!t&&r.nodeType===1&&(s.cleanData(r.getElementsByTagName("*")),s.cleanData([r])),r.parentNode&&r.parentNode.removeChild(r);return this},empty:function(){for(var e=0,t;(t=this[e])!=null;e++){t.nodeType===1&&s.cleanData(t.getElementsByTagName("*"));while(t.firstChild)t.removeChild(t.firstChild)}return this},clone:function(e,t){return e=e==null?!1:e,t=t==null?e:t,this.map(function(){return s.clone(this,e,t)})},html:function(e){return s.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t)return n.nodeType===1?n.innerHTML.replace(J,""):null;if(typeof e=="string"&&!et.test(e)&&(s.support.leadingWhitespace||!K.test(e))&&!ot[(G.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(Q,"<$1></$2>");try{for(;r<i;r++)n=this[r]||{},n.nodeType===1&&(s.cleanData(n.getElementsByTagName("*")),n.innerHTML=e);n=0}catch(o){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){return this[0]&&this[0].parentNode?s.isFunction(e)?this.each(function(t){var n=s(this),r=n.html();n.replaceWith(e.call(this,t,r))}):(typeof e!="string"&&(e=s(e).detach()),this.each(function(){var t=this.nextSibling,n=this.parentNode;s(this).remove(),t?s(t).before(e):s(n).append(e)})):this.length?this.pushStack(s(s.isFunction(e)?e():e),"replaceWith",e):this},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,r){var i,o,u,a,f=e[0],l=[];if(!s.support.checkClone&&arguments.length===3&&typeof 
f=="string"&&rt.test(f))return this.each(function(){s(this).domManip(e,n,r,!0)});if(s.isFunction(f))return this.each(function(i){var o=s(this);e[0]=f.call(this,i,n?o.html():t),o.domManip(e,n,r)});if(this[0]){a=f&&f.parentNode,s.support.parentNode&&a&&a.nodeType===11&&a.childNodes.length===this.length?i={fragment:a}:i=s.buildFragment(e,this,l),u=i.fragment,u.childNodes.length===1?o=u=u.firstChild:o=u.firstChild;if(o){n=n&&s.nodeName(o,"tr");for(var c=0,h=this.length,p=h-1;c<h;c++)r.call(n?at(this[c],o):this[c],i.cacheable||h>1&&c<p?s.clone(u,!0,!0):u)}l.length&&s.each(l,function(e,t){t.src?s.ajax({type:"GET",global:!1,url:t.src,async:!1,dataType:"script"}):s.globalEval((t.text||t.textContent||t.innerHTML||"").replace(st,"/*$0*/")),t.parentNode&&t.parentNode.removeChild(t)})}return this}}),s.buildFragment=function(e,t,r){var i,o,u,a,f=e[0];return t&&t[0]&&(a=t[0].ownerDocument||t[0]),a.createDocumentFragment||(a=n),e.length===1&&typeof f=="string"&&f.length<512&&a===n&&f.charAt(0)==="<"&&!tt.test(f)&&(s.support.checkClone||!rt.test(f))&&(s.support.html5Clone||!nt.test(f))&&(o=!0,u=s.fragments[f],u&&u!==1&&(i=u)),i||(i=a.createDocumentFragment(),s.clean(e,a,i,r)),o&&(s.fragments[f]=u?i:1),{fragment:i,cacheable:o}},s.fragments={},s.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){s.fn[e]=function(n){var r=[],i=s(n),o=this.length===1&&this[0].parentNode;if(o&&o.nodeType===11&&o.childNodes.length===1&&i.length===1)return i[t](this[0]),this;for(var u=0,a=i.length;u<a;u++){var f=(u>0?this.clone(!0):this).get
();s(i[u])[t](f),r=r.concat(f)}return this.pushStack(r,e,i.selector)}}),s.extend({clone:function(e,t,n){var r,i,o,u=s.support.html5Clone||s.isXMLDoc(e)||!nt.test("<"+e.nodeName+">")?e.cloneNode(!0):dt(e);if((!s.support.noCloneEvent||!s.support.noCloneChecked)&&(e.nodeType===1||e.nodeType===11)&&!s.isXMLDoc(e)){lt(e,u),r=ct(e),i=ct(u);for(o=0;r[o];++o)i[o]&&lt(r[o],i[o])}if(t){ft(e,u);if(n){r=ct(e),i=ct(u);for(o=0;r[o];++o)ft(r[o],i[o])}}return r=i=null,u},clean:function(e,t,r,i){var o,u,a,f=[];t=t||n,typeof t.createElement=="undefined"&&(t=t.ownerDocument||t[0]&&t[0].ownerDocument||n);for(var l=0,c;(c=e[l])!=null;l++){typeof c=="number"&&(c+="");if(!c)continue;if(typeof c=="string")if(!Z.test(c))c=t.createTextNode(c);else{c=c.replace(Q,"<$1></$2>");var h=(G.exec(c)||["",""])[1].toLowerCase(),p=ot[h]||ot._default,d=p[0],v=t.createElement("div"),m=ut.childNodes,g;t===n?ut.appendChild(v):V(t).appendChild(v),v.innerHTML=p[1]+c+p[2];while(d--)v=v.lastChild;if(!s.support.tbody){var y=Y.test(c),b=h==="table"&&!y?v.firstChild&&v.firstChild.childNodes:p[1]==="<table>"&&!y?v.childNodes:[];for(a=b.length-1;a>=0;--a)s.nodeName(b[a],"tbody")&&!b[a].childNodes.length&&b[a].parentNode.removeChild(b[a])}!s.support.leadingWhitespace&&K.test(c)&&v.insertBefore(t.createTextNode(K.exec(c)[0]),v.firstChild),c=v.childNodes,v&&(v.parentNode.removeChild(v),m.length>0&&(g=m[m.length-1],g&&g.parentNode&&g.parentNode.removeChild(g)))}var w;if(!s.support.appendChecked)if(c[0]&&typeof (w=c.length)=="number")for(a=0;a<w;a++)pt(c[a]);else pt(c);c.nodeType?f.push(c):f=s.merge(f,c)}if(r){o=function(e){return!
e.type||it.test(e.type)};for(l=0;f[l];l++){u=f[l];if(i&&s.nodeName(u,"script")&&(!u.type||it.test(u.type)))i.push(u.parentNode?u.parentNode.removeChild(u):u);else{if(u.nodeType===1){var E=s.grep(u.getElementsByTagName("script"),o);f.splice.apply(f,[l+1,0].concat(E))}r.appendChild(u)}}}return f},cleanData:function(e){var t,n,r=s.cache,i=s.event.special,o=s.support.deleteExpando;for(var u=0,a;(a=e[u])!=null;u++){if(a.nodeName&&s.noData[a.nodeName.toLowerCase()])continue;n=a[s.expando];if(n){t=r[n];if(t&&t.events){for(var f in t.events)i[f]?s.event.remove(a,f):s.removeEvent(a,f,t.handle);t.handle&&(t.handle.elem=null)}o?delete a[s.expando]:a.removeAttribute&&a.removeAttribute(s.expando),delete r[n]}}}});var vt=/alpha\([^)]*\)/i,mt=/opacity=([^)]*)/,gt=/([A-Z]|^ms)/g,yt=/^[\-+]?(?:\d*\.)?\d+$/i,bt=/^-?(?:\d*\.)?\d+(?!px)[^\d\s]+$/i,wt=/^([\-+])=([\-+.\de]+)/,Et=/^margin/,St={position:"absolute",visibility:"hidden",display:"block"},xt=["Top","Right","Bottom","Left"],Tt,Nt,Ct;s.fn.css=function(e,n){return s.access(this,function(e,n,r){return r!==t?s.style(e,n,r):s.css(e,n)},e,n,arguments.length>1)},s.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Tt(e,"opacity");return n===""?"1":n}return e.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":s.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(!e||e.nodeType===3||e.nodeType===8||!e.style)return;var o,u,a=s.camelCase(n),f=e.style,l=s.cssHooks[a];n=s.cssProps[a]||a;if(r===t)return l&&"get"in l&&(o=l.get(e,!1,i))!==t?o:
f[n];u=typeof r,u==="string"&&(o=wt.exec(r))&&(r=+(o[1]+1)*+o[2]+parseFloat(s.css(e,n)),u="number");if(r==null||u==="number"&&isNaN(r))return;u==="number"&&!s.cssNumber[a]&&(r+="px");if(!l||!("set"in l)||(r=l.set(e,r))!==t)try{f[n]=r}catch(c){}},css:function(e,n,r){var i,o;n=s.camelCase(n),o=s.cssHooks[n],n=s.cssProps[n]||n,n==="cssFloat"&&(n="float");if(o&&"get"in o&&(i=o.get(e,!0,r))!==t)return i;if(Tt)return Tt(e,n)},swap:function(e,t,n){var r={},i,s;for(s in t)r[s]=e.style[s],e.style[s]=t[s];i=n.call(e);for(s in t)e.style[s]=r[s];return i}}),s.curCSS=s.css,n.defaultView&&n.defaultView.getComputedStyle&&(Nt=function(e,t){var n,r,i,o,u=e.style;return t=t.replace(gt,"-$1").toLowerCase(),(r=e.ownerDocument.defaultView)&&(i=r.getComputedStyle(e,null))&&(n=i.getPropertyValue(t),n===""&&!s.contains(e.ownerDocument.documentElement,e)&&(n=s.style(e,t))),!s.support.pixelMargin&&i&&Et.test(t)&&bt.test(n)&&(o=u.width,u.width=n,n=i.width,u.width=o),n}),n.documentElement.currentStyle&&(Ct=function(e,t){var n,r,i,s=e.currentStyle&&e.currentStyle[t],o=e.style;return s==null&&o&&(i=o[t])&&(s=i),bt.test(s)&&(n=o.left,r=e.runtimeStyle&&e.runtimeStyle.left,r&&(e.runtimeStyle.left=e.currentStyle.left),o.left=t==="fontSize"?"1em":s,s=o.pixelLeft+"px",o.left=n,r&&(e.runtimeStyle.left=r)),s===""?"auto":s}),Tt=Nt||Ct,s.each(["height","width"],function(e,t){s.cssHooks[t]={get:function(e,n,r){if(n)return e.offsetWidth!==0?kt(e,t,r):s.swap(e,St,function(){return kt(e,t,r)})},set:function(e,t){return yt.test(t)?t+"px":t}}}),s.support.opacity||(s.cssHooks.opacity={get:function(e,t){return mt.test((t&&
e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?parseFloat(RegExp.$1)/100+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=s.isNumeric(t)?"alpha(opacity="+t*100+")":"",o=r&&r.filter||n.filter||"";n.zoom=1;if(t>=1&&s.trim(o.replace(vt,""))===""){n.removeAttribute("filter");if(r&&!r.filter)return}n.filter=vt.test(o)?o.replace(vt,i):o+" "+i}}),s(function(){s.support.reliableMarginRight||(s.cssHooks.marginRight={get:function(e,t){return s.swap(e,{display:"inline-block"},function(){return t?Tt(e,"margin-right"):e.style.marginRight})}})}),s.expr&&s.expr.filters&&(s.expr.filters.hidden=function(e){var t=e.offsetWidth,n=e.offsetHeight;return t===0&&n===0||!s.support.reliableHiddenOffsets&&(e.style&&e.style.display||s.css(e,"display"))==="none"},s.expr.filters.visible=function(e){return!s.expr.filters.hidden(e)}),s.each({margin:"",padding:"",border:"Width"},function(e,t){s.cssHooks[e+t]={expand:function(n){var r,i=typeof n=="string"?n.split(" "):[n],s={};for(r=0;r<4;r++)s[e+xt[r]+t]=i[r]||i[r-2]||i[0];return s}}});var Lt={},At,Ot,Mt=/^(?:toggle|show|hide)$/,_t=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,Dt,Pt=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],Ht;s.fn.extend({show:function(e,t,n){var r,i;if(e||e===0)return this.animate(Ft("show",3),e,t,n);for(var o=0,u=this.length;o<u;o++)r=this[o],r.style&&(i=r.style.display,!s._data(r,"olddisplay")&&i==="none"&&(i=r.style.display=""),(i===""&&s.css(r,"display")==="none"||!s.contains(r.ownerDocument.documentElement,r))&&s._data
(r,"olddisplay",It(r.nodeName)));for(o=0;o<u;o++){r=this[o];if(r.style){i=r.style.display;if(i===""||i==="none")r.style.display=s._data(r,"olddisplay")||""}}return this},hide:function(e,t,n){if(e||e===0)return this.animate(Ft("hide",3),e,t,n);var r,i,o=0,u=this.length;for(;o<u;o++)r=this[o],r.style&&(i=s.css(r,"display"),i!=="none"&&!s._data(r,"olddisplay")&&s._data(r,"olddisplay",i));for(o=0;o<u;o++)this[o].style&&(this[o].style.display="none");return this},_toggle:s.fn.toggle,toggle:function(e,t,n){var r=typeof e=="boolean";return s.isFunction(e)&&s.isFunction(t)?this._toggle.apply(this,arguments):e==null||r?this.each(function(){var t=r?e:s(this).is(":hidden");s(this)[t?"show":"hide"]()}):this.animate(Ft("toggle",3),e,t,n),this},fadeTo:function(e,t,n,r){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){function o(){i.queue===!1&&s._mark(this);var t=s.extend({},i),n=this.nodeType===1,r=n&&s(this).is(":hidden"),o,u,a,f,l,c,h,p,d,v,m;t.animatedProperties={};for(a in e){o=s.camelCase(a),a!==o&&(e[o]=e[a],delete e[a]);if((l=s.cssHooks[o])&&"expand"in l){c=l.expand(e[o]),delete e[o];for(a in c)a in e||(e[a]=c[a])}}for(o in e){u=e[o],s.isArray(u)?(t.animatedProperties[o]=u[1],u=e[o]=u[0]):t.animatedProperties[o]=t.specialEasing&&t.specialEasing[o]||t.easing||"swing";if(u==="hide"&&r||u==="show"&&!r)return t.complete.call(this);n&&(o==="height"||o==="width")&&(t.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],s.css(this,"display")==="inline"&&s.css(this,"float")==="none"&&(!s.support.inlineBlockNeedsLayout||
It(this.nodeName)==="inline"?this.style.display="inline-block":this.style.zoom=1))}t.overflow!=null&&(this.style.overflow="hidden");for(a in e)f=new s.fx(this,t,a),u=e[a],Mt.test(u)?(m=s._data(this,"toggle"+a)||(u==="toggle"?r?"show":"hide":0),m?(s._data(this,"toggle"+a,m==="show"?"hide":"show"),f[m]()):f[u]()):(h=_t.exec(u),p=f.cur(),h?(d=parseFloat(h[2]),v=h[3]||(s.cssNumber[a]?"":"px"),v!=="px"&&(s.style(this,a,(d||1)+v),p=(d||1)/f.cur()*p,s.style(this,a,p+v)),h[1]&&(d=(h[1]==="-="?-1:1)*d+p),f.custom(p,d,v)):f.custom(p,u,""));return!0}var i=s.speed(t,n,r);return s.isEmptyObject(e)?this.each(i.complete,[!1]):(e=s.extend({},e),i.queue===!1?this.each(o):this.queue(i.queue,o))},stop:function(e,n,r){return typeof e!="string"&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){function u(e,t,n){var i=t[n];s.removeData(e,n,!0),i.stop(r)}var t,n=!1,i=s.timers,o=s._data(this);r||s._unmark(!0,this);if(e==null)for(t in o)o[t]&&o[t].stop&&t.indexOf(".run")===t.length-4&&u(this,o,t);else o[t=e+".run"]&&o[t].stop&&u(this,o,t);for(t=i.length;t--;)i[t].elem===this&&(e==null||i[t].queue===e)&&(r?i[t](!0):i[t].saveState(),n=!0,i.splice(t,1));(!r||!n)&&s.dequeue(this,e)})}}),s.each({slideDown:Ft("show",1),slideUp:Ft("hide",1),slideToggle:Ft("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){s.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),s.extend({speed:function(e,t,n){var r=e&&typeof e=="object"?s.extend({},e):{complete:n||!n&&t||s.isFunction(e)&&e,duration:e,easing:n&&t||t&&!s.isFunction(t)&&t};r.duration=s.
fx.off?0:typeof r.duration=="number"?r.duration:r.duration in s.fx.speeds?s.fx.speeds[r.duration]:s.fx.speeds._default;if(r.queue==null||r.queue===!0)r.queue="fx";return r.old=r.complete,r.complete=function(e){s.isFunction(r.old)&&r.old.call(this),r.queue?s.dequeue(this,r.queue):e!==!1&&s._unmark(this)},r},easing:{linear:function(e){return e},swing:function(e){return-Math.cos(e*Math.PI)/2+.5}},timers:[],fx:function(e,t,n){this.options=t,this.elem=e,this.prop=n,t.orig=t.orig||{}}}),s.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(s.fx.step[this.prop]||s.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]==null||!!this.elem.style&&this.elem.style[this.prop]!=null){var e,t=s.css(this.elem,this.prop);return isNaN(e=parseFloat(t))?!t||t==="auto"?0:t:e}return this.elem[this.prop]},custom:function(e,n,r){function u(e){return i.step(e)}var i=this,o=s.fx;this.startTime=Ht||Bt(),this.end=n,this.now=this.start=e,this.pos=this.state=0,this.unit=r||this.unit||(s.cssNumber[this.prop]?"":"px"),u.queue=this.options.queue,u.elem=this.elem,u.saveState=function(){s._data(i.elem,"fxshow"+i.prop)===t&&(i.options.hide?s._data(i.elem,"fxshow"+i.prop,i.start):i.options.show&&s._data(i.elem,"fxshow"+i.prop,i.end))},u()&&s.timers.push(u)&&!Dt&&(Dt=setInterval(o.tick,o.interval))},show:function(){var e=s._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=e||s.style(this.elem,this.prop),this.options.show=!0,e!==t?this.custom(this.cur(),e):this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur()),s(this.elem).show
()},hide:function(){this.options.orig[this.prop]=s._data(this.elem,"fxshow"+this.prop)||s.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(e){var t,n,r,i=Ht||Bt(),o=!0,u=this.elem,a=this.options;if(e||i>=a.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),a.animatedProperties[this.prop]=!0;for(t in a.animatedProperties)a.animatedProperties[t]!==!0&&(o=!1);if(o){a.overflow!=null&&!s.support.shrinkWrapBlocks&&s.each(["","X","Y"],function(e,t){u.style["overflow"+t]=a.overflow[e]}),a.hide&&s(u).hide();if(a.hide||a.show)for(t in a.animatedProperties)s.style(u,t,a.orig[t]),s.removeData(u,"fxshow"+t,!0),s.removeData(u,"toggle"+t,!0);r=a.complete,r&&(a.complete=!1,r.call(u))}return!1}return a.duration==Infinity?this.now=i:(n=i-this.startTime,this.state=n/a.duration,this.pos=s.easing[a.animatedProperties[this.prop]](this.state,n,0,1,a.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update(),!0}},s.extend(s.fx,{tick:function(){var e,t=s.timers,n=0;for(;n<t.length;n++)e=t[n],!e()&&t[n]===e&&t.splice(n--,1);t.length||s.fx.stop()},interval:13,stop:function(){clearInterval(Dt),Dt=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(e){s.style(e.elem,"opacity",e.now)},_default:function(e){e.elem.style&&e.elem.style[e.prop]!=null?e.elem.style[e.prop]=e.now+e.unit:e.elem[e.prop]=e.now}}}),s.each(Pt.concat.apply([],Pt),function(e,t){t.indexOf("margin")&&(s.fx.step[t]=function(e){s.style(e.elem,t,Math.max(0,e.now)+e.unit)})}),s.expr&&s.expr.filters&&(s.expr.filters.animated=function(e){return s
.grep(s.timers,function(t){return e===t.elem}).length});var qt,Rt=/^t(?:able|d|h)$/i,Ut=/^(?:body|html)$/i;"getBoundingClientRect"in n.documentElement?qt=function(e,t,n,r){try{r=e.getBoundingClientRect()}catch(i){}if(!r||!s.contains(n,e))return r?{top:r.top,left:r.left}:{top:0,left:0};var o=t.body,u=zt(t),a=n.clientTop||o.clientTop||0,f=n.clientLeft||o.clientLeft||0,l=u.pageYOffset||s.support.boxModel&&n.scrollTop||o.scrollTop,c=u.pageXOffset||s.support.boxModel&&n.scrollLeft||o.scrollLeft,h=r.top+l-a,p=r.left+c-f;return{top:h,left:p}}:qt=function(e,t,n){var r,i=e.offsetParent,o=e,u=t.body,a=t.defaultView,f=a?a.getComputedStyle(e,null):e.currentStyle,l=e.offsetTop,c=e.offsetLeft;while((e=e.parentNode)&&e!==u&&e!==n){if(s.support.fixedPosition&&f.position==="fixed")break;r=a?a.getComputedStyle(e,null):e.currentStyle,l-=e.scrollTop,c-=e.scrollLeft,e===i&&(l+=e.offsetTop,c+=e.offsetLeft,s.support.doesNotAddBorder&&(!s.support.doesAddBorderForTableAndCells||!Rt.test(e.nodeName))&&(l+=parseFloat(r.borderTopWidth)||0,c+=parseFloat(r.borderLeftWidth)||0),o=i,i=e.offsetParent),s.support.subtractsBorderForOverflowNotVisible&&r.overflow!=="visible"&&(l+=parseFloat(r.borderTopWidth)||0,c+=parseFloat(r.borderLeftWidth)||0),f=r}if(f.position==="relative"||f.position==="static")l+=u.offsetTop,c+=u.offsetLeft;return s.support.fixedPosition&&f.position==="fixed"&&(l+=Math.max(n.scrollTop,u.scrollTop),c+=Math.max(n.scrollLeft,u.scrollLeft)),{top:l,left:c}},s.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){s.offset.setOffset(this,e,t)});var n=this[0],r=n&&n.ownerDocument
;return r?n===r.body?s.offset.bodyOffset(n):qt(n,r,r.documentElement):null},s.offset={bodyOffset:function(e){var t=e.offsetTop,n=e.offsetLeft;return s.support.doesNotIncludeMarginInBodyOffset&&(t+=parseFloat(s.css(e,"marginTop"))||0,n+=parseFloat(s.css(e,"marginLeft"))||0),{top:t,left:n}},setOffset:function(e,t,n){var r=s.css(e,"position");r==="static"&&(e.style.position="relative");var i=s(e),o=i.offset(),u=s.css(e,"top"),a=s.css(e,"left"),f=(r==="absolute"||r==="fixed")&&s.inArray("auto",[u,a])>-1,l={},c={},h,p;f?(c=i.position(),h=c.top,p=c.left):(h=parseFloat(u)||0,p=parseFloat(a)||0),s.isFunction(t)&&(t=t.call(e,n,o)),t.top!=null&&(l.top=t.top-o.top+h),t.left!=null&&(l.left=t.left-o.left+p),"using"in t?t.using.call(e,l):i.css(l)}},s.fn.extend({position:function(){if(!this[0])return null;var e=this[0],t=this.offsetParent(),n=this.offset(),r=Ut.test(t[0].nodeName)?{top:0,left:0}:t.offset();return n.top-=parseFloat(s.css(e,"marginTop"))||0,n.left-=parseFloat(s.css(e,"marginLeft"))||0,r.top+=parseFloat(s.css(t[0],"borderTopWidth"))||0,r.left+=parseFloat(s.css(t[0],"borderLeftWidth"))||0,{top:n.top-r.top,left:n.left-r.left}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||n.body;while(e&&!Ut.test(e.nodeName)&&s.css(e,"position")==="static")e=e.offsetParent;return e})}}),s.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var r=/Y/.test(n);s.fn[e]=function(i){return s.access(this,function(e,i,o){var u=zt(e);if(o===t)return u?n in u?u[n]:s.support.boxModel&&u.document.documentElement[i]||u.document.body[i]:e[i];u?u.scrollTo(r?s(u)
.scrollLeft():o,r?o:s(u).scrollTop()):e[i]=o},e,i,arguments.length,null)}}),s.each({Height:"height",Width:"width"},function(e,n){var r="client"+e,i="scroll"+e,o="offset"+e;s.fn["inner"+e]=function(){var e=this[0];return e?e.style?parseFloat(s.css(e,n,"padding")):this[n]():null},s.fn["outer"+e]=function(e){var t=this[0];return t?t.style?parseFloat(s.css(t,n,e?"margin":"border")):this[n]():null},s.fn[n]=function(e){return s.access(this,function(e,n,u){var a,f,l,c;if(s.isWindow(e))return a=e.document,f=a.documentElement[r],s.support.boxModel&&f||a.body&&a.body[r]||f;if(e.nodeType===9)return a=e.documentElement,a[r]>=a[i]?a[r]:Math.max(e.body[i],a[i],e.body[o],a[o]);if(u===t)return l=s.css(e,n),c=parseFloat(l),s.isNumeric(c)?c:l;s(e).css(n,u)},n,e,arguments.length,null)}}),e.jQuery=e.$=s,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return s})})(window),jQuery.Buffer=function(){function t(e){for(var t in e)typeof e[t]=="function"&&(e[t].displayName=t)}var e=function(e){e&&this.assign(e),this._bufferedCommandList=[],this._bufferedCommands={}};return e._buffers=[],e._pool=[],e.bufferForElement=function(e){return e._jquery_buffer?e._jquery_buffer:this.bufferFromPool().assign(e)},e.bufferFromPool=function(){var t=null;return this._pool.length===0?t=new e:t=this._pool.pop(),e._buffers.push(t),this.flushingScheduled||this.scheduleFlushing(),t},e.returnToPool=function(e){e.unassign(),this._pool.push(e)},e.scheduleFlushing=function(){this.flushingScheduled=!0},e.flush=function(){var e=this._buffers,t,n=e.length;for(t=0;t<n;t++)e[t].flush(),this.
returnToPool(e[t]);this._buffers=[],this.flushingScheduled=!1},e.prototype.assign=function(e){return this._el&&this.unassign(),this._el=e,this._el._jquery_buffer=this,this},e.prototype.unassign=function(){if(!this._el)return;return this._el._jquery_buffer=undefined,this._el=undefined,this},e.prototype.flush=function(){var e=this._bufferedCommandList,t=e.length,n,r;for(n=0;n<t;n++)r=e[n],this[r](this._bufferedCommands[r]),delete this._bufferedCommands[r];this._bufferedCommandList.length=0,this.unassign()},e.prototype.$=function(e,t){t||(t=this._el);if(e===""||e===undefined)e=t,t=undefined;return jQuery(e,t)},e.prototype.bufferedCommand=function(e){return this._bufferedCommands[e]||(this._bufferedCommands[e]={},this._bufferedCommandList.push(e)),this._bufferedCommands[e]},e.prototype.hasBufferedCommand=function(e){return!!this._bufferedCommands[e]},e.prototype.html=function(e){var t=this.bufferedCommand("flushContent");if(e===undefined)return t.text||t.html||this.$().html();t.text=undefined,t.html=e},e.prototype.text=function(e){var t=this.bufferedCommand("flushContent");if(e===undefined)return t.text||t.html||this.$().text();t.text=e,t.html=undefined},e.prototype.flushContent=function(e){e.text!==undefined?this.$().text(e.text):e.html!==undefined&&this.$().html(e.html)},e.prototype.attr=function(e,t){if(typeof e=="object"){for(var n in e)this.attr(n,e[n]);return}if(e==="class"){if(t===undefined)return this.setClass().join(" ");if(typeof t=="string"||jQuery.isArray(t)){var r=this.bufferedCommand("flushClassNames");r.classNames=this._hashFromClassNames(t);return}return this.setClass
(t)}if(e==="html")return this.html(t);if(e==="text")return this.text(t);if(e==="style")return this.resetStyles(t);var i=this.bufferedCommand("flushAttributes");i.attr||(i.attr={}),i.attr[e]=t},e.prototype.flushAttributes=function(e){var t=e.attr,n=this.$(),r;for(var i in t){if(!t.hasOwnProperty(i))continue;r=t[i],r!==null?n.attr(i,r):n.removeAttr(i)}},e.prototype._STYLE_REGEX=/-?\s*([^:\s]+)\s*:\s*([^;]+)\s*;?/g,e.prototype._camelizeStyleName=function(e){var t=e.match(/^-(webkit|moz|o)-/),n=e.camelize();return t?n.substr(0,1).toUpperCase()+n.substr(1):n},e.prototype._dasherizeStyleName=function(e){var t=SC.String.dasherize(e);return t.match(/^(webkit|moz|ms|o)-/)&&(t="-"+t),t},e.prototype._loadStyles=function(e){e||(e=this.$().attr("style"));if(e&&(e=e.toString()).length>0){SC.browser.msie&&(e=e.toLowerCase());var t={},n=this._STYLE_REGEX,r;n.lastIndex=0;while(r=n.exec(e))t[this._camelizeStyleName(r[1])]=r[2];return t}return{}},e.prototype.resetStyles=function(e){var t=this.bufferedCommand("flushStyles");t._styles=this._loadStyles(e||" ")},e.prototype.styles=function(){var e=this.bufferedCommand("flushStyles");return e._styles||(e._styles=this._loadStyles()),e._styles},e.prototype.css=function(e,t){if(typeof e=="object"){for(var n in e)this.css(n,e[n]);return}var r=this.bufferedCommand("flushStyles");r._styles||(r._styles=this._loadStyles()),r._styles[e]=t},e.prototype.flushStyles=function(e){var t=e._styles,n="",r,i,s=[],o=0;for(r in t){if(!t.hasOwnProperty(r))continue;i=t[r];if(i===null)continue;typeof i=="number"&&r!=="zIndex"&&r!=="fontWeight"&&r!=="opacity"&&(i+="px"),s
[o++]=this._dasherizeStyleName(r)+": "+i}this.$().attr("style",s.join("; "))},e.prototype._hashFromClassNames=function(e){typeof e=="string"&&(e=e.split(" "));var t,n=e.length,r={};for(t=0;t<n;t++)r[e[t]]=!0;return r},e.prototype.setClass=function(e,t){var n=this.bufferedCommand("flushClassNames"),r;if(e===undefined){n.classNames||(n.classNames=this._hashFromClassNames(this._el.className));var i=n.classNames,s=[];for(r in i)r&&i[r]&&s.push(r);return s}if(typeof e=="object"){n.classNames||(n.classNames=this._hashFromClassNames(this._el.className));for(r in e)n.classNames[r]=e[r];return}n.classNames||(n.classNames=this._hashFromClassNames(this._el.className)),n.classNames[e]=t||!1},e.prototype.hasClass=function(e){var t=this.bufferedCommand("flushClassNames");return t.classNames||(t.classNames=this._hashFromClassNames(this._el.className)),!!t.classNames[e]},e.prototype.addClass=function(e){if(!e)return;var t=this.bufferedCommand("flushClassNames");t.classNames||(t.classNames=this._hashFromClassNames(this._el.className)),typeof e=="string"&&(e=e.split(" "));var n,r=e.length;for(n=0;n<r;n++)t.classNames[jQuery.trim(e[n])]=!0},e.prototype.removeClass=function(e){var t=this.bufferedCommand("flushClassNames");t.classNames||(t.classNames=this._hashFromClassNames(this._el.className)),t.classNames[e]=!1},e.prototype.resetClassNames=function(e){var t=this.bufferedCommand("flushClassNames");t.classNames={}},e.prototype.flushClassNames=function(e){var t=[];if(e.classNames){var n=e.classNames,r;for(r in n)n[r]&&t.push(r)}this.$().attr("class",t.join(" "))},t(e),t(e.prototype),e}(),function(
){jQuery.buffer=jQuery.bufferedJQuery=jQuery.sub(),jQuery.bufferedJQuery.fn.extend({html:function(e){if(e===undefined)return this.length<1?undefined:jQuery.Buffer.bufferForElement(this[0]).html();var t=this.length,n,r;for(n=0;n<t;n++)r=jQuery.Buffer.bufferForElement(this[n]),r.html(e);return this},text:function(e){if(e===undefined)return this.length<1?undefined:jQuery.Buffer.bufferForElement(this[0]).text();var t=this.length,n,r;for(n=0;n<t;n++)r=jQuery.Buffer.bufferForElement(this[n]),r.text(e);return this},attr:function(e,t){var n;if(typeof t=="undefined"&&typeof e=="string")return this.length<1?!1:(n=jQuery.Buffer.bufferForElement(this[0]),n.attr(e));var r=this.length,i;for(i=0;i<r;i++)n=jQuery.Buffer.bufferForElement(this[i]),n.attr(e,t);return this},hasClass:function(e){return this.length<1?!1:jQuery.Buffer.bufferForElement(this[0]).hasClass(e)},setClass:function(e,t){var n=this.length,r,i;for(r=0;r<n;r++)i=jQuery.Buffer.bufferForElement(this[r]),i.setClass(e,t);return this},addClass:function(e){var t=this.length,n,r;for(n=0;n<t;n++)r=jQuery.Buffer.bufferForElement(this[n]),r.addClass(e);return this},removeClass:function(e){var t=this.length,n,r;for(n=0;n<t;n++)r=jQuery.Buffer.bufferForElement(this[n]),r.removeClass(e);return this},resetClassNames:function(){var e=this.length,t,n;for(t=0;t<e;t++)n=jQuery.Buffer.bufferForElement(this[t]),n.resetClassNames();return this},css:function(e,t){var n=this.length,r,i;for(r=0;r<n;r++)i=jQuery.Buffer.bufferForElement(this[r]),i.css(e,t);return this},styles:function(){return this.length<1?null:jQuery.Buffer.bufferForElement(this[0]
).styles()},resetStyles:function(){return this.length<1?null:(jQuery.Buffer.bufferForElement(this[0]).resetStyles(),this)}})}(),jQuery.Buffer._flush=function(){jQuery.Buffer.flush()},jQuery.Buffer.scheduleFlushing=function(){SC.RunLoop.currentRunLoop.invokeOnce(jQuery.Buffer._flush),this.flushingScheduled=!0},window.require||(window.require=function(){}),window.sc_require||(window.sc_require=require),window.sc_resource||(window.sc_resource=function(){}),window.YES=!0,window.NO=!1,typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){}),window.SC=window.SC||{},window.SproutCore=window.SproutCore||SC,SC=window.SC,SC.VERSION="1.6.0",SC._baseMixin=function(e){var t=Array.prototype.slice.call(arguments,1),n,r=t[0]||{},i=1,s=t.length,o,u,a;s===1&&(r=this||{},i=0);for(;i<s;i++){if(!(o=t[i]))continue;for(a in o){if(!o.hasOwnProperty(a))continue;u=o[a];if(r===u)continue;u!==undefined&&(e||r[a]===undefined)&&(r[a]=u)}o.hasOwnProperty("toString")&&(r.toString=o.toString)}return r},SC.mixin=function(){var e=Array.prototype.slice.call(arguments);return e.unshift(!0),SC._baseMixin.apply(this,e)},SC.supplement=function(){var e=Array.prototype.slice.call(arguments);return e.unshift(!1),SC._baseMixin.apply(this,e)},SC.extend=SC.mixin,SC.mixin({T_ERROR:"error",T_OBJECT:"object",T_NULL:"null",T_CLASS:"class",T_HASH:"hash",T_FUNCTION:"function",T_UNDEFINED:"undefined",T_NUMBER:"number",T_BOOL:"boolean",T_ARRAY:"array",T_STRING:"string",T_DATE:"date",T_REGEXP:"regexp",typeOf:function(e){if(e===undefined)return SC.T_UNDEFINED;if(e===null)return SC
.T_NULL;var t=jQuery.type(e);return t==="function"?e.isClass?SC.T_CLASS:SC.T_FUNCTION:t==="object"?SC.Error&&e instanceof SC.Error?SC.T_ERROR:e instanceof SC.Object?SC.T_OBJECT:SC.T_HASH:t},none:function(e){return e==null},empty:function(e){return e===null||e===undefined||e===""},isArray:function(e){return!e||e.setInterval?!1:Array.isArray&&Array.isArray(e)?!0:e.objectAt?!0:e.length!==undefined&&jQuery.type(e)==="object"?!0:!1},makeArray:function(e){return SC.isArray(e)?e:SC.A(e)},A:function(e){if(e===null||e===undefined)return[];if(e.slice instanceof Function)return typeof e=="string"?[e]:e.slice();if(e.toArray)return e.toArray();if(!SC.isArray(e))return[e];var t=[],n=e.length;while(--n>=0)t[n]=e[n];return t},guidKey:"SproutCore"+(SC.VERSION+Math.random()).replace(/\D/g,""),_guidPrefixes:{number:"nu",string:"st"},_guidCaches:{number:{},string:{}},_numberGuids:[],_stringGuids:{},_keyCache:{},guidFor:function(e){var t,n,r=typeof e;if(e===null)return"(null)";if(r===SC.T_STRING||r===SC.T_NUMBER)return t=this._guidCaches[r],n=t[e],n||(n="st"+jQuery.uuid++,t[e]=n),n;if(e===undefined)return"(undefined)";if(r===SC.T_BOOL)return e?"(true)":"(false)";var i=this.guidKey,s=e[i];return s?s:e===Object?"(Object)":e===Array?"(Array)":SC.generateGuid(e,"sc")},keyFor:function(e,t){var n,r=this._keyCache[e];return r||(r=this._keyCache[e]={}),n=r[t],n||(n=r[t]=e+"_"+t),n},generateGuid:function(e,t){var n=t+jQuery.uuid++;return e&&(e[this.guidKey]=n),n},hashFor:function(){var e=arguments.length,t="",n,r,i;for(i=0;i<e;++i)n=arguments[i],t+=n&&(r=n.hash)&&typeof r===SC.T_FUNCTION?r.call(n):this.guidFor
(n);return t===""?null:t},isEqual:function(e,t){return this.hashFor(e)===this.hashFor(t)},compare:function(e,t){if(e===t)return 0;var n=SC.typeOf(e),r=SC.typeOf(t),i=SC.ORDER_DEFINITION_MAPPING;if(!i){var s=SC.ORDER_DEFINITION;i=SC.ORDER_DEFINITION_MAPPING={};var o,u;for(o=0,u=s.length;o<u;++o)i[s[o]]=o;delete SC.ORDER_DEFINITION}var a=i[n],f=i[r];if(a<f)return-1;if(a>f)return 1;switch(n){case SC.T_BOOL:case SC.T_NUMBER:if(e<t)return-1;if(e>t)return 1;return 0;case SC.T_STRING:var l=e.localeCompare(t);if(l<0)return-1;if(l>0)return 1;return 0;case SC.T_ARRAY:var c=e.length,h=t.length,p=Math.min(c,h),d=0,v=0,m=arguments.callee;while(d===0&&v<p)d=m(e[v],t[v]),v++;if(d!==0)return d;if(c<h)return-1;if(c>h)return 1;return 0;case SC.T_OBJECT:if(e.constructor.isComparable===YES)return e.constructor.compare(e,t);return 0;default:return 0}},K:function(){return this},EMPTY_ARRAY:[],EMPTY_HASH:{},EMPTY_RANGE:{start:0,length:0},beget:function(e){if(e===null||e===undefined)return null;var t=SC.K;t.prototype=e;var n=new t;return t.prototype=null,typeof e.didBeget=="function"&&(n=e.didBeget(n)),n[this.guidKey]=null,n},copy:function(e,t){var n=e,r;if(e){if(e.isCopyable)return e.copy(t);if(e.clone)return e.clone()}switch(jQuery.type(e)){case"array":n=e.slice();if(t){r=n.length;while(r--)n[r]=SC.copy(n[r],!0)}break;case"object":n={};for(var i in e)n[i]=t?SC.copy(e[i],!0):e[i]}return n},merge:function(){var e={},t=arguments.length,n;for(n=0;n<t;n++)SC.mixin(e,arguments[n]);return e},keys:function(e){var t=[];for(var n in e)t.push(n);return t},inspect:function(e){var t,n=[];for(var r in e){t=e[r
];if(t==="toString")continue;SC.typeOf(t)===SC.T_FUNCTION&&(t="function() { ... }"),n.push(r+": "+t)}return"{"+n.join(" , ")+"}"},tupleForPropertyPath:function(e,t){if(typeof e=="object"&&e instanceof Array)return e;var n,r=e.indexOf("*");r<0&&(r=e.lastIndexOf(".")),n=r>=0?e.slice(r+1):e;var i=this.objectForPropertyPath(e,t,r);return i&&n?[i,n]:null},objectForPropertyPath:function(e,t,n){var r,i,s,o;t||(t=window);if(typeof e=="string"){n===undefined&&(n=e.length),r=0;while(t&&r<n){i=e.indexOf(".",r);if(i<0||i>n)i=n;s=e.slice(r,i),t=t.get?t.get(s):t[s],r=i+1}r<n&&(t=undefined)}else{r=0,o=e.length,s=null;while(r<o&&t)s=e[r++],s&&(t=t.get?t.get(s):t[s]);r<o&&(t=undefined)}return t},requiredObjectForPropertyPath:function(e,t,n){var r=SC.objectForPropertyPath(e,t,n);if(!r)throw e+" could not be found";return r}}),SC.clone=SC.copy,SC.$A=SC.A,SC.didLoad=SC.K,SC.ORDER_DEFINITION=[SC.T_ERROR,SC.T_UNDEFINED,SC.T_NULL,SC.T_BOOL,SC.T_NUMBER,SC.T_STRING,SC.T_ARRAY,SC.T_HASH,SC.T_OBJECT,SC.T_FUNCTION,SC.T_CLASS],SC.Function={property:function(e,t){e.dependentKeys=SC.$A(t);var n=SC.guidFor(e);return e.cacheKey="__cache__"+n,e.lastSetValueKey="__lastValue__"+n,e.isProperty=!0,e},cacheable:function(e,t){return e.isProperty=!0,e.dependentKeys||(e.dependentKeys=[]),e.isCacheable=t===undefined?!0:t,e},idempotent:function(e,t){return e.isProperty=!0,e.dependentKeys||(this.dependentKeys=[]),e.isVolatile=t===undefined?!0:t,e},enhance:function(e){return e.isEnhancement=!0,e},observes:function(e,t){var n=t.length,r=null,i=null;while(--n>=0){var s=t[n];s.indexOf(".")<0&&s.indexOf("*")<0?(r||(r=e.localPropertyPaths=
[]),r.push(s)):(i||(i=e.propertyPaths=[]),i.push(s))}return e}},SC.mixin(Function.prototype,{property:function(){return SC.Function.property(this,arguments)},cacheable:function(e){return SC.Function.cacheable(this,e)},idempotent:function(e){return SC.Function.idempotent(this,e)},enhance:function(){return SC.Function.enhance(this)},observes:function(e){return SC.Function.observes(this,arguments)}}),SC.ObserverSet={add:function(e,t,n){var r=SC.guidFor(e),i=SC.guidFor(t),s=this._members,o=this.members,u=s[r],a,f;u||(u=s[r]={}),a=u[i],a===undefined&&(u[i]=o.length,f=[e,t,n],o.push(f))},remove:function(e,t){var n=SC.guidFor(e),r=SC.guidFor(t),i=this._members[n],s=this.members;if(!i)return!1;var o=i[r];if(o===undefined)return!1;if(o!==s.length-1){var u=s[o]=s[s.length-1];this._members[SC.guidFor(u[0])][SC.guidFor(u[1])]=o}return s.pop(),delete this._members[n][r],!0},invokeMethods:function(){var e=this.members,t;for(var n=0,r=e.length;n<r;n++)t=e[n],t[1].call(t[0])},clone:function(){var e=SC.ObserverSet.create(),t=this.members;e._members=SC.clone(this._members);var n=e.members;for(var r=0,i=t.length;r<i;r++)n[r]=SC.clone(t[r]),n[r].length=3;return e},create:function(){return new SC.ObserverSet.constructor},getMembers:function(){return this.members.slice(0)},constructor:function(){this._members={},this.members=[]}},SC.ObserverSet.constructor.prototype=SC.ObserverSet,SC.ObserverSet.slice=SC.ObserverSet.clone,SC.ObserverSet.copy=SC.ObserverSet.clone,SC._ChainObserver=function(e,t){this.property=e,this.root=t||this},SC._ChainObserver.createChain=function(e,t,n,r,i){var s=t.split("."),
o=new SC._ChainObserver(s[0]),u=o;for(var a=1,f=s.length;a<f;a++)u=u.next=new SC._ChainObserver(s[a],o);var l=o.tails=[u];return o.objectDidChange(e),l.forEach(function(e){e.target=n,e.method=r,e.context=i}),o.tails=null,o},SC._ChainObserver.prototype={isChainObserver:!0,object:null,property:null,next:null,root:null,target:null,method:null,tail:function(){if(this._tail)return this._tail;var e=this;while(e.next)e=e.next;return this._tail=e,e},objectDidChange:function(e){if(e===this.object)return;this.object&&(this.property==="@each"&&this.object._removeContentObserver?this.object._removeContentObserver(this):this.object.removeObserver&&this.object.removeObserver(this.property,this,this.propertyDidChange)),this.object=e,this.property==="@each"&&this.next?this.object&&this.object._addContentObserver&&this.object._addContentObserver(this):(this.object&&this.object.addObserver&&this.object.addObserver(this.property,this,this.propertyDidChange),this.propertyDidChange())},propertyDidChange:function(){var e=this.object,t=this.property,n=e&&e.get?e.get(t):null;this.next&&this.next.objectDidChange(n);var r=this.target,i=this.method,s=this.context;if(r&&i){var o=e?e.propertyRevision:null;s?i.call(r,e,t,n,s,o):i.call(r,e,t,n,o)}},destroyChain:function(){var e=this.object;return e&&e.removeObserver&&e.removeObserver(this.property,this,this.propertyDidChange),this.next&&this.next.destroyChain(),this.next=this.target=this.method=this.object=this.context=null,null}},SC.LOG_OBSERVERS=NO,SC.OBSERVES_HANDLER_ADD=0,SC.OBSERVES_HANDLER_REMOVE=1,SC.Observable={isObservable:YES,automaticallyNotifiesObserversFor
:function(e){return YES},get:function(e){var t=this[e],n;return t===undefined?this.unknownProperty(e):t&&t.isProperty?t.isCacheable?(n=this._kvo_cache,n||(n=this._kvo_cache={}),n[t.cacheKey]!==undefined?n[t.cacheKey]:n[t.cacheKey]=t.call(this,e)):t.call(this,e):t},set:function(e,t){var n=this[e],r=this.automaticallyNotifiesObserversFor(e),i=t,s,o,u,a;if(t===undefined&&SC.typeOf(e)===SC.T_HASH){var f=e;for(e in f){if(!f.hasOwnProperty(e))continue;this.set(e,f[e])}return this}if(!r&&this._kvo_cacheable&&(o=this._kvo_cache)){s=this._kvo_cachedep;if(!s||(s=s[e])===undefined)s=this._kvo_computeCachedDependentsFor(e);if(s){u=s.length;while(--u>=0)a=s[u],o[a.cacheKey]=o[a.lastSetValueKey]=undefined}}if(n&&n.isProperty){o=this._kvo_cache;if(n.isVolatile||!o||o[n.lastSetValueKey]!==t)o||(o=this._kvo_cache={}),o[n.lastSetValueKey]=t,r&&this.propertyWillChange(e,i),i=n.call(this,e,t),n.isCacheable&&(o[n.cacheKey]=i),r&&this.propertyDidChange(e,i,YES)}else n===undefined?(r&&this.propertyWillChange(e,i),this.unknownProperty(e,t),r&&this.propertyDidChange(e,i)):this[e]!==t&&(r&&this.propertyWillChange(e,i),i=this[e]=t,r&&this.propertyDidChange(e,i));return this},unknownProperty:function(e,t){return t!==undefined&&(this[e]=t),t},beginPropertyChanges:function(){return this._kvo_changeLevel=(this._kvo_changeLevel||0)+1,this},endPropertyChanges:function(){this._kvo_changeLevel=(this._kvo_changeLevel||1)-1;var e=this._kvo_changeLevel,t=this._kvo_changes;return e<=0&&t&&t.length>0&&!SC.Observers.isObservingSuspended&&this._notifyPropertyObservers(),this},propertyWillChange:function(e,t){return this
},propertyDidChange:function(e,t,n){this._kvo_revision=(this._kvo_revision||0)+1;var r=this._kvo_changeLevel||0,i,s,o,u,a=SC.LOG_OBSERVERS&&this.LOG_OBSERVING!==NO,f=this._kvo_property_chains;if(f){var l=f[e];l&&(this.beginPropertyChanges(),l=SC.clone(l),l.forEach(function(e){e.notifyPropertyDidChange()}),this.endPropertyChanges())}var c=this._kvo_cache;if(c){n||(u=this[e],u&&u.isProperty&&(c[u.cacheKey]=c[u.lastSetValueKey]=undefined));if(this._kvo_cacheable){i=this._kvo_cachedep;if(!i||(i=i[e])===undefined)i=this._kvo_computeCachedDependentsFor(e);if(i){s=i.length;while(--s>=0)o=i[s],c[o.cacheKey]=c[o.lastSetValueKey]=undefined}}}var h=SC.Observers.isObservingSuspended;if(r>0||h){var p=this._kvo_changes;p||(p=this._kvo_changes=SC.CoreSet.create()),p.add(e),h&&(a&&SC.Logger.log("%@%@: will not notify observers because observing is suspended".fmt(SC.KVO_SPACES,this)),SC.Observers.objectHasPendingChanges(this))}else this._notifyPropertyObservers(e);return this},registerDependentKey:function(e,t){var n=this._kvo_dependents,r=this._kvo_chain_dependents,i=this[e],s,o,u,a,f;typeof t=="object"&&t instanceof Array?(s=t,u=0):(s=arguments,u=1),o=s.length,n||(this._kvo_dependents=n={});while(--o>=u)a=s[o],a.indexOf(".")>=0?SC._PropertyChain.createChain(a,this,e).activate():(f=n[a],f||(f=n[a]=[]),f.push(e))},registerDependentKeyWithChain:function(e,t){var n=this._chainsFor(e),r;n.add(t)},removeDependentKeyWithChain:function(e,t){var n=this._chainsFor(e),r;n.remove(t),n.get("length")===0&&delete this._kvo_property_chains[e]},_chainsFor:function(e){this._kvo_property_chains=this._kvo_property_chains||
{};var t=this._kvo_property_chains[e]||SC.CoreSet.create();return this._kvo_property_chains[e]=t,t},_kvo_addCachedDependents:function(e,t,n){var r=t.length,i,s,o;while(--r>=0)s=t[r],i=this[s],i&&i instanceof Function&&i.isProperty&&(i.isCacheable&&e.push(i),(o=n[s])&&o.length>0&&this._kvo_addCachedDependents(e,o,n))},_kvo_computeCachedDependentsFor:function(e){var t=this._kvo_cachedep,n=this._kvo_dependents,r=n?n[e]:null,i;return t||(t=this._kvo_cachedep={}),!r||r.length===0?t[e]=null:(i=t[e]=[],this._kvo_addCachedDependents(i,r,n),i.length===0&&(i=t[e]=null),i)},_kvo_for:function(e,t){var n=this[e];return this._kvo_cloned||(this._kvo_cloned={}),n?this._kvo_cloned[e]||(n=this[e]=n.copy(),this._kvo_cloned[e]=YES):(n=this[e]=t===undefined?[]:t.create(),this._kvo_cloned[e]=YES),n},addObserver:function(e,t,n,r){var i,s,o,u;n===undefined&&(n=t,t=this),t||(t=this),typeof n=="string"&&(n=t[n]);if(!n)throw"You must pass a method to addObserver()";return e=e.toString(),e.indexOf(".")>=0?(s=SC._ChainObserver.createChain(this,e,t,n,r),s.masterTarget=t,s.masterMethod=n,this._kvo_for(SC.keyFor("_kvo_chains",e)).push(s)):(this[e]===undefined&&e.indexOf("@")===0&&this.get(e),t===this&&(t=null),i=SC.keyFor("_kvo_observers",e),this._kvo_for(i,SC.ObserverSet).add(t,n,r),this._kvo_for("_kvo_observed_keys",SC.CoreSet).add(e)),this.didAddObserver&&this.didAddObserver(e,t,n),this},removeObserver:function(e,t,n){var r,i,s,o,u;n===undefined&&(n=t,t=this),t||(t=this),typeof n=="string"&&(n=t[n]);if(!n)throw"You must pass a method to removeObserver()";e=e.toString();if(e.indexOf(".")>=0){r=SC.keyFor("_kvo_chains"
,e);if(i=this[r]){i=this._kvo_for(r),u=i.length;while(--u>=0)s=i[u],s&&s.masterTarget===t&&s.masterMethod===n&&(i[u]=s.destroyChain())}}else{t===this&&(t=null),r=SC.keyFor("_kvo_observers",e);if(o=this[r])o=this._kvo_for(r),o.remove(t,n),o.getMembers().length===0&&this._kvo_for("_kvo_observed_keys",SC.CoreSet).remove(e)}return this.didRemoveObserver&&this.didRemoveObserver(e,t,n),this},hasObserverFor:function(e){SC.Observers.flush(this);var t=this[SC.keyFor("_kvo_observers",e)],n=this[SC.keyFor("_kvo_local",e)],r;return n&&n.length>0?YES:t&&t.getMembers().length>0?YES:NO},initObservable:function(){if(this._observableInited)return;this._observableInited=YES;var e,t,n,r,i,s,o,u,a,f,l,c,h,p;if(t=this._observers){u=t.length;for(e=0;e<u;e++){n=t[e],i=this[n],s=i.propertyPaths,o=s?s.length:0;for(a=0;a<o;a++)f=s[a],this.addObservesHandler(i,f)}}this.bindings=[];if(t=this._bindings)for(e=0,p=t.length;e<p;e++)n=t[e],r=this[n],h=n.slice(0,-7),this[n]=this.bind(h,r);if(t=this._properties)for(e=0,p=t.length;e<p;e++){n=t[e];if(r=this[n])r.isCacheable&&(this._kvo_cacheable=YES),r.dependentKeys&&r.dependentKeys.length>0&&this.registerDependentKey(n,r.dependentKeys)}},addObservesHandler:function(e,t){return this._configureObservesHandler(SC.OBSERVES_HANDLER_ADD,e,t),this},removeObservesHandler:function(e,t){return this._configureObservesHandler(SC.OBSERVES_HANDLER_REMOVE,e,t),this},_configureObservesHandler:function(e,t,n){var r,i;switch(e){case SC.OBSERVES_HANDLER_ADD:e="addObserver";break;case SC.OBSERVES_HANDLER_REMOVE:e="removeObserver";break;default:throw"invalid action provided: "+e}r=
n.indexOf("."),r<0?this[e](n,this,t):n.indexOf("*")===0?this[e](n.slice(1),this,t):(i=null,r===0?(i=this,n=n.slice(1)):r===4&&n.slice(0,5)==="this."?(i=this,n=n.slice(5)):r<0&&n.length===4&&n==="this"?(i=this,n=""):r>0&&n[0]===n.charAt(0).toLowerCase()&&(i=this),SC.Observers[e](n,this,t,i))},observersForKey:function(e){SC.Observers.flush(this);var t=this[SC.keyFor("_kvo_observers",e)];return t?t.getMembers():[]},_notifyPropertyObservers:function(e){this._observableInited||this.initObservable(),SC.Observers.flush(this);var t=SC.LOG_OBSERVERS&&this.LOG_OBSERVING!==NO,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b;t&&(y=SC.KVO_SPACES=(SC.KVO_SPACES||"")+"  ",SC.Logger.log('%@%@: notifying observers after change to key "%@"'.fmt(y,this,e))),s=this["_kvo_observers_*"],this._kvo_changeLevel=(this._kvo_changeLevel||0)+1;while((r=this._kvo_changes)&&r.length>0||e){a=++this.propertyRevision,r||(r=SC.CoreSet.create()),this._kvo_changes=null,e==="*"?(r.add("*"),r.addEach(this._kvo_for("_kvo_observed_keys",SC.CoreSet))):e&&r.add(e);if(i=this._kvo_dependents)for(o=0;o<r.length;o++){e=r[o],u=i[e];if(u&&(v=u.length)){t&&SC.Logger.log("%@...including dependent keys for %@: %@".fmt(y,e,u)),b=this._kvo_cache,b||(b=this._kvo_cache={});while(--v>=0){r.add(e=u[v]);if(m=this[e])this[m.cacheKey]=undefined,b[m.cacheKey]=b[m.lastSetValueKey]=undefined}}}while(r.length>0){e=r.pop(),n=this[SC.keyFor("_kvo_observers",e)];if(n){f=SC.clone(n.getMembers()),l=f.length;for(h=0;h<l;h++){c=f[h];if(c[3]===a)continue;c[1]||SC.Logger.log(c),p=c[0]||this,d=c[1],g=c[2],c[3]=a,t&&SC.Logger.log('%@...firing observer on %@ for key "%@"'
.fmt(y,p,e)),g!==undefined?d.call(p,this,e,null,g,a):d.call(p,this,e,null,a)}}f=this[SC.keyFor("_kvo_local",e)];if(f){l=f.length;for(h=0;h<l;h++)c=f[h],d=this[c],d&&(t&&SC.Logger.log('%@...firing local observer %@.%@ for key "%@"'.fmt(y,this,c,e)),d.call(this,this,e,null,a))}if(s&&e!=="*"){f=SC.clone(s.getMembers()),l=f.length;for(h=0;h<l;h++)c=f[h],p=c[0]||this,d=c[1],g=c[2],t&&SC.Logger.log('%@...firing * observer on %@ for key "%@"'.fmt(y,p,e)),g!==undefined?d.call(p,this,e,null,g,a):d.call(p,this,e,null,a)}this.propertyObserver&&(t&&SC.Logger.log('%@...firing %@.propertyObserver for key "%@"'.fmt(y,this,e)),this.propertyObserver(this,e,null,a))}r&&r.destroy(),e=null}return this._kvo_changeLevel=(this._kvo_changeLevel||1)-1,t&&(SC.KVO_SPACES=y.slice(0,-2)),YES},bind:function(e,t,n){var r,i;return n!==undefined&&(t=[t,n]),i=typeof t,i==="string"||i==="object"&&t instanceof Array?(r=this[e+"BindingDefault"]||SC.Binding,r=r.beget().from(t)):r=t.beget(),r=r.to(e,this).connect(),this.bindings.push(r),r},didChangeFor:function(e){var t,n,r,i,s,o,u,a,f;e=SC.hashFor(e),t=this._kvo_didChange_valueCache,t||(t=this._kvo_didChange_valueCache={}),n=this._kvo_didChange_revisionCache,n||(n=this._kvo_didChange_revisionCache={}),r=t[e]||{},i=n[e]||{},s=!1,o=this._kvo_revision||0,u=arguments.length;while(--u>=1)a=arguments[u],i[a]!=o&&(f=this.get(a),r[a]!==f&&(s=!0,r[a]=f)),i[a]=o;return t[e]=r,n[e]=i,s},setIfChanged:function(e,t){if(t===undefined&&SC.typeOf(e)===SC.T_HASH){var n=e;for(e in n){if(!n.hasOwnProperty(e))continue;this.setIfChanged(e,n[e])}return this}return this.get(e)!==t?this
.set(e,t):this},getPath:function(e){var t=SC.tupleForPropertyPath(e,this);return t===null||t[0]===null?undefined:SC.get(t[0],t[1])},setPath:function(e,t){if(e.indexOf(".")>=0){var n=SC.tupleForPropertyPath(e,this);if(!n||!n[0])return null;n[0].set(n[1],t)}else this.set(e,t);return this},setPathIfChanged:function(e,t){if(e.indexOf(".")>=0){var n=SC.tupleForPropertyPath(e,this);if(!n||!n[0])return null;n[0].get(n[1])!==t&&n[0].set(n[1],t)}else this.setIfChanged(e,t);return this},getEach:function(){var e=SC.A(arguments),t=[],n,r;for(n=0,r=e.length;n<r;n++)t[t.length]=this.getPath(e[n]);return t},incrementProperty:function(e,t){return t||(t=1),this.set(e,(this.get(e)||0)+t),this.get(e)},decrementProperty:function(e,t){return t||(t=1),this.set(e,(this.get(e)||0)-t),this.get(e)},toggleProperty:function(e,t,n){return t===undefined&&(t=!0),n===undefined&&(n=!1),t=this.get(e)==t?n:t,this.set(e,t),this.get(e)},notifyPropertyChange:function(e,t){return this.propertyWillChange(e,t),this.propertyDidChange(e,t),this},allPropertiesDidChange:function(){return this._kvo_cache=null,this._notifyPropertyObservers("*"),this},addProbe:function(e){this.addObserver(e,SC.logChange)},removeProbe:function(e){this.removeObserver(e,SC.logChange)},logProperty:function(){var e=SC.$A(arguments),t,n,r;for(r=0,n=e.length;r<n;r++)t=e[r],SC.Logger.log("%@:%@: ".fmt(SC.guidFor(this),t),this.get(t))},propertyRevision:1},SC.logChange=function(t,n,r){SC.Logger.log("CHANGE: %@[%@] => %@".fmt(t,n,t.get(n)))},SC.mixin(SC,{get:function(e,t){return e?t===undefined?this[e]:e.get?e.get(t):e[t]:undefined},getPath:function(
e,t){return t===undefined&&(t=e,e=window),SC.objectForPropertyPath(t,e)}}),SC.mixin(Array.prototype,SC.Observable),SC.Enumerator=function(e){return this.enumerable=e,this.reset(),this},SC.Enumerator.prototype={nextObject:function(){var e=this._index,t=this._length;if(e>=t)return undefined;var n=this.enumerable.nextObject(e,this._previousObject,this._context);return this._previousObject=n,this._index=e+1,e>=t&&(this._context=SC.Enumerator._pushContext(this._context)),n},reset:function(){var e=this.enumerable;if(!e)throw SC.$error("Enumerator has been destroyed");this._length=e.get?e.get("length"):e.length;var t=this._length;this._index=0,this._previousObject=null,this._context=t>0?SC.Enumerator._popContext():null},destroy:function(){this.enumerable=this._length=this._index=this._previousObject=this._context=null}},SC.Enumerator.create=function(e){return new SC.Enumerator(e)},SC.Enumerator._popContext=function(){var e=this._contextCache?this._contextCache.pop():null;return e||{}},SC.Enumerator._pushContext=function(e){this._contextCache=this._contextCache||[];var t=this._contextCache;return t.push(e),null},SC.Enumerable={isEnumerable:YES,nextObject:function(e,t,n){return this.objectAt?this.objectAt(e):this[e]},firstObject:function(){if(this.get("length")===0)return undefined;if(this.objectAt)return this.objectAt(0);var e=SC.Enumerator._popContext(),t;return t=this.nextObject(0,null,e),e=SC.Enumerator._pushContext(e),t}.property(),lastObject:function(){var e=this.get("length");if(e===0)return undefined;if(this.objectAt)return this.objectAt(e-1)}.property(),enumerator:function()
{return SC.Enumerator.create(this)},forEach:function(e,t){if(typeof e!="function")throw new TypeError;var n=this.get?this.get("length"):this.length;t===undefined&&(t=null);var r=null,i=SC.Enumerator._popContext();for(var s=0;s<n;s++){var o=this.nextObject(s,r,i);e.call(t,o,s,this),r=o}return r=null,i=SC.Enumerator._pushContext(i),this},getEach:function(e){return this.map(function(t){return t?t.get?t.get(e):t[e]:null},this)},setEach:function(e,t){return this.forEach(function(n){n&&(n.set?n.set(e,t):n[e]=t)},this),this},map:function(e,t){if(typeof e!="function")throw new TypeError;t===undefined&&(t=null);var n=this.get?this.get("length"):this.length,r=[],i=null,s=SC.Enumerator._popContext(),o,u;for(o=0;o<n;o++)u=this.nextObject(o,i,s),r[o]=e.call(t,u,o,this),i=u;return i=null,s=SC.Enumerator._pushContext(s),r},mapProperty:function(e){return this.map(function(t){return t?t.get?t.get(e):t[e]:null})},filter:function(e,t){if(typeof e!="function")throw new TypeError;var n=this.get?this.get("length"):this.length;t===undefined&&(t=null);var r=[],i=null,s=SC.Enumerator._popContext();for(var o=0;o<n;o++){var u=this.nextObject(o,i,s);e.call(t,u,o,this)&&r.push(u),i=u}return i=null,s=SC.Enumerator._pushContext(s),r},sortProperty:function(e){var t=typeof e===SC.T_STRING?arguments:e,n=t.length,r;return this instanceof Array?r=this:(r=[],this.forEach(function(e){r.push(e)})),r?r.sort(function(e,r){var i,s,o,u,a=0;for(i=0;a===0&&i<n;i++)s=t[i],o=e?e.get?e.get(s):e[s]:null,u=r?r.get?r.get(s):r[s]:null,a=SC.compare(o,u);return a}):[]},filterProperty:function(e,t){var n=this.get?this.get("length"
):this.length,r=[],i=null,s=SC.Enumerator._popContext();for(var o=0;o<n;o++){var u=this.nextObject(o,i,s),a=u?u.get?u.get(e):u[e]:null,f=t===undefined?!!a:SC.isEqual(a,t);f&&r.push(u),i=u}return i=null,s=SC.Enumerator._pushContext(s),r},find:function(e,t){var n=this.get?this.get("length"):this.length;t===undefined&&(t=null);var r=null,i,s=NO,o=null,u=SC.Enumerator._popContext();for(var a=0;a<n&&!s;a++){i=this.nextObject(a,r,u);if(s=e.call(t,i,a,this))o=i;r=i}return i=r=null,u=SC.Enumerator._pushContext(u),o},findProperty:function(e,t){var n=this.get?this.get("length"):this.length,r=NO,i=null,s=null,o,u,a=SC.Enumerator._popContext();for(var f=0;f<n&&!r;f++)o=this.nextObject(f,s,a),u=o?o.get?o.get(e):o[e]:null,r=t===undefined?!!u:SC.isEqual(u,t),r&&(i=o),s=o;return s=o=null,a=SC.Enumerator._pushContext(a),i},every:function(e,t){if(typeof e!="function")throw new TypeError;var n=this.get?this.get("length"):this.length;t===undefined&&(t=null);var r=YES,i=null,s=SC.Enumerator._popContext();for(var o=0;r&&o<n;o++){var u=this.nextObject(o,i,s);e.call(t,u,o,this)||(r=NO),i=u}return i=null,s=SC.Enumerator._pushContext(s),r},everyProperty:function(e,t){var n=this.get?this.get("length"):this.length,r=YES,i=null,s=SC.Enumerator._popContext();for(var o=0;r&&o<n;o++){var u=this.nextObject(o,i,s),a=u?u.get?u.get(e):u[e]:null;r=t===undefined?!!a:SC.isEqual(a,t),i=u}return i=null,s=SC.Enumerator._pushContext(s),r},some:function(e,t){if(typeof e!="function")throw new TypeError;var n=this.get?this.get("length"):this.length;t===undefined&&(t=null);var r=NO,i=null,s=SC.Enumerator._popContext();for(
var o=0;!r&&o<n;o++){var u=this.nextObject(o,i,s);e.call(t,u,o,this)&&(r=YES),i=u}return i=null,s=SC.Enumerator._pushContext(s),r},someProperty:function(e,t){var n=this.get?this.get("length"):this.length,r=NO,i=null,s=SC.Enumerator._popContext();for(var o=0;!r&&o<n;o++){var u=this.nextObject(o,i,s),a=u?u.get?u.get(e):u[e]:null;r=t===undefined?!!a:SC.isEqual(a,t),i=u}return i=null,s=SC.Enumerator._pushContext(s),r},reduce:function(e,t,n){if(typeof e!="function")throw new TypeError;var r=this.get?this.get("length"):this.length;if(r===0&&t===undefined)throw new TypeError;var i=t,s=null,o=SC.Enumerator._popContext();for(var u=0;u<r;u++){var a=this.nextObject(u,s,o);a!==null&&(i===undefined?i=a:i=e.call(null,i,a,u,this,n)),s=a}s=null,o=SC.Enumerator._pushContext(o);if(i===undefined)throw new TypeError;return i},invoke:function(e){var t=this.get?this.get("length"):this.length;if(t<=0)return[];var n,r=[],i=arguments.length;if(i>1)for(n=1;n<i;n++)r.push(arguments[n]);var s=[],o=null,u=SC.Enumerator._popContext();for(n=0;n<t;n++){var a=this.nextObject(n,o,u),f=a?a[e]:null;f&&(s[n]=f.apply(a,r)),o=a}return o=null,u=SC.Enumerator._pushContext(u),s},invokeWhile:function(e,t){var n=this.get?this.get("length"):this.length;if(n<=0)return null;var r,i=[],s=arguments.length;if(s>2)for(r=2;r<s;r++)i.push(arguments[r]);var o=e,u=null,a=SC.Enumerator._popContext();for(r=0;o===e&&r<n;r++){var f=this.nextObject(r,u,a),l=f?f[t]:null;l&&(o=l.apply(f,i)),u=f}return u=null,a=SC.Enumerator._pushContext(a),o},toArray:function(){var e=[];return this.forEach(function(t){e.push(t)},this),e},groupBy:function(
e){var t=this.get?this.get("length"):this.length,n=[],r=null,i=SC.Enumerator._popContext(),s=[],o=[],u,a,f;for(u=0;u<t;u++)a=this.nextObject(u,r,i),f=a?a.get?a.get(e):a[e]:null,SC.none(s[f])&&(s[f]=[],o.push(f)),s[f].push(a),r=a;r=null,i=SC.Enumerator._pushContext(i);for(u=0,t=o.length;u<t;u++)n.push(s[o[u]]);return n}},SC._buildReducerFor=function(e,t){return function(n,r){var i=this[e];if(SC.typeOf(i)!==SC.T_FUNCTION)return this.unknownProperty?this.unknownProperty(n,r):null;var s=SC.Enumerable.reduce.call(this,i,null,t);return s}.property("[]")},SC.Reducers={"[]":function(e,t){return this}.property(),enumerableContentDidChange:function(e,t,n){this.notifyPropertyChange("[]")},reducedProperty:function(e,t,n){if(!e||typeof e!==SC.T_STRING||e.charAt(0)!=="@")return undefined;var r=e.match(/^@([^(]*)(\(([^)]*)\))?$/);if(!r||r.length<2)return undefined;var i=r[1],s=r[3];i="reduce"+i.slice(0,1).toUpperCase()+i.slice(1);var o=this[i];if(SC.typeOf(o)!==SC.T_FUNCTION)return undefined;if(n===NO)return SC.Enumerable.reduce.call(this,o,null,s);var u=SC._buildReducerFor(i,s),a=this.constructor.prototype;if(a){a[e]=u;var f=a._properties||[];f.push(e),a._properties=f,this.registerDependentKey(e,"[]")}return SC.Enumerable.reduce.call(this,o,null,s)},reduceMax:function(e,t,n,r,i){return i&&t&&(t=t.get?t.get(i):t[i]),e===null?t:t>e?t:e},reduceMaxObject:function(e,t,n,r,i){var s=e,o=t;return i&&(t&&(o=t.get?t.get(i):t[i]),e&&(s=e.get?e.get(i):e[i])),s===null?t:o>s?t:e},reduceMin:function(e,t,n,r,i){return i&&t&&(t=t.get?t.get(i):t[i]),e===null?t:t<e?t:e},reduceMinObject:function(e,t,n,r,i){var s=
e,o=t;return i&&(t&&(o=t.get?t.get(i):t[i]),e&&(s=e.get?e.get(i):e[i])),s===null?t:o<s?t:e},reduceAverage:function(e,t,n,r,i){i&&t&&(t=t.get?t.get(i):t[i]);var s=(e||0)+t,o=r.get?r.get("length"):r.length;return n>=o-1&&(s/=o),s},reduceSum:function(e,t,n,r,i){return i&&t&&(t=t.get?t.get(i):t[i]),e===null?t:e+t}},SC.mixin(SC.Enumerable,SC.Reducers),SC.mixin(Array.prototype,SC.Reducers),Array.prototype.isEnumerable=YES,function(){var e={nextObject:SC.Enumerable.nextObject,enumerator:SC.Enumerable.enumerator,firstObject:SC.Enumerable.firstObject,lastObject:SC.Enumerable.lastObject,sortProperty:SC.Enumerable.sortProperty,mapProperty:function(e){var t=this.length,n=[];for(var r=0;r<t;r++){var i=this[r];n[r]=i?i.get?i.get(e):i[e]:null}return n},filterProperty:function(e,t){var n=this.length,r=[];for(var i=0;i<n;i++){var s=this[i],o=s?s.get?s.get(e):s[e]:null,u=t===undefined?!!o:SC.isEqual(o,t);u&&r.push(s)}return r},groupBy:function(e){var t=this.length,n=[],r=[],i=[],s,o,u;for(s=0;s<t;s++)o=this[s],u=o?o.get?o.get(e):o[e]:null,SC.none(r[u])&&(r[u]=[],i.push(u)),r[u].push(o);for(s=0,t=i.length;s<t;s++)n.push(r[i[s]]);return n},find:function(e,t){if(typeof e!="function")throw new TypeError;var n=this.length;t===undefined&&(t=null);var r,i=null,s=NO;for(var o=0;o<n&&!s;o++){r=this[o];if(s=e.call(t,r,o,this))i=r}return r=null,i},findProperty:function(e,t){var n=this.length,r,i,s=NO,o=null;for(var u=0;u<n&&!s;u++)i=(r=this[u])?r.get?r.get(e):r[e]:null,s=t===undefined?!!i:SC.isEqual(i,t),s&&(o=r);return r=null,o},everyProperty:function(e,t){var n=this.length,r=YES;for(var i=0;r&&i<n;i++
){var s=this[i],o=s?s.get?s.get(e):s[e]:null;r=t===undefined?!!o:SC.isEqual(o,t)}return r},someProperty:function(e,t){var n=this.length,r=NO;for(var i=0;!r&&i<n;i++){var s=this[i],o=s?s.get?s.get(e):s[e]:null;r=t===undefined?!!o:SC.isEqual(o,t)}return r},invoke:function(e){var t=this.length;if(t<=0)return[];var n,r=[],i=arguments.length;if(i>1)for(n=1;n<i;n++)r.push(arguments[n]);var s=[];for(n=0;n<t;n++){var o=this[n],u=o?o[e]:null;u&&(s[n]=u.apply(o,r))}return s},invokeWhile:function(e,t){var n=this.length;if(n<=0)return null;var r,i=[],s=arguments.length;if(s>2)for(r=2;r<s;r++)i.push(arguments[r]);var o=e;for(r=0;o===e&&r<n;r++){var u=this[r],a=u?u[t]:null;a&&(o=a.apply(u,i))}return o},toArray:function(){var e=this.length;if(e<=0)return[];var t=[];for(var n=0;n<e;n++){var r=this[n];t.push(r)}return t},getEach:function(e){var t=[],n=this.length;for(var r=0;r<n;r++){var i=this[r];t[r]=i?i.get?i.get(e):i[e]:null}return t},setEach:function(e,t){var n=this.length;for(var r=0;r<n;r++){var i=this[r];i&&(i.set?i.set(e,t):i[e]=t)}return this}},t={forEach:function(e,t){if(typeof e!="function")throw new TypeError;t===undefined&&(t=null);for(var n=0,r=this.length;n<r;n++){var i=this[n];e.call(t,i,n,this)}return this},map:function(e,t){if(typeof e!="function")throw new TypeError;t===undefined&&(t=null);var n=[];for(var r=0,i=this.length;r<i;r++){var s=this[r];n[r]=e.call(t,s,r,this)}return n},filter:function(e,t){if(typeof e!="function")throw new TypeError;t===undefined&&(t=null);var n=[];for(var r=0,i=this.length;r<i;r++){var s=this[r];e.call(t,s,r,this)&&n.push(s)}return n},every:function(
e,t){if(typeof e!="function")throw new TypeError;var n=this.length;t===undefined&&(t=null);var r=YES;for(var i=0;r&&i<n;i++){var s=this[i];e.call(t,s,i,this)||(r=NO)}return r},some:function(e,t){if(typeof e!="function")throw new TypeError;var n=this.length;t===undefined&&(t=null);var r=NO;for(var i=0;!r&&i<n;i++){var s=this[i];e.call(t,s,i,this)&&(r=YES)}return r},reduce:function(e,t,n){if(typeof e!="function")throw new TypeError;var r=this.length;if(r===0&&t===undefined)throw new TypeError;var i=t;for(var s=0;s<r;s++){var o=this[s];o!==null&&(i===undefined?i=o:i=e.call(null,i,o,s,this,n))}if(i===undefined)throw new TypeError;return i}};for(var n in t){if(!t.hasOwnProperty(n))continue;if(!Array.prototype[n]||typeof Prototype=="object"&&Prototype.Version.match(/^1\.6/))Array.prototype[n]=t[n]}SC.mixin(Array.prototype,e)}(),SC.RangeObserver={isRangeObserver:YES,toString:function(){var e=this.indexes?this.indexes.toString():"SC.IndexSet<..>";return e.replace("IndexSet","RangeObserver(%@)".fmt(SC.guidFor(this)))},create:function(e,t,n,r,i,s){var o=SC.beget(this);return o.source=e,o.indexes=t?t.frozenCopy():null,o.target=n,o.method=typeof r=="string"?n[r]:r,o.context=i,o.isDeep=s||!1,o.beginObserving(),o},extend:function(e){var t=SC.beget(this),n=arguments;for(var r=0,i=n.length;r<i;r++)SC.mixin(t,n[r]);return t},destroy:function(e){return this.endObserving(),this},update:function(e,t){return this.indexes&&this.indexes.isEqual(t)?this:(this.indexes=t?t.frozenCopy():null,this.endObserving().beginObserving(),this)},beginObserving:function(){if(!this.isDeep)return this;var e=this.observing=
this.observing||SC.CoreSet.create(),t=this._beginObservingForEach,n=this.source;return t||(t=this._beginObservingForEach=function(t){var r=n.objectAt(t);r&&r.addObserver&&(e.push(r),r._kvo_needsRangeObserver=!0)}),this.indexes.forEach(t),this.isObserving=!1,SC.Observers.addPendingRangeObserver(this),this},setupPending:function(e){var t=this.observing;if(this.isObserving||!t||t.get("length")===0)return!0;if(t.contains(e)){this.isObserving=!0;var n=this._setupPendingForEach;if(!n){var r=this.source,i=this.objectPropertyDidChange,s=this;n=this._setupPendingForEach=function(e){var n=r.objectAt(e),o=SC.guidFor(n),u;n&&n.addObserver&&(t.push(n),n.addObserver("*",s,i),u=s[o],u==null?s[o]=e:u.isIndexSet?u.add(e):s[o]=SC.IndexSet.create(u).add(e))}}return this.indexes.forEach(n),!0}return!1},endObserving:function(){if(!this.isDeep)return this;var e=this.observing;if(this.isObserving){var t=this.objectPropertyDidChange,n=this.source,r,i,s;if(e){i=e.length;for(r=0;r<i;r++)s=e[r],s.removeObserver("*",this,t),this[SC.guidFor(s)]=null;e.length=0}this.isObserving=!1}return e&&e.clear(),this},rangeDidChange:function(e){var t=this.indexes;if(!e||!t||t.intersects(e))this.endObserving(),this.method.call(this.target,this.source,null,"[]",e,this.context),this.beginObserving();return this},objectPropertyDidChange:function(e,t,n,r){var i=this.context,s=this.method,o=SC.guidFor(e),u=this[o];u&&!u.isIndexSet&&(u=this[o]=SC.IndexSet.create(u).freeze()),s.call(this.target,this.source,e,t,u,i||r,r)}},SC.OUT_OF_RANGE_EXCEPTION="Index out of range",SC.CoreArray={isSCArray:YES,replace:function(e,t,n){throw"replace() must be implemented to support SC.Array"
},indexOf:function(e,t){var n,r=this.get("length");t===undefined?t=0:t=t<0?Math.ceil(t):Math.floor(t),t<0&&(t+=r);for(n=t;n<r;n++)if(this.objectAt(n,YES)===e)return n;return-1},lastIndexOf:function(e,t){var n,r=this.get("length");t===undefined?t=r-1:t=t<0?Math.ceil(t):Math.floor(t),t<0&&(t+=r);for(n=t;n>=0;n--)if(this.objectAt(n)===e)return n;return-1},objectAt:function(e){return e<0?undefined:e>=this.get("length")?undefined:this.get(e)},"[]":function(e,t){return t!==undefined&&this.replace(0,this.get("length"),t),this}.property(),insertAt:function(e,t){if(e>this.get("length"))throw SC.OUT_OF_RANGE_EXCEPTION;return this.replace(e,0,[t]),this},removeAt:function(e,t){var n=0,r=[];if(typeof e===SC.T_NUMBER){if(e<0||e>=this.get("length"))throw SC.OUT_OF_RANGE_EXCEPTION;if(t===undefined)return this.replace(e,1,r),this;e=SC.IndexSet.create(e,t)}return this.beginPropertyChanges(),e.forEachRange(function(e,t){e-=n,n+=t,this.replace(e,t,r)},this),this.endPropertyChanges(),this},removeObject:function(e){var t=this.get("length")||0;while(--t>=0){var n=this.objectAt(t);n==e&&this.removeAt(t)}return this},removeObjects:function(e){return this.beginPropertyChanges(),e.forEach(function(e){this.removeObject(e)},this),this.endPropertyChanges(),this},slice:function(e,t){var n=[],r=this.get("length");SC.none(e)&&(e=0);if(SC.none(t)||t>r)t=r;while(e<t)n[n.length]=this.objectAt(e++);return n},pushObject:function(e){return this.insertAt(this.get("length"),e),e},pushObjects:function(e){return this.beginPropertyChanges(),e.forEach(function(e){this.pushObject(e)},this),this.endPropertyChanges(),this
},popObject:function(){var e=this.get("length");if(e===0)return null;var t=this.objectAt(e-1);return this.removeAt(e-1),t},shiftObject:function(){if(this.get("length")===0)return null;var e=this.objectAt(0);return this.removeAt(0),e},unshiftObject:function(e){return this.insertAt(0,e),e},unshiftObjects:function(e){return this.beginPropertyChanges(),e.forEach(function(e){this.unshiftObject(e)},this),this.endPropertyChanges(),this},isEqual:function(e){if(!e)return!1;if(e==this)return!0;var t=e.get("length");if(t!=this.get("length"))return!1;while(--t>=0)if(!SC.isEqual(e.objectAt(t),this.objectAt(t)))return!1;return!0},compact:function(){return this.without(null)},without:function(e){if(this.indexOf(e)<0)return this;var t=[];return this.forEach(function(n){n!==e&&(t[t.length]=n)}),t},uniq:function(){var e=[];return this.forEach(function(t){e.indexOf(t)<0&&(e[e.length]=t)}),e},flatten:function(){var e=[];return this.forEach(function(t){t&&t.isEnumerable?e=e.pushObjects(t.flatten()):e.pushObject(t)}),e},max:function(){return Math.max.apply(Math,this)},min:function(){return Math.min.apply(Math,this)},rangeObserverClass:SC.RangeObserver,contains:function(e){return this.indexOf(e)>=0},addRangeObserver:function(e,t,n,r){var i=this._array_rangeObservers;i||(i=this._array_rangeObservers=SC.CoreSet.create()),this._array_oldLength===undefined&&(this._array_oldLength=this.get("length"));var s=this.rangeObserverClass,o=NO,u=s.create(this,e,t,n,r,o);return i.add(u),this._array_isNotifyingRangeObservers||(this._array_isNotifyingRangeObservers=YES,this.addObserver("[]",this,this._array_notifyRangeObservers
)),u},updateRangeObserver:function(e,t){return e.update(this,t)},removeRangeObserver:function(e){var t=e.destroy(this),n=this._array_rangeObservers;return n&&n.remove(e),t},addArrayObservers:function(e){this._modifyObserverSet("add",e)},removeArrayObservers:function(e){this._modifyObserverSet("remove",e)},_modifyObserverSet:function(e,t){var n,r,i=t.target||this,s=t.willChange||"arrayWillChange",o=t.didChange||"arrayDidChange",u=t.context;typeof s=="string"&&(s=i[s]),typeof o=="string"&&(o=i[o]),n=this._kvo_for("_kvo_array_will_change",SC.ObserverSet),r=this._kvo_for("_kvo_array_did_change",SC.ObserverSet),n[e](i,s,u),r[e](i,o,u)},arrayContentWillChange:function(e,t,n){this._teardownContentObservers(e,t);var r,i,s,o,u,a,f=this._kvo_array_will_change;if(f){i=f.members,s=i.length;for(o=0;o<s;o++)r=i[o],u=r[0],a=r[1],a.call(u,e,t,n,this)}},arrayContentDidChange:function(e,t,n){var r=this._array_rangeObservers,i,s,o;this.beginPropertyChanges(),this.notifyPropertyChange("length"),r&&r.length>0&&(o=this._array_rangeChanges,o||(o=this._array_rangeChanges=SC.IndexSet.create()),t===n?s=t:(s=this.get("length")-e,t>n&&(s+=t-n)),o.add(e,s)),this._setupContentObservers(e,n);var u,a,f,l,c,h,p=this._kvo_array_did_change;if(p){e===undefined&&(e=0,t=this.get("length"),n=0),a=p.members,f=a.length;for(l=0;l<f;l++)u=a[l],c=u[0],h=u[1],h.call(c,e,t,n,this)}return this.notifyPropertyChange("[]"),this.endPropertyChanges(),this},_setupContentObservers:function(e,t){var n=this._kvo_for("_kvo_content_observed_keys",SC.CoreSet),r,i;if(n.get("length")>0){r=this.slice(e,e+t);var s=this;n.forEach(function(
e){i=SC.keyFor("_kvo_content_observers",e),s._kvo_for(i).forEach(function(e){r.forEach(function(t){s._resumeChainObservingForItemWithChainObserver(t,e)})})})}},_teardownContentObservers:function(e,t){var n=this._kvo_for("_kvo_content_observed_keys",SC.CoreSet),r,i;n.get("length")>0&&(r=this.slice(e,e+t),n.forEach(function(e){i=SC.keyFor("_kvo_content_observers",e),r.forEach(function(e){e._kvo_for(i).forEach(function(e){e.destroyChain()})})}))},teardownEnumerablePropertyChains:function(e){var t=this._kvo_enumerable_property_chains;return t&&t.forEach(function(t){var n,r=e.get("length"),i=SC.guidFor(t),s,o,u="_kvo_enumerable_property_clones";t.notifyPropertyDidChange();for(n=0;n<r;n++)o=e.objectAt(n),s=o[u][i],s.deactivate(),delete o[u][i]},this),this},setupEnumerablePropertyChains:function(e){var t=this._kvo_enumerable_property_chains;return t&&t.forEach(function(t){var n,r=e.get("length");t.notifyPropertyDidChange(),r=e.get("length");for(n=0;n<r;n++)this._clonePropertyChainToItem(t,e.objectAt(n))},this),this},registerDependentKeyWithChain:function(e,t){var n="_kvo_enumerable_property_chains",r,i,s,o;r=this._kvo_for(n,SC.CoreSet),r.add(t),this.forEach(function(e){this._clonePropertyChainToItem(t,e)},this)},_clonePropertyChainToItem:function(e,t){var n=SC.clone(e),r="_kvo_enumerable_property_clones",i;n.object=t,i=t[r]=t[r]||{},i[SC.guidFor(e)]=n,n.activate(t)},removeDependentKeyWithChain:function(e,t){var n="_kvo_enumerable_property_chains",r="_kvo_enumerable_property_clones",i,s,o,u;this.forEach(function(n){n.removeDependentKeyWithChain(e,t),u=n[r],o=u[SC.guidFor(t)],o.deactivate
(n)},this)},_resumeChainObservingForItemWithChainObserver:function(e,t){var n=SC.clone(t.next),r=n.property;n.object=e,e.addObserver(r,n,n.propertyDidChange),t.root.tails&&t.root.tails.pushObject(n.tail()),n.propertyDidChange(),e._kvo_for(SC.keyFor("_kvo_content_observers",r)).push(n)},_addContentObserver:function(e){var t=e.next.property;this._kvo_for("_kvo_content_observed_keys",SC.CoreSet).push(t);var n=SC.keyFor("_kvo_content_observers",t);this._kvo_for(n).push(e),this._setupContentObservers(0,e.object.get("length"))},_removeContentObserver:function(e){var t,n,r=this._kvo_content_observed_keys,i=e.next.property;r.contains(i)&&(n=SC.keyFor("_kvo_content_observers",i),t=this._kvo_for(n),t.removeObject(e),this._teardownContentObservers(0,e.object.get("length")),t.length===0&&this._kvo_for("_kvo_content_observed_keys").remove(i))},_array_notifyRangeObservers:function(){var e=this._array_rangeObservers,t=this._array_rangeChanges,n=e?e.length:0,r,i;if(n>0&&t&&t.length>0){for(r=0;r<n;r++)e[r].rangeDidChange(t);t.clear()}}},SC.Array=SC.mixin({},SC.Enumerable,SC.CoreArray),SC.supplement(Array.prototype,SC.CoreArray),SC.mixin(Array.prototype,{replace:function(e,t,n){if(this.isFrozen)throw SC.FROZEN_ERROR;var r,i=n?n.get?n.get("length"):n.length:0;return this.arrayContentWillChange(e,t,i),i===0?this.splice(e,t):(r=[e,t].concat(n),this.splice.apply(this,r)),this.arrayContentDidChange(e,t,i),this.enumerableContentDidChange(e,t,i-t),this},unknownProperty:function(e,t){var n=this.reducedProperty(e,t);return t!==undefined&&n===undefined&&(n=this[e]=t),n}}),Array.prototype.indexOf===SC.CoreArray
.indexOf&&(Array.prototype.indexOf=function(e,t){var n,r=this.length;t===undefined?t=0:t=t<0?Math.ceil(t):Math.floor(t),t<0&&(t+=r);for(n=t;n<r;n++)if(this[n]===e)return n;return-1}),Array.prototype.lastIndexOf===SC.CoreArray.lastIndexOf&&(Array.prototype.lastIndexOf=function(e,t){var n,r=this.length;t===undefined?t=r-1:t=t<0?Math.ceil(t):Math.floor(t),t<0&&(t+=r);for(n=t;n>=0;n--)if(this[n]===e)return n;return-1}),Date.now||(Date.now=function(){return(new Date).getTime()}),function(){var e=0,t=["ms","moz","webkit","o"],n;for(var r=0,i=t.length;r<i&&!window.requestAnimationFrame;++r)n=t[r],window.requestAnimationFrame=window[n+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n+"CancelAnimationFrame"]||window[n+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),s=window.setTimeout(function(){t(r+i)},i);return e=r+i,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),SC.String={_scs_valueForKey:function(e,t,n){var r,i,s,o=e.indexOf(":");o>-1&&(r=e.substr(o+1),e=e.substr(0,o)),i=t[e],s=t[e+"Formatter"];if(s)i=s(i,r);else if(r)throw"String.fmt was given a formatting string, but key `"+e+"` has no formatter! String: "+n;return i},fmt:function(e,t){var n=0,r=undefined,i,s,o;return t&&(r=t[0]),s=e,o=e.replace(/%\{(.*?)\}/g,function(t,n){i=YES;if(!r)throw"Cannot use named parameters with `fmt` without a data hash. String: '"+e+"'";return SC.String._scs_valueForKey(n,r,e)}),s.match(/%@/)&&(o=o.replace(/%@([0-9]+)?/g,function(r,s
){if(i)throw"Invalid attempt to use both named parameters and indexed parameters. String: '"+e+"'";return s=s?parseInt(s,10)-1:n++,t[s]})),o},w:function(e){var t=[],n=e.split(" "),r=n.length,i,s=0;for(s=0;s<r;++s)i=n[s],i.length!==0&&t.push(i);return t}},SC.mixin(String.prototype,{fmt:function(){return SC.String.fmt(this,arguments)},w:function(){return SC.String.w(this)}}),SC.Comparable={isComparable:YES,compare:function(e,t){throw"%@.compare() is not implemented".fmt(this.toString())}},SC.Copyable={isCopyable:YES,copy:function(e){var t=SC._object_className(this.constructor);throw"%@.copy() is not implemented".fmt(t)},frozenCopy:function(){var e=this.get?this.get("isFrozen"):this.isFrozen;if(e===YES)return this;if(e===undefined)throw"%@ does not support freezing".fmt(this);return this.copy().freeze()}},SC.mixin(Array.prototype,SC.Copyable),Array.prototype.copy=function(e){var t=this.slice(),n;if(e){n=t.length;while(n--)t[n]=SC.copy(t[n],!0)}return t},SC.FROZEN_ERROR=new Error("Cannot modify a frozen object"),SC.Freezable={isFreezable:YES,isFrozen:NO,freeze:function(){return this.set?this.set("isFrozen",YES):this.isFrozen=YES,this}},SC.mixin(Array.prototype,SC.Freezable),SC.Set=SC.mixin({},SC.Enumerable,SC.Observable,SC.Freezable,{create:function(e){var t,n,r=SC.Set._pool,i=this.isObservable,s;if(!i&&e===undefined&&r.length>0)return r.pop();t=SC.beget(this),i&&t.initObservable();if(e&&e.isEnumerable&&e.get("length")>0){t.isObservable=NO;if(e.isSCArray){s=e.get("length");for(n=0;n<s;n++)t.add(e.objectAt(n))}else if(e.isSet){s=e.length;for(n=0;n<s;n++)t.add(e[n])}else e.forEach
(function(e){t.add(e)},this);t.isObservable=i}return t},isSet:YES,length:0,firstObject:function(){return this.length>0?this[0]:undefined}.property(),clear:function(){if(this.isFrozen)throw SC.FROZEN_ERROR;return this.length=0,this},contains:function(e){if(e===null)return NO;var t=this[SC.hashFor(e)];return!SC.none(t)&&t<this.length&&this[t]===e},isEqual:function(e){if(!e||!e.isSet||e.get("length")!==this.get("length"))return NO;var t=this.get("length");while(--t>=0)if(!e.contains(this[t]))return NO;return YES},addSetObserver:function(e){this.setObservers||(this.setObservers=SC.CoreSet.create()),this.setObservers.add(e)},removeSetObserver:function(e){if(!this.setObservers)return;this.setObservers.remove(e)},add:function(e){if(this.isFrozen)throw SC.FROZEN_ERROR;if(SC.none(e))return this;var t,n=(t=e.hash)&&typeof t=="function"?t.call(e):SC.guidFor(e),r=this[n],i=this.length;if(r>=i||this[r]!==e)this[i]=e,this[n]=i,this.length=i+1,this.setObservers&&this.didAddItem(e);return this.isObservable&&this.enumerableContentDidChange(),this},addEach:function(e){if(this.isFrozen)throw SC.FROZEN_ERROR;if(!e||!e.isEnumerable)throw"%@.addEach must pass enumerable".fmt(this);var t,n=this.isObservable;n&&this.beginPropertyChanges();if(e.isSCArray){t=e.get("length");while(--t>=0)this.add(e.objectAt(t))}else if(e.isSet){t=e.length;while(--t>=0)this.add(e[t])}else e.forEach(function(e){this.add(e)},this);return n&&this.endPropertyChanges(),this},remove:function(e){if(this.isFrozen)throw SC.FROZEN_ERROR;if(e===null||e===undefined)return this;var t,n=e&&(t=e.hash)&&typeof t===SC.T_FUNCTION?t.call
(e):SC.guidFor(e),r=this[n],i=this.length,s;return r===null||r===undefined||r>=i||this[r]!==e?this:(delete this[n],r<i-1&&(s=this[r]=this[i-1],n=s&&(t=s.hash)&&typeof t===SC.T_FUNCTION?t.call(s):SC.guidFor(s),this[n]=r),delete this[i-1],this.length=i-1,this.isObservable&&this.enumerableContentDidChange(),this.setObservers&&this.didRemoveItem(e),this)},pop:function(){if(this.isFrozen)throw SC.FROZEN_ERROR;var e=this.length,t=e>0?this[e-1]:null;return this.remove(t),t},removeEach:function(e){if(this.isFrozen)throw SC.FROZEN_ERROR;if(!e||!e.isEnumerable)throw"%@.addEach must pass enumerable".fmt(this);var t,n=this.isObservable;n&&this.beginPropertyChanges();if(e.isSCArray){t=e.get("length");while(--t>=0)this.remove(e.objectAt(t))}else if(e.isSet){t=e.length;while(--t>=0)this.remove(e[t])}else e.forEach(function(e){this.remove(e)},this);return n&&this.endPropertyChanges(),this},copy:function(){return this.constructor.create(this)},destroy:function(){return this.isFrozen=NO,this.isObservable||SC.Set._pool.push(this.clear()),this},forEach:function(e,t){var n=this.length;t||(t=this);for(var r=0;r<n;r++)e.call(t,this[r],r,this);return this},toString:function(){var e=this.length,t,n=[];for(t=0;t<e;t++)n[t]=this[t];return"SC.Set<%@>".fmt(n.join(","))},didAddItem:function(e){var t=this.setObservers;if(!t)return;var n=t.length,r;for(r=0;r<n;r++)t[r].didAddItem(this,e)},didRemoveItem:function(e){var t=this.setObservers;if(!t)return;var n=t.length,r;for(r=0;r<n;r++)t[r].didRemoveItem(this,e)},_pool:[],isObservable:YES}),SC.Set.constructor=SC.Set,SC.Set.clone=SC.Set.copy,SC.Set.push=SC.Set
.unshift=SC.Set.add,SC.Set.shift=SC.Set.pop,SC.Set.addObject=SC.Set.add,SC.Set.removeObject=SC.Set.remove,SC.Set._pool=[],SC.CoreSet=SC.beget(SC.Set),SC.CoreSet.isObservable=NO,SC.CoreSet.constructor=SC.CoreSet,SC.Observers={queue:[],addObserver:function(e,t,n,r){var i;typeof e=="string"?i=SC.tupleForPropertyPath(e,r):i=e,i&&i[0].addObserver?i[0].addObserver(i[1],t,n):this.queue.push([e,t,n,r])},removeObserver:function(e,t,n,r){var i,s,o,u;o=SC.tupleForPropertyPath(e,r),o&&o[0].removeObserver(o[1],t,n),i=this.queue.length,s=this.queue,newQueue=undefined;while(--i>=0){u=s[i];if(u[0]!==e||u[1]!==t||u[2]!==n||u[3]!==r)newQueue||(newQueue=[]),newQueue.push(u)}this.queue=newQueue||this.queue},addPendingRangeObserver:function(e){var t=this.rangeObservers;return t||(t=this.rangeObservers=SC.CoreSet.create()),t.add(e),this},_TMP_OUT:[],flush:function(e){var t=this.queue,n,r=t.length;if(t&&r>0){var i=this.queue=[];for(n=0;n<r;n++){var s=t[n];if(!s)continue;var o=SC.tupleForPropertyPath(s[0],s[3]);o&&o[0].addObserver?o[0].addObserver(o[1],s[1],s[2]):i.push(s)}}if(e._kvo_needsRangeObserver){var u=this.rangeObservers,a=u?u.get("length"):0,f=this._TMP_OUT,l;for(n=0;n<a;n++)l=u[n],l.setupPending(e)&&f.push(l);f.length>0&&u.removeEach(f),f.length=0,e._kvo_needsRangeObserver=!1}},isObservingSuspended:0,_pending:SC.CoreSet.create(),objectHasPendingChanges:function(e){this._pending.add(e)},suspendPropertyObserving:function(){this.isObservingSuspended++},resumePropertyObserving:function(){var e;if(--this.isObservingSuspended<=0){e=this._pending,this._pending=SC.CoreSet.create();var t,n=e.length
;for(t=0;t<n;t++)e[t]._notifyPropertyObservers();e.clear(),e=null}}},SC.BENCHMARK_OBJECTS=NO,SC._detect_base=function(t,n,r){return function(){var i=n[r],s;if(!i)throw new Error("No '"+r+"' method was found on the superclass");return t.isEnhancement?s=Array.prototype.slice.call(arguments,1):s=arguments,i.apply(this,s)}},SC._object_extend=function(t,n,r){if(!n)throw"SC.Object.extend expects a non-null value.  Did you forget to 'sc_require' something?  Or were you passing a Protocol to extend() as if it were a mixin?";t._kvo_cloned=null;var i,s,o,u,a=t.concatenatedProperties,f=SC.K,l,c;s=a?a.length:0;var h=s>0?{}:null;while(--s>=0)i=a[s],l=t[i],c=n[i],l?(l instanceof Array||(l=SC.$A(l)),h[i]=c?l.concat(c):c):(c instanceof Array||(c=SC.$A(c)),h[i]=c);var p=t._bindings,d=NO,v=t._observers,m=NO,g=t._properties,y=NO,b,w,E,S,x=t.outlets,T=NO;n.outlets&&(x=(x||SC.EMPTY_ARRAY).concat(n.outlets),T=YES);for(i in n){if(i==="_kvo_cloned")continue;if(!n.hasOwnProperty(i))continue;S=(h.hasOwnProperty(i)?h[i]:null)||n[i];if(i.length>7&&i.slice(-7)==="Binding")d||(p=(p||SC.EMPTY_ARRAY).slice(),d=YES),p===null&&(p=(t._bindings||SC.EMPTY_ARRAY).slice()),p[p.length]=i;else if(S&&S instanceof Function){!S.superclass&&S!==(u=t[i])&&(S.superclass=u||f,S.base=r?SC._detect_base(S,r,i):u||f),S.propertyPaths&&(m||(v=(v||SC.EMPTY_ARRAY).slice(),m=YES),v[v.length]=i);if(b=S.localPropertyPaths){w=b.length;while(--w>=0)E=t._kvo_for(SC.keyFor("_kvo_local",b[w]),SC.CoreSet),E.add(i),t._kvo_for("_kvo_observed_keys",SC.CoreSet).add(b[w])}S.dependentKeys&&(y||(g=(g||SC.EMPTY_ARRAY).slice(),y=YES),g[g.length]=i
),S.autoconfiguredOutlet&&(T||(x=(x||SC.EMPTY_ARRAY).slice(),T=YES),x[x.length]=i),S.isEnhancement&&(S=SC._enhance(t[i]||f,S))}t[i]=S}return n.hasOwnProperty("toString")&&(i="toString",S=(h.hasOwnProperty(i)?h[i]:null)||n[i],!S.superclass&&S!==(u=t[i])&&(S.superclass=S.base=u||f),t[i]=S),t._bindings=p||[],t._observers=v||[],t._properties=g||[],t.outlets=x||[],t},SC._enhance=function(e,t){return function(){var n=Array.prototype.slice.call(arguments,0),r=this;return n.unshift(function(){return e.apply(r,arguments)}),t.apply(this,n)}},SC.Object=function(e){return this.__sc_super__=SC.Object.prototype,this._object_init(e)},SC.mixin(SC.Object,{mixin:function(e){var t=arguments.length,n;for(n=0;n<t;n++)SC.mixin(this,arguments[n]);return this},superclass:null,extend:function(e){var t=SC.BENCHMARK_OBJECTS;t&&SC.Benchmark.start("SC.Object.extend");var n,r=function(e){return this.__sc_super__=r.prototype,this._object_init(e)};for(n in this){if(!this.hasOwnProperty(n))continue;r[n]=this[n]}this.hasOwnProperty("toString")&&(r.toString=this.toString),r.superclass=this,r.__sc_super__=this.prototype,SC.generateGuid(r,"sc"),r.subclasses=SC.Set.create(),this.subclasses.add(r);var i=r.prototype=SC.beget(this.prototype),s,o=arguments.length;for(s=0;s<o;s++)SC._object_extend(i,arguments[s],r.__sc_super__);return i.constructor=r,t&&SC.Benchmark.end("SC.Object.extend"),r},reopen:function(e){return SC._object_extend(this.prototype,e,this.__sc_super__)},create:function(){var e=this,t=new e(arguments);return t},isClass:YES,subclasses:SC.Set.create(),toString:function(){return SC._object_className(this
)},subclassOf:function(e){if(this===e)return NO;var t=this;while(t=t.superclass)if(t===e)return YES;return NO},hasSubclass:function(e){return e&&e.subclassOf?e.subclassOf(this):NO},kindOf:function(e){return this===e||this.subclassOf(e)},design:function(){if(this.isDesign)return this;var e=this.extend.apply(this,arguments);return e.isDesign=YES,e}}),SC.Object.prototype={_kvo_enabled:YES,_object_init:function(e){var t,n=e?e.length:0;for(t=0;t<n;t++)SC._object_extend(this,e[t],this.__sc_super__);SC.generateGuid(this,"sc"),this.init();var r=this.initMixin;n=r?r.length:0;for(t=0;t<n;t++)r[t].call(this);return this},mixin:function(){var e,t=arguments.length,n;for(e=0;e<t;e++)SC.mixin(this,arguments[e]);for(e=0;e<t;e++)n=arguments[e].initMixin,n&&n.call(this);return this},init:function(){return this.initObservable(),this},isDestroyed:NO,destroy:function(){if(this.get("isDestroyed"))return this;this.set("isDestroyed",YES);var e,t=this.destroyMixin,n=t?t.length:0;for(e=0;e<n;e++)t[e].call(this);return this.bindings.invoke("disconnect"),this.bindings=null,this},isObject:!0,respondsTo:function(e){return this[e]instanceof Function},tryToPerform:function(e,t,n){return this.respondsTo(e)&&this[e](t,n)!==NO},superclass:function(e){var t=arguments.callee.caller;if(!t)throw"superclass cannot determine the caller method";return t.superclass?t.superclass.apply(this,arguments):null},instanceOf:function(e){return this.constructor===e},kindOf:function(e){return this.constructor.kindOf(e)},toString:function(){if(!this._object_toString){var e=SC._object_className(this.constructor),t=e+":"+SC.guidFor
(this);if(!e)return t;this._object_toString=t}return this._object_toString},awake:function(){var e=this.outlets,t,n,r;for(t=0,n=e.length;t<n;++t)r=e[t],this.get(r);this.bindings.invoke("sync")},invokeOnce:function(e){return SC.RunLoop.currentRunLoop.invokeOnce(this,e),this},invokeLast:function(e){return SC.RunLoop.currentRunLoop.invokeLast(this,e),this},concatenatedProperties:["concatenatedProperties","initMixin","destroyMixin"]},SC.Object.prototype.constructor=SC.Object,SC.mixin(SC.Object.prototype,SC.Observable),SC.instanceOf=function(e,t){return!!e&&e.constructor===t},SC.kindOf=function(e,t){return e&&!e.isClass&&(e=e.constructor),!!(e&&e.kindOf&&e.kindOf(t))},SC._object_className=function(e){if(SC.isReady===NO)return"";e._object_className||findClassNames();if(e._object_className)return e._object_className;var t=e;while(t&&!t._object_className)t=t.superclass;return t&&t._object_className?t._object_className:"Anonymous"},SC._PropertyChain=SC.Object.extend({object:null,property:null,target:null,toInvalidate:null,nextProperty:null,activate:function(e){var t=this.get("object"),n=this.get("property"),r;return e||(e=this.get("target")),t&&t!==e&&this.deactivate(),this.set("object",e),e&&n!=="@each"&&e.registerDependentKeyWithChain(n,this),this.next&&(r=e?e.get(n):undefined,this.next.activate(r)),this},deactivate:function(){var e=this.get("object"),t=this.get("property");return e&&e.removeDependentKeyWithChain(t,this),this.next&&this.next.deactivate(),this},notifyPropertyDidChange:function(){var e=this.get("target"),t=this.get("toInvalidate"),n,r;e.propertyDidChange(t),this.next&&
(n=this.get("object"),r=n.get(this.get("property")),this.next.activate(r))}}),SC._PropertyChain.createChain=function(e,t,n){var r=e.split("."),i=r.length,s=1,o=SC._PropertyChain.create({property:r[0],target:t,toInvalidate:n,nextProperty:r[1]});o.set("length",i);var u=o;while(--i>=1)u=u.next=SC._PropertyChain.create({property:r[s],target:t,toInvalidate:n,nextProperty:r[++s]}),u.set("length",i);return o},SC.LOG_BINDINGS=NO,SC.BENCHMARK_BINDING_NOTIFICATIONS=NO,SC.BENCHMARK_BINDING_SETUP=NO,SC.MULTIPLE_PLACEHOLDER="@@MULT@@",SC.NULL_PLACEHOLDER="@@NULL@@",SC.EMPTY_PLACEHOLDER="@@EMPTY@@",SC.Binding={beget:function(e){var t=SC.beget(this);return t.parentBinding=this,e!==undefined&&(t=t.from(e)),t},builder:function(){var e=this,t=function(t){return e.beget().from(t)};return t.beget=function(){return e.beget()},t},from:function(e,t){if(!e)return this;var n=this===SC.Binding?this.beget():this;return n._fromPropertyPath=e,n._fromRoot=t,n._fromTuple=null,n},to:function(e,t){var n=this===SC.Binding?this.beget():this;return n._toPropertyPath=e,n._toRoot=t,n._toTuple=null,n},connect:function(){return this.isConnected?this:(this.isConnected=YES,this._connectionPending=YES,this._syncOnConnect=YES,SC.Binding._connectQueue.add(this),SC.RunLoop.isRunLoopInProgress()||this._scheduleSync(),this)},_connect:function(){if(!this._connectionPending)return;this._connectionPending=NO;var e,t,n=SC.BENCHMARK_BINDING_SETUP;e=this._fromPropertyPath,t=this._fromRoot,typeof e=="string"&&(e.indexOf(".")===0?(e=e.slice(1),t||(t=this._toRoot)):e.indexOf("*")===0&&(e=[this._fromRoot||this._toRoot,e.slice(1)],t=
null)),this._fromObserverData=[e,this,this.fromPropertyDidChange,t],SC.Observers.addObserver.apply(SC.Observers,this._fromObserverData),this._oneWay||(e=this._toPropertyPath,t=this._toRoot,this._toObserverData=[e,this,this.toPropertyDidChange,t],SC.Observers.addObserver.apply(SC.Observers,this._toObserverData)),this._syncOnConnect&&(this._syncOnConnect=NO,this.sync())},disconnect:function(){return this.isConnected?(this._connectionPending?this._connectionPending=NO:(SC.Observers.removeObserver.apply(SC.Observers,this._fromObserverData),this._oneWay||SC.Observers.removeObserver.apply(SC.Observers,this._toObserverData)),this.isConnected=NO,this):this},fromPropertyDidChange:function(e,t){var n=e?e.get(t):null;if(n!==this._bindingValue||t==="[]")this._setBindingValue(e,t),this._changePending=YES,SC.Binding._changeQueue.add(this),this._scheduleSync()},toPropertyDidChange:function(e,t){if(this._oneWay)return;var n=e.get(t);n!==this._transformedBindingValue&&(this._setBindingValue(e,t),this._changePending=YES,SC.Binding._changeQueue.add(this),this._scheduleSync())},_scheduleSync:function(){if(SC.RunLoop.isRunLoopInProgress()||SC.Binding._syncScheduled)return;SC.Binding._syncScheduled=YES,setTimeout(function(){SC.run(),SC.Binding._syncScheduled=NO},1)},_setBindingValue:function(e,t){this._bindingSource=e,this._bindingKey=t},_computeBindingValue:function(){var e=this._bindingSource,t=this._bindingKey,n,r;this._bindingValue=n=e?e.getPath(t):null;var i=this._transforms;if(i){var s=i.length,o;for(r=0;r<s;r++)o=i[r],n=o(n,this)}this._noError&&SC.typeOf(n)===SC.T_ERROR&&(n=null),this._transformedBindingValue=
n},_connectQueue:SC.CoreSet.create(),_alternateConnectQueue:SC.CoreSet.create(),_changeQueue:SC.CoreSet.create(),_alternateChangeQueue:SC.CoreSet.create(),_changePending:NO,flushPendingChanges:function(){if(this._isFlushing)return NO;this._isFlushing=YES,SC.Observers.suspendPropertyObserving();var e=NO,t=SC.LOG_BINDINGS,n,r;while((n=this._connectQueue).length>0){this._connectQueue=this._alternateConnectQueue,this._alternateConnectQueue=n;while(r=n.pop())r._connect()}while((n=this._changeQueue).length>0){e=YES,this._changeQueue=this._alternateChangeQueue,this._alternateChangeQueue=n;while(r=n.pop())r.applyBindingValue()}return this._isFlushing=NO,SC.Observers.resumePropertyObserving(),e},applyBindingValue:function(){this._changePending=NO,this._computeBindingTargets(),this._computeBindingValue();var e=this._bindingValue,t=this._transformedBindingValue,n=SC.BENCHMARK_BINDING_NOTIFICATIONS,r=SC.LOG_BINDINGS;!this._oneWay&&this._fromTarget&&this._fromTarget.setPathIfChanged(this._fromPropertyKey,e),this._toTarget&&this._toTarget.setPathIfChanged(this._toPropertyKey,t)},sync:function(){if(!this.isConnected)return this;if(this._connectionPending)this._syncOnConnect=YES;else{this._computeBindingTargets();var e=this._fromTarget,t=this._fromPropertyKey;if(!e||!t)return this;if(!e.isObservable)return SC.Logger.warn("Cannot bind '%@' to property '%@' on non-observable '%@'".fmt(this._toPropertyPath,t,e)),this;var n=e.getPath(t);if(n!==this._bindingValue||t==="[]")this._setBindingValue(e,t),this._changePending=YES,SC.Binding._changeQueue.add(this)}return this},_syncOnConnect:NO,_computeBindingTargets
:function(){if(!this._fromTarget){var e,t,n;e=this._fromPropertyPath,t=this._fromRoot,typeof e=="string"&&(e.indexOf(".")===0?(e=e.slice(1),t||(t=this._toRoot)):e.indexOf("*")===0&&(e=[t||this._toRoot,e.slice(1)],t=null)),n=SC.tupleForPropertyPath(e,t),n&&(this._fromTarget=n[0],this._fromPropertyKey=n[1])}this._toTarget||(e=this._toPropertyPath,t=this._toRoot,n=SC.tupleForPropertyPath(e,t),n&&(this._toTarget=n[0],this._toPropertyKey=n[1]))},oneWay:function(e,t){t===undefined&&SC.typeOf(e)===SC.T_BOOL&&(t=e,e=null);var n=this.from(e);return n===SC.Binding&&(n=n.beget()),n._oneWay=t===undefined?YES:t,n},transform:function(e){var t=this===SC.Binding?this.beget():this,n=t._transforms;return n&&n===t.parentBinding._transforms&&(n=t._transforms=n.slice()),n||(n=t._transforms=[]),n.push(e),t},resetTransforms:function(){var e=this===SC.Binding?this.beget():this;return e._transforms=null,e},noError:function(e,t){t===undefined&&SC.typeOf(e)===SC.T_BOOL&&(t=e,e=null);var n=this.from(e);return n===SC.Binding&&(n=n.beget()),n._noError=t===undefined?YES:t,n},single:function(e,t){return t===undefined&&(t=SC.MULTIPLE_PLACEHOLDER),this.from(e).transform(function(e,n){if(e&&e.isEnumerable){var r=e.get("length");e=r>1?t:r<=0?null:e.firstObject()}return e})},notEmpty:function(e,t){return t===undefined&&(t=SC.EMPTY_PLACEHOLDER),this.from(e).transform(function(e,n){if(SC.none(e)||e===""||SC.isArray(e)&&e.length===0)e=t;return e})},notNull:function(e,t){return t===undefined&&(t=SC.EMPTY_PLACEHOLDER),this.from(e).transform(function(e,n){return SC.none(e)&&(e=t),e})},multiple:function(e){return this
.from(e).transform(function(e){return SC.isArray(e)||(e=e==null?[]:[e]),e})},bool:function(e){return this.from(e).transform(function(e){var t=SC.typeOf(e);return t===SC.T_ERROR?e:t==SC.T_ARRAY?e.length>0:e===""?NO:!!e})},and:function(e,t){var n=SC.Object.create({valueABinding:e,valueBBinding:t,and:function(){return this.get("valueA")&&this.get("valueB")}.property("valueA","valueB").cacheable()});return this.from("and",n).oneWay()},or:function(e,t){var n=SC.Object.create({valueABinding:e,valueBBinding:t,or:function(){return this.get("valueA")||this.get("valueB")}.property("valueA","valueB").cacheable()});return this.from("or",n).oneWay()},not:function(e){return this.from(e).transform(function(e){var t=SC.typeOf(e);return t===SC.T_ERROR?e:!(t==SC.T_ARRAY?e.length>0:e===""?NO:!!e)})},isNull:function(e){return this.from(e).transform(function(e){var t=SC.typeOf(e);return t===SC.T_ERROR?e:SC.none(e)})},toString:function(){var e=this._fromRoot?"<%@>:%@".fmt(this._fromRoot,this._fromPropertyPath):this._fromPropertyPath,t=this._toRoot?"<%@>:%@".fmt(this._toRoot,this._toPropertyPath):this._toPropertyPath,n=this._oneWay?"[oneWay]":"";return"SC.Binding%@(%@ -> %@)%@".fmt(SC.guidFor(this),e,t,n)}},SC.binding=function(e,t){return SC.Binding.from(e,t)},SC.Error=SC.Object.extend({code:-1,message:"",errorValue:null,errorObject:function(){return this}.property().cacheable(),label:null,toString:function(){return"SC.Error:%@:%@ (%@)".fmt(SC.guidFor(this),this.get("message"),this.get("code"))},isError:YES}),SC.Error.desc=function(e,t,n,r){var i={message:e};return t!==undefined&&(i.label=t),r!==undefined&&
(i.code=r),n!==undefined&&(i.errorValue=n),this.create(i)},SC.$error=function(e,t,n,r){return SC.Error.desc(e,t,n,r)},SC.ok=function(e){return e!==!1&&(!e||!e.isError)},SC.$ok=SC.ok,SC.val=function(e){return e&&e.isError?e.get?e.get("errorValue"):null:e},SC.$val=SC.val,SC.Error.HAS_MULTIPLE_VALUES=-100,SC.IndexSet=SC.mixin({},SC.Enumerable,SC.Observable,SC.Freezable,SC.Copyable,{_sc_sliceContent:function(e){if(e.length<1e3)return e.slice();var t=0,n=[],r=e[0];while(r!==0)n[t]=r,t=r<0?0-r:r,r=e[t];return n[t]=0,this._hint(0,t,n),n},create:function(e,t){var n=SC.beget(this);return n.initObservable(),n.registerDependentKey("min","[]"),e&&e.isIndexSet?(n._content=this._sc_sliceContent(e._content),n.max=e.max,n.length=e.length,n.source=e.source):(n._content=[0],e!==undefined&&n.add(e,t)),n},isIndexSet:YES,HINT_SIZE:256,length:0,max:0,min:function(){var e=this._content,t=e[0];return t===0?-1:t>0?0:Math.abs(t)}.property("[]").cacheable(),firstObject:function(){return this.get("length")>0?this.get("min"):undefined}.property(),rangeStartForIndex:function(e){var t=this._content,n=this.get("max"),r,i,s;if(e>=n)return n;if(Math.abs(t[e])>e)return e;s=e-e%SC.IndexSet.HINT_SIZE,r=t[s];if(r<0||r>e)r=s;i=Math.abs(t[r]);while(i<e)r=i,i=Math.abs(t[r]);return r},isEqual:function(e){if(e===this)return YES;if(!e||!e.isIndexSet||e.max!==this.max||e.length!==this.length)return NO;var t=this._content,n=e._content,r=0,i=t[r];do{if(n[r]!==i)return NO;r=Math.abs(i),i=t[r]}while(r!==0);return YES},indexBefore:function(e){if(e===0)return-1;e--;var t=this._content,n=this.get("max"),r=this.rangeStartForIndex
(e);if(!t)return null;while(r===n||t[r]<0){if(r===0)return-1;e=r-1,r=this.rangeStartForIndex(e)}return e},indexAfter:function(e){var t=this._content,n=this.get("max"),r,i;if(!t||e>=n)return-1;e++,r=this.rangeStartForIndex(e),i=t[r];while(i<0){if(i===0)return-1;e=r=Math.abs(i),i=t[r]}return e},contains:function(e,t){var n,r,i,s,o;if(t===undefined){if(e===null||e===undefined)return NO;if(typeof e===SC.T_NUMBER)t=1;else{if(e&&e.isIndexSet){if(e===this)return YES;n=e._content,r=0,i=n[r];while(i!==0){if(i>0&&!this.contains(r,i-r))return NO;r=Math.abs(i),i=n[r]}return YES}t=e.length,e=e.start}}return s=this.rangeStartForIndex(e),o=this._content[s],o>0&&s<=e&&o>=e+t},intersects:function(e,t){var n,r,i,s;if(t===undefined)if(typeof e===SC.T_NUMBER)t=1;else{if(e&&e.isIndexSet){if(e===this)return YES;n=e._content,r=0,i=n[r];while(i!==0){if(i>0&&this.intersects(r,i-r))return YES;r=Math.abs(i),i=n[r]}return NO}t=e.length,e=e.start}r=this.rangeStartForIndex(e),n=this._content,i=n[r],s=e+t;while(r<s){if(i===0)return NO;if(i>0&&i>e)return YES;r=Math.abs(i),i=n[r]}return NO},without:function(e,t){return e===this?SC.IndexSet.create():this.clone().remove(e,t)},replace:function(e,t){if(t===undefined)if(typeof e===SC.T_NUMBER)t=1;else{if(e&&e.isIndexSet)return this._content=this._sc_sliceContent(e._content),this.beginPropertyChanges().set("max",e.max).set("length",e.length).set("source",e.source).enumerableContentDidChange(),this.endPropertyChanges(),this;t=e.length,e=e.start}var n=this.length;return this._content.length=1,this._content[0]=0,this.length=this.max=0,this.add(e,t)},add:function(e,t
){if(this.isFrozen)throw SC.FROZEN_ERROR;var n,r,i;if(e&&e.isIndexSet){n=e._content;if(!n)return this;r=0,i=n[0];while(i!==0)i>0&&this.add(r,i-r),r=i<0?0-i:i,i=n[r];return this}if(t===undefined){if(e===null||e===undefined)return this;typeof e===SC.T_NUMBER?t=1:(t=e.length,e=e.start)}else t===null&&(t=1);if(t<=0)return this;var s=this.get("max"),o=s,u,a;n=this._content;if(e===s)e>0?(r=this.rangeStartForIndex(e-1),i=n[r],i>0?(delete n[s],n[r]=s=e+t,e=r):n[s]=s=e+t):n[e]=s=t,n[s]=0,this.set("max",s),this.set("length",this.length+t),t=s-e;else if(e>s)n[s]=0-e,n[e]=e+t,n[e+t]=0,this.set("max",e+t),this.set("length",this.length+t),t=e+t-s,e=s;else{r=this.rangeStartForIndex(e),i=n[r],s=e+t,u=0,e>0&&r===e&&i<=0&&(r=this.rangeStartForIndex(e-1),i=n[r]),i<0?(n[r]=0-e,Math.abs(i)>s?(n[e]=0-s,n[s]=i):n[e]=i):(e=r,i>s&&(s=i)),r=e;while(r<s)a=n[r],a===0?(n[s]=0,i=s,u+=s-r):(i=Math.abs(a),i>s&&(n[s]=a,i=s),a<0&&(u+=i-r)),delete n[r],r=i;(r=n[s])>0&&(delete n[s],s=r),n[e]=s,s>o&&this.set("max",s),this.set("length",this.get("length")+u),t=s-e}return this._hint(e,t),u!==0&&this.enumerableContentDidChange(),this},remove:function(e,t){if(this.isFrozen)throw SC.FROZEN_ERROR;if(t===undefined){if(e===null||e===undefined)return this;if(typeof e===SC.T_NUMBER)t=1;else{if(e.isIndexSet)return e.forEachRange(this.remove,this),this;t=e.length,e=e.start}}if(t<=0)return this;var n=this.get("max"),r=n,i=this._content,s,o,u,a,f;if(e>=n)return this;s=this.rangeStartForIndex(e),o=i[s],f=e+t,u=0;var l=this.HINT_SIZE,c=e-e%l+l;Math.abs(i[c])===e&&(i[c]=0),e>0&&s===e&&o>0&&(s=this.rangeStartForIndex(e-1),o=i[s])
,o>0?(i[s]=e,o>f?(i[e]=f,i[f]=o):i[e]=o):(e=s,o=Math.abs(o),o>f&&(f=o)),s=e;while(s<f)a=i[s],a===0?(i[f]=0,o=f):(o=Math.abs(a),o>f&&(i[f]=a,o=f),a>0&&(u+=o-s)),delete i[s],s=o;return(s=i[f])<0&&(delete i[f],f=Math.abs(s)),i[f]===0?(delete i[f],i[e]=0,this.set("max",e)):i[e]=0-f,this.set("length",this.get("length")-u),t=f-e,this._hint(e,t),u!==0&&this.enumerableContentDidChange(),this},_hint:function(e,t,n){n===undefined&&(n=this._content);var r=SC.IndexSet.HINT_SIZE,i=Math.abs(n[e]),s=e-e%r+r,o=e+t;while(s<o){while(i!==0&&i<=s)e=i,i=Math.abs(n[e]);i===0?delete n[s]:s!==e&&(n[s]=-e),s+=r}},clear:function(){if(this.isFrozen)throw SC.FROZEN_ERROR;var e=this.length;this._content.length=1,this._content[0]=0,this.set("length",0).set("max",0),e>0&&this.enumerableContentDidChange()},addEach:function(e){if(this.isFrozen)throw SC.FROZEN_ERROR;this.beginPropertyChanges();var t=e.get("length");if(e.isSCArray)while(--t>=0)this.add(e.objectAt(t));else e.isEnumerable&&e.forEach(function(e){this.add(e)},this);return this.endPropertyChanges(),this},removeEach:function(e){if(this.isFrozen)throw SC.FROZEN_ERROR;this.beginPropertyChanges();var t=e.get("length");if(e.isSCArray)while(--t>=0)this.remove(e.objectAt(t));else e.isEnumerable&&e.forEach(function(e){this.remove(e)},this);return this.endPropertyChanges(),this},clone:function(){return SC.IndexSet.create(this)},inspect:function(){var e=this._content,t=e.length,n=0,r=[],i;for(n=0;n<t;n++)i=e[n],i!==undefined&&r.push("%@:%@".fmt(n,i));return"SC.IndexSet<%@>".fmt(r.join(" , "))},forEachRange:function(e,t){var n=this._content,r=0,i=n[r],s=this
.source;t===undefined&&(t=null);while(i!==0)i>0&&e.call(t,r,i-r,this,s),r=Math.abs(i),i=n[r];return this},forEachIn:function(e,t,n,r){var i=this._content,s=0,o=0,u=e+t,a=this.source,f=i[s];r===undefined&&(r=null);while(f!==0){s<e&&(s=e);while(s<f&&s<u)n.call(r,s++,o++,this,a);s>=u?s=f=0:(s=Math.abs(f),f=i[s])}return this},lengthIn:function(e,t){var n=0;if(t===undefined){if(e===null||e===undefined)return 0;if(typeof e===SC.T_NUMBER)t=1;else{if(e.isIndexSet)return e.forEachRange(function(e,t){n+=this.lengthIn(e,t)},this),n;t=e.length,e=e.start}}if(this.get("length")===0)return 0;var r=this._content,i=0,s=r[i],o=e+t;while(i<o&&s!==0)s>0&&(n+=s>o?o-i:s-i),i=Math.abs(s),s=r[i];return n},source:null,indexOf:function(e,t){var n=this.source;if(!n)throw"%@.indexOf() requires source".fmt(this);var r=n.get("length"),i=this._content,s=i[0]<0?Math.abs(i[0]):0,o;while(s>=0&&s<r){o=n.indexOf(e,s);if(o<0)return-1;if(this.contains(o))return o;s=o+1}return-1},lastIndexOf:function(e,t){var n=this.source;if(!n)throw"%@.lastIndexOf() requires source".fmt(this);var r=n.get("length"),i=this.max-1,s;i>=r&&(i=r-1);while(i>=0){s=n.lastIndexOf(e,i);if(s<0)return-1;if(this.contains(s))return s;i=s+1}return-1},forEachObject:function(e,t){var n=this.source;if(!n)throw"%@.forEachObject() requires source".fmt(this);var r=this._content,i=0,s=0,o=r[i];t===undefined&&(t=null);while(o!==0){while(i<o)e.call(t,n.objectAt(i),i,n,this),i++;i=Math.abs(o),o=r[i]}return this},addObject:function(e,t){var n=this.source;if(!n)throw"%@.addObject() requires source".fmt(this);var r=n.get("length"),i=0,s;while(i>=0&&i<r){s=
n.indexOf(e,i);if(!(s>=0))return this;this.add(s);if(t)return this;i=s++}return this},addObjects:function(e,t){return e.forEach(function(e){this.addObject(e,t)},this),this},removeObject:function(e,t){var n=this.source;if(!n)throw"%@.removeObject() requires source".fmt(this);var r=n.get("length"),i=0,s;while(i>=0&&i<r){s=n.indexOf(e,i);if(!(s>=0))return this;this.remove(s);if(t)return this;i=s+1}return this},removeObjects:function(e,t){return e.forEach(function(e){this.removeObject(e,t)},this),this},LOG_OBSERVING:NO,forEach:function(e,t){var n=this._content,r=0,i=0,s=this.source,o=n[r];t===undefined&&(t=null);while(o!==0){while(r<o)e.call(t,r++,i++,this,s);r=Math.abs(o),o=n[r]}return this},nextObject:function(e,t,n){var r=this._content,i=n.next,s=this.get("max");if(t===null)t=i=0;else{if(t>=s)return delete n.next,null;t++}if(t===i){do t=Math.abs(i),i=r[t];while(i<0);n.next=i}return t<i?t:null},toString:function(){var e=[];return this.forEachRange(function(t,n){e.push(n===1?t:"%@..%@".fmt(t,t+n-1))},this),"SC.IndexSet<%@>".fmt(e.join(","))}}),SC.IndexSet.slice=SC.IndexSet.copy=SC.IndexSet.clone,SC.IndexSet.EMPTY=SC.IndexSet.create().freeze(),SC.json={encode:function(e){return JSON.stringify(e)},decode:function(e){return JSON.parse(e)}},this.JSON||(this.JSON={}),function(){function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a&&typeof a=="object"&&typeof 
a.toJSON=="function"&&(a=a.toJSON(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)r=rep[n],typeof r=="string"&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(
e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),SC.LOGGER_LOG_DELIMITER=", ",SC.LOGGER_LOG_ERROR="ERROR: ",SC.LOGGER_LOG_INFO="INFO:  ",SC.LOGGER_LOG_WARN="WARN:  ",SC.LOGGER_LOG_DEBUG="DEBUG: ",SC.LOGGER_LOG_GROUP_HEADER="** %@",SC.LOGGER_LOG_GROUP_INDENTATION="    ",SC.LOGGER_RECORDED_LOG_TIMESTAMP_PREFIX="%@:  ",SC.LOGGER_LEVEL_DEBUG="debug",SC.LOGGER_LEVEL_INFO="info",SC.LOGGER_LEVEL_WARN="warn",SC.LOGGER_LEVEL_ERROR="error",SC.LOGGER_LEVEL_NONE="none",SC.Logger=SC.Object.create({messagePrefix:null,outputMessagePrefix:null,recordedMessagePrefix:null,logOutputLevel:null,logRecordingLevel:SC.LOGGER_LEVEL_NONE,recordedLogMessages:null,recordedLogMessagesMaximumLength:500,recordedLogMessagesPruningMinimumLength
:100,debugEnabled:NO,exists:function(){return!SC.none(this.get("reporter"))}.property("reporter").cacheable(),fallBackOnAlert:NO,reporter:console,debug:function(e,t){SC.Logger._handleMessage(SC.LOGGER_LEVEL_DEBUG,YES,e,arguments)},debugWithoutFmt:function(){this._handleMessage(SC.LOGGER_LEVEL_DEBUG,NO,null,arguments)},debugGroup:function(e,t){SC.Logger._handleGroup(SC.LOGGER_LEVEL_DEBUG,e,arguments)},debugGroupEnd:function(){SC.Logger._handleGroupEnd(SC.LOGGER_LEVEL_DEBUG)},info:function(e,t){SC.Logger._handleMessage(SC.LOGGER_LEVEL_INFO,YES,e,arguments)},infoWithoutFmt:function(){this._handleMessage(SC.LOGGER_LEVEL_INFO,NO,null,arguments)},infoGroup:function(e,t){SC.Logger._handleGroup(SC.LOGGER_LEVEL_INFO,e,arguments)},infoGroupEnd:function(){SC.Logger._handleGroupEnd(SC.LOGGER_LEVEL_INFO)},warn:function(e,t){SC.Logger._handleMessage(SC.LOGGER_LEVEL_WARN,YES,e,arguments)},warnWithoutFmt:function(){this._handleMessage(SC.LOGGER_LEVEL_WARN,NO,null,arguments)},warnGroup:function(e,t){SC.Logger._handleGroup(SC.LOGGER_LEVEL_WARN,e,arguments)},warnGroupEnd:function(){SC.Logger._handleGroupEnd(SC.LOGGER_LEVEL_WARN)},error:function(e,t){SC.Logger._handleMessage(SC.LOGGER_LEVEL_ERROR,YES,e,arguments)},errorWithoutFmt:function(){this._handleMessage(SC.LOGGER_LEVEL_ERROR,NO,null,arguments)},errorGroup:function(e,t){SC.Logger._handleGroup(SC.LOGGER_LEVEL_ERROR,e,arguments)},errorGroupEnd:function(){SC.Logger._handleGroupEnd(SC.LOGGER_LEVEL_ERROR)},outputRecordedLogMessages:function(e){if(!this.get("exists"))return;var t=this.get("reporter"),n=this.get("recordedLogMessages"),r=0,i=SC.LOGGER_RECORDED_LOG_TIMESTAMP_PREFIX
,s,o,u,a,f,l,c,h,p,d,v,m,g;if(n)for(s=0,o=n.length;s<o;++s){u=n[s],a=u.type,e&&(f=i.fmt(u.timestamp.toUTCString())),l=u.message;if(l)c=u.originalArguments,this._outputMessage(a,f,r,l,c);else{d=u.indentation,p=u.title,v=d-r;if(t.group){if(Math.abs(v)>1)for(m=0,g=v-1;m<g;++m)v>0?t.group():t.groupEnd();v>0?(h=f?f:"",h+=p,t.group(h)):t.groupEnd()}else v>0&&this._outputGroup(a,f,d-1,p);r=d}}},stringifyRecordedLogMessages:function(){var e="",t=this.get("recordedLogMessages"),n=0,r=SC.LOGGER_RECORDED_LOG_TIMESTAMP_PREFIX,i=this._LOG_FALLBACK_PREFIX_MAPPING,s=SC.LOGGER_LOG_GROUP_HEADER,o,u,a,f,l,c,h,p,d,v,m;if(t)for(o=0,u=t.length;o<u;++o)a=t[o],f=a.type,h=r.fmt(a.timestamp.toUTCString()),h+=i[f]||"",l=a.message,l?(c=a.originalArguments,p=h+this._indentation(n),p+=c?this._argumentsToString(c):l):(v=a.indentation,d=a.title,m=v-n,m>0&&(p=h+this._indentation(n)+s.fmt(d)),n=v),e+=p+"\n";return e},log:function(){var e=this.get("reporter"),t=arguments[0],n=this.get("messagePrefix"),r=this.get("outputMessagePrefix"),i=NO;return t&&SC.typeOf(t)===SC.T_STRING&&(n||r)&&(n&&(t=n+t),r&&(t=r+t),arguments[0]=t),this.get("exists")&&(typeof e.log=="function"?(e.log.apply(e,arguments),i=YES):e.log&&(e.log(this._argumentsToArray(arguments)),i=YES)),!i&&this.get("fallBackOnAlert")&&(this.get("exists")&&typeof e.alert=="function"?(e.alert(arguments),i=YES):(alert(arguments),i=YES)),i},group:function(e){var t=this.get("reporter");this.get("exists")&&typeof t.group=="function"&&t.group(e)},groupEnd:function(){var e=this.get("reporter");this.get("exists")&&typeof e.groupEnd=="function"&&e.groupEnd()},dir:
function(){var e=this.get("reporter");this.get("exists")&&typeof e.dir=="function"?e.dir.apply(e,arguments):this.log.apply(this,arguments)},dirxml:function(){var e=this.get("reporter");this.get("exists")&&typeof e.dirxml=="function"?e.dirxml.apply(e,arguments):this.log.apply(this,arguments)},profile:function(e){var t=this.get("reporter");return this.get("exists")&&typeof t.profile=="function"?(t.profile(e),YES):NO},profileEnd:function(e){var t=this.get("reporter");return this.get("exists")&&typeof t.profileEnd=="function"?(t.profileEnd(e),YES):NO},time:function(e){var t=this.get("reporter");return this.get("exists")&&typeof t.time=="function"?(t.time(e),YES):NO},timeEnd:function(e){var t=this.get("reporter");return this.get("exists")&&typeof t.timeEnd=="function"?(t.timeEnd(e),YES):NO},trace:function(){var e=this.get("reporter");return this.get("exists")&&typeof e.trace=="function"?(e.trace(),YES):NO},init:function(){arguments.callee.base.apply(this,arguments),this.get("logOutputLevel")||(SC.buildMode==="debug"?this.set("logOutputLevel",SC.LOGGER_LEVEL_DEBUG):this.set("logOutputLevel",SC.LOGGER_LEVEL_INFO)),this.debugEnabledDidChange()},debugEnabledDidChange:function(){this.get("debugEnabled")&&this.set("logOutputLevel",SC.LOGGER_LEVEL_DEBUG)}.observes("debugEnabled"),_handleMessage:function(e,t,n,r){var i=this._shouldOutputType(e),s=this._shouldRecordType(e),o,u,a,f,l,c,h,p,d;if(!i&&!s)return;o=r&&r.length>1,t&&(SC.none(n)||typeof n!="string")&&(t=NO);if(t&&o){f=[];for(u=1,a=r.length;u<a;++u)f.push(r[u]);n=n.fmt.apply(n,f)}h=this.get("messagePrefix"),h&&(n=h+n),i&&(p=this.get
("outputMessagePrefix"),f=t?null:r,this._outputMessage(e,null,this._outputIndentationLevel,p?p+n:n,f)),s&&(d=this.get("recordedMessagePrefix"),c={type:e,message:n?d?d+n:n:YES,timestamp:new Date},!t&&o&&(c.originalArguments=r),this._addRecordedMessageEntry(c))},_handleGroup:function(e,t,n){var r=this._shouldOutputType(e),i=this._shouldRecordType(e),s,o,u,a,f,l,c,h,p,d,v;if(!r&&!i)return;s=n&&n.length>1;if(t&&s){a=[];for(o=1,u=n.length;o<u;++o)a.push(n[o]);t=t.fmt.apply(t,a)}r&&(this._outputGroup(e,null,this._outputIndentationLevel,t),this._outputIndentationLevel++),i&&(d=++this._recordingIndentationLevel,v={type:e,indentation:d,beginGroup:YES,title:t,timestamp:new Date},this._addRecordedMessageEntry(v))},_handleGroupEnd:function(e){var t=this._shouldOutputType(e),n=this._shouldRecordType(e),r,i,s,o;if(!t&&!n)return;t&&(this._outputIndentationLevel--,this.get("exists")&&(r=this.get("reporter"),i=r.groupEnd,i&&i.call(r))),n&&(s=--this._recordingIndentationLevel,o={type:e,indentation:s,timestamp:new Date},this._addRecordedMessageEntry(o))},_shouldOutputType:function(e){var t=this._LOG_LEVEL_MAPPING,n=t[e]||0,r=t[this.get("logOutputLevel")]||0;return n<=r},_shouldRecordType:function(e){var t=this._LOG_LEVEL_MAPPING,n=t[e]||0,r=t[this.get("logRecordingLevel")]||0;return n<=r},_outputMessage:function(e,t,n,r,i){if(!this.get("exists"))return;var s=this.get("reporter"),o,u,a,f,l,c;u=!s.group,a=s[e],a?i?(l=this._argumentsToArray(i),f="",t&&(f=t),u&&(f+=this._indentation(n)),f&&l.splice(0,0,f),a.apply?a.apply(s,l):s[e](l)):(o=t?t:"",u&&(o+=this._indentation(n)),o+=r,s[e](o)):s.log&&(f=""
,t&&(f=t),f+=this._LOG_FALLBACK_PREFIX_MAPPING[e]||"",u&&(f+=this._indentation(n)),i?(l=this._argumentsToArray(i),f&&l.splice(0,0,f),s.log(l)):s.log(f+r))},_outputGroup:function(e,t,n,r){if(!this.get("exists"))return;var i=this.get("reporter"),s=i.group,o;s?(o=t?t:"",o+=r,s.call(i,o)):i.log&&(o="",t&&(o=t),o+=this._LOG_FALLBACK_PREFIX_MAPPING[e]||"",o+=this._indentation(n),o+=SC.LOGGER_LOG_GROUP_HEADER.fmt(r),i.log(o))},_addRecordedMessageEntry:function(e){var t=this.get("recordedLogMessages"),n;t||(t=[],this.set("recordedLogMessages",t)),t.push(e),n=t.length,n>this.get("recordedLogMessagesMaximumLength")&&t.splice(0,n-this.get("recordedLogMessagesPruningMinimumLength")),t.enumerableContentDidChange()},_argumentsToArray:function(e){var t=[],n,r;if(e)for(n=0,r=e.length;n<r;++n)t[n]=e[n];return t},_argumentsToString:function(){var e="",t=SC.LOGGER_LOG_DELIMITER,n,r;for(n=0,r=arguments.length-1;n<r;++n)e+=arguments[n]+t;return e+=arguments[r],e},_indentation:function(e){if(!e||e<0)e=0;var t="",n=SC.LOGGER_LOG_GROUP_INDENTATION,r;for(r=0;r<e;++r)t+=n;return t},_outputIndentationLevel:0,_recordingIndentationLevel:0,_LOG_LEVEL_MAPPING:{debug:4,info:3,warn:2,error:1,none:0},_LOG_FALLBACK_PREFIX_MAPPING:{debug:SC.LOGGER_LOG_DEBUG,info:SC.LOGGER_LOG_INFO,warn:SC.LOGGER_LOG_WARN,error:SC.LOGGER_LOG_ERROR}}),SC.debug=SC.Logger.debug,SC.info=SC.Logger.info,SC.warn=SC.Logger.warn,SC.error=SC.Logger.error,SC.RunLoop=SC.Object.extend({beginRunLoop:function(){return this._start=(new Date).getTime(),this._runLoopInProgress=YES,this},isRunLoopInProgress:function(){return this._runLoopInProgress
}.property(),endRunLoop:function(){return this.flushAllPending(),this._start=null,SC.RunLoop.lastRunLoopEnd=Date.now(),this._runLoopInProgress=NO,this},flushAllPending:function(){var e=!0;while(e)e=this.flushApplicationQueues(),e||(e=this._flushinvokeLastQueue())},invokeOnce:function(e,t){t===undefined&&(t=e,e=this);var n;return typeof t=="string"&&(t=e[t]),this._invokeQueue||(this._invokeQueue=SC.ObserverSet.create()),t&&this._invokeQueue.add(e,t,undefined,n),this},invokeLast:function(e,t){t===undefined&&(t=e,e=this);var n;return typeof t=="string"&&(t=e[t]),this._invokeLastQueue||(this._invokeLastQueue=SC.ObserverSet.create()),this._invokeLastQueue.add(e,t,undefined,n),this},flushApplicationQueues:function(){var e=NO,t=this._invokeQueue;return t&&t.getMembers().length&&(this._invokeQueue=null,e=YES,t.invokeMethods()),SC.Binding.flushPendingChanges()||e},_flushinvokeLastQueue:function(){var e=this._invokeLastQueue,t=NO;return e&&e.getMembers().length&&(this._invokeLastQueue=null,t=YES,t&&e.invokeMethods()),t}}),SC.RunLoop.currentRunLoop=null,SC.RunLoop.runLoopClass=SC.RunLoop,SC.RunLoop.begin=function(){var e=this.currentRunLoop;return e||(e=this.currentRunLoop=this.runLoopClass.create()),e.beginRunLoop(),this},SC.RunLoop.end=function(){var e=this.currentRunLoop;if(!e)throw"SC.RunLoop.end() called outside of a runloop!";return e.endRunLoop(),this},SC.RunLoop.kill=function(){return this.currentRunLoop=this.runLoopClass.create(),this},SC.RunLoop.isRunLoopInProgress=function(){return this.currentRunLoop?this.currentRunLoop.get("isRunLoopInProgress"):NO},SC.run=function(e,t,n){
var r=SC.RunLoop.isRunLoopInProgress(),i;if(SC.ExceptionHandler&&SC.ExceptionHandler.enabled)try{(n||!r)&&SC.RunLoop.begin(),e&&(i=e.call(t)),(n||!r)&&SC.RunLoop.end()}catch(s){var o=SC.ExceptionHandler.handleException(s);if(!o&&!SC.browser.msie)throw s}else(n||!r)&&SC.RunLoop.begin(),e&&(i=e.call(t)),(n||!r)&&SC.RunLoop.end();return i},SC.RunLoop.wrapFunction=function(e){var t=function(){var t=SC.$A(arguments),n=this;return SC.run(function(){return e.apply(n,t)})};return t.wrapped=e,t},SC.DROP_ON=1,SC.DROP_BEFORE=2,SC.DROP_AFTER=4,SC.DROP_ANY=7,SC.ALIGN_LEFT="left",SC.ALIGN_RIGHT="right",SC.ALIGN_CENTER="center",SC.ALIGN_TOP="top",SC.ALIGN_MIDDLE="middle",SC.ALIGN_BOTTOM="bottom",SC.ALIGN_TOP_LEFT="top-left",SC.ALIGN_TOP_RIGHT="top-right",SC.ALIGN_BOTTOM_LEFT="bottom-left",SC.ALIGN_BOTTOM_RIGHT="bottom-right",SC.mixin({data:$.data,removeData:$.removeData,STRINGS:{},stringsFor:function(e,t){return SC.mixin(SC.STRINGS,t),this}}),SC.Controller=SC.Object.extend({isEditable:YES,destroyContentOnReplace:NO,contentObjectDidChanged:function(){var e,t;if(!this.get("destroyContentOnReplace"))return;e=this._oldContent,t=this.get("content"),e&&t!==e&&e.destroy&&e.destroy(),this._oldContent=t}.observes("content")}),SC.SelectionSupport={hasSelectionSupport:YES,allowsSelection:YES,allowsMultipleSelection:YES,allowsEmptySelection:YES,firstSelectableObject:function(){return this.get("firstObject")}.property(),selection:function(e,t){var n=this._scsel_selection,r=n?n.get("length"):0,i,s=this.get("arrangedObjects"),o;if(t===undefined||!this.get("allowsSelection"))t=n;return o=t&&t.isEnumerable?
t.get("length"):0,o>1&&!this.get("allowsMultipleSelection")&&(r>1?(t=SC.SelectionSet.create().addObject(n.get("firstObject")).freeze(),o=1):(t=n,o=r)),o===0&&!this.get("allowsEmptySelection")&&s&&s.get("length")!==0&&(r===0?(t=this.get("firstSelectableObject"),t?t=SC.SelectionSet.create().addObject(t).freeze():t=SC.SelectionSet.EMPTY,o=t.get("length")):(t=n,o=r)),o===0&&(t=SC.SelectionSet.EMPTY),t!==n&&(t=t.frozenCopy()),this._scsel_selection=t,t}.property("arrangedObjects","allowsEmptySelection","allowsMultipleSelection","allowsSelection").cacheable(),hasSelection:function(){var e=this.get("selection");return!!e&&e.get("length")>0}.property("selection").cacheable(),selectObjects:function(e,t){if(!e||e.get("length")===0)return t||this.set("selection",SC.SelectionSet.EMPTY),this;var n=this.get("selection");return t&&n?n=n.copy():n=SC.SelectionSet.create(),n.addObjects(e).freeze(),this.set("selection",n),this},selectObject:function(e,t){return e===null?(t||this.set("selection",null),this):this.selectObjects([e],t)},deselectObjects:function(e){if(!e||e.get("length")===0)return this;var t=this.get("selection");return!t||t.get("length")===0?this:(t=t.copy().removeObjects(e).freeze(),this.set("selection",t.freeze()),this)},deselectObject:function(e){return e?this.deselectObjects([e]):this},updateSelectionAfterContentChange:function(){var e=this.get("arrangedObjects"),t=this.get("selection"),n=this.get("allowsEmptySelection"),r;if(!t)return this;r=t.indexSetForSource(e);if(r&&r.get("length")!==t.get("length")||!r&&t.get("length")>0)t=t.copy().constrain(e).freeze(),this.set("selection"
,t);return t.get("length")===0&&e&&e.get("length")>0&&!n&&this.selectObject(this.get("firstSelectableObject"),NO),this}},SC.ArrayController=SC.Controller.extend(SC.Array,SC.SelectionSupport,{content:null,isEditable:YES,orderBy:null,allowsSingleContent:YES,destroyOnRemoval:NO,arrangedObjects:function(){return this}.property().cacheable(),canRemoveContent:function(){var e=this.get("content"),t;return t=!!e&&this.get("isEditable")&&this.get("hasContent"),t?!e.isEnumerable||SC.typeOf(e.removeObject)===SC.T_FUNCTION:NO}.property("content","isEditable","hasContent"),canReorderContent:function(){var e=this.get("content"),t;return t=!!e&&this.get("isEditable")&&!this.get("orderBy"),t&&!!e.isSCArray}.property("content","isEditable","orderBy"),canAddContent:function(){var e=this.get("content"),t;return t=e&&this.get("isEditable")&&e.isEnumerable,t?SC.typeOf(e.addObject)===SC.T_FUNCTION||SC.typeOf(e.pushObject)===SC.T_FUNCTION:NO}.property("content","isEditable"),hasContent:function(){var e=this.get("content");return!!e&&(!!e.isEnumerable||!!this.get("allowsSingleContent"))}.property("content","allowSingleContent"),status:function(){var e=this.get("content"),t=e?e.get("status"):null;return t?t:SC.Record.READY}.property().cacheable(),addObject:function(e){if(!this.get("canAddContent"))throw"%@ cannot add content".fmt(this);var t=this.get("content");if(t.isSCArray)t.pushObject(e);else{if(!t.addObject)throw"%@.content does not support addObject".fmt(this);t.addObject(e)}return this},removeObject:function(e){if(!this.get("canRemoveContent"))throw"%@ cannot remove content".fmt(this);var t=this
.get("content");return t.isEnumerable?t.removeObject(e):this.set("content",null),this.get("destroyOnRemoval")&&e.destroy&&e.destroy(),this},length:function(){var e=this._scac_observableContent();return e?e.get("length"):0}.property().cacheable(),objectAt:function(e){var t=this._scac_observableContent();return t?t.objectAt(e):undefined},replace:function(e,t,n){if(!n||n.get("length")===0){if(!this.get("canRemoveContent"))throw"%@ cannot remove objects from the current content".fmt(this)}else if(!this.get("canReorderContent"))throw"%@ cannot add or reorder the current content".fmt(this);var r=this.get("content"),i=[],s,o;if(this.get("destroyOnRemoval"))for(s=0;s<t;s++)i.push(r.objectAt(s+e));r&&r.replace(e,t,n);for(s=0,o=i.length;s<o;s++)i[s].destroy();return i=null,this},indexOf:function(e,t){var n=this._scac_observableContent();return n?n.indexOf(e,t):-1},init:function(){arguments.callee.base.apply(this,arguments),this._scac_contentDidChange()},_scac_cached:NO,_scac_observableContent:function(){var e=this._scac_cached;if(e)return e;var t=this.get("content"),n,r,i;if(SC.none(t))return this._scac_cached=[];if(!t.isEnumerable)return e=this.get("allowsSingleContent")?[t]:[],this._scac_cached=e;var s=this.get("orderBy");if(!s){if(t.isSCArray)return this._scac_cached=t;throw"%@.orderBy is required for unordered content".fmt(this)}var o=SC.typeOf(s);if(o===SC.T_STRING)s=[s];else if(o===SC.T_FUNCTION)n=s;else if(o!==SC.T_ARRAY)throw"%@.orderBy must be Array, String, or Function".fmt(this);return n=n||function(e,t){var n,r,o,u;for(var a=0,f=s.get("length");a<f&&!n;a++)r=s.objectAt(a),
o=r.match(/^(ASC )?(DESC )?(.*)$/),r=o[3],i=o[2]?-1:1,e&&(e=e.isObservable?e.get(r):e[r]),t&&(t=t.isObservable?t.get(r):t[r]),n=SC.compare(e,t)*i;return n},this._scac_cached=t.toArray().sort(n)},propertyWillChange:function(e){if(e!=="content")return arguments.callee.base.apply(this,arguments);this.arrayContentWillChange(0,this.get("length"),0)},_scac_arrayContentWillChange:function(e,t,n){this.arrayContentWillChange(e,t,n);if(this._kvo_enumerable_property_chains){var r=this.slice(e,e+t);this.teardownEnumerablePropertyChains(r)}},_scac_arrayContentDidChange:function(e,t,n){var r=this._scac_observableContent(),i=r?r.get("length"):0;this._scac_length=i,this._scac_cached=NO,this.notifyPropertyChange("length");if(this._kvo_enumerable_property_chains){var s=this.slice(e,e+n);this.setupEnumerablePropertyChains(s)}this.updateSelectionAfterContentChange(),this.arrayContentDidChange(e,t,n)},_scac_contentDidChange:function(){this._scac_cached=NO;var e=this.get("content"),t=!!this.get("orderBy"),n=this._scac_content,r=this._scac_length||0,i=this._scac_arrayContentDidChange,s=this._scac_arrayContentWillChange,o=this._scac_contentStatusDidChange,u=this._scac_enumerableDidChange,a;if(e===n)return this;this.arrayContentWillChange(0,r,a),n&&(n.isSCArray?n.removeArrayObservers({target:this,didChange:i,willChange:s}):n.isEnumerable&&n.removeObserver("[]",this,u),n.removeObserver("status",this,o),this.teardownEnumerablePropertyChains(n)),this._scac_cached=NO,this._scac_content=e,e?(e.isSCArray?(e.addArrayObservers({target:this,didChange:i,willChange:s}),a=e.get("length")):e.isEnumerable?(e.addObserver
("[]",this,u),a=e.get("length")):a=1,e.addObserver("status",this,o),this.setupEnumerablePropertyChains(e)):a=SC.none(e)?0:1,this._scac_length=a,this._scac_contentStatusDidChange(),this.arrayContentDidChange(0,r,a),this.updateSelectionAfterContentChange()}.observes("content"),_scac_enumerableDidChange:function(){var e=this.get("content"),t=e?e.get("length"):0,n=this._scac_length;this._scac_length=t,this.beginPropertyChanges(),this._scac_cached=NO,this.arrayContentDidChange(0,n,t),this.endPropertyChanges(),this.updateSelectionAfterContentChange()}.observes("orderBy"),_scac_contentStatusDidChange:function(){this.notifyPropertyChange("status")}}),SC.ObjectController=SC.Controller.extend({content:null,allowsMultipleContent:NO,hasContent:function(){return!SC.none(this.get("observableContent"))}.property("observableContent"),isEditable:YES,observableContent:function(){var e=this.get("content"),t,n;if(e&&e.isEnumerable){t=e.get("length"),n=this.get("allowsMultipleContent");if(t===1)e=e.firstObject();else if(t===0||!n)e=null;e&&!n&&e.isEnumerable&&(e=null)}return e}.property("content","allowsMultipleContent").cacheable(),destroy:function(){var e=this.get("observableContent");return e&&SC.typeOf(e.destroy)===SC.T_FUNCTION&&e.destroy(),this.set("content",null),this},contentPropertyDidChange:function(e,t){t==="*"?this.allPropertiesDidChange():this.notifyPropertyChange(t)},unknownProperty:function(e,t){if(e==="content")return t!==undefined&&(this.content=t),this.content;var n=this.get("observableContent"),r,i,s;if(n===null||n===undefined)return undefined;if(t===undefined)if(n.isEnumerable
){t=n.getEach(e),r=t.get("length");if(r>0){s=YES,i=t.objectAt(0);while(--r>0&&s)i!==t.objectAt(r)&&(s=NO);s&&(t=i)}else t=undefined}else t=n.isObservable?n.get(e):n[e];else{if(!this.get("isEditable"))throw"%@.%@ is not editable".fmt(this,e);n.isEnumerable?n.setEach(e,t):n.isObservable?n.set(e,t):n[e]=t}return t},init:function(){arguments.callee.base.apply(this,arguments),this.get("content")&&this._scoc_contentDidChange(),this.get("observableContent")&&this._scoc_observableContentDidChange()},_scoc_contentDidChange:function(){var e=this._scoc_content,t=this.get("content");if(e!==t){this._scoc_content=t;var n=this._scoc_enumerableContentDidChange;e&&e.isEnumerable&&e.removeObserver("[]",this,n),t&&t.isEnumerable&&t.addObserver("[]",this,n)}}.observes("content"),_scoc_observableContentDidChange:function(){var e=this._scoc_observableContent,t=this.get("observableContent"),n=this.contentPropertyDidChange,r=this._scoc_enumerableContentDidChange;if(e===t)return this;this._scoc_observableContent=t,e&&(e.isEnumerable?e.removeObserver("[]",this,r):e.isObservable&&e.removeObserver("*",this,n)),t&&(t.isEnumerable?t.addObserver("[]",this,r):t.isObservable&&t.addObserver("*",this,n)),e&&e.isEnumerable||t&&t.isEnumerable?this._scoc_enumerableContentDidChange():this.contentPropertyDidChange(t,"*")}.observes("observableContent"),_scoc_enumerableContentDidChange:function(){var e=this.get("observableContent"),t=this._scoc_observableContentItems,n=this.contentPropertyDidChange;return t&&(t.forEach(function(e){e.isObservable&&e.removeObserver("*",this,n)},this),t.clear()),e&&e.isEnumerable?(t||(
t=SC.Set.create()),e.forEach(function(e){if(t.contains(e))return;t.add(e),e.isObservable&&e.addObserver("*",this,n)},this)):t=null,this._scoc_observableContentItems=t,this.contentPropertyDidChange(e,"*"),this}}),SC.mixin(SC.Object.prototype,{invokeLater:function(e,t){t===undefined&&(t=1);var n=e,r,i;return arguments.length>2&&(r=SC.$A(arguments).slice(2),SC.typeOf(n)===SC.T_STRING&&(n=this[e]),i=n,n=function(){return i.apply(this,r)}),SC.Timer.schedule({target:this,action:n,interval:t})},invokeOnceLater:function(e,t){t===undefined&&(t=1);var n=this._sc_invokeOnceLaterTimers,r,i,s,o;return SC.typeOf(e)===SC.T_STRING&&(e=this[e]),r=SC.guidFor(e),n||(this._sc_invokeOnceLaterTimers=n={}),i=n[r],i&&i.invalidate(),s=function(){return delete n[r],e.apply(this,arguments)},o=SC.Timer.schedule({target:this,action:s,interval:t}),n[r]=o,o},invokeWith:function(e,t,n){n===undefined&&(n=t,t=this),t||(t=this),SC.typeOf(n)===SC.T_STRING&&(n=t[n]);var r=this.getPath(e);return n.call(t,r,this),this}}),SC.RunLoop=SC.RunLoop.extend({startTime:function(){return this._start||(this._start=Date.now()),this._start}.property(),endRunLoop:function(){this.fireExpiredTimers();var e=arguments.callee.base.apply(this,arguments);return this.scheduleNextTimeout(),e},scheduleTimer:function(e,t){return this._timerQueue=e.removeFromTimerQueue(this._timerQueue),this._timerQueue=e.scheduleInTimerQueue(this._timerQueue,t),this},cancelTimer:function(e){return this._timerQueue=e.removeFromTimerQueue(this._timerQueue),this},TIMER_ARRAY:[],fireExpiredTimers:function(){if(!this._timerQueue||this._firing)return NO;var e=
this.get("startTime"),t=this.TIMER_ARRAY,n,r,i;this._firing=YES,this._timerQueue=this._timerQueue.collectExpiredTimers(t,e),r=t.length;for(n=0;n<r;n++)t[n].fire();return i=t.length>0,t.length=0,this._firing=NO,i},scheduleNextTimeout:function(){var e=this._timerQueue,t=NO;if(!e)this._timeout&&clearTimeout(this._timeout);else{var n=e._timerQueueRunTime;if(this._timeoutAt!==n){this._timeout&&clearTimeout(this._timeout);var r=Math.max(0,n-Date.now());this._timeout=setTimeout(this._timeoutDidFire,r),this._timeoutAt=n}t=YES}return t},_timeoutDidFire:function(){var e=SC.RunLoop.currentRunLoop;e._timeout=e._timeoutAt=null,SC.run()}}),SC.RunLoop.currentRunLoop=SC.RunLoop.create(),SC.RunLoop.runLoopClass=SC.RunLoop,SC.Locale=SC.Object.extend({init:function(){this.language||SC.Locale._assignLocales();if(!this.hasStrings){var e=this._deprecatedLanguageCodes||[];e.push(this.language);var t=e.length,n=null;while(!n&&--t>=0)n=String[e[t]];n&&(this.hasStrings=YES,this.strings=n)}},hasStrings:NO,strings:{},metrics:{},toString:function(){return this.language||SC.Locale._assignLocales(),"SC.Locale["+this.language+"]"+SC.guidFor(this)},locWithDefault:function(e,t){var n=this.strings[e];return SC.typeOf(n)===SC.T_STRING?n:SC.typeOf(t)===SC.T_STRING?t:e},locMetric:function(e){var t=this.metrics[e];return SC.typeOf(t)===SC.T_NUMBER?t:t===undefined?(SC.warn('No localized metric found for key "'+e+'"'),undefined):(SC.warn('Unexpected metric type for key "'+e+'"'),undefined)},locLayout:function(e,t){var n,r,i,s,o,u=SC.Locale.layoutKeys,a=this.metrics,f=SC.typeOf,l=SC.T_NUMBER,c={};t&&SC.mixin(c,t);for(
n=0,r=u.length;n<r;++n){i=u[n],s=e+"."+i,o=a[s];if(f(o)===l){if(t&&t[i])throw"locLayout():  There is a localized value for the key '"+s+"' but a value for '"+i+"' was also specified in the non-localized hash";c[i]=o}}return c}}),SC.Locale.mixin({useAutodetectedLanguage:NO,preferredLanguage:null,layoutKeys:["left","top","right","bottom","width","height","minWidth","minHeight","centerX","centerY"],createCurrentLocale:function(){var e=String.useAutodetectedLanguage!==undefined?String.useAutodetectedLanguage:this.useAutodetectedLanguage,t=String.preferredLanguage!==undefined?String.preferredLanguage:this.preferredLanguage,n=(e?SC.browser.language:null)||t||SC.browser.language||"en";n=SC.Locale.normalizeLanguage(n);var r=this.localeClassFor(n);return n!=this.currentLanguage&&(this.currentLanguage=n,this.currentLocale=r.create()),this.currentLocale},localeClassFor:function(e){e=SC.Locale.normalizeLanguage(e);var t,n=this.locales[e];return!n&&(t=e.split("-")[0])!==e&&(n=this.locales[t])&&(n=this.locales[e]=n.extend()),n||(n=this.locales[e]=this.locales.en.extend()),n},define:function(e,t){var n;return t===undefined&&SC.typeOf(e)!==SC.T_STRING?(n=this,t=e):n=SC.Locale.localeClassFor(e),SC.mixin(n.prototype,t),n},options:function(){return this.prototype},addStrings:function(e){var t=this.prototype.strings;return t?this.prototype.hasOwnProperty("strings")||(this.prototype.strings=SC.clone(t)):t=this.prototype.strings={},e&&(this.prototype.strings=SC.mixin(t,e)),this.prototype.hasStrings=YES,this},addMetrics:function(e){var t=this.prototype.metrics;return t?this.prototype.hasOwnProperty
(t)||(this.prototype.metrics=SC.clone(t)):t=this.prototype.metrics={},e&&(this.prototype.metrics=SC.mixin(t,e)),this},_map:{english:"en",french:"fr",german:"de",japanese:"ja",jp:"ja",spanish:"es"},normalizeLanguage:function(e){return e?SC.Locale._map[e.toLowerCase()]||e:"en"},_assignLocales:function(){for(var e in this.locales)this.locales[e].prototype.language=e},toString:function(){return this.prototype.language||SC.Locale._assignLocales(),"SC.Locale["+this.prototype.language+"]"},extend:function(){var e=SC.Object.extend.apply(this,arguments);return e.addStrings=SC.Locale.addStrings,e.define=SC.Locale.define,e.options=SC.Locale.options,e.toString=SC.Locale.toString,e}}),SC.Locale.locales={en:SC.Locale.extend({_deprecatedLanguageCodes:["English"]}),fr:SC.Locale.extend({_deprecatedLanguageCodes:["French"]}),de:SC.Locale.extend({_deprecatedLanguageCodes:["German"]}),ja:SC.Locale.extend({_deprecatedLanguageCodes:["Japanese","jp"]}),es:SC.Locale.extend({_deprecatedLanguageCodes:["Spanish"]})},SC.stringsFor=function(e,t){var n=SC.Locale.localeClassFor(e);return n.addStrings(t),this},SC.metricsFor=function(e,t){var n=SC.Locale.localeClassFor(e);return n.addMetrics(t),this},SC.STRING_TITLEIZE_REGEXP=/([\s|\-|\_|\n])([^\s|\-|\_|\n]?)/g,SC.STRING_DECAMELIZE_REGEXP=/([a-z])([A-Z])/g,SC.STRING_DASHERIZE_REGEXP=/[ _]/g,SC.STRING_DASHERIZE_CACHE={},SC.STRING_TRIM_LEFT_REGEXP=/^\s+/g,SC.STRING_TRIM_RIGHT_REGEXP=/\s+$/g,SC.mixin(SC.String,{capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},camelize:function(e){var t=e.replace(SC.STRING_TITLEIZE_REGEXP,function(e,t,n){return n?
n.toUpperCase():""}),n=t.charAt(0),r=n.toLowerCase();return n!==r?r+t.slice(1):t},decamelize:function(e){return e.replace(SC.STRING_DECAMELIZE_REGEXP,"$1_$2").toLowerCase()},dasherize:function(e){var t=SC.STRING_DASHERIZE_CACHE,n=t[e];return n?n:(n=SC.String.decamelize(e).replace(SC.STRING_DASHERIZE_REGEXP,"-"),t[e]=n,n)},loc:function(e){SC.Locale.currentLocale||SC.Locale.createCurrentLocale();var t=SC.Locale.currentLocale.locWithDefault(e);SC.typeOf(t)!==SC.T_STRING&&(t=e);var n=SC.$A(arguments);n.shift(),n.length>0&&n[0].isSCArray&&(n=n[0]);try{return SC.String.fmt(t,n)}catch(r){SC.error("Error processing string with key: "+e),SC.error("Localized String: "+t),SC.error("Error: "+r)}},locMetric:function(e){var t=SC.Locale,n=t.currentLocale;return n||(t.createCurrentLocale(),n=t.currentLocale),n.locMetric(e)},locLayout:function(e,t){var n=SC.Locale,r=n.currentLocale;return r||(n.createCurrentLocale(),r=n.currentLocale),r.locLayout(e,t)},locWithDefault:function(e,t){SC.Locale.currentLocale||SC.Locale.createCurrentLocale();var n=SC.Locale.currentLocale.locWithDefault(e,t);SC.typeOf(n)!==SC.T_STRING&&(n=e);var r=SC.$A(arguments);return r.shift(),r.shift(),SC.String.fmt(n,r)},trim:jQuery.trim,trimLeft:function(e){return e.replace(SC.STRING_TRIM_LEFT_REGEXP,"")},trimRight:function(e){return e.replace(SC.STRING_TRIM_RIGHT_REGEXP,"")},mult:function(e,t){if(SC.typeOf(t)!==SC.T_NUMBER||t<1)return null;var n="";for(var r=0;r<t;r+=1)n+=e;return n}}),String.prototype.trim&&SC.supplement(String.prototype,{trim:function(){return SC.String.trim(this,arguments)},trimLeft:function(){return SC
.String.trimLeft(this,arguments)},trimRight:function(){return SC.String.trimRight(this,arguments)}}),SC.mixin(String.prototype,{loc:function(){return SC.String.loc(this.toString(),SC.$A(arguments))},locMetric:function(){return SC.String.locMetric(this.toString())},locLayout:function(e){return SC.String.locLayout(this.toString(),e)}}),SC.supplement(String.prototype,{capitalize:function(){return SC.String.capitalize(this,arguments)},camelize:function(){return SC.String.camelize(this,arguments)},decamelize:function(){return SC.String.decamelize(this,arguments)},dasherize:function(){return SC.String.dasherize(this,arguments)},loc:function(){var e=SC.$A(arguments);return e.unshift(this),SC.String.loc.apply(SC.String,e)},locWithDefault:function(e){var t=SC.$A(arguments);return t.unshift(this),SC.String.locWithDefault.apply(SC.String,t)},mult:function(e){return SC.String.mult(this,e)}}),SC.DelegateSupport={delegateFor:function(e){var t=1,n=arguments.length,r;while(t<n){r=arguments[t];if(r&&r[e]!==undefined)return r;t++}return this[e]!==undefined?this:null},invokeDelegateMethod:function(e,t,n){n=SC.A(arguments),n=n.slice(2,n.length);if(!e||!e[t])e=this;var r=e[t];return r?r.apply(e,n):null},getDelegateProperty:function(e,t){var n=1,r=arguments.length,i;while(n<r){i=arguments[n++];if(i&&i[e]!=undefined)return i.get?i.get(e):i[e]}return this[e]!=undefined?this.get(e):undefined}},SC.Responder=SC.Object.extend({isResponder:YES,pane:null,responderContext:null,nextResponder:null,isFirstResponder:NO,hasFirstResponder:NO,acceptsFirstResponder:YES,becomingFirstResponder:NO,becomeFirstResponder
:function(){var e=this.get("pane")||this.get("responderContext")||this.pane();return e&&this.get("acceptsFirstResponder")&&e.get("firstResponder")!==this&&e.makeFirstResponder(this),this},resignFirstResponder:function(e){var t=this.get("pane")||this.get("responderContext");return t&&t.get("firstResponder")===this&&(this.get("isPane")||t.set("lastViewFirstResponder",this),t.makeFirstResponder(null,e)),YES},willLoseFirstResponder:function(e){},didBecomeFirstResponder:function(e){},sendAction:function(e,t){return SC.RootResponder.responder.sendAction(e,null,this,null,t,this)}}),SC.ResponderContext={isResponderContext:YES,trace:NO,defaultResponder:null,nextResponder:function(){return this.get("defaultResponder")}.property("defaultResponder").cacheable(),firstResponder:null,nextResponderFor:function(e){var t=e.get("nextResponder");return typeof t===SC.T_STRING?t=SC.objectForPropertyPath(t,this):!t&&e!==this&&(t=this),t},responderNameFor:function(e){if(!e)return"(No Responder)";if(e._scrc_name)return e._scrc_name;var t=this.NAMESPACE;return this._findResponderNamesFor(this,3,t?[this.NAMESPACE]:[]),e._scrc_name||e.toString()},_findResponderNamesFor:function(e,t,n){var r,i;for(r in e){if(r==="nextResponder")continue;i=e[r];if(i&&i.isResponder){if(i._scrc_name)continue;n.push(r),i._scrc_name=n.join("."),t>0&&this._findResponderNamesFor(i,t-1,n),n.pop()}}},makeFirstResponder:function(e,t){var n=this.get("firstResponder"),r=this.get("nextResponder"),i=this.get("trace"),s;if(this._locked){i&&SC.Logger.log("%@: AFTER ACTION: makeFirstResponder => %@".fmt(this,this.responderNameFor(e))),this
._pendingResponder=e;return}i&&SC.Logger.log("%@: makeFirstResponder => %@".fmt(this,this.responderNameFor(e))),e&&e.set("becomingFirstResponder",YES),this._locked=YES,this._pendingResponder=null,s=e?e:null;while(s){if(s.get("hasFirstResponder"))break;s=s===r?null:this.nextResponderFor(s)}return s||(s=r),this._notifyWillLoseFirstResponder(n,n,s,t),n&&n.set("isFirstResponder",NO),this.beginPropertyChanges(),this.set("firstResponder",e),e&&e.set("isFirstResponder",YES),this._notifyDidBecomeFirstResponder(e,e,s),this.endPropertyChanges(),this._locked=NO,this._pendingResponder&&(this.makeFirstResponder(this._pendingResponder),this._pendingResponder=null),e&&e.set("becomingFirstResponder",NO),this},_notifyWillLoseFirstResponder:function(e,t,n,r){if(!t||t===n)return;t.willLoseFirstResponder(e,r),t.set("hasFirstResponder",NO);var i=this.nextResponderFor(t);i&&this._notifyWillLoseFirstResponder(e,i,n)},_notifyDidBecomeFirstResponder:function(e,t,n){if(!t||t===n)return;var r=this.nextResponderFor(t);r&&this._notifyDidBecomeFirstResponder(e,r,n),t.set("hasFirstResponder",YES),t.didBecomeFirstResponder(e)},resetFirstResponder:function(){var e=this.get("firstResponder");if(!e)return;e.willLoseFirstResponder(),e.didBecomeFirstResponder()},sendAction:function(e,t,n){var r=this.get("firstResponder"),i=this.get("nextResponder"),s=this.get("trace"),o=NO,u;this._locked=YES,s&&SC.Logger.log("%@: begin action '%@' (%@, %@)".fmt(this,e,t,n)),!o&&!r&&this.tryToPerform&&(o=this.tryToPerform(e,t,n));while(!o&&r)r.tryToPerform&&(o=r.tryToPerform(e,t,n)),o||(r=r===i?null:this.nextResponderFor(r));s&&
(o?SC.Logger.log("%@: action '%@' handled by %@".fmt(this,e,this.responderNameFor(r))):SC.Logger.log("%@:  action '%@' NOT HANDLED".fmt(this,e))),this._locked=NO;if(u=this._pendingResponder)this._pendingResponder=null,this.makeFirstResponder(u);return r}},SC.bodyOverflowArbitrator=SC.Object.create({requestHidden:function(e,t){this._makeRequest(e,-1-9*!!t)},requestVisible:function(e,t){this._makeRequest(e,1+9*!!t)},withdrawRequest:function(e){if(!e)return;var t=SC.guidFor(e);this._requests[t]&&delete this._requests[t],this.setOverflow()},setOverflow:function(){var e=this._decideOverflow();e!==undefined&&(document.body.style.overflow=e?"auto":"hidden")},_makeRequest:function(e,t){if(!e)return;var n=SC.guidFor(e);this._requests[n]=t,this.setOverflow()},_requests:{},_decideOverflow:function(){var e,t,n,r,i=this._requests,s;for(var o in i)(s=i[o])<0&&(e=YES),s<-1&&(n=YES),s>0&&(t=YES),s>1&&(r=YES);return r?YES:t&&n?NO:t?YES:e?NO:undefined}}),SC.mixin(SC.browser,{compareVersion:function(){if(this._versionSplit===undefined){var e=function(e){return Number(e.match(/^[0-9]+/))};this._versionSplit=SC.A(this.version.split(".")).map(e)}var t=SC.A(arguments).map(Number);for(var n=0;n<t.length;n++){var r=this._versionSplit[n]-t[n];if(isNaN(r))return 0;if(r!==0)return r}return 0}}),SC.Builder=function(e){return SC.Builder.create(e)},SC.Builder.create=function(t){var n=SC.mixin(SC.beget(this.fn),t||{});t.hasOwnProperty("toString")&&(n.toString=t.toString);var r=function(){var e=SC.beget(n);return e.defaultClass=this,e.constructor=r,e.init.apply(e,arguments)};return r.fn=r.prototype=n,r.extend=
SC.Builder.create,r.mixin=SC.Builder.mixin,r},SC.Builder.mixin=function(){var e=arguments.length,t;for(t=0;t<e;t++)SC.mixin(this,arguments[t]);return this},SC.Builder.fn={init:function(e){if(e!==undefined)if(SC.typeOf(e)===SC.T_ARRAY){var t=e.length;while(--t>=0)this[t]=e.objectAt?e.objectAt(t):e[t];this.length=e.length}else this[0]=e,this.length=1;return this},size:function(){return this.length},pushStack:function(){var e=this.constructor.apply(this,arguments);return e.prevObject=this,e},end:function(){return this.prevObject||this.constructor()},toString:function(){return"%@$(%@)".fmt(this.defaultClass.toString(),SC.A(this).invoke("toString").join(","))},mixin:SC.Builder.mixin},function(){var e=SC.Enumerable,t=SC.Builder.fn,n,r;for(n in e){if(!e.hasOwnProperty(n))continue;r=Array.prototype[n]||e[n],t[n]=r}}(),SC.$=SC.CoreQuery=jQuery,SC.mixin(SC.$.fn,{isCoreQuery:YES,toString:function(){var e=[],t=this.length,n=0;for(n=0;n<t;n++)e[n]="%@: %@".fmt(n,this[n]?this[n].toString():"(null)");return"<$:%@>(%@)".fmt(SC.guidFor(this),e.join(" , "))},isVisible:function(){return Array.prototype.every.call(this,function(e){return SC.$.isVisible(e)})},view:function(){return this.map(function(){var e=null,t=SC.viewKey,n=this,r;while(!e&&n&&n!==document)n.nodeType===1&&(r=n.getAttribute("id"))&&(e=SC.View.views[r]),n=n.parentNode;return n=null,e})},within:function(e){return this.filter(e).length?!0:!!this.has(e).length}}),function(){var e={},t={find:function(t,n){return n!==undefined?SC.Enumerable.find.call(this,t,n):e.find.call(this,t)},filter:function(t,n){return n!==undefined?this.pushStack
(SC.Enumerable.filter.call(this,t,n)):e.filter.call(this,t)},filterProperty:function(e,t){return this.pushStack(SC.Enumerable.filterProperty.call(this,e,t))},indexOf:SC.$.index,map:function(t,n){return n!==undefined?SC.Enumerable.map.call(this,t,n):e.map.call(this,t)}},n=SC.$.fn,r=SC.Enumerable,i;for(var s in r)r.hasOwnProperty(s)&&(i=r[s],s in t&&(e[s]=n[s],i=t[s]),n[s]=i)}(),SC.mixin(SC.$,{isVisible:function(e){var t=SC.$;return"hidden"!=e.type&&t.css(e,"display")!="none"&&t.css(e,"visibility")!="hidden"}}),SC.Event=function(e){var t,n;if(e){this.originalEvent=e;var r=SC.Event._props,i;n=r.length,t=n;while(--t>=0)i=r[t],this[i]=e[i]}this.timeStamp=this.timeStamp||Date.now(),this.target||(this.target=this.srcElement||document),this.target.nodeType===3&&(this.target=this.target.parentNode),!this.relatedTarget&&this.fromElement&&(this.relatedTarget=this.fromElement===this.target?this.toElement:this.fromElement);if(SC.none(this.pageX)&&!SC.none(this.clientX)){var s=document.documentElement,o=document.body;this.pageX=this.clientX+(s&&s.scrollLeft||o&&o.scrollLeft||0)-(s.clientLeft||0),this.pageY=this.clientY+(s&&s.scrollTop||o&&o.scrollTop||0)-(s.clientTop||0)}!this.which&&(this.charCode||e.charCode===0?this.charCode:this.keyCode)&&(this.which=this.charCode||this.keyCode),!this.metaKey&&this.ctrlKey&&(this.metaKey=this.ctrlKey),!this.which&&this.button&&(this.which=this.button&1?1:this.button&2?3:this.button&4?2:0);if(this.type==="mousewheel"||this.type==="DOMMouseScroll"||this.type==="MozMousePixelScroll"||this.type==="wheel"){var u=SC.Event.MOUSE_WHEEL_MULTIPLIER;SC.browser.webkit&&
e.wheelDelta!==undefined?(this.wheelDelta=0-(e.wheelDeltaY||e.wheelDeltaX),this.wheelDeltaY=0-(e.wheelDeltaY||0),this.wheelDeltaX=0-(e.wheelDeltaX||0)):!SC.none(e.detail)&&SC.browser.mozilla?e.axis&&e.axis===e.HORIZONTAL_AXIS?(this.wheelDeltaX=e.detail,this.wheelDeltaY=this.wheelDelta=0):(this.wheelDeltaY=this.wheelDelta=e.detail,this.wheelDeltaX=0):!SC.none(e.deltaX)&&SC.browser.msie?(this.wheelDeltaY=e.deltaY||0,this.wheelDeltaX=e.deltaX||0,this.wheelDelta=this.wheelDeltaY||this.wheelDeltaX):(this.wheelDelta=this.wheelDeltaY=SC.browser.msie||SC.browser.opera?0-e.wheelDelta:e.wheelDelta,this.wheelDeltaX=0),this.wheelDelta*=u,this.wheelDeltaX*=u,this.wheelDeltaY*=u}return this},SC.mixin(SC.Event,{MOUSE_WHEEL_MULTIPLIER:function(){var e=1,t=parseFloat(SC.browser.version);return SC.browser.safari?(e=.4,t>=533.17&&t<534?e=.004:t<533&&(e=40)):SC.browser.msie?e=.3:SC.browser.chrome&&(e=.4),e}(),MOUSE_WHEEL_DELTA_LIMIT:1e3,_MOUSE_WHEEL_LIMIT_INVALIDATED:NO,create:function(e){return new SC.Event(e)},add:function(e,t,n,r,i,s){if(e&&e.isCoreQuery){if(e.length>0)return e.forEach(function(e){this.add(e,t,n,r,i)},this),this;e=e[0]}if(!e)return this;s||(s=NO);if(e.nodeType===3||e.nodeType===8)return SC.Event;SC.browser.msie&&e.setInterval&&(e=window),SC.typeOf(n)===SC.T_FUNCTION?(i=r,r=n,n=null):n&&SC.typeOf(r)===SC.T_STRING&&(r=n[r]);var o=SC.data(e,"sc_events")||SC.data(e,"sc_events",{}),u=o[t];return u||(u=o[t]={},this._addEventListener(e,t,s)),u[SC.hashFor(n,r)]=[n,r,i],SC.Event._global[t]=YES,e=o=u=null,this},remove:function(e,t,n,r){if(e&&e.isCoreQuery){if(e.length>0)return e.forEach
(function(e){this.remove(e,t,n,r)},this),this;e=e[0]}if(!e)return this;if(e.nodeType===3||e.nodeType===8)return SC.Event;var i,s,o=SC.data(e,"sc_events");if(!o)return this;if(t===undefined)for(t in o)this.remove(e,t);else if(i=o[t]){var u=NO;if(n||r){SC.typeOf(n)===SC.T_FUNCTION?(r=n,n=null):SC.typeOf(r)===SC.T_STRING&&(r=n[r]),delete i[SC.hashFor(n,r)],s=null;for(s in i)break;s===null&&(u=YES)}else u=YES;u&&(delete o[t],this._removeEventListener(e,t)),s=null;for(s in o)break;s||(SC.removeData(e,"sc_events"),delete this._elements[SC.guidFor(e)])}return e=o=i=null,this},NO_BUBBLE:["blur","focus","change"],simulateEvent:function(e,t,n){var r=SC.Event.create({type:t,target:e,preventDefault:function(){this.cancelled=YES},stopPropagation:function(){this.bubbles=NO},allowDefault:function(){this.hasCustomEventHandling=YES},timeStamp:Date.now(),bubbles:this.NO_BUBBLE.indexOf(t)<0,cancelled:NO,normalized:YES});return n&&SC.mixin(r,n),r},trigger:function(e,t,n,r){if(e&&e.isCoreQuery){if(e.length>0)return e.forEach(function(e){this.trigger(e,t,n,r)},this),this;e=e[0]}if(!e)return this;if(e.nodeType===3||e.nodeType===8)return undefined;n=SC.A(n);var i,s=SC.typeOf(e[t]||null)===SC.T_FUNCTION,o,u,a,f;o=n[0];if(!o||!o.preventDefault)o=this.simulateEvent(e,t),n.unshift(o);o.type=t,u=e;do i=SC.Event.handle.apply(u,n),u=u===document?null:u.parentNode||document;while(!i&&o.bubbles&&u);u=null,a=e["on"+t],f=SC.$.nodeName(e,"a")&&t==="click",(!s||f)&&a&&a.apply(e,n)===NO&&(i=NO);if(s&&r!==NO&&i!==NO&&!f){this.triggered=YES;try{e[t]()}catch(l){}}return this.triggered=NO,i},handle:function(e){if(typeof 
SC=="undefined"||SC.Event.triggered)return YES;var t,n,r,i,s,o,u,a,f,l;o=SC.A(arguments),o[0]=e=SC.Event.normalizeEvent(e||window.event),s=(SC.data(this,"sc_events")||{})[e.type];if(!s)return NO;for(u in s)a=s[u],f=a[1],e.handler=f,e.data=e.context=a[2],l=a[0]||this,n=f.apply(l,o),t!==NO&&(t=n),n===NO&&(e.preventDefault(),e.stopPropagation());return t},unload:function(){var e,t=this._elements;for(e in t)this.remove(t[e]);for(e in t)delete t[e];delete this._elements},special:{ready:{setup:function(){SC._bindReady();return},teardown:function(){return}},mouseenter:{setup:function(){return SC.browser.msie?NO:(SC.Event.add(this,"mouseover",SC.Event.special.mouseenter.handler),YES)},teardown:function(){return SC.browser.msie?NO:(SC.Event.remove(this,"mouseover",SC.Event.special.mouseenter.handler),YES)},handler:function(e){return SC.Event._withinElement(e,this)?YES:(e.type="mouseenter",SC.Event.handle.apply(this,arguments))}},mouseleave:{setup:function(){return SC.browser.msie?NO:(SC.Event.add(this,"mouseout",SC.Event.special.mouseleave.handler),YES)},teardown:function(){return SC.browser.msie?NO:(SC.Event.remove(this,"mouseout",SC.Event.special.mouseleave.handler),YES)},handler:function(e){return SC.Event._withinElement(e,this)?YES:(e.type="mouseleave",SC.Event.handle.apply(this,arguments))}}},KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,_withinElement:function(e,t){var n=e.relatedTarget;while(n&&n!==t)try{n=n.parentNode}catch(r){n=t}return n===t},
_addEventListener:function(e,t,n){var r,i=this.special[t];n||(n=NO);if(!i||i.setup.call(e)===NO){var s=SC.guidFor(e);this._elements[s]=e,r=SC.data(e,"listener")||SC.data(e,"listener",function(){return SC.Event.handle.apply(SC.Event._elements[s],arguments)}),e.addEventListener?e.addEventListener(t,r,n):e.attachEvent&&e.attachEvent("on"+t,r)}e=i=r=null},_removeEventListener:function(e,t){var n,r=SC.Event.special[t];if(!r||r.teardown.call(e)===NO)n=SC.data(e,"listener"),n&&(e.removeEventListener?e.removeEventListener(t,n,NO):e.detachEvent&&e.detachEvent("on"+t,n));e=r=n=null},_elements:{},normalizeEvent:function(e){return e===window.event?SC.Event.create(e):e.normalized?e:SC.Event.create(e)},_global:{},_props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode metaKey newValue originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target timeStamp toElement type view which touches targetTouches changedTouches animationName elapsedTime dataTransfer".split(" ")}),SC.Event.prototype={hasCustomEventHandling:NO,touchesForView:function(e){if(this.touchContext)return this.touchContext.touchesForView(e)},touchesForResponder:function(e){if(this.touchContext)return this.touchContext.touchesForView(e)},averagedTouchesForView:function(e){return this.touchContext?this.touchContext.averagedTouchesForView(e):null},allowDefault:function(){return this.hasCustomEventHandling=YES,this},preventDefault:function(){var e=this.originalEvent;return e&&(e.preventDefault&&
e.preventDefault(),e.returnValue=NO),this.hasCustomEventHandling=YES,this},stopPropagation:function(){var e=this.originalEvent;return e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=YES),this.hasCustomEventHandling=YES,this},stop:function(){return this.preventDefault().stopPropagation()},normalized:YES,getCharString:function(){if(SC.browser.msie){if(this.keyCode==8||this.keyCode==9||this.keyCode>=37&&this.keyCode<=40)return String.fromCharCode(0);var e=this.keyCode>=96&&this.keyCode<=105?this.charCode:this.keyCode;return e>0?String.fromCharCode(e):null}return this.charCode>0?String.fromCharCode(this.charCode):null},commandCodes:function(){var e=this.keyCode,t=null,n=null,r="",i;if(e){t=SC.FUNCTION_KEYS[e],!t&&(this.altKey||this.ctrlKey||this.metaKey)&&(t=SC.PRINTABLE_KEYS[e]);if(t){this.altKey&&(r+="alt_");if(this.ctrlKey||this.metaKey)r+="ctrl_";this.shiftKey&&(r+="shift_")}}return t||(e=this.which,e>95&&e<106&&(e-=48),n=t=String.fromCharCode(e),i=t.toLowerCase(),this.metaKey?(r="meta_",t=i):t=null),t&&(t=r+t),[t,n]}},SC.Event.observe=SC.Event.add,SC.Event.stopObserving=SC.Event.remove,SC.Event.fire=SC.Event.trigger,SC.browser.msie&&SC.Event.add(window,"unload",SC.Event.prototype,SC.Event.unload),SC.MODIFIER_KEYS={16:"shift",17:"ctrl",18:"alt"},SC.FUNCTION_KEYS={8:"backspace",9:"tab",13:"return",19:"pause",27:"escape",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",44:"printscreen",45:"insert",46:"delete",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock"
},SC.PRINTABLE_KEYS={32:" ",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",107:"+",109:"-",110:".",188:",",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:'"'},SC.SYSTEM_CURSOR="default",SC.AUTO_CURSOR=SC.DEFAULT_CURSOR="auto",SC.CROSSHAIR_CURSOR="crosshair",SC.HAND_CURSOR=SC.POINTER_CURSOR="pointer",SC.MOVE_CURSOR="move",SC.E_RESIZE_CURSOR="e-resize",SC.NE_RESIZE_CURSOR="ne-resize",SC.NW_RESIZE_CURSOR="nw-resize",SC.N_RESIZE_CURSOR="n-resize",SC.SE_RESIZE_CURSOR="se-resize",SC.SW_RESIZE_CURSOR="sw-resize",SC.S_RESIZE_CURSOR="s-resize",SC.W_RESIZE_CURSOR="w-resize",SC.IBEAM_CURSOR=SC.TEXT_CURSOR="text",SC.WAIT_CURSOR="wait",SC.HELP_CURSOR="help",SC.Cursor=SC.Object.extend({init:function(){arguments.callee.base.apply(this,arguments);var e=this.get("cursorStyle")||SC.DEFAULT_CURSOR,t=this.constructor.sharedStyleSheet(),n=SC.guidFor(this);return t.insertRule?t.insertRule("."+n+" {cursor: "+e+";}",t.cssRules?t.cssRules.length:0):t.addRule&&t.addRule("."+n,"cursor: "+e),this.cursorStyle=e,this.className=n,this},className:null,cursorStyle:SC.DEFAULT_CURSOR,cursorStyleDidChange:function(){var e,t,n,r,i,s,o;e=this.get("cursorStyle")||SC.DEFAULT_CURSOR,t=this._rule;if(t){t.style.cursor=e;return}n="."+this.get("className"),r=this.constructor.sharedStyleSheet(),i=(r.cssRules?r.cssRules:r.rules)||[];for(s=0,o=i.length;s<o;++s){t=i[s];if(t.selectorText===n){this._rule=
t,t.style.cursor=e;break}}}.observes("cursorStyle")}),SC.Cursor.sharedStyleSheet=function(){var e,t=this._styleSheet;return t||(t=document.createElement("style"),t.type="text/css",e=document.getElementsByTagName("head")[0],e||(e=document.documentElement),e.appendChild(t),t=document.styleSheets[document.styleSheets.length-1],this._styleSheet=t),t},SC.Theme={isTheme:YES,classNames:SC.CoreSet.create(),_extend_class_names:function(e){if(e)if(SC.typeOf(e)===SC.T_HASH&&!e.isSet)for(var t in e)e[t]?this.classNames.add(t):this.classNames.remove(t);else typeof e=="string"?this.classNames.addEach(e.split(" ")):this.classNames.addEach(e)},_extend_self:function(e){e.classNames&&this._extend_class_names(e.classNames);var t,n,r;for(t in e){if(t==="classNames")continue;if(!e.hasOwnProperty(t))continue;n=e[t],n instanceof Function&&!n.base&&n!==(r=this[t])&&(n.base=r),this[t]=n}},create:function(){var e=SC.beget(this);e.baseTheme=this,this.themes===SC.Theme.themes?(e.themes={},e._themeIsUnrelated={}):(e.themes=SC.beget(this.themes),e._themeIsUnrelated=SC.beget(this._themeIsUnrelated)),e._privateThemes={},e._specializedThemes={},e.classNames=SC.clone(this.classNames);var t=arguments,n=t.length,r,i;for(r=0;r<n;r++)e._extend_self(t[r]);return e.name&&e.classNames.add(e.name),e},subtheme:function(e){var t=this.create({name:e});return this.addTheme(t),t},invisibleSubtheme:function(e){var t=this.create({name:e});return this._privateThemes[e]=t,t},themes:{},_themeIsUnrelated:{},find:function(e,t){if(this===SC.Theme)return this.themes[e];var n;n=this._privateThemes[e];if(n)return n;n=this._specializedThemes
[e];if(n)return n;n=this.themes[e];if(n&&this._themeIsUnrelated[e])return n;if(n&&!this._specializedThemes[e])return this._specializedThemes[e]=n.create({classNames:this.classNames});if(t)return;return n=SC.Theme.themes[e],n?n:null},addTheme:function(e){this.themes[e.name]=e,this._themeIsUnrelated[e.name]=NO},addUnrelatedTheme:function(e){this.themes[e.name]=e,this._themeIsUnrelated[e.name]=YES}},SC.BaseTheme=SC.Theme.create({name:""}),SC.Theme.themes["sc-base"]=SC.BaseTheme,SC.defaultTheme="sc-base",SC.CoreView=SC.Responder.extend(SC.DelegateSupport),SC.CONTEXT_MENU_ENABLED=YES,SC.TABBING_ONLY_INSIDE_DOCUMENT=NO,SC.FROM_THEME="__FROM_THEME__",SC.EMPTY_CHILD_VIEWS_ARRAY=[],SC.EMPTY_CHILD_VIEWS_ARRAY.needsClone=YES,SC.CoreView.reopen({concatenatedProperties:["outlets","displayProperties","classNames","renderMixin","didCreateLayerMixin","willDestroyLayerMixin","classNameBindings","attributeBindings"],ariaRole:null,ariaHidden:null,ariaLabel:null,pane:function(){var e=this;while(e&&!e.isPane)e=e.get("parentView");return e}.property("parentView").cacheable(),page:null,parentView:null,isVisible:YES,isVisibleBindingDefault:SC.Binding.bool(),isVisibleInWindow:YES,childViews:SC.EMPTY_CHILD_VIEWS_ARRAY,layer:function(e,t){if(t!==undefined)this._view_layer=t;else{t=this._view_layer;if(!t){var n=this.get("parentView");n&&(n=n.get("layer")),n&&(this._view_layer=t=this.findLayerInParentLayer(n))}}return t}.property("isVisibleInWindow").cacheable(),$:function(e){var t=this.get("layer");return t?e===undefined?SC.$(t):SC.$(e,t):SC.$()},containerLayer:function(){return this.get("layer")}.property
("layer").cacheable(),layerId:function(e,t){return t&&(this._layerId=t),this._layerId?this._layerId:SC.guidFor(this)}.property().cacheable(),findLayerInParentLayer:function(e){var t="#"+this.get("layerId");return jQuery(t)[0]||jQuery(t,e)[0]},isDescendantOf:function(e){var t=this.get("parentView");return this===e?YES:t?t.isDescendantOf(e):NO},displayDidChange:function(){return this.set("layerNeedsUpdate",YES),this},_sc_isVisibleDidChange:function(){this.displayDidChange()}.observes("isVisible"),layerNeedsUpdate:NO,_view_layerNeedsUpdateDidChange:function(){this.get("layerNeedsUpdate")&&this.invokeOnce(this.updateLayerIfNeeded)}.observes("layerNeedsUpdate"),updateLayerIfNeeded:function(e){var t=this.get("layerNeedsUpdate"),n=t&&(e||this.get("isVisibleInWindow"));return n&&this.get("layer")&&(this.beginPropertyChanges(),this.set("layerNeedsUpdate",NO),this.updateLayer(),this.endPropertyChanges()),this},updateLayer:function(e){var t,n,r,i,s=e||this.renderContext(this.get("layer"));this._renderLayerSettings(s,NO),i=!this.update,i?this.render(s,NO):this.update(s.$());if(t=this.renderMixin){r=t.length;for(n=0;n<r;++n)t[n].call(this,s,NO)}s.update();if(s._innerHTMLReplaced){var o=this.get("pane");o&&o.get("isPaneAttached")&&this._notifyDidAppendToDocument()}return this.useStaticLayout&&this.viewDidResize(),this.didUpdateLayer&&this.didUpdateLayer(),this},parentViewDidResize:function(){this.get("hasLayout")||this.notifyPropertyChange("frame"),this.viewDidResize()},viewDidResize:function(){},renderContext:function(e){return SC.RenderContext(e)},createLayer:function(){if(this.get("layer"
))return this;var e=this.renderContext(this.get("tagName"));return this.renderToContext(e),this.set("layer",e.element()),this._notifyDidCreateLayer(),this},_notifyDidCreateLayer:function(){var e=this.get("useStaticLayout"),t=this.didCreateLayerMixin,n,r,i=this.get("childViews"),s;this.notifyPropertyChange("layer");if(e){var o=this.get("pane");o&&o.isPaneAttached&&this.viewDidResize()}this.didCreateLayer&&this.didCreateLayer();if(t){n=t.length;for(r=0;r<n;++r)t[r].call(this)}n=i.length;for(r=0;r<n;++r){s=i[r];if(!s)continue;s.notifyPropertyChange("layer"),e&&(s.get("isFixedLayout")||s.viewDidResize()),s._notifyDidCreateLayer()}},_invalidateStaticLayoutFrames:function(){var e=this.get("childViews"),t=e.length,n,r;for(n=0;n<t;n++)r=e[n],r.useStaticLayout?r.viewDidResize():r._invalidateStaticLayoutFrames()},destroyLayer:function(){var e=this.get("layer");return e&&(this._notifyWillDestroyLayer(),e.parentNode&&e.parentNode.removeChild(e),e=null),this},replaceLayer:function(){this.destroyLayer(),this.set("layerLocationNeedsUpdate",YES),this.invokeOnce(this.updateLayerLocationIfNeeded)},parentViewDidChange:function(){this.parentViewDidResize(),this.updateLayerLocation()},layerLocationNeedsUpdate:NO,updateLayerLocationIfNeeded:function(e){return this.get("layerLocationNeedsUpdate")&&this.updateLayerLocation(),this},updateLayerLocation:function(){var e=this.get("layer"),t=this.get("parentView"),n=t?t.get("containerLayer"):null;e&&e.parentNode&&e.parentNode!==n&&e.parentNode.removeChild(e);if(!t)e&&e.parentNode&&e.parentNode.removeChild(e);else if(!n)e&&(e.parentNode&&e.parentNode.removeChild
(e),this.destroyLayer());else{if(!e){this.createLayer(),e=this.get("layer");if(!e)return}var r=t.get("childViews"),i=r.objectAt(r.indexOf(this)+1),s=i?i.get("layer"):null;i&&(!s||s.parentNode!==n)&&(i.updateLayerLocationIfNeeded(),s=i.get("layer")||null),(e.parentNode!==n||e.nextSibling!==s)&&n.insertBefore(e,s)}return n=t=e=s=null,this.set("layerLocationNeedsUpdate",NO),this},_notifyWillDestroyLayer:function(){this.willDestroyLayer&&this.willDestroyLayer();var e=this.willDestroyLayerMixin,t,n,r=this.get("childViews");if(e){t=e.length;for(n=0;n<t;++n)e[n].call(this)}t=r.length;for(n=0;n<t;++n)r[n]._notifyWillDestroyLayer();this.set("layer",null)},renderToContext:function(e,t){var n,r,i,s;this.beginPropertyChanges(),this.set("layerNeedsUpdate",NO),SC.none(t)&&(t=YES),this._renderLayerSettings(e,t),n=!this.update,n?this.render(e,t):t?this.render(e):this.update(e.$()),t&&!this._didRenderChildViews&&this.renderChildViews(e,t),this._didRenderChildViews=NO;if(r=this.renderMixin){s=r.length;for(i=0;i<s;++i)r[i].call(this,e,t)}this.endPropertyChanges()},_renderLayerSettings:function(e,t){e.resetClassNames(),e.resetStyles(),this.applyAttributesToContext(e)},applyAttributesToContext:function(e){this._didApplyAttributes||(this._applyClassNameBindings(),this._applyAttributeBindings(e),this._didApplyAttributes=YES),e.addClass(this.get("classNames")),this.get("isTextSelectable")&&e.addClass("allow-select"),this.get("isVisible")||e.addClass("sc-hidden"),this.get("isFirstResponder")&&e.addClass("focus"),e.id(this.get("layerId")),e.attr("role",this.get("ariaRole")),e.attr("aria-label",this.get
("ariaLabel"));var t=this.get("ariaHidden");t!==null&&(t===NO?e.removeAttr("aria-hidden"):e.attr("aria-hidden",t)),this.get("acceptsFirstResponder")&&e.attr("tabindex","0")},_applyClassNameBindings:function(){var e=this.get("classNameBindings"),t=this.get("classNames"),n,r,i;if(!e)return;e.forEach(function(e){var s,o=function(){r=this._classStringForProperty(e),n=this.$(),s&&(n.removeClass(s),t.removeObject(s)),r?(n.addClass(r),t.pushObject(r),s=r):s=null};this.addObserver(e.split(":")[0],this,o),i=this._classStringForProperty(e),i&&(t.push(i),s=i)},this)},_applyAttributeBindings:function(e){var t=this.get("attributeBindings"),n,r,i;if(!t)return;t.forEach(function(t){var s=function(){r=this.$();var e=r.attr(t);n=this.get(t),i=typeof n,i!=="string"&&i!=="number"||n===e?n&&i==="boolean"?r.attr(t,t):n===NO&&r.removeAttr(t):r.attr(t,n)};this.addObserver(t,this,s),n=this.get(t),i=typeof n,i==="string"||i==="number"?e.attr(t,n):n&&i==="boolean"&&e.attr(t,t)},this)},_classStringForProperty:function(e){var t=e.split(":"),n=t[1];e=t[0];var r=SC.getPath(this,e);return r===YES?n?n:SC.String.dasherize(e.split(".").get("lastObject")):r!==NO&&r!==undefined&&r!==null?r:null},prepareContext:function(e,t){t!==!1&&(t=YES),t?this.renderToContext(e):this.updateLayer(e)},renderChildViews:function(e,t){var n=this.get("childViews"),r=n.length,i,s;for(i=0;i<r;++i){s=n[i];if(!s)continue;e=e.begin(s.get("tagName")),s.renderToContext(e,t),e=e.end()}return this._didRenderChildViews=YES,e},render:function(){},_notifyDidAppendToDocument:function(){this.get("hasLayout")||this.notifyPropertyChange("frame")
,this.didAppendToDocument&&this.didAppendToDocument();var e=0,t,n,r=this.get("childViews");for(e=0,n=r.length;e<n;e++)t=r[e],t._notifyDidAppendToDocument&&t._notifyDidAppendToDocument()},childViewsObserver:function(){var e=this.get("childViews"),t,n,r;for(t=0,n=e.length;t<n;t++)r=e[t],r._notifyDidAppendToDocument&&r._notifyDidAppendToDocument()}.observes("childViews"),tagName:"div",classNames:[],toolTip:null,displayToolTip:function(){var e=this.get("toolTip");return e&&this.get("localize")?SC.String.loc(e):e||""}.property("toolTip","localize").cacheable(),isTextSelectable:NO,displayProperties:["ariaHidden","ariaLabel"],nextResponder:function(){return this.get("parentView")}.property("parentView").cacheable(),acceptsFirstResponder:NO,init:function(){var e=this.get("parentView"),t,n,r,i;arguments.callee.base.apply(this,arguments),SC.View.views[this.get("layerId")]=this,this.classNames=this.get("classNames").slice(),this.childViews=this.get("childViews").slice(),this.createChildViews(),i=this.get("displayProperties");for(var s=0,o=i.length;s<o;s++)this.addObserver(i[s],this,this.displayDidChange)},awake:function(){arguments.callee.base.apply(this,arguments);var e=this.get("childViews"),t=e.length,n;for(n=0;n<t;++n){if(!e[n])continue;e[n].awake()}},frame:function(){return this.computeFrameWithParentFrame(null)}.property("useStaticLayout").cacheable(),computeFrameWithParentFrame:function(){var e,t=this.get("parentView"),n;return(e=this.get("layer"))?(n=SC.offset(e),t&&(n=t.convertFrameFromView(n,null)),n.width=e.offsetWidth,n.height=e.offsetHeight,n):this.get("hasLayout")?null:{x
:0,y:0,width:0,height:0}},clippingFrame:function(){var e=this.__alreadyCalculatedClippingFrame;if(e)return delete this.__alreadyCalculatedClippingFrame,e;var t=this.get("frame"),n=t,r,i;if(!t)return null;r=this.get("parentView");if(r){i=r.get("clippingFrame");if(!i)return{x:0,y:0,width:t.width,height:t.height};n=SC.intersectRects(i,t)}return n.x-=t.x,n.y-=t.y,n}.property().cacheable(),_previousClippingFrame:null,_sc_view_clippingFrameMayHaveChanged:function(){var e=this._previousClippingFrame,t=this.clippingFrame(),n,r,i,s;if(!e||!t||e.height!==t.height||e.width!==t.width||e.y!==t.y||e.x!==t.x){this._previousClippingFrame=t,this.__alreadyCalculatedClippingFrame=t,this.notifyPropertyChange("clippingFrame"),n=this.get("childViews");for(r=0,i=n.length;r<i;++r)s=n[r],s._sc_view_clippingFrameMayHaveChanged()}else delete this.__alreadyCalculatedClippingFrame},removeChild:function(e){e.set("parentView",null);var t=this.get("childViews"),n=t.indexOf(e);return n>=0&&t.removeAt(n),this},removeAllChildren:function(){var e=this.get("childViews"),t;while(t=e.objectAt(e.get("length")-1))this.removeChild(t);return this},removeFromParent:function(){var e=this.get("parentView");return e&&e.removeChild(this),this},destroy:function(){return this.get("isDestroyed")?this:(this._destroy(),this.get("parentView")&&this.removeFromParent(),arguments.callee.base.apply(this,arguments))},_destroy:function(){this.destroyLayer();var e=this.get("childViews"),t=e.length,n;if(t){e=e.slice();for(n=0;n<t;++n)e[n].destroy()}return delete SC.View.views[this.get("layerId")],delete this._CQ,delete this.page,this.get
("parentView")&&this.removeFromParent(),this.set("owner",null),this},createChildViews:function(){var e=this.get("childViews"),t=e.length,n,r,i,s;this.beginPropertyChanges();for(n=0;n<t;++n){if(r=s=e[n]){typeof r===SC.T_STRING?s=this[r]:r=null;if(!s){SC.Logger.error("No view with name "+r+" has been found in "+this.toString());continue}s=this.createChildView(s),r&&(this[r]=s)}e[n]=s}return this.endPropertyChanges(),this},createChildView:function(e,t){return e.isClass?t?t=SC.clone(t):t={}:t=e,t.owner=t.parentView=this,e.isClass&&e.prototype.hasVisibility&&(t.isVisibleInWindow=this.get("isVisibleInWindow")),t.page||(t.page=this.page),e.isClass&&(e=e.create(t)),e},isView:YES,selectStart:function(e){return this.get("isTextSelectable")},isContextMenuEnabled:SC.CONTEXT_MENU_ENABLED,contextMenu:function(e){return!this.get("isContextMenuEnabled")}}),SC.CoreView.mixin({isViewClass:YES,design:function(){if(this.isDesign)return this;var e=this.extend.apply(this,arguments);return e.isDesign=YES,e},extend:function(){var e=arguments[arguments.length-1];return e&&!SC.none(e.theme)&&typeof e.theme=="string"&&(e.themeName=e.theme,delete e.theme),SC.Object.extend.apply(this,arguments)},layout:function(e){return this.prototype.layout=e,this},classNames:function(e){return e=(this.prototype.classNames||[]).concat(e),this.prototype.classNames=e,this},tagName:function(e){return this.prototype.tagName=e,this},childView:function(e){var t=this.prototype.childViews||[];return t===this.superclass.prototype.childViews&&(t=t.slice()),t.push(e),this.prototype.childViews=t,this},bind:function(e,t){var n=this
.prototype,r=this.superclass.prototype,i=n._bindings;if(!i||i===r._bindings)i=n._bindings=(i||[]).slice();return e+="Binding",n[e]=t,i.push(e),this},prop:function(e,t){return this.prototype[e]=t,this},localization:function(e,t){return t&&(e.rootElement=SC.$(t)[0]),e},viewFor:function(e,t){var n=SC.$A(arguments);SC.none(e)?n.shift():n[0]={rootElement:SC.$(e)[0]};var r=this.create.apply(this,arguments);return n=n[0]=null,r},create:function(){var e=arguments[arguments.length-1];e&&e.theme&&(e.themeName=e.theme,delete e.theme);var t=this,n=new t(arguments);return n},loc:function(e){var t=e.childViews;delete e.childViews,this.applyLocalizedAttributes(e);var n=this.prototype.childViews,r=n.length,i;while(--r>=0)i=n[r],e=t[r],e&&i&&typeof i===SC.T_STRING&&SC.String.loc(i,e);return this},applyLocalizedAttributes:function(e){SC.mixin(this.prototype,e)},views:{}}),SC.outlet=function(e,t){return function(n){return this[n]=SC.objectForPropertyPath(e,t!==undefined?t:this)}.property()},SC.CoreView.unload=function(){var e=SC.View.views;if(e)for(var t in e){if(!e.hasOwnProperty(t))continue;delete e[t]}},SC.View=SC.CoreView.extend({classNames:["sc-view"],displayProperties:["isFirstResponder"]}),SC.browser.msie&&SC.Event.add(window,"unload",SC.View,SC.View.unload),SC.ANIMATABLE_PROPERTIES={top:YES,left:YES,bottom:YES,right:YES,width:YES,height:YES,centerX:YES,centerY:YES,opacity:YES,scale:YES,rotate:YES,rotateX:YES,rotateY:YES,rotateZ:YES},SC.View.reopen({didCreateLayerMixin:function(){SC.platform.supportsCSSTransitions&&this.resetAnimation()},animate:function(e,t,n,r){var i,s;typeof e===SC.T_STRING?
(i={},i[e]=t,s=n):(i=e,s=t,r=n);var o=SC.typeOf(s);if(o===SC.T_NUMBER)s={duration:s};else if(o!==SC.T_HASH)throw"Must provide options hash or duration!";r&&(s.callback=r);var u=s.timing;u?typeof u!==SC.T_STRING&&(s.timing="cubic-bezier("+u[0]+", "+u[1]+", "+u[2]+", "+u[3]+")"):s.timing="linear";var a=SC.clone(this.get("layout")),f=NO,l,c,h,p,d;a.animate||(a.animate={});for(d in i){if(!i.hasOwnProperty(d)||!SC.ANIMATABLE_PROPERTIES[d])continue;l=i[d],c=a[d],p=a.animate[d];if(l==null)throw"Can only animate to an actual value!";if(c!==l||p&&p.duration!==s.duration)f=YES,a.animate[d]=s,a[d]=l}return f&&this.set("layout",a),this},resetAnimation:function(){var e=this.get("layout"),t=e.animate,n=NO,r;if(!t)return;var i;for(r in t)n=YES,delete t[r];return n&&(this.set("layout",e),this.notifyPropertyChange("layout")),this},transitionDidEnd:function(e){this.get("layoutStyleCalculator").transitionDidEnd(e)}}),SC.CSS_TRANSFORM_MAP={rotate:function(e){return null},rotateX:function(e){return SC.typeOf(e)===SC.T_NUMBER&&(e+="deg"),"rotateX("+e+")"},rotateY:function(e){return SC.typeOf(e)===SC.T_NUMBER&&(e+="deg"),"rotateY("+e+")"},rotateZ:function(e){return SC.typeOf(e)===SC.T_NUMBER&&(e+="deg"),"rotateZ("+e+")"},scale:function(e){return SC.typeOf(e)===SC.T_ARRAY&&(e=e.join(", ")),"scale("+e+")"}},SC.View.reopen({layoutStyleCalculator:null,layoutStyle:function(){var e={layout:this.get("layout"),turbo:this.get("hasAcceleratedLayer"),staticLayout:this.get("useStaticLayout")},t=this.get("layoutStyleCalculator");return t.set(e),t.calculate()}.property().cacheable()}),SC.View.LayoutStyleCalculator=
SC.Object.extend({_layoutDidUpdate:function(){var e=this.get("layout");if(!e)return;this.dims=SC._VIEW_DEFAULT_DIMS,this.loc=this.dims.length;var t=this.right=e.right;this.hasRight=t!=null;var n=this.left=e.left;this.hasLeft=n!=null;var r=this.top=e.top;this.hasTop=r!=null;var i=this.bottom=e.bottom;this.hasBottom=i!=null;var s=this.width=e.width;this.hasWidth=s!=null;var o=this.height=e.height;this.hasHeight=o!=null,this.minWidth=e.minWidth===undefined?null:e.minWidth;var u=this.maxWidth=e.maxWidth===undefined?null:e.maxWidth;this.hasMaxWidth=u!=null,this.minHeight=e.minHeight===undefined?null:e.minHeight;var a=this.maxHeight=e.maxHeight===undefined?null:e.maxHeight;this.hasMaxHeight=a!=null;var f=this.centerX=e.centerX;this.hasCenterX=f!=null;var l=this.centerY=e.centerY;this.hasCenterY=l!=null;var c=this.borderTop=(e.borderTop!==undefined?e.borderTop:e.border)||0,h=this.borderRight=(e.borderRight!==undefined?e.borderRight:e.border)||0,p=this.borderBottom=(e.borderBottom!==undefined?e.borderBottom:e.border)||0,d=this.borderLeft=(e.borderLeft!==undefined?e.borderLeft:e.border)||0;this.zIndex=e.zIndex!=null?e.zIndex.toString():null,this.opacity=e.opacity!=null?e.opacity.toString():null,this.backgroundPosition=e.backgroundPosition!=null?e.backgroundPosition:null,this.ret={marginTop:null,marginLeft:null}}.observes("layout"),_invalidAutoValue:function(e){var t=SC.Error.desc("%@.layout() you cannot use %@:auto if staticLayout is disabled".fmt(this.get("view"),e),"%@".fmt(this.get("view")),-1);throw SC.Logger.error(t.toString()),t},_handleMistakes:function(){var e=this.get("layout"
);this.staticLayout||(this.width===SC.LAYOUT_AUTO&&this._invalidAutoValue("width"),this.height===SC.LAYOUT_AUTO&&this._invalidAutoValue("height"));if(SC.platform.supportsCSSTransforms){var t=e.animate,n,r;if(t)for(r in t)if(SC.CSS_TRANSFORM_MAP[r]){if(this._pendingAnimations&&this._pendingAnimations["-"+SC.platform.cssPrefix+"-transform"])throw"Animations of transforms must be executed simultaneously!";n&&t[r].duration!==n&&(SC.Logger.warn("Can't animate transforms with different durations! Using first duration specified."),t[r].duration=n),n=t[r].duration}}},_calculatePosition:function(e){var t=null,n=this.get("turbo"),r=this.ret,i,s,o,u,a,f,l,c,h,p,d,v,m,g;e==="x"?(i="left",s="right",o="width",u="maxWidth",a="marginLeft",p="borderLeft",v="borderRight",f=this.hasLeft,l=this.hasRight,c=this.hasWidth,h=this.hasMaxWidth):(i="top",s="bottom",o="height",u="maxHeight",a="marginTop",p="borderTop",v="borderBottom",f=this.hasTop,l=this.hasBottom,c=this.hasHeight,h=this.hasMaxHeight),r[i]=this._cssNumber(this[i]),r[s]=this._cssNumber(this[s]),d=this._cssNumber(this[p]),m=this._cssNumber(this[v]),r[p+"Width"]=d||null,r[v+"Width"]=m||null,g=this[o],g>=1&&(g-=d+m),r[o]=this._cssNumber(g);if(f)n&&(t=r[i],r[i]=0),l&&c&&(r[s]=null);else if(!l||l&&!c&&!h)r[i]=0;return!c&&!l&&(r[s]=0),t},_calculateCenter:function(e){var t=this.ret,n,r,i,s,o,u,a,f,l;e==="x"?(n="width",r="centerX",i="left",s="right",o="marginLeft",u="borderLeft",f="borderRight"):(n="height",r="centerY",i="top",s="bottom",o="marginTop",u="borderTop",f="borderBottom"),t[i]="50%",a=this._cssNumber(this[u]),l=this._cssNumber(this[
f]),t[u+"Width"]=a||null,t[f+"Width"]=l||null;var c=this[n],h=this[r],p=this[i],d=SC.isPercentage(c),v=SC.isPercentage(h,YES);c>1&&(c-=a+l);if(d&&v||!d&&!v){var m=h-c/2;t[o]=d?Math.floor(m*100)+"%":Math.floor(m)}else SC.Logger.warn("You have to set "+n+" and "+r+" using both percentages or pixels"),t[o]="50%";t[n]=this._cssNumber(c)||0,t[s]=null},_calculateTransforms:function(e,t){if(SC.platform.supportsCSSTransforms){var n=this.get("layout"),r=SC.platform.domCSSPrefix+"Transform",i=[];this.turbo&&(i.push("translateX("+(e||0)+"px)","translateY("+(t||0)+"px)"),SC.platform.supportsCSS3DTransforms&&i.push("translateZ(0px)"));var s=SC.CSS_TRANSFORM_MAP;for(var o in s){var u=n[o];u!=null&&i.push(s[o](u))}this.ret[r]=i.length>0?i.join(" "):null}},_calculateAnimations:function(e,t){var n=this.layout,r=n.animate,i;if(!r)return;if(this.getPath("view.isAnimatable"))return;var s=[],o;this._animatedTransforms=[],this._pendingAnimations||(this._pendingAnimations={});var u="-"+SC.platform.cssPrefix+"-transform";if(SC.platform.supportsCSSTransitions){for(i in r){o=r[i];var a=SC.CSS_TRANSFORM_MAP[i],f=i==="top"&&t!=null||i==="left"&&e!=null;SC.platform.supportsCSSTransforms&&(f||a)&&(this._animatedTransforms.push(i),i=u),o.css=i+" "+o.duration+"s "+o.timing,this._pendingAnimations[i]||(this._pendingAnimations[i]=o,s.push(o.css))}this.ret[SC.platform.domCSSPrefix+"Transition"]=s.join(", ")}else for(i in r)this._pendingAnimations[i]=r[i];delete n.animate},_cssNumber:function(e){return e==null?null:e===SC.LAYOUT_AUTO?SC.LAYOUT_AUTO:SC.isPercentage(e)?e*100+"%":e},calculate:function(){var e=this
.get("layout"),t=null,n=this.get("staticLayout"),r=null,i=null,s=this.get("turbo"),o=this.ret,u=this.dims,a=this.loc,f=this.get("view"),l,c;this._handleMistakes(e);if(n&&e===SC.View.prototype.layout)return{};this.hasLeft||this.hasRight||!this.hasCenterX?i=this._calculatePosition("x"):this._calculateCenter("x"),this.hasTop||this.hasBottom||!this.hasCenterY?r=this._calculatePosition("y"):this._calculateCenter("y"),o.minWidth=this.minWidth,o.maxWidth=this.maxWidth,o.minHeight=this.minHeight,o.maxHeight=this.maxHeight,o.zIndex=this.zIndex,o.opacity=this.opacity,o.backgroundPosition=this.backgroundPosition,this._calculateTransforms(i,r),this._calculateAnimations(i,r);for(l in o)c=o[l],typeof c===SC.T_NUMBER&&(o[l]=c+"px");return o},willRenderAnimations:function(){if(SC.platform.supportsCSSTransitions){var e=this.get("view"),t=e.get("layer"),n=t?t.style:null,r=e.get("layoutStyle"),i=this._activeAnimations,s,o=this._pendingAnimations,u,a=this._animatedTransforms,f=a?a.length:0,l=r[SC.platform.domCSSPrefix+"Transition"],c=e.get("layout"),h,p,d,v;if(o){i||(i={});for(h in o){if(!o.hasOwnProperty(h))continue;u=o[h],s=i[h],v=NO,r[h]!==(n?n[h]:null)&&(v=YES),s&&(s.duration!==u.duration||s.timing!==u.timing)&&(v=YES);if(v&&s){if(p=s.callback)if(f>0){for(d=0;d<f;d++)this.runAnimationCallback(p,null,a[d],YES);this._animatedTransforms=null}else this.runAnimationCallback(p,null,h,YES);this.removeAnimationFromLayout(h,YES)}i[h]=u}}this._activeAnimations=i,this._pendingAnimations=null}},didRenderAnimations:function(){if(!SC.platform.supportsCSSTransitions){var e,t;for(e in this._pendingAnimations
)t=this._pendingAnimations[e].callback,t&&this.runAnimationCallback(t,null,e,NO),this.removeAnimationFromLayout(e,NO,YES);this._activeAnimations=this._pendingAnimations=null}},runAnimationCallback:function(e,t,n,r){var i=this.get("view");e&&(SC.typeOf(e)!==SC.T_HASH&&(e={action:e}),e.source=i,e.target||(e.target=this)),SC.View.runCallback(e,{event:t,propertyName:n,view:i,isCancelled:r})},transitionDidEnd:function(e){var t=e.originalEvent.propertyName,n,r;n=this._activeAnimations?this._activeAnimations[t]:null;if(n){if(n.callback){SC.RunLoop.begin();if(this._animatedTransforms&&this._animatedTransforms.length>0)for(r=0;r<this._animatedTransforms.length;r++)this.invokeLater("runAnimationCallback",1,n.callback,e,this._animatedTransforms[r],NO);else this.invokeLater("runAnimationCallback",1,n.callback,e,t,NO);SC.RunLoop.end()}this.removeAnimationFromLayout(t,YES)}},removeAnimationFromLayout:function(e,t,n){if(t){var r=this.getPath("view.layer"),i=[],s;for(s in this._activeAnimations)s!==e&&i.push(this._activeAnimations[s].css);r&&(r.style[SC.platform.domCSSPrefix+"Transition"]=i.join(", "))}var o=this.getPath("view.layout"),u;if(e==="-"+SC.platform.cssPrefix+"-transform"&&this._animatedTransforms&&this._animatedTransforms.length>0){for(u=0;u<this._animatedTransforms.length;u++)delete o["animate"+SC.String.capitalize(this._animatedTransforms[u])];this._animatedTransforms=null}delete o["animate"+SC.String.capitalize(e)],n||delete this._activeAnimations[e]}}),SC.CoreView.runCallback=function(e){var t=SC.$A(arguments).slice(1),n=SC.typeOf(e.action);if(n==SC.T_FUNCTION)e.action.apply
(e.target,t);else if(n===SC.T_STRING&&e.action.indexOf(".")>=0){var r=e.action.split("."),i=r.pop(),s=SC.objectForPropertyPath(r,window),o=s.get?s.get(i):s[i];if(!o||SC.typeOf(o)!=SC.T_FUNCTION)throw"SC.runCallback could not find a function at %@".fmt(e.action);o.apply(s,t)}},SC.View.runCallback=SC.CoreView.runCallback,SC.View.reopen({wantsAcceleratedLayer:NO,hasAcceleratedLayer:function(){if(this.get("wantsAcceleratedLayer")&&SC.platform.supportsAcceleratedLayers){var e=this.get("layout"),t=e.animate,n=SC.LAYOUT_AUTO,r;if(t&&(t.top||t.left))for(r in t)if(SC.CSS_TRANSFORM_MAP[r]&&(t.top&&t.top.duration!==t[r].duration||t.left&&t.left.duration!==t[r].duration))return NO;if(e.left!=null&&!SC.isPercentage(e.left)&&e.left!==n&&e.top!=null&&!SC.isPercentage(e.top)&&e.top!==n&&e.width!=null&&!SC.isPercentage(e.width)&&e.width!==n&&e.height!=null&&!SC.isPercentage(e.height)&&e.height!==n)return YES}return NO}.property("wantsAcceleratedLayer").cacheable()}),SC.View.reopen({cursor:function(e,t){var n;return t&&(this._setCursor=t),this._setCursor!==undefined?this._setCursor:(n=this.get("parentView"),this.get("shouldInheritCursor")&&n?n.get("cursor"):null)}.property("parentView","shouldInheritCursor").cacheable(),applyAttributesToContext:function(e,t){var n=this.get("cursor");n&&t.addClass(n.get("className")),e(t)}.enhance(),shouldInheritCursor:YES}),SC.View.reopen({isEnabled:YES,isEnabledBindingDefault:SC.Binding.oneWay().bool(),isEnabledInPane:function(){var e=this.get("isEnabled"),t;return e&&(t=this.get("parentView"))&&(e=t.get("isEnabledInPane")),e}.property("parentView","isEnabled"
),_sc_view_isEnabledDidChange:function(){!this.get("isEnabled")&&this.get("isFirstResponder")&&this.resignFirstResponder()}.observes("isEnabled"),applyAttributesToContext:function(e,t){var n=this.get("isEnabled");e(t),t.setClass("disabled",!n),t.attr("aria-disabled",n?null:"true")}.enhance()}),SC.View.reopen({isKeyResponder:NO,willLoseKeyResponderTo:function(e){},willBecomeKeyResponderFrom:function(e){},didLoseKeyResponderTo:function(e){},didBecomeKeyResponderFrom:function(e){},interpretKeyEvents:function(e){var t=e.commandCodes(),n=t[0],r=t[1],i;if(!n&&!r)return null;if(n){var s=SC.MODIFIED_KEY_BINDINGS[n]||SC.BASE_KEY_BINDINGS[n.match(/[^_]+$/)[0]];if(s){var o=this,u=this.get("pane"),a=null;while(o&&!(a=o.tryToPerform(s,e)))o=o===u?null:o.get("nextResponder");return a}}return r&&this.respondsTo("insertText")?(i=this.insertText(r,e),i?i===YES?this:i:null):null},insertText:function(e){return NO},performKeyEquivalent:function(e,t){var n=NO,r=this.get("childViews"),i=r.length,s=-1,o;while(!n&&++s<i)o=r[s],n=o.tryToPerform("performKeyEquivalent",e,t);return n},firstKeyView:null,_getFirstKeyView:function(){var e=this.get("firstKeyView");if(e)return e;var t=this.get("childViews");if(t)return t[0]},lastKeyView:null,_getLastKeyView:function(){var e=this.get("lastKeyView");if(e)return e;var t,n=this.get("firstKeyView");if(n){while(t=n._getNextKeyView())n=t;return n}var r=this.get("childViews");if(r)return r[r.length-1]},nextKeyView:undefined,_getNextKeyView:function(){var e=this.get("parentView"),t=this.get("nextKeyView");if(e&&e.get("lastKeyView")===this)return null;if(t!==undefined
)return t;if(e){var n=e.get("childViews");return n[n.indexOf(this)+1]}},nextValidKeyView:function(){var e=this,t;while(t!==this){t=null,e.get("isVisibleInWindow")&&(t=e._getFirstKeyView()),t||(t=e._getNextKeyView());if(!t)while(e=e.get("parentView"))if(t=e._getNextKeyView())break;if(!t){if(!SC.TABBING_ONLY_INSIDE_DOCUMENT)break;t=this.get("pane")}if(t.get("isVisibleInWindow")&&t.get("acceptsFirstResponder"))return t;e=t}return null}.property("nextKeyView"),previousKeyView:undefined,_getPreviousKeyView:function(){var e=this.get("parentView"),t=this.get("previousKeyView");if(e&&e.get("firstKeyView")===this)return null;if(t!==undefined)return t;if(e){var n=e.get("childViews");return n[n.indexOf(this)-1]}},previousValidKeyView:function(){var e=this,t;while(t!==this){if(e.get("parentView"))t=e._getPreviousKeyView();else{if(!SC.TABBING_ONLY_INSIDE_DOCUMENT)break;t=e}if(t){do e=t,t=t._getLastKeyView();while(t&&t.get("isVisibleInWindow"));t||(t=e)}else t=e.get("parentView");if(t.get("isVisibleInWindow")&&t.get("acceptsFirstResponder"))return t;e=t}return null}.property("previousKeyView")}),SC.LAYOUT_HORIZONTAL="sc-layout-horizontal",SC.LAYOUT_VERTICAL="sc-layout-vertical",SC._VIEW_DEFAULT_DIMS=["marginTop","marginLeft"],SC.FULL_WIDTH={left:0,right:0},SC.FULL_HEIGHT={top:0,bottom:0},SC.ANCHOR_CENTER={centerX:0,centerY:0},SC.LAYOUT_AUTO="auto",SC.View.reopen({hasLayout:YES,useStaticLayout:NO,init:function(e){e(),this.layoutStyleCalculator=SC.View.LayoutStyleCalculator.create({view:this}),this._previousLayout=this.get("layout")}.enhance(),propertyDidChange:function(e,t,n){var r=!1;if(typeof 
this.layout=="function"&&this._kvo_dependents){var i=this._kvo_dependents[e];i&&i.indexOf("layout")!=-1&&(r=!0)}(e==="layout"||r)&&this.layoutDidChange(),arguments.callee.base.apply(this,arguments)},adjust:function(e,t){var n=this.get("layout"),r=NO,i,s;if(e===undefined)return this;if(SC.typeOf(e)===SC.T_STRING){i=n[e];if(t===undefined||i==t)return this;n=SC.clone(n),t===null?delete n[e]:n[e]=t,r=YES}else{s=e;for(e in s){if(!s.hasOwnProperty(e))continue;t=s[e],i=n[e];if(t===undefined||i==t)continue;r||(n=SC.clone(n)),t===null?delete n[e]:n[e]=t,r=YES}}return r&&this.set("layout",n),this},layout:{top:0,left:0,bottom:0,right:0},isFixedLayout:function(){return this.get("isFixedPosition")&&this.get("isFixedSize")}.property("isFixedPosition","isFixedSize").cacheable(),isFixedPosition:function(){var e=this.get("layout"),t,n=e.left,r=e.top;return t=n!==undefined&&r!==undefined&&n!==SC.LAYOUT_AUTO&&r!==SC.LAYOUT_AUTO,t&&(t=!SC.isPercentage(r)&&!SC.isPercentage(n)),t}.property("layout").cacheable(),isFixedSize:function(){var e=this.get("layout"),t,n=e.width,r=e.height;return t=n!==undefined&&r!==undefined&&n!==SC.LAYOUT_AUTO&&r!==SC.LAYOUT_AUTO,t&&(t=!SC.isPercentage(n)&&!SC.isPercentage(r)),t}.property("layout").cacheable(),convertFrameToView:function(e,t){var n=0,r=0,i=0,s=0,o=this,u;while(o)u=o.get("frame"),n+=u.x,r+=u.y,o=o.get("layoutView");if(t){o=t;while(o)u=o.get("frame"),i+=u.x,s+=u.y,o=o.get("layoutView")}return n=e.x+n-i,r=e.y+r-s,{x:n,y:r,width:e.width,height:e.height}},convertFrameFromView:function(e,t){var n=0,r=0,i=0,s=0,o=this,u;while(o&&(u=o.get("frame")))n+=u.x,r+=u
.y,o=o.get("parentView");if(t){o=t;while(o)u=o.get("frame"),i+=u.x,s+=u.y,o=o.get("parentView")}return n=e.x-n+i,r=e.y-r+s,{x:n,y:r,width:e.width,height:e.height}},scrollToVisible:function(){var e=this.get("parentView");while(e&&!e.get("isScrollable"))e=e.get("parentView");return e?(e.scrollToVisible(),e.scrollToVisible(this)):NO},_adjustForBorder:function(e,t){var n=(t.borderTop!==undefined?t.borderTop:t.border)||0,r=(t.borderLeft!==undefined?t.borderLeft:t.border)||0,i=(t.borderBottom!==undefined?t.borderBottom:t.border)||0,s=(t.borderRight!==undefined?t.borderRight:t.border)||0;return e.x+=r,e.y+=n,e.width-=r+s,e.height-=n+i,e},computeFrameWithParentFrame:function(e,t){var n,r=this.get("layout");if(this.get("useStaticLayout"))return n=e(),n?this._adjustForBorder(n,r):null;n={};var i,s,o=SC.LAYOUT_AUTO,u=this.get("parentView"),a,f,l=r.right,c=r.left,h=r.top,p=r.bottom,d=r.width,v=r.height,m=r.centerX,g=r.centerY;if(d===o)throw i=SC.Error.desc("%@.layout() cannot use width:auto if staticLayout is disabled".fmt(this),"%@".fmt(this),-1),SC.Logger.error(i.toString()),i;if(v===o)throw i=SC.Error.desc("%@.layout() cannot use height:auto if staticLayout is disabled".fmt(this),"%@".fmt(this),-1),SC.Logger.error(i.toString()),i;t||(t=this.computeParentDimensions(r)),a=t.height,f=t.width,SC.none(c)?SC.none(l)?SC.none(m)?(n.x=0,SC.none(d)?n.width=f:(d===o&&(n.width=o),SC.isPercentage(d)?n.width=d*f:n.width=d||0)):(d===o?n.width=o:SC.isPercentage(d)?n.width=d*f:n.width=d||0,SC.isPercentage(m)?n.x=(f-n.width)/2+m*f:n.x=(f-n.width)/2+m):SC.none(d)?(SC.isPercentage(l)?n.width=f-f*l:n.width=
f-l,n.x=0):(d===o?n.width=o:SC.isPercentage(d)?n.width=f*d:n.width=d||0,SC.isPercentage(d)?n.x=f-l*f-n.width:n.x=f-l-n.width):(SC.isPercentage(c)?n.x=f*c:n.x=c,d!==undefined?d===o?n.width=o:SC.isPercentage(d)?n.width=f*d:n.width=d:(n.width=f-n.x,l&&SC.isPercentage(l)?n.width=n.width-l*f:n.width=n.width-(l||0))),SC.none(h)?SC.none(p)?SC.none(g)?(n.y=0,SC.none(v)?n.height=a:(v===o&&(n.height=o),SC.isPercentage(v)?n.height=v*a:n.height=v||0)):(v===o&&(n.height=o),v&&SC.isPercentage(v)?n.height=v*a:n.height=v||0,SC.isPercentage(g)?n.y=(a-n.height)/2+g*a:n.y=(a-n.height)/2+g):SC.none(v)?(SC.isPercentage(p)?n.height=a-p*a:n.height=a-p,n.y=0):(v===o&&(n.height=o),v&&SC.isPercentage(v)?n.height=v*a:n.height=v||0,SC.isPercentage(p)?n.y=a-p*a-n.height:n.y=a-p-n.height):(SC.isPercentage(h)?n.y=h*a:n.y=h,v!==undefined?v===o?n.height=o:SC.isPercentage(v)?n.height=v*a:n.height=v:p&&SC.isPercentage(p)?n.height=a-n.y-p*a:n.height=a-n.y-(p||0));if(n.height===o||n.width===o)s=this.get("layer"),n.height===o&&(n.height=s?s.clientHeight:0),n.width===o&&(n.width=s?s.clientWidth:0);return n=this._adjustForBorder(n,r),u&&u.isScrollContainer&&(u=u.get("parentView"),n.x-=u.get("horizontalScrollOffset"),n.y-=u.get("verticalScrollOffset")),!SC.none(r.maxHeight)&&n.height>r.maxHeight&&(n.height=r.maxHeight),!SC.none(r.minHeight)&&n.height<r.minHeight&&(n.height=r.minHeight),!SC.none(r.maxWidth)&&n.width>r.maxWidth&&(n.width=r.maxWidth),!SC.none(r.minWidth)&&n.width<r.minWidth&&(n.width=r.minWidth),n.height<0&&(n.height=0),n.width<0&&(n.width=0),n}.enhance(),computeParentDimensions:function(e){var t,n=this
.get("parentView"),r=n?n.get("frame"):null;if(r)t={width:r.width,height:r.height};else{var i=e||{};t={width:(i.left||0)+(i.width||0)+(i.right||0),height:(i.top||0)+(i.height||0)+(i.bottom||0)}}return t},borderFrame:function(){var e=this.get("layout"),t=this.get("frame"),n=e.border,r=(e.topBorder!==undefined?e.topBorder:e.border)||0,i=(e.rightBorder!==undefined?e.rightBorder:e.border)||0,s=(e.bottomBorder!==undefined?e.bottomBorder:e.border)||0,o=(e.leftBorder!==undefined?e.leftBorder:e.border)||0;return{x:t.x-o,y:t.y-r,width:t.width+o+i,height:t.height+r+s}}.property("frame").cacheable(),parentViewDidResize:function(){var e,t;t=this.useStaticLayout||!this.get("isFixedSize"),e=!this.get("isFixedPosition"),t?this.viewDidResize():e&&this._viewFrameDidChange()},viewDidResize:function(){this._viewFrameDidChange();var e=this.childViews,t,n,r;for(n=0;n<(t=e.length);++n)r=e[n],r.tryToPerform("parentViewDidResize")},_viewFrameDidChange:function(){this.notifyPropertyChange("frame"),this._sc_view_clippingFrameMayHaveChanged()},beginLiveResize:function(){this.willBeginLiveResize&&this.willBeginLiveResize();var e=this.get("childViews"),t=e.length,n,r;for(n=0;n<t;++n)r=e[n],r.beginLiveResize&&r.beginLiveResize();return this},endLiveResize:function(){var e=this.get("childViews"),t=e.length,n,r;for(n=t-1;n>=0;--n)r=e[n],r.endLiveResize&&r.endLiveResize();return this.didEndLiveResize&&this.didEndLiveResize(),this},layoutView:function(){return this.get("parentView")}.property("parentView").cacheable(),layoutDidChange:function(){var e=this._previousLayout,t=this.get("layout"),n=YES,r,i,s,o;SC.
none(t.rotate)||SC.none(t.rotateX)&&(t.rotateX=t.rotate,SC.Logger.warn("Please set rotateX instead of rotate")),SC.none(t.rotateX)?delete t.rotate:t.rotate=t.rotateX;var u=t.animations;u&&(SC.none(u.rotate)||SC.none(u.rotateX)&&(u.rotateX=u.rotate,SC.Logger.warn("Please animate rotateX instead of rotate")),SC.none(u.rotateX)?delete u.rotate:u.rotate=u.rotateX),e&&e!==t&&(r=e.width,r!==undefined&&(s=t.width,r===s&&(i=e.height,e!==undefined&&(o=t.height,i===o&&(n=NO))))),this.beginPropertyChanges(),this.notifyPropertyChange("hasAcceleratedLayer"),this.notifyPropertyChange("layoutStyle"),n?this.viewDidResize():this._viewFrameDidChange(),this.endPropertyChanges();var a=this.get("layoutView");return a&&(a.set("childViewsNeedLayout",YES),a.layoutDidChangeFor(this),a.get("childViewsNeedLayout")&&a.invokeOnce(a.layoutChildViewsIfNeeded)),this._previousLayout=t,this},childViewsNeedLayout:NO,layoutDidChangeFor:function(e){var t=this._needLayoutViews;t||(t=this._needLayoutViews=SC.CoreSet.create()),t.add(e)},layoutChildViewsIfNeeded:function(e){return e||(e=this.get("isVisibleInWindow")),e&&this.get("childViewsNeedLayout")&&(this.set("childViewsNeedLayout",NO),this.layoutChildViews()),this},layoutChildViews:function(){var e=this._needLayoutViews,t=e?e.length:0,n;for(n=0;n<t;++n)e[n].updateLayout();e.clear()},updateLayout:function(){var e=this.get("layer"),t;return e&&(t=this.renderContext(e),this.renderLayout(t,NO),t.update(),this.useStaticLayout&&this.viewDidResize()),e=null,this},renderLayout:function(e,t){var n=this.get("layoutStyleCalculator");n.willRenderAnimations(),e.addStyle(this
.get("layoutStyle")),n.didRenderAnimations()},_renderLayerSettings:function(e,t,n){e(t,n),this.renderLayout(t,n)}.enhance(),applyAttributesToContext:function(e,t){e(t),this.get("useStaticLayout")&&t.addClass("sc-static-layout")}.enhance()}),SC.View.mixin({convertLayoutToAnchoredLayout:function(e,t){var n={top:0,left:0,width:t.width,height:t.height},r=t.width,i=t.height,s=e.right,o=e.left,u=e.top,a=e.bottom,f=e.width,l=e.height,c=e.centerX,h=e.centerY;return SC.none(o)?SC.none(s)?SC.none(c)?SC.none(f)?(n.left=0,n.width=0):(n.left=0,f===SC.LAYOUT_AUTO?n.width=SC.LAYOUT_AUTO:SC.isPercentage(f)?n.width=f*r:n.width=f):(f&&SC.isPercentage(f)?n.width=f*r:n.width=f||0,n.left=(r-n.width)/2,SC.isPercentage(c)?n.left=n.left+c*r:n.left=n.left+c):SC.none(f)?(n.left=0,s&&SC.isPercentage(s)?n.width=r-s*r:n.width=r-(s||0)):f===SC.LAYOUT_AUTO?n.width=SC.LAYOUT_AUTO:(SC.isPercentage(f)?n.width=f*r:n.width=f,SC.isPercentage(s)?n.left=r-(n.width+s):n.left=r-(n.width+s)):(SC.isPercentage(o)?n.left=o*r:n.left=o,f!==undefined?f===SC.LAYOUT_AUTO?n.width=SC.LAYOUT_AUTO:SC.isPercentage(f)?n.width=f*r:n.width=f:s&&SC.isPercentage(s)?n.width=r-n.left-s*r:n.width=r-n.left-(s||0)),e.minWidth!==undefined&&(n.minWidth=e.minWidth),e.maxWidth!==undefined&&(n.maxWidth=e.maxWidth),SC.none(u)?SC.none(a)?SC.none(h)?SC.none(l)?(n.top=0,n.height=0):(n.top=0,l===SC.LAYOUT_AUTO?n.height=SC.LAYOUT_AUTO:SC.isPercentage(l)?n.height=l*i:n.height=l):(l&&SC.isPercentage(l)?n.height=l*i:n.height=l||0,n.top=(i-n.height)/2,SC.isPercentage(h)?n.top=n.top+h*i:n.top=n.top+h):SC.none(l)?(n.top=0,a&&SC.isPercentage(a)?n.height=i-
a*i:n.height=i-(a||0)):l===SC.LAYOUT_AUTO?n.height=SC.LAYOUT_AUTO:(SC.isPercentage(l)?n.height=l*i:n.height=l,n.top=i-n.height,SC.isPercentage(a)?n.top=n.top-a*i:n.top=n.top-a):(SC.isPercentage(u)?n.top=u*i:n.top=u,l!==undefined?l===SC.LAYOUT_AUTO?n.height=SC.LAYOUT_AUTO:SC.isPercentage(l)?n.height=l*i:n.height=l:(n.height=i-n.top,a&&SC.isPercentage(a)?n.height=n.height-a*i:n.height=n.height-(a||0))),n.top&&(n.top=Math.floor(n.top)),n.bottom&&(n.bottom=Math.floor(n.bottom)),n.left&&(n.left=Math.floor(n.left)),n.right&&(n.right=Math.floor(n.right)),n.width!==SC.LAYOUT_AUTO&&(n.width=Math.floor(n.width)),n.height!==SC.LAYOUT_AUTO&&(n.height=Math.floor(n.height)),e.minHeight!==undefined&&(n.minHeight=e.minHeight),e.maxHeight!==undefined&&(n.maxHeight=e.maxHeight),n}}),SC.View.reopen({_lastLayerId:null,layerIdDidChange:function(){var e=this.get("layer"),t=this.get("layerId"),n=this._lastLayerId;t!==n&&(n&&SC.View.views[n]===this&&delete SC.View.views[n],this._lastLayerId=t,SC.View.views[t]=this,e&&(e.id=t))}.observes("layerId"),parentViewDidChange:function(){return this.recomputeIsVisibleInWindow(),this.resetBuildState(),this.set("layerLocationNeedsUpdate",YES),this.invokeOnce(this.updateLayerLocationIfNeeded),this._invalidatePaneCacheForSelfAndAllChildViews(),this},_invalidatePaneCacheForSelfAndAllChildViews:function(){var e,t=this.get("childViews"),n=t.length,r;this.notifyPropertyChange("pane");for(r=0;r<n;++r)e=t[r],e._invalidatePaneCacheForSelfAndAllChildViews&&e._invalidatePaneCacheForSelfAndAllChildViews()},insertBefore:function(e,t){e.beginPropertyChanges(),e.get("parentView"
)&&e.removeFromParent(),this.willAddChild&&this.willAddChild(e,t),e.willAddToParent&&e.willAddToParent(this,t),e.set("parentView",this);var n,r=this.get("childViews");return r.needsClone&&this.set(r=[]),n=t?r.indexOf(t):r.length,n<0&&(n=r.length),r.insertAt(n,e),e.parentViewDidChange&&e.parentViewDidChange(),e.layoutDidChange&&e.layoutDidChange(),e.endPropertyChanges(),this.invokeLast(function(){var t=e.get("pane");t&&t.get("isPaneAttached")&&e._notifyDidAppendToDocument()}),this.didAddChild&&this.didAddChild(e,t),e.didAddToParent&&e.didAddToParent(this,t),this},removeChild:function(e,t){if(!t)return this;if(t.parentView!==this)throw"%@.removeChild(%@) must belong to parent".fmt(this,t);return t.willRemoveFromParent&&t.willRemoveFromParent(),this.willRemoveChild&&this.willRemoveChild(t),e(t),t.parentViewDidChange&&t.parentViewDidChange(),this.didRemoveChild&&this.didRemoveChild(t),t.didRemoveFromParent&&t.didRemoveFromParent(this),this}.enhance(),replaceChild:function(e,t){return e.beginPropertyChanges(),t.beginPropertyChanges(),this.beginPropertyChanges(),this.insertBefore(e,t).removeChild(t),this.endPropertyChanges(),t.endPropertyChanges(),e.endPropertyChanges(),this},replaceAllChildren:function(e){var t=e.get("length"),n;this.beginPropertyChanges(),this.destroyLayer().removeAllChildren();for(n=0;n<t;n++)this.appendChild(e.objectAt(n));return this.replaceLayer(),this.endPropertyChanges(),this},appendChild:function(e){return this.insertBefore(e,null)},buildInChild:function(e){e.willBuildInToView(this),this.appendChild(e),e.buildInToView(this)},buildOutChild:function(e){e.buildOutFromView
(this)},buildInDidFinishFor:function(e){},buildOutDidFinishFor:function(e){this.removeChild(e)},isBuildingIn:NO,isBuildingOut:NO,buildIn:function(){this.buildInDidFinish()},buildOut:function(){this.buildOutDidFinish()},resetBuild:function(){},buildOutDidCancel:function(){},buildInDidCancel:function(){},buildInDidFinish:function(){this.isBuildingIn=NO,this._buildingInTo.buildInDidFinishFor(this),this._buildingInTo=null},buildOutDidFinish:function(){this.isBuildingOut=NO,this._buildingOutFrom.buildOutDidFinishFor(this),this._buildingOutFrom=null},resetBuildState:function(){this.isBuildingIn&&(this.buildInDidCancel(),this.isBuildingIn=NO),this.isBuildingOut&&(this.buildOutDidCancel(),this.isBuildingOut=NO),this.buildingInTo=null,this.buildingOutFrom=null,this.resetBuild()},willBuildInToView:function(e){this.isBuildingOut&&this.buildOutDidCancel()},buildInToView:function(e){if(this.isBuildingIn)return;this._buildingInTo=e,this.isBuildingOut=NO,this.isBuildingIn=YES,this.buildIn()},buildOutFromView:function(e){if(this.isBuildingOut)return;this.isBuildingIn&&this.buildInDidCancel(),this.isBuildingOut=YES,this.isBuildingIn=NO,this._buildingOutFrom=e,this.buildOut()}}),SC.View.reopen({init:function(e){e(),this._lastTheme=this.get("theme"),this._sc_view_lastRenderTheme=this.get("renderTheme")}.enhance(),themeName:null,baseThemeName:null,_sc_view_findThemeInParent:function(e,t,n){if(e){var r;if(t){r=t.find(e,n);if(r)return r}if(!n){r=SC.Theme.find(e);if(r)return r}return t.invisibleSubtheme(e)}return t},findThemeAtPathInParent:function(e,t,n){if(!e)return t;var r=e.split("."),i,s=r.length
,o=t;for(i=0;i<s;i++)o=this._sc_view_findThemeInParent(r[i],o,n),n=YES;return o},theme:function(){return this.findThemeAtPathInParent(this.get("themeName"),this.get("baseTheme"))}.property("baseTheme","themeName").cacheable(),_sc_view_themeDidChange:function(){if(this._lastTheme===this.get("theme"))return;this._lastTheme=this.get("theme");var e=this.childViews,t=e.length,n;for(n=0;n<t;n++)e[n].notifyPropertyChange("baseTheme")}.observes("theme"),baseTheme:function(){var e,t=this.get("baseThemeName");if(t)return this.findThemeAtPathInParent(t,SC.Theme);e=this.get("parentView");var n=e&&e.get("theme");return n||this.findThemeAtPathInParent(SC.defaultTheme,SC.Theme)}.property("baseThemeName","parentView").cacheable(),renderStyle:null,renderTheme:function(){return this.findThemeAtPathInParent(this.get("renderStyle"),this.get("theme"))}.property("theme","renderStyle").cacheable(),_sc_view_renderThemeDidChange:function(){if(this._sc_view_lastRenderTheme===this.get("renderTheme"))return;this._sc_view_lastRenderTheme=this.get("renderTheme"),this.get("layer")&&this.replaceLayer()}.observes("renderTheme"),renderDelegate:function(e,t){t&&(this._setRenderDelegate=t);if(this._setRenderDelegate)return this._setRenderDelegate;var n=this.get("renderDelegateName"),r;if(n){r=this.get("theme")[n];if(!r)throw'%@: Unable to locate render delegate "%@" in theme.'.fmt(this,n);return r}return null}.property("renderDelegateName","renderTheme"),renderDelegateName:null,renderDelegateProxy:function(){return SC.View._RenderDelegateProxy.createForView(this)}.property("renderDelegate").cacheable(),render:
function(e,t){var n=this.get("renderDelegate");n&&(t?n.render(this.get("renderDelegateProxy"),e):n.update(this.get("renderDelegateProxy"),e.$()))},applyAttributesToContext:function(e,t){var n=this.get("renderTheme"),r=n.classNames,i,s=r.length;for(i=0;i<s;i++)t.addClass(r[i]);e(t);var o=this.get("renderDelegate");o&&o.className&&t.addClass(o.className)}.enhance(),invokeRenderDelegateMethod:function(e,t){var n=this.get("renderDelegate");return n?SC.typeOf(n[e])!==SC.T_FUNCTION?undefined:(t=SC.$A(arguments),t.shift(),t.unshift(this.get("renderDelegateProxy")),n[e].apply(n,t)):undefined}}),SC.View._RenderDelegateProxy={isViewRenderDelegateProxy:YES,createForView:function(e){var t=SC.beget(this),n=e.get("displayProperties"),r={};for(var i=0,s=n.length;i<s;i++)r[n[i]]=YES;return r.theme=YES,t._displayPropertiesLookup=r,t.renderState={},t._view=e,t},get:function(e){if(this[e]!==undefined)return this[e];var t="display"+e.capitalize();return this._displayPropertiesLookup[t]?this._view.get(t):this._displayPropertiesLookup[e]?this._view.get(e):undefined},didChangeFor:function(e){var t=arguments.length,n;for(n=1;n<t;n++){var r=arguments[n],i="display"+r.capitalize();if(this._displayPropertiesLookup[i]){if(this._view.didChangeFor(e,i))return YES}else if(this._displayPropertiesLookup[r]&&this._view.didChangeFor(e,r))return YES}return NO}},SC.propertyFromRenderDelegate=function(e,t){return function(n,r){r!==undefined&&(this["_set_rd_"+n]=r);var i=this["_set_rd_"+n];if(i!==undefined)return i;var s=this.get("renderDelegate");if(s&&s.get){var o=this.get("renderDelegateProxy");i=s.getPropertyFor
(o,e)}return i!==undefined?i:t}.property("renderDelegate","controlSize").cacheable()},SC.View.reopen({acceptsMultitouch:NO,hasTouch:NO,touchBoundary:{left:50,right:50,top:50,bottom:50},_touchBoundaryFrame:function(){return this.get("parentView").convertFrameToView(this.get("frame"),null)}.property("frame","parentView").cacheable(),touchIsInBoundary:function(e){var t=this.get("_touchBoundaryFrame"),n=0,r=0,i=this.get("touchBoundary"),s=e.pageX,o=e.pageY;return s<t.x?(s=t.x-s,n=i.left):s>t.x+t.width?(s-=t.x+t.width,n=i.right):(s=0,n=1),o<t.y?(o=t.y-o,r=i.top):o>t.y+t.height?(o-=t.y+t.height,r=i.bottom):(o=0,r=1),s>100||o>100?NO:YES}}),SC.View.reopen({hasVisibility:YES,isVisibleInWindow:NO,recomputeIsVisibleInWindow:function(e){var t=this.get("isVisibleInWindow"),n=this.get("isVisible"),r;n&&(e===undefined&&(r=this.get("parentView"),e=r?r.get("isVisibleInWindow"):NO),n=n&&e);if(t!==n){this.set("isVisibleInWindow",n);var i=this.get("childViews"),s=i.length,o,u;for(o=0;o<s;o++)u=i[o],u&&u.recomputeIsVisibleInWindow&&u.recomputeIsVisibleInWindow(n);n?this.get("childViewsNeedLayout")&&this.invokeOnce(this.layoutChildViewsIfNeeded):this.get("isFirstResponder")&&this.resignFirstResponder()}return this.updateLayerIfNeeded(YES),this},_sc_isVisibleDidChange:function(){this.displayDidChange(),this.recomputeIsVisibleInWindow()}.observes("isVisible")}),SC.MIXED_STATE="__MIXED__",SC.Pane=SC.View.extend(SC.ResponderContext,{isPane:YES,page:null,rootResponder:null,sendEvent:function(e,t,n){var r;n||(n=this.get("firstResponder"));while(n){if(e==="touchStart"){if(t.touchResponder===n){n=null;break}
if(!n.get("hasTouch")||n.get("acceptsMultitouch"))if(n.tryToPerform("touchStart",t))break}else if(e==="touchEnd"&&!n.get("acceptsMultitouch")){if(!n.get("hasTouch")&&n.tryToPerform("touchEnd",t))break}else if(n.tryToPerform(e,t))break;n=n===this?null:n.get("nextResponder")}return!n&&(n=this.get("defaultResponder"))?(typeof n===SC.T_STRING&&(n=SC.objectForPropertyPath(n)),n?n=n.tryToPerform(e,t)?n:null:n=null):!n&&!(n=this.get("defaultResponder"))&&(n=this.tryToPerform(e,t)?this:null),t.mouseHandler||n},nextResponder:function(){return null}.property().cacheable(),firstResponder:null,acceptsKeyPane:YES,isKeyPane:NO,becomeKeyPane:function(){return this.get("isKeyPane")?this:(this.rootResponder&&this.rootResponder.makeKeyPane(this),this)},resignKeyPane:function(){return this.get("isKeyPane")?(this.rootResponder&&this.rootResponder.makeKeyPane(null),this):this},makeFirstResponder:function(e,t,n){t||(t=this);var r=this.get("firstResponder"),i=this.get("isKeyPane");return r===t?this:SC.platform.touch&&t&&t.kindOf(SC.TextFieldView)&&!t.get("focused")?this:(i&&(r&&r.tryToPerform("willLoseKeyResponderTo",t),t&&t.tryToPerform("willBecomeKeyResponderFrom",r)),r&&(r.beginPropertyChanges(),r.set("isKeyResponder",NO)),t&&(t.beginPropertyChanges(),t.set("isKeyResponder",i)),e(t,n),r&&r.endPropertyChanges(),t&&t.endPropertyChanges(),i&&(t&&t.tryToPerform("didBecomeKeyResponderFrom",r),r&&r.tryToPerform("didLoseKeyResponderTo",t)),this)}.enhance(),willLoseKeyPaneTo:function(e){return this._forwardKeyChange(this.get("isKeyPane"),"willLoseKeyResponderTo",e,NO),this},willBecomeKeyPaneFrom:function(
e){return this._forwardKeyChange(!this.get("isKeyPane"),"willBecomeKeyResponderFrom",e,YES),this},didBecomeKeyResponderFrom:function(e){},didLoseKeyPaneTo:function(e){var t=this.get("isKeyPane");return this.set("isKeyPane",NO),this._forwardKeyChange(t,"didLoseKeyResponderTo",e),this},didBecomeKeyPaneFrom:function(e){var t=this.get("isKeyPane");return this.set("isKeyPane",YES),this._forwardKeyChange(!t,"didBecomeKeyResponderFrom",e,YES),this},isMainPane:NO,focusFrom:function(e){},blurTo:function(e){},blurMainTo:function(e){this.set("isMainPane",NO)},focusMainFrom:function(e){this.set("isMainPane",YES)},append:function(){return this.appendTo(document.body)},remove:function(){if(!this.get("isVisibleInWindow"))return this;if(!this.get("isPaneAttached"))return this;var e=this.get("layer");e&&e.parentNode&&e.parentNode.removeChild(e),e=null,this._removeIntercept(),this.resignKeyPane();var t=this.rootResponder;return this.get("isMainPane")&&t.makeMainPane(null),t.panes.remove(this),this.rootResponder=null,this.set("isPaneAttached",NO),this.parentViewDidChange(),this},insert:function(e){var t=this.get("layer");return t||(t=this.createLayer().get("layer")),e(t),this.get("isPaneAttached")||this.paneDidAttach(),this},appendTo:function(e){return this.insert(function(t){jQuery(e).append(t)})},paneDidAttach:function(){var e=this.rootResponder=SC.RootResponder.responder;return e.panes.add(this),this.set("isPaneAttached",YES),this.recomputeDependentProperties(),this._notifyDidAppendToDocument(),this._invalidateStaticLayoutFrames(),this._addIntercept(),this},recomputeDependentProperties:function(
){},isPaneAttached:NO,wantsTouchIntercept:NO,hasTouchIntercept:function(){return this.get("wantsTouchIntercept")&&SC.platform.touch}.property("wantsTouchIntercept").cacheable(),zIndex:0,touchZ:99,_addIntercept:function(){if(this.get("hasTouchIntercept")){var e=document.createElement("div"),t=e.style;t.position="absolute",t.left="0px",t.top="0px",t.right="0px",t.bottom="0px",t.webkitTransform="translateZ(0px)",t.zIndex=this.get("zIndex")+this.get("touchZ"),e.className="touch-intercept",e.id="touch-intercept-"+SC.guidFor(this),this._touchIntercept=e,document.body.appendChild(e)}},_removeIntercept:function(){this._touchIntercept&&(document.body.removeChild(this._touchIntercept),this._touchIntercept=null)},hideTouchIntercept:function(){this._touchIntercept&&(this._touchIntercept.style.display="none")},showTouchIntercept:function(){this._touchIntercept&&(this._touchIntercept.style.display="block")},recomputeIsVisibleInWindow:function(){var e=this.get("isVisibleInWindow"),t=this.get("isVisible")&&this.get("isPaneAttached");if(e!==t){this.set("isVisibleInWindow",t);var n=this.get("childViews"),r=n.length,i,s;for(i=0;i<r;i++)s=n[i],s.recomputeIsVisibleInWindow&&s.recomputeIsVisibleInWindow(t);t?this.get("childViewsNeedLayout")&&this.invokeOnce(this.layoutChildViewsIfNeeded):this.get("isKeyPane")&&this.resignKeyPane()}return this.updateLayerIfNeeded(YES),this},updateLayerLocation:function(){return this.get("parentView")?arguments.callee.base.apply(this,arguments):this},replaceLayer:function(){var e=this.get("isPaneAttached");this.destroyLayer(),e&&this.invokeLast(this.append)},init:function(
){this.hasTouchIntercept===YES&&(SC.Logger.warn("Do not set hasTouchIntercept directly. Use wantsTouchIntercept instead."),this.hasTouchIntercept=SC.platform.touch);var e=!!this.get("layer");arguments.callee.base.apply(this,arguments),e&&this.paneDidAttach()},classNames:["sc-pane"]}),SC.Pane.reopen({performKeyEquivalent:function(e,t){var n=arguments.callee.base.apply(this,arguments);if(!n){var r=this.get("defaultResponder");r&&(r.performKeyEquivalent&&(n=r.performKeyEquivalent(e,t)),!n&&r.tryToPerform&&(n=r.tryToPerform(e,t)))}return n},keyDown:function(e){var t;if((e.which===9||SC.browser.mozilla&&e.keyCode===9)&&!this.get("firstResponder")){e.shiftKey?t=this.get("previousValidKeyView"):t=this.get("nextValidKeyView");if(t)return this.makeFirstResponder(t),YES;SC.TABBING_ONLY_INSIDE_DOCUMENT||e.allowDefault()}return NO},_forwardKeyChange:function(e,t,n,r){var i,s,o;e&&(s=this.get("firstResponder"))&&(o=n?n.get("firstResponder"):null,i=this.get("firstResponder"),i&&i[t]&&i[t](o),r!==undefined&&s&&s.set("isKeyResponder",r))}}),SC.Pane.reopen({currentWindowSize:null,computeParentDimensions:function(e){var t={x:0,y:0,width:1e3,height:1e3},n=this.get("layout");document&&document.body&&(t.width=document.body.clientWidth,t.height=document.body.clientHeight);if(n.minHeight||n.minWidth)n.minHeight&&(t.height=Math.max(t.height,n.minHeight)),n.minWidth&&(t.width=Math.max(t.width,n.minWidth));return t},frame:function(){return this.computeFrameWithParentFrame(null)}.property(),windowSizeDidChange:function(e,t){return this.set("currentWindowSize",t),this.setBodyOverflowIfNeeded(),this.parentViewDidResize
(),this},setBodyOverflowIfNeeded:function(e){var t=this.get("layout"),n=this.get("currentWindowSize");if(!t||!n||!n.width||!n.height)return;var r=t.minWidth,i=t.minHeight;if(e===!0||r||i)i&&n.height<i||r&&n.width<r?SC.bodyOverflowArbitrator.requestVisible(this):SC.bodyOverflowArbitrator.requestHidden(this)},paneLayoutDidChange:function(){this.invokeOnce(this.updateLayout),this.setBodyOverflowIfNeeded()}.observes("layout"),recomputeDependentProperties:function(e){this.set("currentWindowSize",this.rootResponder.computeWindowSize()),e()}.enhance()}),SC.Pane.reopen({prependTo:function(e){return this.insert(function(t){jQuery(e).prepend(t)})},removeFromParent:function(){throw SC.Error.desc("SC.Pane cannot be removed from its parent, since it's the root. Did you mean remove()?")}}),SC.Pane.reopen({recomputeDependentProperties:function(e){this.recomputeIsVisibleInWindow(),e()}.enhance()}),SC.Application=SC.Responder.extend(SC.ResponderContext,{}),SC.BENCHMARK_LOG_READY=YES,SC.mixin({isReady:NO,suppressOnReady:SC.suppressOnReady?YES:NO,suppressMain:SC.suppressMain?YES:NO,ready:function(e,t){var n=SC._readyQueue;return t===undefined?(t=e,e=null):SC.typeOf(t)===SC.T_STRING&&(t=e[t]),SC.isReady?jQuery(document).ready(function(){t.call(e)}):(n||(SC._readyQueue=[]),SC._readyQueue.push(function(){t.call(e)})),this},onReady:{done:function(){if(SC.isReady)return;var e=SC.Locale.currentLanguage.toLowerCase();SC.isReady=!0,SC.RunLoop.begin(),SC.Locale.createCurrentLocale(),jQuery("body").addClass(e),jQuery("html").attr("lang",e),jQuery("#loading").remove();var t=SC._readyQueue,n,r;if(t){for(n=0
,r=t.length;n<r;n++)t[n].call();SC._readyQueue=null}window.main&&!SC.suppressMain&&SC.mode===SC.APP_MODE&&window.main(),SC.RunLoop.end()}}}),SC.suppressOnReady||(jQuery.event.special.ready._default=SC.onReady.done),SC.APP_MODE="APP_MODE",SC.TEST_MODE="TEST_MODE",SC.mode=SC.APP_MODE,SC.platform=SC.Object.create({scrollbarSize:function(){var e=document.createElement("DIV"),t;e.innerHTML="<div style='height:1px;'></div>",e.style.cssText="position:absolute;width:100px;height:100px;overflow-y:visible;",t=e.childNodes[0],document.body.appendChild(e);var n=t.innerWidth||t.clientWidth;e.style.overflowY="scroll";var r=t.innerWidth||t.clientWidth;return document.body.removeChild(e),n-r}.property().cacheable(),touch:"createTouch"in document&&(SC.browser.iOS||SC.browser.android||SC.browser.silk),bounceOnScroll:SC.browser.iOS,pinchToZoom:SC.browser.iOS,input:function(e){var t={},n=e.length,r=document.createElement("input"),i,s;for(s=0;s<n;s++)i=e[s],t[i]=i in r;return t}(["autocomplete","readonly","list","size","required","multiple","maxlength","pattern","min","max","step","placeholder"]),standalone:!!navigator.standalone,dpi:BUILD_INFO.stylesDPIUsed,cssPrefix:null,domCSSPrefix:null,simulateTouchEvents:function(){if(this.touch)return;SC.Logger.log("Simulating touch events"),SC.platform.touch=YES,SC.platform.bounceOnScroll=YES,document.body.className=document.body.className+" touch",this._simtouch_counter=1,this.removeEvents(["click","dblclick","mouseout","mouseover","mousewheel"]),this.replaceEvent("mousemove",this._simtouch_mousemove),this.replaceEvent("mousedown",this._simtouch_mousedown
),this.replaceEvent("mouseup",this._simtouch_mouseup),SC.platform.windowSizeDeterminesOrientation=YES,SC.device.orientationHandlingShouldChange()},removeEvents:function(e){var t,n=e.length,r;for(t=0;t<n;t++)r=e[t],SC.Event.remove(document,r,SC.RootResponder.responder,SC.RootResponder.responder[r])},replaceEvent:function(e,t){SC.Event.remove(document,e,SC.RootResponder.responder,SC.RootResponder.responder[e]),SC.Event.add(document,e,this,t)},_simtouch_mousemove:function(e){if(!this._mousedown)return e.altKey&&this._pinchCenter===null?this._pinchCenter={pageX:e.pageX,pageY:e.pageY,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY}:!e.altKey&&this._pinchCenter!==null&&(this._pinchCenter=null),NO;var t=this.manufactureTouchEvent(e,"touchmove");return SC.RootResponder.responder.touchmove(t)},_simtouch_mousedown:function(e){this._mousedown=YES;var t=this.manufactureTouchEvent(e,"touchstart");return SC.RootResponder.responder.touchstart(t)},_simtouch_mouseup:function(e){var t=this.manufactureTouchEvent(e,"touchend"),n=SC.RootResponder.responder.touchend(t);return this._mousedown=NO,this._simtouch_counter++,n},manufactureTouchEvent:function(e,t){var n,r,i=this._simtouch_counter;n={type:t,target:e.target,identifier:i,pageX:e.pageX,pageY:e.pageY,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY},e.touches=[n];if(e.altKey&&this._pinchCenter!==null){var s=this._pinchCenter.pageX+this._pinchCenter.pageX-e.pageX,o=this._pinchCenter.pageY+this._pinchCenter.pageY-e.pageY,u=this._pinchCenter.screenX+this._pinchCenter.screenX-e.screenX,a=this._pinchCenter
.screenY+this._pinchCenter.screenY-e.screenY,f=this._pinchCenter.clientX+this._pinchCenter.clientX-e.clientX,l=this._pinchCenter.clientY+this._pinchCenter.clientY-e.clientY,c=this._simtouch_counter+1;r={type:t,target:e.target,identifier:c,pageX:s,pageY:o,screenX:u,screenY:a,clientX:f,clientY:l},e.touches=[n,r]}return e.changedTouches=e.touches,e},supportsCSSTransitions:NO,supportsCSSTransforms:NO,understandsCSS3DTransforms:NO,supportsCSS3DTransforms:NO,supportsAcceleratedLayers:NO,supportsHashChange:function(){return"onhashchange"in window&&(document.documentMode===undefined||document.documentMode>7)}(),supportsHistory:function(){return!!window.history&&!!window.history.pushState}(),supportsCanvas:function(){return!!document.createElement("canvas").getContext}(),supportsOrientationChange:"onorientationchange"in window,windowSizeDeterminesOrientation:SC.browser.iOS||!("onorientationchange"in window)}),function(){var e=navigator.userAgent.toLowerCase();/webkit/.test(e)?(SC.platform.cssPrefix="webkit",SC.platform.domCSSPrefix="Webkit"):/opera/.test(e)?(SC.platform.cssPrefix="opera",SC.platform.domCSSPrefix="O"):/msie/.test(e)&&!/opera/.test(e)?(SC.platform.cssPrefix="ms",SC.platform.domCSSPrefix="ms"):/mozilla/.test(e)&&!/(compatible|webkit)/.test(e)&&(SC.platform.cssPrefix="moz",SC.platform.domCSSPrefix="Moz")}(),function(){var e=document.createElement("div"),t=["-moz-","-moz-","-o-","-ms-","-webkit-"],n=["moz","Moz","o","ms","webkit"],r="",i=null,s,o;for(i=0,o=t.length;i<o;i++)s=t[i],r+=s+"transition:all 1s linear;",r+=s+"transform: translate(1px, 1px);",r+=s+"perspective: 500px;"
;e.style.cssText=r;var u;for(i=0,o=n.length;i<o;i++){u=n[i],e.style[u+"TransitionProperty"]!==undefined&&(SC.platform.supportsCSSTransitions=YES),e.style[u+"Transform"]!==undefined&&(SC.platform.supportsCSSTransforms=YES);if(e.style[u+"Perspective"]!==undefined||e.style[u+"PerspectiveProperty"]!==undefined)SC.platform.understandsCSS3DTransforms=YES,SC.platform.supportsCSS3DTransforms=YES}try{window.media&&window.media.matchMedium?window.media.matchMedium("(-webkit-transform-3d)")||(SC.platform.supportsCSS3DTransforms=NO):window.styleMedia&&window.styleMedia.matchMedium&&(window.styleMedia.matchMedium("(-webkit-transform-3d)")||(SC.platform.supportsCSS3DTransforms=NO))}catch(a){SC.platform.supportsCSS3DTransforms=NO}SC.platform.supportsCSSTransforms&&SC.platform.cssPrefix==="webkit"&&(SC.platform.supportsAcceleratedLayers=YES)}(),SC.CAPTURE_BACKSPACE_KEY=NO,SC.APP_HAS_NONSC_IFRAME=NO,SC.RootResponder=SC.Object.extend({panes:null,init:function(){arguments.callee.base.apply(this,arguments),this.panes=SC.Set.create(),SC.platform.supportsCSSTransitions&&(this[SC.platform.cssPrefix+"TransitionEnd"]=this.transitionEnd,this.transitionend=this.transitionEnd)},mainPane:null,makeMainPane:function(e){var t=this.get("mainPane");return t===e?this:(this.beginPropertyChanges(),this.get("keyPane")===t&&this.makeKeyPane(e),this.set("mainPane",e),t&&t.blurMainTo(e),e&&e.focusMainFrom(t),this.endPropertyChanges(),this)},menuPane:null,makeMenuPane:function(e){if(e&&!e.get("acceptsMenuPane"))return this;var t=this.get("menuPane");return t===e?this:(this.set("menuPane",e),this)},keyPane:null,previousKeyPanes
:[],makeKeyPane:function(e){var t,n,r;if(e){if(!e.get("acceptsKeyPane"))return this;n=this.get("keyPane");if(n===e)return this;n&&(r=this.get("previousKeyPanes"),r.push(n)),t=e}else{n=this.get("keyPane"),r=this.get("previousKeyPanes"),t=null;var i;while(r.length>0){i=r.pop();if(i.get("isPaneAttached")&&i.get("acceptsKeyPane")){t=i;break}}}if(!t){var s=this.get("mainPane");s&&s.get("acceptsKeyPane")&&(t=s)}return n&&n.willLoseKeyPaneTo(t),t&&t.willBecomeKeyPaneFrom(n),this.set("keyPane",t),t&&t.didBecomeKeyPaneFrom(n),n&&n.didLoseKeyPaneTo(t),this},currentWindowSize:null,computeWindowSize:function(){var e,t,n;return!this._bod||!this._docElement?(t=document.body,n=document.documentElement,this._bod=t,this._docElement=n):(t=this._bod,n=this._docElement),window.innerHeight?e={width:window.innerWidth,height:window.innerHeight}:n&&n.clientHeight?e={width:n.clientWidth,height:n.clientHeight}:t&&(e={width:t.clientWidth,height:t.clientHeight}),e},resize:function(){return this._resize(),YES},_resize:function(){var e=this.computeWindowSize(),t=this.get("currentWindowSize");this.set("currentWindowSize",e),SC.rectsEqual(e,t)||(SC.device.windowSizeDidChange(e),this.panes&&SC.run(function(){this.panes.invoke("windowSizeDidChange",t,e)},this))},hasFocus:NO,focus:function(e){return!this.get("hasFocus")&&document.hasFocus()&&SC.run(function(){SC.$("body").addClass("sc-focus").removeClass("sc-blur");if(!SC.TABBING_ONLY_INSIDE_DOCUMENT&&!SC.browser.isIE8OrLower&&!SC.APP_HAS_NONSC_IFRAME){var e=SC.RootResponder.responder.get("keyPane");if(e){var t=e.get("lastViewFirstResponder");if(t)e.makeFirstResponder
(t),e.set("lastViewFirstResponder",null);else{var n=e.get("nextValidKeyView");n&&e.makeFirstResponder(n)}}}this.set("hasFocus",YES)},this),YES},focusin:function(e){this._focusTimeout&&clearTimeout(this._focusTimeout),this.focus(e)},focusout:function(e){var t=this;this._focusTimeout=setTimeout(function(){t.blur(e)},300)},blur:function(e){if(this.get("hasFocus")&&!document.hasFocus()){SC.$("body").addClass("sc-blur").removeClass("sc-focus");var t=SC.RootResponder.responder.get("keyPane");if(t){var n=t.get("firstResponder");n&&!SC.browser.isIE8OrLower&&!SC.APP_HAS_NONSC_IFRAME&&n.resignFirstResponder(e)}SC.run(function(){this.set("hasFocus",NO)},this)}return YES},dragDidStart:function(e){this._mouseDownView=e,this._drag=e},defaultResponder:null,sendAction:function(e,t,n,r,i,s){return t=this.targetForAction(e,t,n,r,s),t&&t.isResponderContext?!!t.sendAction(e,n,i,s):t&&t.tryToPerform(e,n)},_responderFor:function(e,t,n){var r=e?e.get("defaultResponder"):null;if(e){e=n||e.get("firstResponder")||e;do if(e.respondsTo(t))return e;while(e=e.get("nextResponder"))}return typeof r===SC.T_STRING&&(r=SC.objectForPropertyPath(r)),r?r.isResponderContext?r:r.respondsTo(t)?r:null:null},targetForAction:function(e,t,n,r,i){if(!e||SC.typeOf(e)!==SC.T_STRING)return null;if(t)return SC.typeOf(t)===SC.T_STRING&&(t=SC.objectForPropertyPath(t)||SC.objectForPropertyPath(t,n)),t&&!t.isResponderContext&&(t.respondsTo&&!t.respondsTo(e)?t=null:SC.typeOf(t[e])!==SC.T_FUNCTION&&(t=null)),t;if(r){t=this._responderFor(r,e,i);if(t)return t}var s=this.get("keyPane"),o=this.get("mainPane");return s&&s!==r&&(t=this
._responderFor(s,e)),!t&&o&&o!==s&&(t=this._responderFor(o,e)),!t&&(t=this.get("defaultResponder"))&&(SC.typeOf(t)===SC.T_STRING&&(t=SC.objectForPropertyPath(t),t&&this.set("defaultResponder",t)),t&&!t.isResponderContext&&(t.respondsTo&&!t.respondsTo(e)?t=null:SC.typeOf(t[e])!==SC.T_FUNCTION&&(t=null))),t},targetViewForEvent:function(e){return e.target?SC.$(e.target).view()[0]:null},sendEvent:function(e,t,n){var r,i;return SC.run(function(){n?r=n.get("pane"):r=this.get("menuPane")||this.get("keyPane")||this.get("mainPane"),i=r?r.sendEvent(e,t,n):null},this),i},listenFor:function(e,t,n,r){return n=n?n:this,e.forEach(function(e){var i=n[e];i&&SC.Event.add(t,e,n,i,null,r)},this),t=null,n},setup:function(){this.listenFor(["touchstart","touchmove","touchend","touchcancel"],document),this.listenFor(["keydown","keyup","beforedeactivate","mousedown","mouseup","click","dblclick","mousemove","selectstart","contextmenu","scroll"],document).listenFor(["resize"],window),SC.browser.isIE8OrLower?this.listenFor(["focusin","focusout"],document):this.listenFor(["focus","blur"],window),this.listenFor(["webkitAnimationStart","webkitAnimationIteration","webkitAnimationEnd"],document),SC.platform.supportsCSSTransitions&&this.listenFor(["transitionend",SC.platform.cssPrefix+"TransitionEnd"],document);if(this.keypress)if(SC.CAPTURE_BACKSPACE_KEY&&SC.browser.mozilla){var e=this;document.onkeypress=function(t){return t=SC.Event.normalizeEvent(t),e.keypress.call(e,t)}}else SC.Event.add(document,"keypress",this,this.keypress);["drag","selectstart"].forEach(function(e){var t=this[e];if(t)if(SC.browser.msie
){var n=this;document.body["on"+e]=function(e){return t.call(n,SC.Event.normalizeEvent(event||window.event))},SC.Event.add(window,"unload",this,function(){document.body["on"+e]=null})}else SC.Event.add(document,e,this,t)},this);var t="mousewheel";if(SC.browser.mozilla)SC.browser.compareVersion(1,9,1)<0?t="DOMMouseScroll":t="MozMousePixelScroll";else if(parseInt(SC.browser.chrome)>=31||parseInt(SC.browser.msie)>=9||parseInt(SC.browser.safari)>=600)t="wheel";SC.Event.add(document,t,this,this.mousewheel),this.set("currentWindowSize",this.computeWindowSize());if(SC.browser.mobileSafari){SC.platform&&!SC.platform.touch&&SC.platform.simulateTouchEvents();var n=SC.RunLoop.prototype.endRunLoop,r;r=function(){n&&n.apply(this,arguments);var e=SC.RootResponder.responder._touches,t,r,i,s,o,u=NO;if(e)for(t in e){if(e[t]._rescuedElement)continue;i=r=e[t].target;while(r&&(r=r.parentNode)&&!u)u=r===document.body;if(!u&&i){if(i.parentNode&&i.cloneNode){var a=i.cloneNode(!0);i.parentNode.replaceChild(a,i),i.swapNode=a}var l=SC.touchHoldingPen;l||(l=SC.touchHoldingPen=document.createElement("div"),l.style.display="none",document.body.appendChild(l)),l.appendChild(i),e[t]._rescuedElement=i}}},SC.RunLoop.prototype.endRunLoop=r}},_touchedViews:{},_touches:{},touchesForView:function(e){if(this._touchedViews[SC.guidFor(e)])return this._touchedViews[SC.guidFor(e)].touches},averagedTouchesForView:function(e,t){var n=this.touchesForView(e),r=e._scrr_averagedTouches||(e._scrr_averagedTouches={});if((!n||n.length===0)&&!t)r.x=0,r.y=0,r.d=0,r.touchCount=0;else{var i=this._averagedTouches_touches||(this._averagedTouches_touches=
[]),s;i.length=0;if(n){var o;s=n.length;for(o=0;o<s;o++)i.push(n[o])}t&&i.push(t);var u,a,f=0,l=0,c,h,p=0;s=i.length;for(u=0;u<s;u++)a=i[u],f+=a.pageX,l+=a.pageY;f/=s,l/=s;for(u=0;u<s;u++)a=i[u],c=Math.abs(a.pageX-f),h=Math.abs(a.pageY-l),p+=Math.pow(c*c+h*h,.5);p/=s,r.x=f,r.y=l,r.d=p,r.touchCount=s}return r},assignTouch:function(e,t){if(e.hasEnded)throw"Attemt to assign a touch that is already finished.";if(e.view===t)return;e.view&&this.unassignTouch(e),this._touchedViews[SC.guidFor(t)]||(this._touchedViews[SC.guidFor(t)]={view:t,touches:SC.CoreSet.create([]),touchCount:0},t.set("hasTouch",YES)),e.view=t,this._touchedViews[SC.guidFor(t)].touches.add(e),this._touchedViews[SC.guidFor(t)].touchCount++},unassignTouch:function(e){var t,n;if(!e.view)return;t=e.view,n=this._touchedViews[SC.guidFor(t)],n.touches.remove(e),n.touchCount--,n.touchCount<1&&(t.set("hasTouch",NO),n.view=null,delete this._touchedViews[SC.guidFor(t)]),e.view=undefined},_flushQueuedTouchResponder:function(){if(this._queuedTouchResponder){var e=this._queuedTouchResponder;this._queuedTouchResponder=null,this.makeTouchResponder.apply(this,e)}},makeTouchResponder:function(e,t,n,r){if(this._isMakingTouchResponder){this._queuedTouchResponder=[e,t,n,r];return}this._isMakingTouchResponder=YES;var i=e.touchResponders,s;if(e.touchResponder===t){this._isMakingTouchResponder=NO,this._flushQueuedTouchResponder();return}var o;t?o=t.get("pane"):o=this.get("keyPane")||this.get("mainPane");if(i.indexOf(t)<0)if(r)try{t=o?o.sendEvent("touchStart",e,t):null}catch(u){SC.Logger.error("Error in touchStart: "+u),t=null}else t&&((
t.get?t.get("acceptsMultitouch"):t.acceptsMultitouch)||!t.hasTouch)&&(t.touchStart(e)||(t=null));if(!n||i.indexOf(t)>-1&&i[i.length-1]!==t){this.unassignTouch(e);var a=i.length-1,f=i[a];while(f&&f!==t)s=this.touchesForView(f),((f.get?f.get("acceptsMultitouch"):f.acceptsMultitouch)||!s)&&f.touchCancelled&&f.touchCancelled(e),a--,f=i[a],i.pop(),e.touchResponder=i[a],e.nextTouchResponder=i[a-1]}t&&(this.assignTouch(e,t),t!==e.touchResponder&&(i.push(t),e.touchResponder=t,e.nextTouchResponder=i[i.length-2])),this._isMakingTouchResponder=NO,this._flushQueuedTouchResponder()},captureTouch:function(e,t,n){t||(t=this);var r=e.targetView,i=r,s=[],o,u;SC.LOG_TOUCH_EVENTS&&SC.Logger.info("  -- Received one touch on %@".fmt(r.toString()));while(i&&i!==t)s.unshift(i),i=i.get("nextResponder");for(u=s.length,o=0;o<u;o++){i=s[o],SC.LOG_TOUCH_EVENTS&&SC.Logger.info("  -- Checking %@ for captureTouch response…".fmt(i.toString()));if(i.tryToPerform("captureTouch",e)){SC.LOG_TOUCH_EVENTS&&SC.Logger.info("   -- Making %@ touch responder because it returns YES to captureTouch".fmt(i.toString())),this.makeTouchResponder(e,i,n,YES);return}}SC.LOG_TOUCH_EVENTS&&SC.Logger.info("   -- Didn't find a view that returned YES to captureTouch, so we're calling touchStart"),this.makeTouchResponder(e,r,n,YES)},endMissingTouches:function(e){var t,n=e.length,r={},i=[];for(t=0;t<n;t++)r[e[t].identifier]=YES;for(t in this._touches){var s=this._touches[t].identifier;r[s]||i.push(this._touches[t])}for(t=0,n=i.length;t<n;t++)this.endTouch(i[t]),this.finishTouch(i[t])},_touchCount:0,endTouch:function(e,t,n){t||(t="touchEnd"
);var r,i,s,o;this.unassignTouch(e);if(e.touchResponder){o=e.touchResponder,i=e.touchResponders,r=i.length-1,s=i[r];while(s){s[t]&&s[t](e,n);if(e.touchResponder!==o)break;r--,s=i[r],t="touchCancelled"}}},finishTouch:function(e){var t;this.unassignTouch(e);if(t=e._rescuedElement)t.swapNode&&t.swapNode.parentNode?t.swapNode.parentNode.replaceChild(t,t.swapNode):t.parentNode===SC.touchHoldingPen&&SC.touchHoldingPen.removeChild(t),delete e._rescuedElement,t.swapNode=null,t=null;e.touchResponders=null,e.touchResponder=null,e.nextTouchResponder=null,e.hasEnded=YES,this._touches[e.identifier]&&delete this._touches[e.identifier]},touchstart:function(e){if(this.ignoreTouchHandle(e))return YES;var t=NO;return SC.run(function(){this.endMissingTouches(e.touches);var n,r=e.changedTouches,i=r.length,s,o,u,a;e.touchContext=this;for(n=0;n<i;n++){u=r[n],a=SC.Touch.create(u,this);if(!a.targetView)continue;a.hidesTouchIntercept&&(t=YES),a.timeStamp=e.timeStamp,this._touches[u.identifier]=a,a.event=e,this.captureTouch(a,this),a.event=null}},this),t?YES:e.hasCustomEventHandling},touchmove:function(e){return this.ignoreTouchHandle(e)?YES:(SC.run(function(){var t=e.changedTouches,n,r,i,s=t.length,o,u,a,f,l={},c,h,p=NO;this._drag&&(n=SC.Touch.create(e.changedTouches[0],this),this._drag.tryToPerform("mouseDragged",n));for(i=0;i<s;i++){n=t[i],r=this._touches[n.identifier];if(!r)continue;r.hidesTouchIntercept&&(p=YES),r.pageX=n.pageX,r.pageY=n.pageY,r.clientX=n.clientX,r.clientY=n.clientY,r.screenX=n.screenX,r.screenY=n.screenY,r.timeStamp=e.timeStamp,r.event=e,r.touchResponder&&(o=r.touchResponder,h=
SC.guidFor(o),l[h]||(l[h]={view:o,touches:[]}),l[h].touches.push(r))}if(p)return e.allowDefault(),YES;for(i in l)o=l[i].view,u=l[i].touches,e.viewChangedTouches=u,a=this.touchesForView(o),f=a.firstObject(),e.pageX=f.pageX,e.pageY=f.pageY,e.clientX=f.clientX,e.clientY=f.clientY,e.screenX=f.screenX,e.screenY=f.screenY,e.touchContext=this,o.tryToPerform("touchesDragged",e,a);t=e.changedTouches,s=t.length;for(i=0;i<s;i++)n=t[i],r=this._touches[n.identifier],r&&(r.event=null)},this),e.hasCustomEventHandling)},touchend:function(e){var t=NO;return this.ignoreTouchHandle(e)?YES:(SC.run(function(){var n=e.changedTouches,r,i,s,o=n.length,u,a,f=e.isCancel?"touchCancelled":"touchEnd",l,c,h,p;for(s=0;s<o;s++){r=n[s],r.type="touchend",i=this._touches[r.identifier];if(!i)continue;i.timeStamp=e.timeStamp,i.pageX=r.pageX,i.pageY=r.pageY,i.clientX=r.clientX,i.clientY=r.clientY,i.screenX=r.screenX,i.screenY=r.screenY,i.type="touchend",i.event=e,SC.LOG_TOUCH_EVENTS&&SC.Logger.info("-- Received touch end"),i.hidesTouchIntercept&&(i.unhideTouchIntercept(),t=YES),this._drag&&(this._drag.tryToPerform("mouseUp",r),this._drag=null),this.endTouch(i,f,e),this.finishTouch(i)}},this),t?YES:e.hasCustomEventHandling)},touchcancel:function(e){e.isCancel=YES,this.touchend(e)},ignoreTouchHandle:function(e){if(SC.browser.isMobileSafari||SC.browser.android||SC.browser.silk){var t=e.target.tagName;if(t==="INPUT"||t==="A")return e.allowDefault(),YES}return NO},attemptKeyEquivalent:function(e){var t=e.commandCodes()[0],n=null;if(!t)return n;var r=this.get("menuPane"),i=this.get("keyPane"),s=this.get("mainPane");if(
r){n=r.performKeyEquivalent(t,e);if(n)return n}if(i){n=i.performKeyEquivalent(t,e);if(n||i.get("isModal"))return n}if(!n&&s&&s!==i){n=s.performKeyEquivalent(t,e);if(n||s.get("isModal"))return n}return n},_lastModifiers:null,_handleModifierChanges:function(e){var t;t=this._lastModifiers=this._lastModifiers||{alt:!1,ctrl:!1,shift:!1};var n=!1;return e.altKey!==t.alt&&(t.alt=e.altKey,n=!0),e.ctrlKey!==t.ctrl&&(t.ctrl=e.ctrlKey,n=!0),e.shiftKey!==t.shift&&(t.shift=e.shiftKey,n=!0),e.modifiers=t,n?this.sendEvent("flagsChanged",e)?e.hasCustomEventHandling:YES:YES},_isModifierKey:function(e){return!!SC.MODIFIER_KEYS[e.charCode]},keydown:function(e){if(SC.none(e))return YES;var t=e.keyCode;this._lastKeyDownKeyCodeForKeyPress=t,SC.browser.mozilla&&e.keyCode===9&&(this.keydownCounter=1);if(t===229)return this._IMEInputON=YES,this.sendEvent("keyDown",e);if(t===27&&this._drag)return this._drag.cancelDrag(),this._drag=null,this._mouseDownView=null,YES;if(SC.browser.mozilla&&e.which===8)return!0;var n=this._handleModifierChanges(e),r=e.target||e.srcElement,i=e.which===8&&!SC.allowsBackspaceToPreviousPage&&r===document.body;if(this._isModifierKey(e))return i?NO:n;n=YES;if(SC.isFunctionOrNonPrintableKey(e)){if(t>=37&&t<=40&&SC.browser.mozilla)return YES;n=this.sendEvent("keyDown",e),n?(n=e.hasCustomEventHandling,n&&(i=NO)):n=SC.run(function(){return!this.attemptKeyEquivalent(e)},this)}return i?NO:n},keypress:function(e){var t,n=e.keyCode,r=!!SC.browser.mozilla;e.keyCode=e.which=this._lastKeyDownKeyCodeForKeyPress;if(SC.browser.mozilla&&e.keyCode===9){this.keydownCounter++;if(this.keydownCounter==2
)return YES}if(r&&e.which===8)return t=this.sendEvent("keyDown",e)||!this.attemptKeyEquivalent(e),t?SC.allowsBackspaceToPreviousPage||e.hasCustomEventHandling:YES;var i=n>=37&&n<=40&&r,s=e.charCode;if(s!==undefined&&s===0&&e.keyCode!==9&&!i)return YES;if(i||!SC.isFunctionOrNonPrintableKey(e))t=this.sendEvent("keyDown",e),t?t=e.hasCustomEventHandling:t=!this.attemptKeyEquivalent(e);return t},keyup:function(e){this._lastKeyDownKeyCodeForKeyPress=null,this._ffevt&&(this._ffevt=null);var t=this._handleModifierChanges(e);return this._isModifierKey(e)?t:(this._IMEInputON&&e.keyCode===13&&(e.isIMEInput=YES,this.sendEvent("keyDown",e),this._IMEInputON=NO),this.sendEvent("keyUp",e)?e.hasCustomEventHandling:YES)},beforedeactivate:function(e){var t=e.toElement;if(t&&t.tagName&&t.tagName!=="IFRAME"){var n=SC.$(t).view()[0];if(n&&n.get("blocksIEDeactivate"))return NO}return YES},mousedown:function(e){if(SC.platform.touch)return e.allowDefault(),this._lastMouseDownCustomHandling=YES,YES;if(e.target&&e.target.tagName==="HTML")return YES;this._clickCount+=1;if(!this._lastMouseUpAt||Date.now()-this._lastMouseUpAt>250)this._clickCount=1;else{var t=this._lastMouseDownX-e.clientX,n=this._lastMouseDownY-e.clientY,r=Math.sqrt(t*t+n*n);r>8&&(this._clickCount=1)}e.clickCount=this._clickCount,this._lastMouseDownX=e.clientX,this._lastMouseDownY=e.clientY;var i,s=this.targetViewForEvent(e);s&&(i=s.getPath("pane.firstResponder")),i&&i.get("blurOnMouseDown")&&i!==s&&i.resignFirstResponder(e),s=this._mouseDownView=this.sendEvent("mouseDown",e,s),s&&s.respondsTo("mouseDragged")&&(this._mouseCanDrag=YES);var o=
s?e.hasCustomEventHandling:YES;return this._lastMouseDownCustomHandling=o,o},mouseup:function(e){var t=NO;if(SC.platform.touch)return e.allowDefault(),this._lastMouseUpCustomHandling=YES,YES;this._drag&&(this._drag.tryToPerform("mouseUp",e),this._drag=null);var n=null,r=this._mouseDownView,i=this.targetViewForEvent(e);e.clickCount=this._clickCount,r&&(n=this.sendEvent("mouseUp",e,r),!n&&this._clickCount===2&&(n=this.sendEvent("doubleClick",e,r),t=YES),n||(n=this.sendEvent("click",e,r),t=YES)),!n&&!t&&(this._clickCount===2&&(n=this.sendEvent("doubleClick",e,i)),n||(n=this.sendEvent("click",e,i))),this._mouseCanDrag=NO,this._mouseDownView=null,this._lastMouseUpAt=Date.now();var s=n?e.hasCustomEventHandling:YES;return this._lastMouseUpCustomHandling=s,s},click:function(e){return!this._lastMouseUpCustomHandling||!this._lastMouseDownCustomHandling?(e.preventDefault(),e.stopPropagation(),NO):YES},dblclick:function(e){SC.browser.isIE8OrLower&&(this._clickCount=2,this._mouseDownView=this.targetViewForEvent(e),this.mouseup(e))},mousewheel:function(e){var t=this.targetViewForEvent(e),n=this.sendEvent("mouseWheel",e,t);return n?e.hasCustomEventHandling:YES},_lastHovered:null,mousemove:function(e){if(SC.platform.touch)return e.allowDefault(),YES;if(SC.browser.msie&&this._lastMoveX===e.clientX&&this._lastMoveY===e.clientY)return;this._lastMoveX=e.clientX,this._lastMoveY=e.clientY,SC.run(function(){if(this._drag)SC.browser.msie?(this._lastMouseDownX!==e.clientX||this._lastMouseDownY!==e.clientY)&&this._drag.tryToPerform("mouseDragged",e):this._drag.tryToPerform("mouseDragged",e);else{var t=
this._lastHovered||[],n=[],r,i,s,o=this.targetViewForEvent(e);while(o&&o!==this)n.push(o),o=o.get("nextResponder");for(i=0,s=t.length;i<s;i++)o=t[i],r=o.respondsTo("mouseExited"),r&&n.indexOf(o)===-1&&o.tryToPerform("mouseExited",e);for(i=0,s=n.length;i<s;i++)o=n[i],t.indexOf(o)!==-1?o.tryToPerform("mouseMoved",e):o.tryToPerform("mouseEntered",e);this._lastHovered=n,this._mouseDownView&&(SC.browser.msie?this._lastMouseDownX!==e.clientX&&this._lastMouseDownY!==e.clientY&&this._mouseDownView.tryToPerform("mouseDragged",e):this._mouseDownView.tryToPerform("mouseDragged",e))}},this)},_mouseCanDrag:YES,selectstart:function(e){var t=this.targetViewForEvent(e),n=this.sendEvent("selectStart",e,t);return t&&t.respondsTo("mouseDragged")?(n!==null?YES:NO)&&!this._mouseCanDrag:n!==null?YES:NO},drag:function(){return!1},contextmenu:function(e){var t=this.targetViewForEvent(e);return this.sendEvent("contextMenu",e,t)?NO:YES},scroll:function(e){var t=this.targetViewForEvent(e);return this.sendEvent("scroll",e,t)?NO:YES},webkitAnimationStart:function(e){var t;try{t=this.targetViewForEvent(e),this.sendEvent("animationDidStart",e,t)}catch(n){throw SC.Logger.warn("Exception during animationDidStart: %@".fmt(n)),n}return t?e.hasCustomEventHandling:YES},webkitAnimationIteration:function(e){var t;try{t=this.targetViewForEvent(e),this.sendEvent("animationDidIterate",e,t)}catch(n){throw SC.Logger.warn("Exception during animationDidIterate: %@".fmt(n)),n}return t?e.hasCustomEventHandling:YES},webkitAnimationEnd:function(e){var t;try{t=this.targetViewForEvent(e),this.sendEvent("animationDidEnd",e,t)}
catch(n){throw SC.Logger.warn("Exception during animationDidEnd: %@".fmt(n)),n}return t?e.hasCustomEventHandling:YES},transitionEnd:function(e){var t;try{t=this.targetViewForEvent(e),this.sendEvent("transitionDidEnd",e,t)}catch(n){throw SC.Logger.warn("Exception during transitionDidEnd: %@".fmt(n)),n}return t?e.hasCustomEventHandling:YES}}),SC.Touch=function(e,t){this.touchContext=t,this.identifier=e.identifier;var n=e.target,r;n&&SC.$(n).hasClass("touch-intercept")?(e.target.style.webkitTransform="translate3d(0px,-5000px,0px)",n=document.elementFromPoint(e.pageX,e.pageY),n&&(r=SC.$(n).view()[0]),this.hidesTouchIntercept=NO,n.tagName==="INPUT"?this.hidesTouchIntercept=e.target:e.target.style.webkitTransform="translate3d(0px,0px,0px)"):r=e.target?SC.$(e.target).view()[0]:null,this.targetView=r,this.target=n,this.hasEnded=NO,this.type=e.type,this.clickCount=1,this.view=undefined,this.touchResponder=this.nextTouchResponder=undefined,this.touchResponders=[],this.startX=this.pageX=e.pageX,this.startY=this.pageY=e.pageY,this.clientX=e.clientX,this.clientY=e.clientY,this.screenX=e.screenX,this.screenY=e.screenY},SC.Touch.prototype={unhideTouchIntercept:function(){var e=this.hidesTouchIntercept;e&&setTimeout(function(){e.style.webkitTransform="translate3d(0px,0px,0px)"},500)},allowDefault:function(){this.event&&(this.event.hasCustomEventHandling=YES)},preventDefault:function(){this.event&&this.event.preventDefault()},stopPropagation:function(){this.event&&this.event.stopPropagation()},stop:function(){this.event&&this.event.stop()},end:function(){this.touchContext.endTouch(this)},makeTouchResponder
:function(e,t,n){this.touchContext.makeTouchResponder(this,e,t,n)},captureTouch:function(e,t){this.touchContext.captureTouch(this,e,t)},touchesForView:function(e){return this.touchContext.touchesForView(e)},touchesForResponder:function(e){return this.touchContext.touchesForView(e)},averagedTouchesForView:function(e,t){return this.touchContext.averagedTouchesForView(e,t?this:null)}},SC.mixin(SC.Touch,{create:function(e,t){return new SC.Touch(e,t)}}),SC.ready(SC.RootResponder,SC.RootResponder.ready=function(){var e;e=SC.RootResponder.responder=SC.RootResponder.create(),e.setup()}),SC.PORTRAIT_ORIENTATION="portrait",SC.LANDSCAPE_ORIENTATION="landscape",SC.NO_ORIENTATION="desktop",SC.device=SC.Object.create({orientation:SC.NO_ORIENTATION,isOffline:NO,mouseLocation:function(){var e=SC.RootResponder.responder,t=e._lastMoveX,n=e._lastMoveY;return SC.empty(t)||SC.empty(n)?null:{x:t,y:n}}.property(),init:function(){arguments.callee.base.apply(this,arguments),navigator&&navigator.onLine===!1&&this.set("isOffline",YES)},setup:function(){var e=SC.RootResponder.responder;e.listenFor(["online","offline"],window,this),this.orientationHandlingShouldChange()},orientationHandlingShouldChange:function(){SC.platform.windowSizeDeterminesOrientation?(SC.Event.remove(window,"orientationchange",this,this.orientationchange),this.windowSizeDidChange(SC.RootResponder.responder.get("currentWindowSize"))):SC.platform.supportsOrientationChange&&(SC.Event.add(window,"orientationchange",this,this.orientationchange),this.orientationchange())},windowSizeDidChange:function(e){return SC.platform.windowSizeDeterminesOrientation?
(SC.browser.iOS?SC.run(function(){e.width===window.screen.width?SC.device.set("orientation",SC.PORTRAIT_ORIENTATION):SC.device.set("orientation",SC.LANDSCAPE_ORIENTATION)}):SC.run(function(){SC.platform.touch?e.height>=e.width?SC.device.set("orientation",SC.PORTRAIT_ORIENTATION):SC.device.set("orientation",SC.LANDSCAPE_ORIENTATION):SC.device.set("orientation",SC.NO_ORIENTATION)}),YES):NO},orientationchange:function(e){SC.run(function(){window.orientation===0||window.orientation===180?SC.device.set("orientation",SC.PORTRAIT_ORIENTATION):SC.device.set("orientation",SC.LANDSCAPE_ORIENTATION)})},orientationObserver:function(){var e=SC.$(document.body),t=this.get("orientation");t===SC.PORTRAIT_ORIENTATION?e.addClass("portrait"):e.removeClass("portrait"),t===SC.LANDSCAPE_ORIENTATION?e.addClass("landscape"):e.removeClass("landscape")}.observes("orientation"),online:function(e){this.set("isOffline",NO)},offline:function(e){this.set("isOffline",YES)}}),SC.ready(function(){SC.device.setup()}),SC.Page=SC.Object.extend({owner:null,get:function(e){var t=this[e];return t&&t.isClass?(this[e]=t=t.create({page:this}),t.awake(),t):arguments.callee.base.apply(this,arguments)},awake:function(){var e,t;for(t in this){if(!this.hasOwnProperty(t))continue;e=this[t],e&&e.isViewClass&&(this[t]=e=e.create({page:this}))}return this},getIfConfigured:function(e){var t=this[e];return t&&t.isViewClass?null:this.get(e)}}),SC.Page.design=SC.Page.create,SC.Page.localization=function(e){return e},SC.MODE_REPLACE="replace",SC.MODE_APPEND="append",SC.MODE_PREPEND="prepend",SC.NON_PIXEL_PROPERTIES=["zIndex","fontWeight"
,"opacity"],SC.COMBO_STYLES={WebkitTransition:["WebkitTransitionProperty","WebkitTransitionDuration","WebkitTransitionDelay","WebkitTransitionTimingFunction"]},SC.RenderContext=SC.Builder.create({SELF_CLOSING:SC.CoreSet.create().addEach(["area","base","basefront","br","hr","input","img","link","meta"]),init:function(e,t){var n,r;t&&(this.prevObject=t,this.strings=t.strings,this.offset=t.length+t.offset),this.strings||(this.strings=[]),e===undefined?(e="div",r=YES):e==="div"||e==="label"||e==="a"?r=YES:SC.typeOf(e)===SC.T_STRING&&(e=e.toLowerCase(),r=YES);if(r){this._tagName=e,this._needsTag=YES,this.needsContent=YES;var i=this;while(i)i.length++,i=i.prevObject;this.strings.push(null),this._selfClosing=this.SELF_CLOSING.contains(e)}else this._elem=e,this._needsTag=NO,this.length=0,this.needsContent=NO;return this},strings:null,offset:0,length:0,updateMode:SC.MODE_REPLACE,needsContent:NO,get:function(e){var t=this.strings||[];return e===undefined?t.slice(this.offset,this.length):t[e+this.offset]},push:function(e){var t=this.strings,n=arguments.length;t||(this.strings=t=[]),n>1?t.push.apply(t,arguments):t.push(e);var r=this;while(r)r.length+=n,r=r.prevObject;return this.needsContent=YES,this},text:function(e){var t=arguments.length,n=0;for(n=0;n<t;n++)this.push(SC.RenderContext.escapeHTML(arguments[n]));return this},join:function(e){this._needsTag&&this.end();var t=this.strings;return t?t.join(e||""):""},begin:function(e){return SC.RenderContext(e,this)},element:function(){return this._elem?this._elem:SC.$(this.join())[0]},remove:function(e){if(!e)return;var t,n=this._elem;if(!
n||!n.removeChild)return;t=document.getElementById(e),t&&(t=n.removeChild(t),t=null)},update:function(){var e=this._elem,t=this.updateMode,n,r,i,s,o;this._innerHTMLReplaced=NO;if(!e)return;n=this.$();if(this.length>0){this._innerHTMLReplaced=YES;if(t===SC.MODE_REPLACE)n.html(this.join());else{i=e.cloneNode(!1),i.innerHTML=this.join(),s=i.firstChild;while(s)o=s.nextSibling,e.insertBefore(s,o),s=o;s=o=i=null}}return this._idDidChange&&(r=this._id)&&n.attr("id",r),jQuery.Buffer.flush(),e=this._elem=null,this.prevObject||this},_DEFAULT_ATTRS:{},end:function(){var e="",t="",n,r,i,s,o=this._attrs,u=this._classNames,a=this._id,f=this._styles,l,c,h;e="<"+this._tagName;if(o||u||f||a){o||(o=this._DEFAULT_ATTRS),a&&(o.id=a),u&&(o["class"]=u.join(" "));if(f){for(i in f){if(!f.hasOwnProperty(i))continue;s=f[i];if(s===null)continue;typeof s===SC.T_NUMBER&&!SC.NON_PIXEL_PROPERTIES.contains(i)&&(s+="px"),t=t+this._dasherizeStyleName(i)+": "+s+"; "}o.style=t}e+=" ";for(i in o){if(!o.hasOwnProperty(i))continue;s=o[i];if(s===null)continue;h=SC.RenderContext.escapeHTML(s+"").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),e=e+i+'="'+h+'" '}o===this._DEFAULT_ATTRS&&(delete o.style,delete o["class"],delete o.id)}l=this.strings,c=this._selfClosing===NO?NO:this.length===1,e+=c?" />":">",l[this.offset]=e;if(!c){l.push("</"+this._tagName+">");var p=this;while(p)p.length++,p=p.prevObject}return this._elem=null,this.prevObject||this},tag:function(e,t){return this.begin(e,t).end()},tagName:function(e){return e===undefined?(!this._tagName&&this._elem&&(this._tagName=this._elem.tagName),this._tagName):(this.
_tagName=e,this._tagNameDidChange=YES,this)},id:function(e){return e===undefined?(!this._id&&this._elem&&(this._id=this._elem.id),this._id):(this._id=e,this._idDidChange=YES,this)},classNames:function(e,t){return this._elem?e?(this.$().resetClassNames().addClass(e),this):this.$().attr("class").split(" "):e===undefined?(this._cloneClassNames&&(this._classNames=(this._classNames||[]).slice(),this._cloneClassNames=NO),this._classNames||(this._classNames=[]),this._classNames):(this._classNames=e,this._cloneClassNames=t||NO,this._classNamesDidChange=YES,this)},hasClass:function(e){return this._elem?this.$().hasClass(e):this.classNames().indexOf(e)>=0},addClass:function(e){if(e===undefined||e===null)return SC.Logger.warn("You are adding an undefined or empty class"+this.toString()),this;if(this._elem){if(SC.typeOf(e)===SC.T_STRING)this.$().addClass(e);else{var t,n=e.length;for(t=0;t<n;t++)this.$().addClass(e[t])}return this}var r=this.classNames();if(SC.typeOf(e)===SC.T_STRING)r.indexOf(e)<0&&(r.push(e),this._classNamesDidChange=YES);else{var i;for(var s=0,o=e.length;s<o;s++)i=e[s],r.indexOf(i)<0&&(r.push(i),this._classNamesDidChange=YES)}return this},removeClass:function(e){if(this._elem)return this.$().removeClass(e),this;var t=this._classNames,n;return t&&(n=t.indexOf(e))>=0&&(this._cloneClassNames&&(t=this._classNames=t.slice(),this._cloneClassNames=NO),t[n]=null,this._classNamesDidChange=YES),this},resetClassNames:function(){return this._elem?(this.$().resetClassNames(),this):(this._classNames=[],this._classNamesDidChange=YES,this)},setClass:function(e,t){if(this._elem)return this
.$().setClass(e,t),this;var n,r,i,s;if(t!==undefined)return t?this.addClass(e):this.removeClass(e);n=this._classNames,n||(n=this._classNames=[]),this._cloneClassNames&&(n=this._classNames=n.slice(),this._cloneClassNames=NO),s=NO;for(i in e){if(!e.hasOwnProperty(i))continue;r=n.indexOf(i),e[i]?r<0&&(n.push(i),s=YES):r>=0&&(n[r]=null,s=YES)}return s&&(this._classNamesDidChange=YES),this},_STYLE_REGEX:/-?\s*([^:\s]+)\s*:\s*([^;]+)\s*;?/g,styles:function(e,t){if(this._elem)return e&&this.$().resetStyles().css(e),this.$().styles();var n,r,i;if(e===undefined){if(!this._styles&&this._elem){n=this.$().attr("style");if(n&&(n=n.toString()).length>0){SC.browser.msie&&(n=n.toLowerCase()),e={},r=this._STYLE_REGEX,r.lastIndex=0;while(i=r.exec(n))e[this._camelizeStyleName(i[1])]=i[2];this._styles=e,this._cloneStyles=NO}else this._styles={}}else this._styles?this._cloneStyles&&(this._styles=SC.clone(this._styles),this._cloneStyles=NO):this._styles={};return this._styles}return this._styles=e,this._cloneStyles=t||NO,this._stylesDidChange=YES,this},_deleteComboStyles:function(e,t){var n=SC.COMBO_STYLES[t],r=NO,i;if(n)for(var s=0,o=n.length;s<o;s++)i=n[s],e[i]&&(delete e[i],r=YES);return r},resetStyles:function(){return this.styles({}),this},addStyle:function(e,t){if(this._elem)return this.$().css(e,t),this;var n,r=NO,i=this.styles();if(typeof e===SC.T_STRING){if(t===undefined)return i[e];r=this._deleteComboStyles(i,e),i[e]!==t&&(i[e]=t,r=YES),r&&(this._stylesDidChange=YES)}else{for(n in e){if(!e.hasOwnProperty(n))continue;r=r||this._deleteComboStyles(i,n),t=e[n],i[n]!==t&&(i[n]=t,r=YES)}r&&(this
._stylesDidChange=YES)}return this},removeStyle:function(e){if(this._elem)return this.$().css(e,null),this;if(!this._styles)return this;var t=this.styles();t[e]&&(t[e]=null,this._stylesDidChange=YES)},attr:function(e,t){if(this._elem)return this.$().attr(e,t),this;var n,r=this._attrs,i=NO;r||(this._attrs=r={});if(typeof e===SC.T_STRING){if(t===undefined)return r[e];r[e]!==t&&(r[e]=t,this._attrsDidChange=YES)}else{for(n in e){if(!e.hasOwnProperty(n))continue;t=e[n],r[n]!==t&&(r[n]=t,i=YES)}i&&(this._attrsDidChange=YES)}return this},removeAttr:function(e){if(this._elem)return this.$().removeAttr(e),this},$:function(e){var t,n=this._elem;return t=n?e===undefined?SC.$.buffer(n):SC.$.buffer(e,n):SC.$.buffer([]),n=null,t},_camelizeStyleName:function(e){var t=e.match(/^-(webkit|moz|o)-/),n=SC.String.camelize(e);return t?n.substr(0,1).toUpperCase()+n.substr(1):n},_dasherizeStyleName:function(e){var t=SC.String.dasherize(e);return t.match(/^(webkit|moz|ms|o)-/)&&(t="-"+t),t}}),SC.RenderContext.fn.html=SC.RenderContext.fn.push,SC.RenderContext.fn.css=SC.RenderContext.fn.addStyle,function(){var e=/[&<>]/g,t=function(e){switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;"}};SC.RenderContext.escapeHTML=function(n){return n?n.replace(e,t):""}}(),SC.SelectionSet=SC.Object.extend(SC.Enumerable,SC.Freezable,SC.Copyable,{isSelectionSet:YES,length:function(){var e=0,t=this._sets,n=this._objects;return n&&(e+=n.get("length")),t&&t.forEach(function(t){e+=t.get("length")}),e}.property().cacheable(),sources:function(){var e=[],t=this._sets,n=t?t.length:0,r,i,s;for(r=0;r<n;r++)
i=t[r],i&&i.get("length")>0&&i.source&&e.push(i.source);return e}.property().cacheable(),indexSetForSource:function(e){if(!e||!e.isSCArray)return null;var t=this._indexSetCache,n=this._objects,r,i;return t||(t=this._indexSetCache={}),r=t[SC.guidFor(e)],r&&r._sourceRevision&&r._sourceRevision!==e.propertyRevision&&(r=null),r||(r=this._indexSetForSource(e,NO),r&&r.get("length")===0&&(r=null),n&&(r&&(r=r.copy()),n.forEach(function(t){(i=e.indexOf(t))>=0&&(r||(r=SC.IndexSet.create()),r.add(i))},this)),r&&(r=t[SC.guidFor(e)]=r.frozenCopy(),r._sourceRevision=e.propertyRevision)),r},_indexSetForSource:function(e,t){t===undefined&&(t=YES);var n=SC.guidFor(e),r=this[n],i=this._sets,s=i?i.length:0,o=null;return r>=s&&(r=null),SC.none(r)?t&&!this.isFrozen&&(this.propertyWillChange("sources"),i||(i=this._sets=[]),o=i[s]=SC.IndexSet.create(),o.source=e,this[n]=s,this.propertyDidChange("sources")):o=i?i[r]:null,o},add:function(e,t,n){if(this.isFrozen)throw SC.FROZEN_ERROR;var r,i,s,o,u,a,f,l;if(t===undefined&&n===undefined){if(!e)throw"Must pass params to SC.SelectionSet.add()";if(e.isIndexSet)return this.add(e.source,e);if(e.isSelectionSet){r=e._sets,l=e._objects,i=r?r.length:0,this.beginPropertyChanges();for(s=0;s<i;s++)o=r[s],o&&o.get("length")>0&&this.add(o.source,o);return l&&this.addObjects(l),this.endPropertyChanges(),this}}return o=this._indexSetForSource(e,YES),u=this.get("length"),f=o.get("length"),a=u-f,o.add(t,n),this._indexSetCache=null,a+=o.get("length"),a!==u&&(this.propertyDidChange("length"),this.enumerableContentDidChange(),f===0&&this.notifyPropertyChange("sources")),this
},remove:function(e,t,n){if(this.isFrozen)throw SC.FROZEN_ERROR;var r,i,s,o,u,a,f,l;if(t===undefined&&n===undefined){if(!e)throw"Must pass params to SC.SelectionSet.remove()";if(e.isIndexSet)return this.remove(e.source,e);if(e.isSelectionSet){r=e._sets,l=e._objects,i=r?r.length:0,this.beginPropertyChanges();for(s=0;s<i;s++)o=r[s],o&&o.get("length")>0&&this.remove(o.source,o);return l&&this.removeObjects(l),this.endPropertyChanges(),this}}return o=this._indexSetForSource(e,YES),u=this.get("length"),a=u-o.get("length"),o&&(l=this._objects)&&(n!==undefined&&(t=SC.IndexSet.create(t,n),n=undefined),l.forEach(function(n){s=e.indexOf(n),t.contains(s)&&(l.remove(n),a--)},this)),o.remove(t,n),f=o.get("length"),a+=f,this._indexSetCache=null,a!==u&&(this.propertyDidChange("length"),this.enumerableContentDidChange(),f===0&&this.notifyPropertyChange("sources")),this},contains:function(e,t,n){if(t===undefined&&n===undefined)return this.containsObject(e);var r=this.indexSetForSource(e);return r?r.contains(t,n):NO},intersects:function(e,t,n){var r=this.indexSetForSource(e,NO);return r?r.intersects(t,n):NO},_TMP_ARY:[],addObject:function(e){var t=this._TMP_ARY,n;return t[0]=e,n=this.addObjects(t),t.length=0,n},addObjects:function(e){var t=this._objects,n,r;return t||(t=this._objects=SC.CoreSet.create()),n=t.get("length"),t.addEach(e),r=t.get("length"),this._indexSetCache=null,r!==n&&(this.propertyDidChange("length"),this.enumerableContentDidChange()),this},removeObject:function(e){var t=this._TMP_ARY,n;return t[0]=e,n=this.removeObjects(t),t.length=0,n},removeObjects:function(e){var t=this._objects
,n,r,i;return t?(n=t.get("length"),t.removeEach(e),r=t.get("length"),(i=this._sets)&&i.forEach(function(t){n+=t.get("length"),t.removeObjects(e),r+=t.get("length")},this),this._indexSetCache=null,r!==n&&(this.propertyDidChange("length"),this.enumerableContentDidChange()),this):this},containsObject:function(e){var t=this._objects;if(t&&t.contains(e))return YES;var n=this._sets,r=n?n.length:0,i,s;for(i=0;i<r;i++){s=n[i];if(s&&s.indexOf(e)>=0)return YES}return NO},constrain:function(e){var t,n,r,i;this.beginPropertyChanges(),this.get("sources").forEach(function(t){if(t===e)return;var n=this._indexSetForSource(e,NO);n&&this.remove(e,n)},this),t=this._indexSetForSource(e,NO),t&&(r=t.get("max"))>(n=e.get("length"))&&this.remove(e,n,r-n);if(i=this._objects){var s,o;for(s=i.length-1;s>=0;s--)o=i[s],e.indexOf(o)<0&&this.removeObject(o)}return this.endPropertyChanges(),this},isEqual:function(e){var t,n,r,i,s,o;if(!e||!e.isSelectionSet)return NO;if(e===this)return YES;if(this._sets===e._sets&&this._objects===e._objects)return YES;if(this.get("length")!==e.get("length"))return NO;t=this._objects,n=e._objects;if(t||n){if((t?t.get("length"):0)!==(n?n.get("length"):0))return NO;if(t&&!t.isEqual(n))return NO}s=this.get("sources"),i=s.get("length");for(r=0;r<i;r++){o=s.objectAt(r),t=this._indexSetForSource(o,NO),n=this._indexSetForSource(o,NO);if(!!n!=!!t)return NO;if(t&&!t.isEqual(n))return NO}return YES},clear:function(){if(this.isFrozen)throw SC.FROZEN_ERROR;return this._sets&&(this._sets.length=0),this._objects&&(this._objects=null),this._indexSetCache=null,this.propertyDidChange("length"
),this.enumerableContentDidChange(),this.notifyPropertyChange("sources"),this},copy:function(){var e=this.constructor.create(),t=this._sets,n=t?t.length:0,r,i;if(t&&n>0){t=e._sets=t.slice();for(r=0;r<n;r++){if(!(i=t[r]))continue;i=t[r]=i.copy(),e[SC.guidFor(i.source)]=r}}return this._objects&&(e._objects=this._objects.copy()),e},freeze:function(){if(this.get("isFrozen"))return this;var e=this._sets,t=e?e.length:0,n;while(--t>=0)n=e[t],n&&n.freeze();return this._objects&&this._objects.freeze(),this.set("isFrozen",YES),this},toString:function(){var e=this._sets||[];return e=e.map(function(e){return e.toString().replace("SC.IndexSet",SC.guidFor(e.source))},this),this._objects&&e.push(this._objects.toString()),"SC.SelectionSet:%@<%@>".fmt(SC.guidFor(this),e.join(","))},firstObject:function(){var e=this._sets,t=this._objects;if(e&&e.get("length")>0){var n=e?e[0]:null,r=n?n.source:null,i=n?n.firstObject():-1;if(r&&i>=0)return r.objectAt(i)}return t?t.firstObject():undefined}.property(),nextObject:function(e,t,n){var r,i;return e===0&&(r=n.objects=[],this.forEach(function(e){r.push(e)},this),n.max=r.length),r=n.objects,i=r[e],e+1>=n.max&&(n.objects=n.max=null),i},forEach:function(e,t){var n=this._sets,r=this._objects,i=n?n.length:0,s,o;for(o=0;o<i;o++)s=n[o],s&&s.forEachObject(e,t);return r&&r.forEach(e,t),this}}),SC.SelectionSet.prototype.clone=SC.SelectionSet.prototype.copy,SC.SelectionSet.EMPTY=SC.SelectionSet.create().freeze(),SC.Timer=SC.Object.extend({target:null,action:null,isPooled:NO,interval:0,startTime:null,repeats:NO,until:null,isPaused:NO,isScheduled:NO,isValid:YES,lastFireTime
:0,fireTime:function(){if(!this.get("isValid"))return-1;var e=this.get("startTime");if(!e||e===0)return-1;var t=this.get("interval"),n=this.get("lastFireTime");n<e&&(n=e);var r;this.get("repeats")?t===0?r=n:r=e+(Math.floor((n-e)/t)+1)*t:r=e+t;var i=this.get("until");return i&&i>0&&r>i&&(r=i),r}.property("interval","startTime","repeats","until","isValid","lastFireTime").cacheable(),schedule:function(){if(!this.get("isValid"))return this;this.beginPropertyChanges(),this.startTime||this.set("startTime",SC.RunLoop.currentRunLoop.get("startTime"));var e=this.get("fireTime"),t=this.get("lastFireTime");return e>=t&&(this.set("isScheduled",YES),SC.RunLoop.currentRunLoop.scheduleTimer(this,e)),this.endPropertyChanges(),this},invalidate:function(){this.beginPropertyChanges(),this.set("isValid",NO);var e=SC.RunLoop.currentRunLoop;return e&&e.cancelTimer(this),this.action=this.target=null,this.endPropertyChanges(),this.get("isPooled")&&SC.Timer.returnTimerToPool(this),this},fire:function(){var e=Date.now();this.set("lastFireTime",e);var t=this.get("fireTime");this.get("isPaused")||this.performAction(),t>e?this.schedule():this.invalidate()},performAction:function(){var e=SC.typeOf(this.action);if(e==SC.T_FUNCTION)this.action.call(this.target||this,this);else if(e===SC.T_STRING)if(this.action.indexOf(".")>=0){var t=this.action.split("."),n=t.pop(),r=SC.objectForPropertyPath(t,window),i=r.get?r.get(n):r[n];if(!i||SC.typeOf(i)!=SC.T_FUNCTION)throw"%@: Timer could not find a function at %@".fmt(this,this.action);i.call(r,this)}else SC.RootResponder.responder.sendAction(this.action,this.target
,this)},init:function(){arguments.callee.base.apply(this,arguments),this.startTime instanceof Date&&(this.startTime=this.startTime.getTime()),this.until instanceof Date&&(this.until=this.until.getTime())},RESET_DEFAULTS:{target:null,action:null,isPooled:NO,isPaused:NO,isScheduled:NO,isValid:YES,interval:0,repeats:NO,until:null,startTime:null,lastFireTime:0},reset:function(e){e||(e=SC.EMPTY_HASH),this.propertyWillChange("fireTime");var t=this.RESET_DEFAULTS;for(var n in t){if(!t.hasOwnProperty(n))continue;this[n]=SC.none(e[n])?t[n]:e[n]}return this.propertyDidChange("fireTime"),this},removeFromTimerQueue:function(e){var t=this._timerQueuePrevious,n=this._timerQueueNext;return!t&&!n&&e!==this?e:(t&&(t._timerQueueNext=n),n&&(n._timerQueuePrevious=t),this._timerQueuePrevious=this._timerQueueNext=null,e===this?n:e)},scheduleInTimerQueue:function(e,t){this._timerQueueRunTime=t;var n=e,r=null;while(n&&n._timerQueueRunTime<t)r=n,n=n._timerQueueNext;return r&&(r._timerQueueNext=this,this._timerQueuePrevious=r),n&&(n._timerQueuePrevious=this,this._timerQueueNext=n),n===e?this:e},collectExpiredTimers:function(e,t){if(this._timerQueueRunTime>t)return this;e.push(this);var n=this._timerQueueNext;return this._timerQueueNext=null,n&&(n._timerQueuePrevious=null),n?n.collectExpiredTimers(e,t):null}}),SC.Timer.schedule=function(e){var t;return!e||SC.none(e.isPooled)||e.isPooled?t=this.timerFromPool(e):t=this.create(e),t.schedule()},SC.Timer.timerFromPool=function(e){var t=this._timerPool;t||(t=this._timerPool=[]);var n=t.pop();return n||(n=this.create()),n.reset(e)},SC.Timer.returnTimerToPool=
function(e){return this._timerPool||(this._timerPool=[]),this._timerPool.push(e),this},SC.mixin({normalizeURL:function(e){return e.slice(0,1)=="/"?e=window.location.protocol+"//"+window.location.host+e:e.slice(0,5)!="http:"&&e.slice(0,6)!="https:"&&(e=window.location.href+"/"+e),e},isPercentage:function(e){return e<1&&e>0},minX:function(e){return e.x||0},maxX:function(e){return(e.x||0)+(e.width||0)},midX:function(e){return(e.x||0)+(e.width||0)/2},minY:function(e){return e.y||0},maxY:function(e){return(e.y||0)+(e.height||0)},midY:function(e){return(e.y||0)+(e.height||0)/2},centerX:function(e,t){return(t.width-e.width)/2},centerY:function(e,t){return(t.height-e.height)/2},offset:function(e,t){var n,r,i,s;t=t||"document";if(t==="parent")s=jQuery(e).position();else{s=jQuery(e).offset();if(SC.browser.mobileSafari){n=navigator.userAgent,r=n.indexOf("Mobile/"),i=n.substring(r+7,r+9);if(parseInt(SC.browser.mobileSafari,0)<=532||i<="8A")s.left-=window.pageXOffset,s.top-=window.pageYOffset}if(t==="viewport")if(SC.browser.isIE8OrLower){var o=$(window);s.left-=o.scrollLeft(),s.top-=o.scrollTop()}else s.left-=window.pageXOffset,s.top-=window.pageYOffset}try{s.x=s.left,s.y=s.top}catch(u){s={x:s.left,y:s.top}}return delete s.left,delete s.top,s},viewportOffset:function(e){console.warn("SC.viewportOffset() has been deprecated in favor of SC.offset().  Please use SC.offset() from here on.");var t=SC.offset(e,"viewport");return{x:t.left,y:t.top}},isFunctionOrNonPrintableKey:function(e){return!!(e.altKey||e.ctrlKey||e.metaKey||e.charCode!==e.which&&SC.FUNCTION_KEYS[e.which])}}),SC.mixin({ZERO_POINT
:{x:0,y:0},pointInRect:function(e,t){return e.x>=SC.minX(t)&&e.y>=SC.minY(t)&&e.x<=SC.maxX(t)&&e.y<=SC.maxY(t)},rectsEqual:function(e,t,n){return!e||!t?e==t:(!n&&n!==0&&(n=.1),e.y!=t.y&&Math.abs(e.y-t.y)>n?NO:e.x!=t.x&&Math.abs(e.x-t.x)>n?NO:e.width!=t.width&&Math.abs(e.width-t.width)>n?NO:e.height!=t.height&&Math.abs(e.height-t.height)>n?NO:YES)},intersectRects:function(e,t){var n={x:Math.max(SC.minX(e),SC.minX(t)),y:Math.max(SC.minY(e),SC.minY(t)),width:Math.min(SC.maxX(e),SC.maxX(t)),height:Math.min(SC.maxY(e),SC.maxY(t))};return n.width=Math.max(0,n.width-n.x),n.height=Math.max(0,n.height-n.y),n},unionRects:function(e,t){var n={x:Math.min(SC.minX(e),SC.minX(t)),y:Math.min(SC.minY(e),SC.minY(t)),width:Math.max(SC.maxX(e),SC.maxX(t)),height:Math.max(SC.maxY(e),SC.maxY(t))};return n.width=Math.max(0,n.width-n.x),n.height=Math.max(0,n.height-n.y),n},cloneRect:function(e){return{x:e.x,y:e.y,width:e.width,height:e.height}},stringFromRect:function(e){return e?"{x:"+e.x+", y:"+e.y+", width:"+e.width+", height:"+e.height+"}":"(null)"}}),SC.MainPane=SC.Pane.extend({layout:{top:0,left:0,bottom:0,right:0,minHeight:200,minWidth:200},init:function(){var e={x:0,y:0,width:1e3,height:1e3},t=this.get("layout"),n=!1;if(document&&document.body){e.width=document.body.clientWidth,e.height=document.body.clientHeight;if(t.minHeight||t.minWidth)t.minHeight&&e.height<t.minHeight||t.minWidth&&e.width<t.minWidth?SC.bodyOverflowArbitrator.requestVisible(this):SC.bodyOverflowArbitrator.requestHidden(this)}arguments.callee.base.apply(this,arguments)},paneDidAttach:function(){var e=arguments.callee.base
.apply(this,arguments),t=this.rootResponder;return t.makeMainPane(this),t.get("keyRootView")||t.makeKeyPane(this),e},acceptsKeyPane:YES,classNames:["sc-main"]}),SC.SCANNER_OUT_OF_BOUNDS_ERROR=new Error("Out of bounds."),SC.SCANNER_INT_ERROR=new Error("Not an int."),SC.SCANNER_SKIP_ERROR=new Error("Did not find the string to skip."),SC.SCANNER_SCAN_ARRAY_ERROR=new Error("Did not find any string of the given array to scan."),SC.DATETIME_COMPAREDATE_TIMEZONE_ERROR=new Error("Can't compare the dates of two DateTimes that don't have the same timezone."),SC.DATETIME_ISO8601="%Y-%m-%dT%H:%M:%S%Z",SC.Scanner=SC.Object.extend({string:null,scanLocation:0,scan:function(e){if(this.scanLocation+e>this.length)throw SC.SCANNER_OUT_OF_BOUNDS_ERROR;var t=this.string.substr(this.scanLocation,e);return this.scanLocation+=e,t},scanInt:function(e,t){t===undefined&&(t=e);var n=this.scan(t),r=new RegExp("^\\d{"+e+","+t+"}"),i=n.match(r);if(!i)throw SC.SCANNER_INT_ERROR;return i[0].length<t&&(this.scanLocation+=i[0].length-t),parseInt(i[0],10)},skipString:function(e){if(this.scan(e.length)!==e)throw SC.SCANNER_SKIP_ERROR;return YES},scanArray:function(e){for(var t=0,n=e.length;t<n;t++){if(this.scan(e[t].length)===e[t])return t;this.scanLocation-=e[t].length}throw SC.SCANNER_SCAN_ARRAY_ERROR}}),SC.DateTime=SC.Object.extend(SC.Freezable,SC.Copyable,{_ms:0,timezone:0,isFrozen:YES,adjust:function(e,t){var n;return e=e?SC.clone(e):{},n=e.timezone!==undefined?e.timezone:this.timezone!==undefined?this.timezone:0,this.constructor._adjust(e,this._ms,n,t)._createFromCurrentState()},advance:function(e){return this
.constructor._advance(e,this._ms,this.timezone)._createFromCurrentState()},unknownProperty:function(e){return this.constructor._get(e,this._ms,this.timezone)},toFormattedString:function(e){return this.constructor._toFormattedString(e,this._ms,this.timezone)},toISO8601:function(){return this.constructor._toFormattedString(SC.DATETIME_ISO8601,this._ms,this.timezone)},toString:function(){return"UTC: "+(new Date(this._ms)).toUTCString()+", timezone: "+this.timezone},isEqual:function(e){return SC.DateTime.compare(this,e)===0},copy:function(){return this},toTimezone:function(e){return e===undefined&&(e=0),this.advance({timezone:e-this.timezone})}}),SC.DateTime.mixin(SC.Comparable,{recordFormat:SC.DATETIME_ISO8601,dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],_englishDayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],AMPMNames:["AM","PM"],_date:new Date,_tz:0,timezone:(new Date).getTimezoneOffset(),_dt_cache:{},_dt_cache_index:-1,_DT_CACHE_MAX_LENGTH:1e3,_setCalcState:function(e,t){var n={milliseconds:this._date.getTime(),timezone:this._tz};return e!==undefined&&this._date.setTime(e),t!==undefined&&(this._tz=t),n},_setCalcStateFromHash:function(e,t){var n=t!==undefined?t:this._tz,r=this._toMilliseconds(e,this._ms,n);return this._setCalcState
(r,n)},_get:function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v=this._date,m,g=null;m=this._setCalcState(t,n),e==="milliseconds"?g=v.getTime():e==="timezone"&&(g=this._tz);if(g===null){c=e.slice(0,4),h=e.slice(4);if(c==="last"||c==="next"){p=this._get("dayOfWeek",t,n),d=this._englishDayNames.indexOf(h);if(d>=0){var y=d-p;c==="last"&&y>=0&&(y-=7),c==="next"&&y<0&&(y+=7),this._advance({day:y},t,n),g=this._createFromCurrentState()}}}if(g===null){n!==undefined&&this._setCalcState(v.getTime()-n*6e4,0);switch(e){case"year":g=v.getUTCFullYear();break;case"month":g=v.getUTCMonth()+1;break;case"day":g=v.getUTCDate();break;case"dayOfWeek":g=v.getUTCDay();break;case"hour":g=v.getUTCHours();break;case"minute":g=v.getUTCMinutes();break;case"second":g=v.getUTCSeconds();break;case"millisecond":g=v.getUTCMilliseconds()}g===null&&e==="isLeapYear"&&(u=this._get("year"),g=u%4===0&&u%100!==0||u%400===0);if(g===null&&e==="daysInMonth")switch(this._get("month")){case 4:case 6:case 9:case 11:g=30;break;case 2:g=this._get("isLeapYear")?29:28;break;default:g=31}if(g===null&&e==="dayOfYear"){r=v.getTime(),s=this._get("day"),this._setCalcStateFromHash({day:1});for(o=this._get("month")-1;o>0;o--)this._setCalcStateFromHash({month:o}),s+=this._get("daysInMonth");v.setTime(r),g=s}g===null&&e.slice(0,4)==="week"&&(a=e.length===4?1:parseInt(e.slice("4"),10),f=this._get("dayOfWeek"),l=this._get("dayOfYear")-1,a===0?g=parseInt((l-f+7)/7,10):g=parseInt((l-(f-1+7)%7+7)/7,10))}return this._setCalcState(m.milliseconds,m.timezone),g},_adjust:function(e,t,n,r){var i=e?SC.clone(e):{},s=this._toMilliseconds(e,t,n,r);return this
._setCalcState(s,n),this},_advance:function(e,t,n){var r=e?SC.clone(e):{},i;for(var s in r)r[s]+=this._get(s,t,n);return i=r.timezone!==undefined?r.timezone:n,this._adjust(r,t,i,NO)},_toMilliseconds:function(e,t,n,r){var i=e?SC.clone(e):{},s=this._date,o=s.getTime(),u,a;SC.none(t)||s.setTime(t),a=n!==undefined?n:this.timezone!==undefined?this.timezone:0,s.setTime(s.getTime()-a*6e4);if(r===undefined||r===YES)!SC.none(i.hour)&&SC.none(i.minute)&&(i.minute=0),(!SC.none(i.hour)||!SC.none(i.minute))&&SC.none(i.second)&&(i.second=0),!(SC.none(i.hour)&&SC.none(i.minute)&&SC.none(i.second))&&SC.none(i.millisecond)&&(i.millisecond=0);return SC.none(i.year)&&(i.year=s.getUTCFullYear()),SC.none(i.month)&&(i.month=s.getUTCMonth()+1),SC.none(i.day)&&(i.day=s.getUTCDate()),SC.none(i.hour)&&(i.hour=s.getUTCHours()),SC.none(i.minute)&&(i.minute=s.getUTCMinutes()),SC.none(i.second)&&(i.second=s.getUTCSeconds()),SC.none(i.millisecond)&&(i.millisecond=s.getUTCMilliseconds()),u=Date.UTC(i.year,i.month-1,i.day,i.hour,i.minute,i.second,i.millisecond),s.setTime(u+a*6e4),u=s.getTime(),s.setTime(o),u},create:function(){var e=arguments.length===0?{}:arguments[0],t;SC.typeOf(e)===SC.T_NUMBER&&(e={milliseconds:e}),t=e.timezone!==undefined?e.timezone:this.timezone,t===undefined&&(t=0);if(!SC.none(e.milliseconds)){var n="nu"+e.milliseconds+t,r=this._dt_cache,i=r[n];if(!i){var s,o=this._dt_cache_index,u=this;i=r[n]=new u([{_ms:e.milliseconds,timezone:t}]),o=this._dt_cache_index=(o+1)%this._DT_CACHE_MAX_LENGTH,s=r[o],s!==undefined&&r[s]&&delete r[s],r[o]=n}return i}var a=new Date;return this.create({milliseconds
:this._toMilliseconds(e,a.getTime(),t,e.resetCascadingly),timezone:t})},_createFromCurrentState:function(){return this.create({milliseconds:this._date.getTime(),timezone:this._tz})},parse:function(e,t){var n=new RegExp("(?:%([aAbBcdDhHiIjmMpsSUWwxXyYZ%])|(.))","g"),r,i,s={},o={},u=SC.Scanner.create({string:e});SC.none(t)&&(t=SC.DATETIME_ISO8601);try{while((i=n.exec(t))!==null)switch(i[1]){case"a":o.dayOfWeek=u.scanArray(this.abbreviatedDayNames);break;case"A":o.dayOfWeek=u.scanArray(this.dayNames);break;case"b":s.month=u.scanArray(this.abbreviatedMonthNames)+1;break;case"B":s.month=u.scanArray(this.monthNames)+1;break;case"c":throw"%c is not implemented";case"d":case"D":s.day=u.scanInt(1,2);break;case"h":case"H":s.hour=u.scanInt(1,2);break;case"i":case"I":s.hour=u.scanInt(1,2);break;case"j":throw"%j is not implemented";case"m":s.month=u.scanInt(1,2);break;case"M":s.minute=u.scanInt(1,2);break;case"p":s.meridian=u.scanArray(this.AMPMNames);break;case"S":s.second=u.scanInt(1,2);break;case"s":s.millisecond=u.scanInt(1,3);break;case"U":throw"%U is not implemented";case"W":throw"%W is not implemented";case"w":throw"%w is not implemented";case"x":throw"%x is not implemented";case"X":throw"%X is not implemented";case"y":s.year=u.scanInt(2),s.year+=s.year>70?1900:2e3;break;case"Y":s.year=u.scanInt(4);break;case"Z":var a=u.scan(1);if(a==="Z")s.timezone=0;else if(a==="+"||a==="-"){var f=u.scanInt(2);u.scan(1)!==":"&&u.scan(-1);var l=u.scanInt(2);s.timezone=(a==="+"?-1:1)*(f*60+l)}break;case"%":u.skipString("%");break;default:u.skipString(i[0])}}catch(c){return SC.Logger.log("SC.DateTime.createFromString "+
c.toString()),null}if(!SC.none(s.meridian)&&!SC.none(s.hour)){if(s.meridian===1&&s.hour!==12||s.meridian===0&&s.hour===12)s.hour=(s.hour+12)%24;delete s.meridian}return r=SC.DateTime.create(s),!SC.none(o.dayOfWeek)&&r.get("dayOfWeek")!==o.dayOfWeek?null:r},_pad:function(e,t){var n=""+e;t===undefined&&(t=2);while(n.length<t)n="0"+n;return n},__toFormattedString:function(e,t,n){var r,i;switch(e[1]){case"a":return this.abbreviatedDayNames[this._get("dayOfWeek")];case"A":return this.dayNames[this._get("dayOfWeek")];case"b":return this.abbreviatedMonthNames[this._get("month")-1];case"B":return this.monthNames[this._get("month")-1];case"c":return this._date.toString();case"d":return this._pad(this._get("day"));case"D":return this._get("day");case"h":return this._get("hour");case"H":return this._pad(this._get("hour"));case"i":return r=this._get("hour"),r===12||r===0?12:(r+12)%12;case"I":return r=this._get("hour"),this._pad(r===12||r===0?12:(r+12)%12);case"j":return this._pad(this._get("dayOfYear"),3);case"m":return this._pad(this._get("month"));case"M":return this._pad(this._get("minute"));case"p":return this._get("hour")>11?this.AMPMNames[1]:this.AMPMNames[0];case"S":return this._pad(this._get("second"));case"s":return this._pad(this._get("millisecond"),3);case"u":return this._pad(this._get("utc"));case"U":return this._pad(this._get("week0"));case"W":return this._pad(this._get("week1"));case"w":return this._get("dayOfWeek");case"x":return this._date.toDateString();case"X":return this._date.toTimeString();case"y":return this._pad(this._get("year")%100);case"Y":return this._get("year"
);case"Z":return i=-1*n,(i>=0?"+":"-")+this._pad(parseInt(Math.abs(i)/60,10))+":"+this._pad(Math.abs(i)%60);case"%":return"%"}},_toFormattedString:function(e,t,n){var r=this,i=n!==undefined?n:this.timezone!==undefined?this.timezone:0;return this._setCalcState(t-n*6e4,0),e.replace(/\%([aAbBcdDhHiIjmMpsSUWwxXyYZ\%])/g,function(){var e=r.__toFormattedString.call(r,arguments,t,n);return e})},compare:function(e,t){var n=e.get("milliseconds"),r=t.get("milliseconds");return n<r?-1:n===r?0:1},compareDate:function(e,t){if(e.get("timezone")!==t.get("timezone"))throw SC.DATETIME_COMPAREDATE_TIMEZONE_ERROR;var n=e.adjust({hour:0}).get("milliseconds"),r=t.adjust({hour:0}).get("milliseconds");return n<r?-1:n===r?0:1}}),SC.Binding.dateTime=function(e){return this.transform(function(t,n){return t?t.toFormattedString(e):null})},SC.stringsFor("English",{"_SC.DateTime.dayNames":"Sunday Monday Tuesday Wednesday Thursday Friday Saturday","_SC.DateTime.abbreviatedDayNames":"Sun Mon Tue Wed Thu Fri Sat","_SC.DateTime.monthNames":"January February March April May June July August September October November December","_SC.DateTime.abbreviatedMonthNames":"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec","_SC.DateTime.AMPMNames":"AM PM"}),SC.DateTime.mixin({_setup:function(){SC.DateTime.dayNames=SC.String.w(SC.String.loc("_SC.DateTime.dayNames")),SC.DateTime.abbreviatedDayNames=SC.String.w(SC.String.loc("_SC.DateTime.abbreviatedDayNames")),SC.DateTime.monthNames=SC.String.w(SC.String.loc("_SC.DateTime.monthNames")),SC.DateTime.abbreviatedMonthNames=SC.String.w(SC.String.loc("_SC.DateTime.abbreviatedMonthNames"
)),SC.DateTime.AMPMNames=SC.String.w(SC.String.loc("_SC.DateTime.AMPMNames"))}}),jQuery(document).ready(function(){SC.DateTime._setup()}),SC.Response=SC.Object.extend({isResponse:YES,isError:NO,errorValue:function(){return this}.property().cacheable(),errorObject:null,request:null,originalRequest:function(){var e=this.get("request");while(e.get("source"))e=e.get("source");return e}.property("request").cacheable(),type:function(){return this.getPath("request.type")}.property("request").cacheable(),address:function(){return this.getPath("request.address")}.property("request").cacheable(),isJSON:function(){return this.getPath("request.isJSON")||NO}.property("request").cacheable(),isXML:function(){return this.getPath("request.isXML")||NO}.property("request").cacheable(),listeners:function(){return this.getPath("request.listeners")}.property("request").cacheable(),status:-100,headers:null,body:function(){var e=this.get("encodedBody");if(e&&this.get("isJSON"))try{e=SC.json.decode(e)}catch(t){return SC.error("Failed to parse response: %@",e),SC.Error.create({message:t.name+": "+t.message,label:"Response",errorValue:this})}return e}.property("encodedBody").cacheable(),response:function(){return this.get("body")}.property("body").cacheable(),isCancelled:NO,timedOut:null,timeoutTimer:null,fire:function(){var e=this.get("request"),t=e?e.get("source"):null;t&&t.willSend&&t.willSend(e,this),e.freeze(),this.get("isCancelled")||this.invokeTransport();var n=e.get("timeout");if(n){var r=SC.Timer.schedule({target:this,action:"timeoutReached",interval:n,repeats:NO});this.set("timeoutTimer",r)}!
this.get("isCancelled")&&t&&t.didSend&&t.didSend(e,this)},invokeTransport:function(){this.receive(function(e){this.set("status",200)},this)},receive:function(e,t){if(!this.get("timedOut")){var n=this.get("timeoutTimer");n&&n.invalidate(),this.set("timedOut",NO)}var r=this.get("request"),i=r?r.get("source"):null;return SC.run(function(){i&&i.willReceive&&i.willReceive(r,this),e.call(t,!this.get("isCancelled")),!this.get("isCancelled")&&i&&i.didReceive&&i.didReceive(r,this),this.get("isCancelled")||this.notify()},this),SC.Request.manager.transportDidClose(this),this},cancel:function(){this.get("isCancelled")||(this.set("isCancelled",YES),this.cancelTransport(),SC.Request.manager.transportDidClose(this))},timeoutReached:function(){return this.get("timedOut")===null?(this.set("timedOut",YES),this.cancelTransport(),this.receive(function(e){if(!e)return;var t=SC.$error("HTTP Request timed out","Request",0);t.set("errorValue",this),this.set("isError",YES),this.set("errorObject",t),this.set("status",0)},this),YES):NO},cancelTransport:function(){},_notifyListeners:function(e,t){var n=e[t],r,i,s;if(!n)return NO;var o=NO,u=n.length;for(var a=0;a<u;a++){var f=n[a];r=(f.params||[]).copy(),r.unshift(this),i=f.target,s=f.action,SC.typeOf(s)===SC.T_STRING&&(s=i[s]),o=s.apply(i,r)}return o},notify:function(){var e=this.get("listeners"),t=this.get("status"),n=Math.floor(t/100)*100,r=NO;return e?(r=this._notifyListeners(e,t),!r&&n!==t&&(r=this._notifyListeners(e,n)),!r&&t!==0&&(r=this._notifyListeners(e,0)),this):this},toString:function(){var e=arguments.callee.base.apply(this,arguments);return"%@<%@ %@, status=%@"
.fmt(e,this.get("type"),this.get("address"),this.get("status"))}}),SC.XHRResponse=SC.Response.extend({headers:function(){var e=this.get("rawRequest"),t=e?e.getAllResponseHeaders():null,n={};return t?(t.split("\n").forEach(function(e){var t=e.indexOf(":"),r,i;t>=0&&(r=e.slice(0,t),i=e.slice(t+1).trim(),n[r]=i)},this),n):n}.property("status").cacheable(),header:function(e){var t=this.get("rawRequest");return t?t.getResponseHeader(e):null},encodedBody:function(){var e=this.get("rawRequest");return e?this.get("isXML")?e.responseXML:e.responseText:null}.property("status").cacheable(),cancelTransport:function(){var e=this.get("rawRequest");e&&e.abort(),this.set("rawRequest",null)},invokeTransport:function(){var e,t,n,r,i;e=this.createRequest(),this.set("rawRequest",e),r=!!this.getPath("request.isAsynchronous"),r&&(!SC.browser.msie&&!SC.browser.opera?SC.Event.add(e,"readystatechange",this,this.finishRequest,e):(t=this,n=function(){if(!t)return null;var e=t.finishRequest();return e&&(t=null),e},e.onreadystatechange=n)),e.open(this.get("type"),this.get("address"),r),i=this.getPath("request.headers");for(var s in i)e.setRequestHeader(s,i[s]);return e.send(this.getPath("request.encodedBody")),r||this.finishRequest(),e},createRequest:function(){function e(){for(var e=0;e<arguments.length;e++)try{var t=arguments[e]();return t}catch(n){}return NO}return e(function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})},finishRequest:function(e){var t=this.get("rawRequest"),n=t.readyState,r,i,s;return n===4&&!
this.get("timedOut")?(this.receive(function(e){if(!e)return;i=-1;try{i=t.status||0}catch(n){}if(i<200||i>=300){try{s=t.statusText||""}catch(o){s=""}r=SC.$error(s||"HTTP Request failed","Request",i),r.set("errorValue",this),this.set("isError",YES),this.set("errorObject",r)}this.set("status",i)},this),!SC.browser.msie&&!SC.browser.opera?SC.Event.remove(t,"readystatechange",this,this.finishRequest):t.onreadystatechange=null,YES):NO}}),SC.Request=SC.Object.extend(SC.Copyable,SC.Freezable,{isAsynchronous:YES,isJSON:NO,isXML:NO,attachIdentifyingHeaders:YES,headers:function(){var e=this._headers;return e||(e=this._headers={}),e}.property().cacheable(),responseClass:SC.XHRResponse,source:null,address:null,type:"GET",timeout:null,body:null,encodedBody:function(){var e=this.get("body");return e&&this.get("isJSON")&&(e=SC.json.encode(e)),e}.property("isJSON","isXML","body").cacheable(),willSend:function(e,t){},didSend:function(e,t){},willReceive:function(e,t){},didReceive:function(e,t){},concatenatedProperties:"COPY_KEYS",COPY_KEYS:["attachIdentifyingHeaders","isAsynchronous","isJSON","isXML","address","type","timeout","body","responseClass","willSend","didSend","willReceive","didReceive"],copy:function(){var e={},t=this.COPY_KEYS,n=t.length,r,i,s;while(--n>=0)r=t[n],this.hasOwnProperty(r)&&(e[r]=this.get(r));return this.hasOwnProperty("listeners")&&(e.listeners=SC.copy(this.get("listeners"))),this.hasOwnProperty("_headers")&&(e._headers=SC.copy(this._headers)),e.source=this.get("source")||this,this.constructor.create(e)},header:function(e,t){var n;if(SC.typeOf(e)===SC.T_STRING)return n=
this._headers,arguments.length===1?n?n[e]:null:(this.propertyWillChange("headers"),n||(n=this._headers={}),n[e]=t,this.propertyDidChange("headers"),this);if(t===undefined){n=e,this.beginPropertyChanges();for(e in n){if(!n.hasOwnProperty(e))continue;this.header(e,n[e])}return this.endPropertyChanges(),this}return this},clearHeaders:function(){this.propertyWillChange("headers"),this._headers={},this.propertyDidChange("headers")},async:function(e){return e===undefined&&(e=YES),this.set("isAsynchronous",e)},timeoutAfter:function(e){return this.set("timeout",e)},json:function(e){return e===undefined&&(e=YES),e&&this.set("isXML",NO),this.set("isJSON",e)},xml:function(e){return e===undefined&&(e=YES),e&&this.set("isJSON",NO),this.set("isXML",e)},_prep:function(){var e=!!this.header("Content-Type");return this.get("attachIdentifyingHeaders")&&(this.header("X-Requested-With","XMLHttpRequest"),this.header("X-SproutCore-Version",SC.VERSION)),this.get("isJSON")&&!e?this.header("Content-Type","application/json"):this.get("isXML")&&!e&&this.header("Content-Type","text/xml"),this},send:function(e){var t=this.get("timeout");if(t&&!this.get("isAsynchronous"))throw"Timeout values cannot be used with synchronous requests";if(t===0)throw"The timeout value must either not be specified or must be greater than 0";return e&&this.set("body",e),SC.Request.manager.sendRequest(this.copy()._prep())},resend:function(){var e=this.get("source")?this:this.copy()._prep();return SC.Request.manager.sendRequest(e)},notify:function(e,t,n,r){var i=YES;SC.typeOf(e)!==SC.T_NUMBER?(r=SC.A(arguments).slice(2),n=t,t=e
,e=0,i=NO):r=SC.A(arguments).slice(3);var s=this.get("listeners");return s||this.set("listeners",s={}),s[e]||(s[e]=[]),s[e].push({target:t,action:n,params:r}),this}}),SC.Request.mixin({getUrl:function(e){return this.create().set("address",e).set("type","GET")},postUrl:function(e,t){var n=this.create().set("address",e).set("type","POST");return t&&n.set("body",t),n},deleteUrl:function(e){return this.create().set("address",e).set("type","DELETE")},putUrl:function(e,t){var n=this.create().set("address",e).set("type","PUT");return t&&n.set("body",t),n}}),SC.Request.manager=SC.Object.create({maxRequests:6,inflight:[],pending:[],sendRequest:function(e){if(!e)return null;var t=e.get("responseClass").create({request:e});return this.get("pending").pushObject(t),this.fireRequestIfNeeded(),t},cancel:function(e){var t=this.get("pending"),n=this.get("inflight"),r;return t.indexOf(e)>=0?(this.propertyWillChange("pending"),t.removeObject(e),this.propertyDidChange("pending"),YES):n.indexOf(e)>=0?(e.cancel(),n.removeObject(e),this.fireRequestIfNeeded(),YES):NO},cancelAll:function(){return this.get("pending").length||this.get("inflight").length?(this.set("pending",[]),this.get("inflight").forEach(function(e){e.cancel()}),this.set("inflight",[]),YES):NO},fireRequestIfNeeded:function(){var e=this.get("pending"),t=this.get("inflight"),n=this.get("maxRequests"),r;e.length>0&&t.length<n&&(r=e.shiftObject(),t.pushObject(r),r.fire())},transportDidClose:function(e){this.get("inflight").removeObject(e),this.fireRequestIfNeeded()}}),SC.BRANCH_OPEN=17,SC.BRANCH_CLOSED=18,SC.LEAF_NODE=32,SC.CollectionContent=
{isCollectionContent:YES,contentIndexIsSelected:function(e,t,n){var r=e.get("selection");return r?r.contains(t,n):NO},contentIndexIsEnabled:function(e,t,n){return e.get("isEnabled")},contentGroupIndexes:function(e,t){return null},contentIndexIsGroup:function(e,t,n){return NO},contentIndexOutlineLevel:function(e,t,n){return-1},contentIndexDisclosureState:function(e,t,n){return SC.LEAF_NODE},contentIndexExpand:function(e,t,n){SC.Logger.log("contentIndexExpand(%@, %@, %@)".fmt(e,t,n))},contentIndexCollapse:function(e,t,n){SC.Logger.log("contentIndexCollapse(%@, %@, %@)".fmt(e,t,n))}},SC.ContentValueSupport={hasContentValueSupport:YES,initMixin:function(){this._control_contentKeysDidChange()},value:null,content:null,contentKeys:null,_default_contentKeys:{contentValueKey:"value"},contentValueKey:null,contentPropertyDidChange:function(e,t){var n=this.get("contentKeys"),r;if(n){for(r in n)(t==="*"||t===this.getDelegateProperty(r,this,this.get("displayDelegate"),n))&&this.updatePropertyFromContent(n[r],t,r,e);return this}return this.updatePropertyFromContent("value",t,"contentValueKey",e)},updatePropertyFromContent:function(e,t,n,r){var i,s;n===undefined&&(n="content"+e.capitalize()+"Key");if(this[n])n=this.get(n);else{if(!(i=this.get("displayDelegate"))||!(s=i[n]))return this;n=i.get?i.get(n):s}if(t==="*"||t===n)r===undefined&&(r=this.get("content")),r?s=r.get?r.get(n):r[n]:s=null,this.setIfChanged(e,s);return this},updateContentWithValueObserver:function(e,t){var n=this._reverseContentKeys;if(!t||t==="*")for(t in n)this.updateContentWithValueObserver(this,t);var r=this.get(t),i=this
.get("content"),s=this.getDelegateProperty(n[t],this,this.displayDelegate);if(!s||!i)return this;typeof i.setIfChanged===SC.T_FUNCTION?i.setIfChanged(s,r):i[s]!==r&&(i[s]=r)},_control_content:null,_old_contentValueKeys:null,_old_contentKeys:null,_control_contentDidChange:function(e,t){var n=this.get("content"),r=this.get("contentKeys"),i,s=this._control_content,o=this._old_contentValueKeys,u=SC.typeOf(o),a=this.contentPropertyDidChange;if(s&&s.removeObserver&&o)if(u===SC.T_STRING)s.removeObserver(o,this,a),o=null;else{var f,l=o.get("length");for(f=0;f<l;f++)i=o[f],s.removeObserver(i,this,a);o.clear()}if(n&&n.addObserver)if(r){o||(o=SC.CoreSet.create());for(i in r)i=this.getDelegateProperty(i,this,this.get("displayDelegate")),i&&(n.addObserver(i,this,a),o.add(i))}else i=this.getDelegateProperty("contentValueKey",this,this.get("displayDelegate")),i&&(n.addObserver(i,this,a),o?o.add(i):o=i);this._control_content=n,this._old_contentValueKeys=o,t=!t||t==="content"?"*":this.get(t),t&&this.contentPropertyDidChange(n,t)}.observes("content"),_old_contentKeys:null,_control_contentKeysDidChange:function(){var e,t={},n=this.get("contentKeys")||this._default_contentKeys,r,i=this._old_contentKeys,s=this._control_contentDidChange,o=this.updateContentWithValueObserver;for(e in i)r=i[e],this.removeObserver(r,this,o),this.removeObserver(e,this,s);for(e in n)r=n[e],t[r]=e,this.addObserver(r,this,o),this.addObserver(e,this,s);this._reverseContentKeys=t,this._old_contentKeys=n,this._control_contentDidChange()}.observes("contentKeys")},SC.STRING_TITLEIZE_REGEXP=/([\s|\-|\_|\n])([^\s|\-|\_|\n]?)/g
,SC.STRING_HUMANIZE_REGEXP=/[\-_]/g,SC.STRING_REGEXP_ESCAPED_REGEXP=/([\\\.\+\*\?\[\^\]\$\(\)\{\}\=\!\<\>\|\:])/g,SC.STRING_DASHERIZE_CACHE={top:"top",left:"left",right:"right",bottom:"bottom",width:"width",height:"height",minWidth:"min-width",maxWidth:"max-width"},SC.INFLECTION_CONSTANTS={PLURAL:[[/(quiz)$/i,"$1zes"],[/^(ox)$/i,"$1en"],[/([m|l])ouse$/i,"$1ice"],[/(matr|vert|ind)ix|ex$/i,"$1ices"],[/(x|ch|ss|sh)$/i,"$1es"],[/([^aeiouy]|qu)y$/i,"$1ies"],[/(hive)$/i,"$1s"],[/(?:([^f])fe|([lr])f)$/i,"$1$2ves"],[/sis$/i,"ses"],[/([ti])um$/i,"$1a"],[/(buffal|tomat)o$/i,"$1oes"],[/(bu)s$/i,"$1ses"],[/(alias|status)$/i,"$1es"],[/(octop|vir)us$/i,"$1i"],[/(ax|test)is$/i,"$1es"],[/s$/i,"s"],[/$/,"s"]],SINGULAR:[[/(quiz)zes$/i,"$1"],[/(matr)ices$/i,"$1ix"],[/(vert|ind)ices$/i,"$1ex"],[/^(ox)en/i,"$1"],[/(alias|status)es$/i,"$1"],[/(octop|vir)i$/i,"$1us"],[/(cris|ax|test)es$/i,"$1is"],[/(shoe)s$/i,"$1"],[/(o)es$/i,"$1"],[/(bus)es$/i,"$1"],[/([m|l])ice$/i,"$1ouse"],[/(x|ch|ss|sh)es$/i,"$1"],[/(m)ovies$/i,"$1ovie"],[/(s)eries$/i,"$1eries"],[/([^aeiouy]|qu)ies$/i,"$1y"],[/([lr])ves$/i,"$1f"],[/(tive)s$/i,"$1"],[/(hive)s$/i,"$1"],[/([^f])ves$/i,"$1fe"],[/(^analy)ses$/i,"$1sis"],[/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$/i,"$1$2sis"],[/([ti])a$/i,"$1um"],[/(n)ews$/i,"$1ews"],[/s$/i,""]],IRREGULAR:[["move","moves"],["sex","sexes"],["child","children"],["man","men"],["person","people"]],UNCOUNTABLE:["sheep","fish","series","species","money","rice","information","info","equipment"]},SC.mixin(SC.String,{capitalizeEach:function(e){return e.replace(SC.STRING_TITLEIZE_REGEXP,function(
e,t,n){return n?t+n.toUpperCase():t}).capitalize()},titleize:function(e){var t=e.replace(SC.STRING_DECAMELIZE_REGEXP,"$1_$2");return t.replace(SC.STRING_TITLEIZE_REGEXP,function(e,t,n){return n?" "+n.toUpperCase():" "}).capitalize()},classify:function(e){var t=e.replace(SC.STRING_TITLEIZE_REGEXP,function(e,t,n){return n?n.toUpperCase():""}),n=t.charAt(0),r=n.toUpperCase();return n!==r?r+t.slice(1):t},humanize:function(e){return SC.String.decamelize(e).replace(SC.STRING_HUMANIZE_REGEXP," ")},escapeForRegExp:function(e){return e.replace(SC.STRING_REGEXP_ESCAPED_REGEXP,"\\$1")},removeDiacritics:function(e){var t=SC.diacriticMappingTable;t||(SC.diacriticMappingTable={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","Ā":"A","Ă":"A","Ą":"A","Ǎ":"A","Ǟ":"A","Ǡ":"A","Ǻ":"A","Ȁ":"A","Ȃ":"A","Ȧ":"A","Ḁ":"A","Ạ":"A","Ả":"A","Ấ":"A","Ầ":"A","Ẩ":"A","Ẫ":"A","Ậ":"A","Ắ":"A","Ằ":"A","Ẳ":"A","Ẵ":"A","Ặ":"A","Å":"A","Ḃ":"B","Ḅ":"B","Ḇ":"B","Ç":"C","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","Ḉ":"C","Ď":"D","Ḋ":"D","Ḍ":"D","Ḏ":"D","Ḑ":"D","Ḓ":"D","È":"E","É":"E","Ê":"E","Ë":"E","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","Ȅ":"E","Ȇ":"E","Ȩ":"E","Ḕ":"E","Ḗ":"E","Ḙ":"E","Ḛ":"E","Ḝ":"E","Ẹ":"E","Ẻ":"E","Ẽ":"E","Ế":"E","Ề":"E","Ể":"E","Ễ":"E","Ệ":"E","Ḟ":"F","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","Ǧ":"G","Ǵ":"G","Ḡ":"G","Ĥ":"H","Ȟ":"H","Ḣ":"H","Ḥ":"H","Ḧ":"H","Ḩ":"H","Ḫ":"H","Ì":"I","Í":"I","Î":"I","Ï":"I","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","Ǐ":"I","Ȉ":"I","Ȋ":"I","Ḭ":"I","Ḯ":"I","Ỉ":"I","Ị":"I","Ĵ":"J","Ķ":"K","Ǩ":"K","Ḱ":"K","Ḳ":"K","Ḵ":"K","Ĺ":"L","Ļ":"L","Ľ":"L","Ḷ":"L","Ḹ":"L","Ḻ":"L","Ḽ":"L","Ḿ":"M","Ṁ":"M","Ṃ"
:"M","Ñ":"N","Ń":"N","Ņ":"N","Ň":"N","Ǹ":"N","Ṅ":"N","Ṇ":"N","Ṉ":"N","Ṋ":"N","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ō":"O","Ŏ":"O","Ő":"O","Ơ":"O","Ǒ":"O","Ǫ":"O","Ǭ":"O","Ȍ":"O","Ȏ":"O","Ȫ":"O","Ȭ":"O","Ȯ":"O","Ȱ":"O","Ṍ":"O","Ṏ":"O","Ṑ":"O","Ṓ":"O","Ọ":"O","Ỏ":"O","Ố":"O","Ồ":"O","Ổ":"O","Ỗ":"O","Ộ":"O","Ớ":"O","Ờ":"O","Ở":"O","Ỡ":"O","Ợ":"O","Ṕ":"P","Ṗ":"P","Ŕ":"R","Ŗ":"R","Ř":"R","Ȑ":"R","Ȓ":"R","Ṙ":"R","Ṛ":"R","Ṝ":"R","Ṟ":"R","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","Ș":"S","Ṡ":"S","Ṣ":"S","Ṥ":"S","Ṧ":"S","Ṩ":"S","Ţ":"T","Ť":"T","Ț":"T","Ṫ":"T","Ṭ":"T","Ṯ":"T","Ṱ":"T","Ù":"U","Ú":"U","Û":"U","Ü":"U","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","Ư":"U","Ǔ":"U","Ǖ":"U","Ǘ":"U","Ǚ":"U","Ǜ":"U","Ȕ":"U","Ȗ":"U","Ṳ":"U","Ṵ":"U","Ṷ":"U","Ṹ":"U","Ṻ":"U","Ụ":"U","Ủ":"U","Ứ":"U","Ừ":"U","Ử":"U","Ữ":"U","Ự":"U","Ṽ":"V","Ṿ":"V","Ŵ":"W","Ẁ":"W","Ẃ":"W","Ẅ":"W","Ẇ":"W","Ẉ":"W","Ẋ":"X","Ẍ":"X","Ý":"Y","Ŷ":"Y","Ÿ":"Y","Ȳ":"Y","Ẏ":"Y","Ỳ":"Y","Ỵ":"Y","Ỷ":"Y","Ỹ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","Ẑ":"Z","Ẓ":"Z","Ẕ":"Z","`":"`","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","ā":"a","ă":"a","ą":"a","ǎ":"a","ǟ":"a","ǡ":"a","ǻ":"a","ȁ":"a","ȃ":"a","ȧ":"a","ḁ":"a","ạ":"a","ả":"a","ấ":"a","ầ":"a","ẩ":"a","ẫ":"a","ậ":"a","ắ":"a","ằ":"a","ẳ":"a","ẵ":"a","ặ":"a","ḃ":"b","ḅ":"b","ḇ":"b","ç":"c","ć":"c","ĉ":"c","ċ":"c","č":"c","ḉ":"c","ď":"d","ḋ":"d","ḍ":"d","ḏ":"d","ḑ":"d","ḓ":"d","è":"e","é":"e","ê":"e","ë":"e","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","ȅ":"e","ȇ":"e","ȩ":"e","ḕ":"e","ḗ":"e","ḙ":"e","ḛ":"e","ḝ":"e","ẹ":"e","ẻ":"e","ẽ":"e","ế":"e","ề":"e","ể":"e","ễ":"e","ệ":"e","ḟ":"f","ĝ":"g","ğ":"g","ġ":"g"
,"ģ":"g","ǧ":"g","ǵ":"g","ḡ":"g","ĥ":"h","ȟ":"h","ḣ":"h","ḥ":"h","ḧ":"h","ḩ":"h","ḫ":"h","ẖ":"h","ì":"i","í":"i","î":"i","ï":"i","ĩ":"i","ī":"i","ĭ":"i","į":"i","ǐ":"i","ȉ":"i","ȋ":"i","ḭ":"i","ḯ":"i","ỉ":"i","ị":"i","ĵ":"j","ǰ":"j","ķ":"k","ǩ":"k","ḱ":"k","ḳ":"k","ḵ":"k","ĺ":"l","ļ":"l","ľ":"l","ḷ":"l","ḹ":"l","ḻ":"l","ḽ":"l","ḿ":"m","ṁ":"m","ṃ":"m","ñ":"n","ń":"n","ņ":"n","ň":"n","ǹ":"n","ṅ":"n","ṇ":"n","ṉ":"n","ṋ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ō":"o","ŏ":"o","ő":"o","ơ":"o","ǒ":"o","ǫ":"o","ǭ":"o","ȍ":"o","ȏ":"o","ȫ":"o","ȭ":"o","ȯ":"o","ȱ":"o","ṍ":"o","ṏ":"o","ṑ":"o","ṓ":"o","ọ":"o","ỏ":"o","ố":"o","ồ":"o","ổ":"o","ỗ":"o","ộ":"o","ớ":"o","ờ":"o","ở":"o","ỡ":"o","ợ":"o","ṕ":"p","ṗ":"p","ŕ":"r","ŗ":"r","ř":"r","ȑ":"r","ȓ":"r","ṙ":"r","ṛ":"r","ṝ":"r","ṟ":"r","ś":"s","ŝ":"s","ş":"s","š":"s","ș":"s","ṡ":"s","ṣ":"s","ṥ":"s","ṧ":"s","ṩ":"s","ţ":"t","ť":"t","ț":"t","ṫ":"t","ṭ":"t","ṯ":"t","ṱ":"t","ẗ":"t","ù":"u","ú":"u","û":"u","ü":"u","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","ư":"u","ǔ":"u","ǖ":"u","ǘ":"u","ǚ":"u","ǜ":"u","ȕ":"u","ȗ":"u","ṳ":"u","ṵ":"u","ṷ":"u","ṹ":"u","ṻ":"u","ụ":"u","ủ":"u","ứ":"u","ừ":"u","ử":"u","ữ":"u","ự":"u","ṽ":"v","ṿ":"v","ŵ":"w","ẁ":"w","ẃ":"w","ẅ":"w","ẇ":"w","ẉ":"w","ẘ":"w","ẋ":"x","ẍ":"x","ý":"y","ÿ":"y","ŷ":"y","ȳ":"y","ẏ":"y","ẙ":"y","ỳ":"y","ỵ":"y","ỷ":"y","ỹ":"y","ź":"z","ż":"z","ž":"z","ẑ":"z","ẓ":"z","ẕ":"z"},t=SC.diacriticMappingTable);var n,r,i="",s=e.length;for(var o=0;o<=s;++o)n=e.charAt(o),r=t[n],i+=r||n;return i},pluralize:function(e){var t,n,r=e.split(/\s/).pop(),i=e.replace(r,""),s=r.charAt(0).match(/[A-Z]/)?!0:!1
;r=r.toLowerCase();for(t=0,n=SC.INFLECTION_CONSTANTS.UNCOUNTABLE.length;t<n;t++){var o=SC.INFLECTION_CONSTANTS.UNCOUNTABLE[t];if(r==o)return e.toString()}for(t=0,n=SC.INFLECTION_CONSTANTS.IRREGULAR.length;t<n;t++){var u=SC.INFLECTION_CONSTANTS.IRREGULAR[t][0],a=SC.INFLECTION_CONSTANTS.IRREGULAR[t][1];if(r==u||r==a)return s&&(a=a.capitalize()),i+a}for(t=0,n=SC.INFLECTION_CONSTANTS.PLURAL.length;t<n;t++){var f=SC.INFLECTION_CONSTANTS.PLURAL[t][0],l=SC.INFLECTION_CONSTANTS.PLURAL[t][1];if(f.test(r))return e.replace(f,l)}},singularize:function(e){var t,n,r=e.split(/\s/).pop(),i=e.replace(r,""),s=r.charAt(0).match(/[A-Z]/)?!0:!1;r=r.toLowerCase();for(t=0,n=SC.INFLECTION_CONSTANTS.UNCOUNTABLE.length;t<n;t++){var o=SC.INFLECTION_CONSTANTS.UNCOUNTABLE[t];if(r==o)return e.toString()}for(t=0,n=SC.INFLECTION_CONSTANTS.IRREGULAR.length;t<n;t++){var u=SC.INFLECTION_CONSTANTS.IRREGULAR[t][0],a=SC.INFLECTION_CONSTANTS.IRREGULAR[t][1];if(r==u||r==a)return s&&(u=u.capitalize()),i+u}for(t=0,n=SC.INFLECTION_CONSTANTS.SINGULAR.length;t<n;t++){var f=SC.INFLECTION_CONSTANTS.SINGULAR[t][0],l=SC.INFLECTION_CONSTANTS.SINGULAR[t][1];if(f.test(r))return e.replace(f,l)}}}),SC.String.strip=SC.String.trim,SC.AUTO_CONTROL_SIZE="__AUTO__",SC.JUMBO_CONTROL_SIZE="sc-jumbo-size",SC.HUGE_CONTROL_SIZE="sc-huge-size",SC.LARGE_CONTROL_SIZE="sc-large-size",SC.REGULAR_CONTROL_SIZE="sc-regular-size",SC.SMALL_CONTROL_SIZE="sc-small-size",SC.TINY_CONTROL_SIZE="sc-tiny-size",SC.CUSTOM_CONTROL_SIZE="sc-custom-size",SC.Control=SC.mixin(SC.clone(SC.ContentValueSupport),{isControl:YES,isSelected:NO,isSelectedBindingDefault
:SC.Binding.oneWay().bool(),isActive:NO,isActiveBindingDefault:SC.Binding.oneWay().bool(),fieldKey:null,fieldLabel:null,errorLabel:function(){var e,t,n,r;return(e=this.get("fieldLabel"))?e:(t=this.get("fieldKey")||this.constructor.toString(),n=t?SC.String.capitalize(SC.String.humanize(t)):"",r=SC.String.locWithDefault("FieldKey."+t,n),SC.String.locWithDefault("ErrorLabel."+t,r))}.property("fieldLabel","fieldKey").cacheable(),controlSize:SC.REGULAR_CONTROL_SIZE,displayProperties:["isEnabled","isSelected","isActive","controlSize"],_CONTROL_TMP_CLASSNAMES:{},renderMixin:function(e,t){var n=this.get("isSelected"),r=!this.get("isEnabled"),i=this._CONTROL_TMP_CLASSNAMES;i.mixed=n===SC.MIXED_STATE,i.sel=n&&n!==SC.MIXED_STATE,i.active=this.get("isActive");var s=this.get("controlSize");s||(s=SC.REGULAR_CONTROL_SIZE),t?(e.setClass(i),this.get("renderDelegate")||e.addClass(s)):(e.$().setClass(i),this.get("renderDelegate")||e.$().addClass(s));if(!t&&this.$input){var o=this.$input();o.attr("type")!=="radio"&&this.$input().attr("disabled",r)}}}),SC.InlineEditable={isInlineEditable:YES,isEditable:YES,exampleEditor:SC.InlineTextFieldView,isEditing:NO,inlineEditorDelegate:SC.InlineTextFieldDelegate,_editor:null,beginEditing:function(){var e;return e=this.delegateFor("inlineEditorShouldBeginEditing",this.inlineEditorDelegate),e&&!e.inlineEditorShouldBeginEditing(this,this.get("value"))?NO:(this._editor=this.invokeDelegateMethod(this.inlineEditorDelegate,"acquireEditor",this),this._editor?this._editor.beginEditing(this):NO)},commitEditing:function(){return this._editor?this._editor.commitEditing
():NO},discardEditing:function(){return this._editor?this._editor.discardEditing():NO},inlineEditorShouldBeginEditing:function(){return!this.get("isEditing")&&this.get("isEditable")},inlineEditorWillBeginEditing:function(e,t,n){e.set("value",this.get("value"))},inlineEditorDidBeginEditing:function(e,t,n){this.set("isEditing",YES)},inlineEditorWillCommmitEditing:function(e,t,n){this.inlineEditorWillEndEditing&&this.inlineEditorWillEndEditing(e,t)},inlineEditorDidCommitEditing:function(e,t,n){n.setIfChanged("value",t),this.inlineEditorDidEndEditing&&this.inlineEditorDidEndEditing(e,t),this._endEditing()},inlineEditorWillDiscardEditing:function(e,t){this.inlineEditorWillEndEditing&&this.inlineEditorWillEndEditing(e,this.get("value"))},inlineEditorDidDiscardEditing:function(e,t){this.inlineEditorDidEndEditing&&this.inlineEditorDidEndEditing(e,this.get("value")),this._endEditing()},_endEditing:function(){this._editor&&(this.invokeDelegateMethod(this.inlineEditorDelegate,"releaseEditor",this._editor),this._editor=null),this.set("isEditing",NO)}},SC.RenderDelegate={create:function(){var e=SC.beget(this),t,n=arguments.length;for(t=0;t<n;t++)e.mixin(arguments[t]);return e},reopen:function(e){var t,n;for(t in e){n=e[t];if(!e.hasOwnProperty(t))continue;typeof n=="function"&&n!==this[t]&&(n.base=this[t]||SC.K),n&&n.isEnhancement&&n!==this[t]&&(n=SC._enhance(this[t]||SC.K,n)),this[t]=n}},get:function(e){return this[e]},getPropertyFor:function(e,t){return this[t+"For"]?this[t+"For"](e,t):this[t]},className:undefined,render:function(e,t){},update:function(e,t){}},SC.RenderDelegate.extend=SC
.RenderDelegate.create,SC.RenderDelegate.mixin=SC.RenderDelegate.reopen,SC.BaseTheme.containerRenderDelegate=SC.RenderDelegate.create({render:function(e,t){},update:function(){}}),SC.RenderDelegate.reopen({sizes:[SC.TINY_CONTROL_SIZE,SC.SMALL_CONTROL_SIZE,SC.REGULAR_CONTROL_SIZE,SC.LARGE_CONTROL_SIZE,SC.HUGE_CONTROL_SIZE,SC.JUMBO_CONTROL_SIZE],sizeFor:function(e){var t=e.get("controlSize"),n,r,i;if(t)return this[t]||(this[t]={}),n=this[t],n.name||(n.name=t),n;var s=e.get("frame");if(!s)return n=this["sc-regular-size"],n||(n=this["sc-regular-size"]={}),n.name||(n.name="sc-regular-size"),n;for(r=0;r<i;r++){key=sizes[r],n=this[key];if(!n)continue;if(n.width===undefined&&n.height===undefined&&n.minHeight===undefined&&n.minWidth===undefined&&n.maxHeight===undefined&&n.maxWidth===undefined||n.width!==undefined&&s.width!==n.width||n.minWidth!==undefined&&s.width<n.minWidth||n.maxWidth!==undefined&&s.width>n.maxWidth||n.height!==undefined&&s.height!==n.height||n.minHeight!==undefined&&s.height<n.minHeight||n.maxHeight!==undefined&&s.height<n.maxHeight)continue;return n.name||(n.name=key),n}return n=this["sc-regular-size"],n||(n=this["sc-regular-size"]={}),n.name||(n.name="sc-regular-size"),n},addSizeClassName:function(e,t){var n=this.sizeFor(e);n&&t.addClass(n.name)},updateSizeClassName:function(e,t){var n=this.sizeFor(e);n&&t.addClass(n.name)},getPropertyFor:function(e,t){var n=this.sizeFor(e);if(n){if(n[t+"For"])return n[t+"For"](e,t);if(n[t]!==undefined)return n[t]}return this[t+"For"]?this[t+"For"]:this[t]}}),SC.BaseTheme.labelRenderDelegate=SC.RenderDelegate.create({className:"label"
,render:function(e,t){this.addSizeClassName(e,t);var n=e.get("fontWeight"),r=e.get("textAlign");(n||r)&&t.addStyle({fontWeight:n||null,textAlign:r||null}),t.setClass("ellipsis",e.get("needsEllipsis")||NO),t.setClass("icon",e.get("icon")||NO);var i=this.htmlForTitleAndIcon(e);t.push(i),e.get("renderState")._lastHTMLForTitleAndIcon=i},update:function(e,t){this.updateSizeClassName(e,t);var n=e.get("fontWeight"),r=e.get("textAlign");(n||r)&&t.css({fontWeight:n||null,textAlign:r||null}),t.setClass("ellipsis",e.get("needsEllipsis")||NO);var i=this.htmlForTitleAndIcon(e);e.get("renderState")._lastHTMLForTitleAndIcon!==i&&(t.html(i),e.get("renderState")._lastHTMLForTitleAndIcon=i)},htmlForTitleAndIcon:function(e){var t=e.get("title"),n=e.get("hint"),r=e.get("hintEnabled"),i=e.get("escapeHTML"),s=e.get("icon")||"";return t&&i&&(t=SC.RenderContext.escapeHTML(t)),r&&n&&!t&&(i&&(n=SC.RenderContext.escapeHTML(n)),t="<span class='sc-hint'>"+n+"</span>"),s&&(s.indexOf("/")>=0?s='<img src="'+s+'" class="icon" />':s='<img src="'+SC.BLANK_IMAGE_URL+'" class="icon '+s+'" />'),s+t}}),SC.ExceptionHandler={enabled:SC.buildMode!=="debug",handleException:function(e){return this.isShowingErrorDialog?NO:(this._displayErrorDialog(e),NO)},_displayErrorDialog:function(e){var t=this._errorDialogHTMLForException(e),n=document.createElement("div");n.style.cssText="left: 0px; right: 0px; top: 0px; bottom: 0px; position: absolute; background-color: white; background-color: rgba(255,255,255,0.6); z-index:100;",n.innerHTML=t,document.body.appendChild(n),this.isShowingErrorDialog=YES},_errorDialogHTMLForException
:function(e){var t;return t=['<div id="sc-error-dialog" style="position: absolute; width: 500px; left: 50%; top: 50%; margin-left: -250px; background-color: white; border: 1px solid black; font-family: Monaco, monospace; font-size: 9px; letter-spacing: 1px; padding: 10px">',"An error has occurred which prevents the application from running:","<br><br>",e.message,'<div id="sc-error-dialog-reload-button" onclick="window.location.reload();" style="float: right; font-family: Monaco, monospace; font-size: 9px; letter-spacing: 1px; border: 1px solid black; padding: 3px; clear: both; margin-top: 20px; cursor: pointer;">',"Reload","</div>","</div>"],t.join("")},isShowingErrorDialog:NO},SC.IMAGE_ABORTED_ERROR=SC.$error("SC.Image.AbortedError","Image",-100),SC.IMAGE_FAILED_ERROR=SC.$error("SC.Image.FailedError","Image",-101),SC.imageQueue=SC.Object.create({loadLimit:4,activeRequests:0,loadImage:function(e,t,n,r){var i=SC.typeOf(t);SC.none(n)&&SC.typeOf(t)===SC.T_FUNCTION&&(t=null,n=t),SC.typeOf(n)===SC.T_STRING&&(n=t[n]),SC.none(r)&&(r=SC.none(t)&&SC.none(n));var s=this._imageEntryFor(e);s.status===this.IMAGE_LOADED?n&&n.call(t||s.image,s.url,s.image):((t||n)&&this._addCallback(s,t,n),s.retainCount++,this._scheduleImageEntry(s,r))},releaseImage:function(e,t,n){var r=this._imageEntryFor(e,NO);if(!r)return this;if(--r.retainCount<=0)this._deleteEntry(r);else if(t||n){var i=SC.typeOf(t);SC.none(n)&&SC.typeOf(t)===SC.T_FUNCTION&&(t=null,n=t),SC.typeOf(n)===SC.T_STRING&&(n=t[n]),this._removeCallback(r,t,n)}},reloadImage:function(e){var t=this._imageEntryFor(e,NO);t&&t.status===this.IMAGE_LOADED&&
(t.status=this.IMAGE_WAITING)},loadNextImage:function(){var e=null,t;if(this.get("activeRequests")>=this.get("loadLimit"))return;t=this._foregroundQueue;while(t.length>0&&!e)e=t.shift();if(!e){t=this._backgroundQueue;while(t.length>0&&!e)e=t.shift()}this.set("isLoading",!!e);if(e){var n=e.image;if(!n)return;var r=SC.$(n);r.length!==0?(r.bind("abort",this._imageDidAbort),r.bind("error",this._imageDidError),r.bind("load",this._imageDidLoad),n.src=e.url,this._loading.push(e)):e.url?SC.error("Unable to load the image for url %@".fmt(e.url)):SC.error("entry does not contain any url. Its an invalid entry"),this.incrementProperty("activeRequests"),this.loadNextImage()}},_imageEntryFor:function(e,t){t===undefined&&(t=YES);var n=this._images[e];if(!n&&t){var r=new Image;n=this._images[e]={url:e,status:this.IMAGE_WAITING,callbacks:[],retainCount:0,image:r},r.entry=n}return n},_deleteEntry:function(e){this._unscheduleImageEntry(e),delete this._images[e.url]},_addCallback:function(e,t,n){var r=e.callbacks,i=r.find(function(e){return e[0]===t&&e[1]===n},this);return i||r.push([t,n]),r=null,this},_removeCallback:function(e,t,n){var r=e.callbacks;return r.forEach(function(e,i){e[0]===t&&e[1]===n&&(r[i]=null)},this),r=null,this},_scheduleImageEntry:function(e,t){var n=this._backgroundQueue,r=this._foregroundQueue;if(e.status===this.IMAGE_LOADED)return this;e.status===this.IMAGE_QUEUED&&!t&&e.isBackground&&(n[n.indexOf(e)]=null,e.status=this.IMAGE_WAITING);if(e.status!==this.IMAGE_QUEUED){var i=t?n:r;i.push(e),e.status=this.IMAGE_QUEUED,e.isBackground=t}return this.isLoading||this.invokeLater
(this.loadNextImage,100),this.set("isLoading",YES),this},_unscheduleImageEntry:function(e){if(e.status!==this.IMAGE_QUEUED)return this;var t=e.isBackground?this._backgroundQueue:this._foregroundQueue;return t[t.indexOf(e)]=null,this._loading.indexOf(e)>=0&&(t.image&&t.image.abort(),this.imageStatusDidChange(e,this.ABORTED)),this},_imageDidAbort:function(){SC.run(function(){SC.imageQueue.imageStatusDidChange(this.entry,SC.imageQueue.ABORTED)},this)},_imageDidError:function(){SC.run(function(){SC.imageQueue.imageStatusDidChange(this.entry,SC.imageQueue.ERROR)},this)},_imageDidLoad:function(){SC.run(function(){SC.imageQueue.imageStatusDidChange(this.entry,SC.imageQueue.LOADED)},this)},imageStatusDidChange:function(e,t){if(!e)return;var n=e.url,r;switch(t){case this.LOADED:r=e.image;break;case this.ABORTED:r=SC.IMAGE_ABORTED_ERROR;break;case this.ERROR:r=SC.IMAGE_FAILED_ERROR;break;default:r=SC.IMAGE_FAILED_ERROR}e.callbacks.forEach(function(e){var t=e[0],i=e[1];i.call(t,n,r)},this),e.callbacks=[],e.status=t===this.LOADED?this.IMAGE_LOADED:this.IMAGE_WAITING;var i=e.image;i&&(i.onload=i.onerror=i.onabort=null,t!==this.LOADED&&(e.image=null)),this._loading[this._loading.indexOf(e)]=null,this._loading.length>this.loadLimit*2&&(this._loading=this._loading.compact()),this.decrementProperty("activeRequests"),this.loadNextImage()},init:function(){arguments.callee.base.apply(this,arguments),this._images={},this._loading=[],this._foregroundQueue=[],this._backgroundQueue=[]},IMAGE_LOADED:"loaded",IMAGE_QUEUED:"queued",IMAGE_WAITING:"waiting",ABORTED:"aborted",ERROR:"error",LOADED:"loaded"
}),SC.ContainerView=SC.View.extend({classNames:["sc-container-view"],renderDelegateName:"containerRenderDelegate",nowShowing:null,contentView:null,contentViewBindingDefault:SC.Binding.single(),replaceContent:function(e){this.removeAllChildren(),e&&this.appendChild(e)},createChildViews:function(){var e=this.get("contentView");e&&(e=this.contentView=this.createChildView(e),this.childViews=[e])},awake:function(){arguments.callee.base.apply(this,arguments);var e=this.get("nowShowing");e&&e.length>0&&this.nowShowingDidChange()},nowShowingDidChange:function(){var e=this.get("nowShowing");if(e===SC.CONTENT_SET_DIRECTLY)return;var t=this._instantiatedLastView===YES?this.get("contentView"):null;this._instantiatedLastView=NO;if(SC.typeOf(e)===SC.T_STRING&&e.length>0)if(e.indexOf(".")>0)e=SC.objectForPropertyPath(e);else{var n=this.getPath(e);e=SC.kindOf(n,SC.CoreView)?n:SC.objectForPropertyPath(e,this.get("page"))}SC.typeOf(e)===SC.T_CLASS&&(e.kindOf(SC.CoreView)?(e=this.createChildView(e),this._instantiatedLastView=YES):e=null),e&&!(e instanceof SC.CoreView)&&(e=null),this.set("contentView",e),t&&t.destroy()}.observes("nowShowing"),contentViewDidChange:function(){this.replaceContent(this.get("contentView"))}.observes("contentView")}),SC.CollectionGroup={classNames:["sc-collection-group"]},SC.CollectionRowDelegate={isCollectionRowDelegate:YES,itemHeight:24,rowSpacing:0,rowPadding:0,rowHeight:function(e,t){var n=this.get("rowPadding"),r=this.get("itemHeight");return t!==undefined?(this.set("itemHeight",t-n*2),t):r+n*2}.property("itemHeight","rowPadding"),customRowHeightIndexes:null,contentIndexRowHeight
:function(e,t,n){return this.get("rowHeight")}},SC.CollectionViewDelegate={isCollectionViewDelegate:YES,collectionViewSelectionForProposedSelection:function(e,t){return t},collectionViewShouldSelectIndexes:function(e,t,n){return t},collectionViewShouldDeselectIndexes:function(e,t){return t},collectionViewShouldDeleteIndexes:function(e,t){return t},collectionViewDeleteContent:function(e,t,n){return t?SC.typeOf(t.destroyAt)===SC.T_FUNCTION?(t.destroyAt(n),e.selectPreviousItem(NO,1),YES):SC.typeOf(t.removeAt)===SC.T_FUNCTION?(t.removeAt(n),e.selectPreviousItem(NO,1),YES):NO:NO},collectionViewShouldBeginDrag:function(e){return YES},collectionViewDragDataTypes:function(e){return[]},collectionViewDragDataForType:function(e,t,n){return null},collectionViewComputeDragOperations:function(e,t,n){return n},collectionViewValidateDragOperation:function(e,t,n,r,i){return i&SC.DROP_ON?SC.DRAG_NONE:n},collectionViewPerformDragOperation:function(e,t,n,r,i){return SC.DRAG_NONE},collectionViewDragViewFor:function(e,t){return null},ghostActsLikeCursor:NO},SC.BaseTheme.buttonRenderDelegate=SC.RenderDelegate.create({className:"button","sc-small-size":{height:18,autoResizePadding:{width:15,height:0}},"sc-regular-size":{height:24,autoResizePadding:{width:20,height:0}},"sc-huge-size":{height:30,autoResizePadding:{width:30,height:0}},"sc-jumbo-size":{height:44,autoResizePadding:{width:50,height:0}},render:function(e,t){this.addSizeClassName(e,t);var n,r=e.get("toolTip"),i=e.get("value"),s=e.get("isSelected")||NO,o=e.get("isActive")||NO,u=e.get("isDefault")||NO,a=e.get("isCancel")||NO,f=e.get("isToggle"
)||NO,l=SC.guidFor(e)+"-label",c=e.get("isBorderless")||NO;t.setClass({icon:!!e.get("icon"),def:u,cancel:a&&!u,active:o,sel:s}),r&&(t.attr("title",r),t.attr("alt",r)),c||this.includeSlices(e,t,SC.THREE_SLICE),e.get("isSegment")?t.attr("aria-selected",s.toString()):f&&t.attr("aria-pressed",o.toString()),i?t.attr("aria-labelledby",l):r?t.attr("aria-label",r):t.attr("aria-label",e.get("displayTitle")),t=t.begin("label").addClass("sc-button-label").id(l),e.get("theme").labelRenderDelegate.render(e,t),t=t.end(),e.get("supportFocusRing")&&(t=t.begin("div").addClass("focus-ring"),this.includeSlices(e,t,SC.THREE_SLICE),t=t.end())},update:function(e,t){var n=e.get("buttonBehavior")===SC.TOGGLE_BEHAVIOR;this.updateSizeClassName(e,t),e.get("isActive")&&t.addClass("active");var r=e.get("isDefault"),i=e.get("isCancel");e.get("isSegment")?t.attr("aria-selected",e.get("isSelected").toString()):n&&t.attr("aria-pressed",e.get("isActive").toString());var s=e.get("toolTip");t.attr("title",s),t.attr("aria-label",s),t.setClass("icon",!!e.get("icon")),t.setClass("def",!!r),t.setClass("cancel",!!i&&!r),e.get("theme").labelRenderDelegate.update(e,t.find("label"))},getRenderedAutoResizeLayer:function(e,t){return t.find(".sc-button-label")[0]}}),SC.BaseTheme.collectionRenderDelegate=SC.RenderDelegate.create({className:"collection",render:function(e,t){t.setClass("focus",e.get("hasFirstResponder")),t.setClass("disabled",!e.get("isEnabled")),t.setClass("active",e.get("isActive"))},update:function(e,t){t.setClass("focus",e.get("hasFirstResponder")),t.setClass("disabled",!e.get("isEnabled")),t.setClass("active"
,e.get("isActive"))}}),SC.BaseTheme.segmentRenderDelegate=SC.RenderDelegate.create({className:"segment",render:function(e,t){var n=e.get("theme"),r,i;i={"sc-first-segment":e.get("isFirstSegment"),"sc-middle-segment":e.get("isMiddleSegment"),"sc-last-segment":e.get("isLastSegment"),"sc-overflow-segment":e.get("isOverflowSegment")},SC.none(e.get("index"))||(i["sc-segment-"+e.get("index")]=YES),t.setClass(i),t.attr("tabindex",e.get("isSelected")?0:-1),r=n.buttonRenderDelegate,r.render(e,t)},update:function(e,t){var n=e.get("theme"),r,i={};i={"sc-first-segment":e.get("isFirstSegment"),"sc-middle-segment":e.get("isMiddleSegment"),"sc-last-segment":e.get("isLastSegment"),"sc-overflow-segment":e.get("isOverflowSegment")||NO},SC.none(e.get("index"))||(i["sc-segment-"+e.get("index")]=YES),t.setClass(i),t.attr("tabindex",e.get("isSelected")?0:-1),r=n.buttonRenderDelegate,r.update(e,t)}}),SC.BaseTheme.segmentedRenderDelegate=SC.RenderDelegate.create({className:"segmented",render:function(e,t){this.addSizeClassName(e,t),t.addStyle("text-align",e.get("align"))},update:function(e,t){this.updateSizeClassName(e,t),t.css("text-align",e.get("align"))},segmentWidths:function(e){var t=e.$(".sc-segment-view"),n,r=[];for(var i=0,s=t.length;i<s-1;i++)n=t[i],r[i]=n.getBoundingClientRect().width;return r},overflowSegmentWidth:function(e){var t=e.$(".sc-segment-view"),n;return n=t[t.length-1],n.getBoundingClientRect().width},indexForClientPosition:function(e,t,n){var r=e.$(".sc-segment-view"),i,s,o,u,a;a={x:t,y:n};for(s=0,i=r.length;s<i;s++){o=r[s],u=o.getBoundingClientRect(),u={x:u.left,y:u.top,width
:u.right-u.left,height:u.bottom-u.top};if(SC.pointInRect(a,u))return s}return-1}}),SC.MODIFIED_KEY_BINDINGS={"ctrl_.":"cancel",shift_tab:"insertBacktab",shift_left:"moveLeftAndModifySelection",shift_right:"moveRightAndModifySelection",shift_up:"moveUpAndModifySelection",shift_down:"moveDownAndModifySelection",alt_left:"moveLeftAndModifySelection",alt_right:"moveRightAndModifySelection",alt_up:"moveUpAndModifySelection",alt_down:"moveDownAndModifySelection",ctrl_a:"selectAll"},SC.BASE_KEY_BINDINGS={escape:"cancel",backspace:"deleteBackward","delete":"deleteForward","return":"insertNewline",tab:"insertTab",left:"moveLeft",right:"moveRight",up:"moveUp",down:"moveDown",home:"moveToBeginningOfDocument",end:"moveToEndOfDocument",pagedown:"pageDown",pageup:"pageUp"},SC.TOGGLE_BEHAVIOR="toggle",SC.PUSH_BEHAVIOR="push",SC.TOGGLE_ON_BEHAVIOR="on",SC.TOGGLE_OFF_BEHAVIOR="off",SC.HOLD_BEHAVIOR="hold",SC.ButtonView=SC.View.extend(SC.Control,{acceptsFirstResponder:function(){return SC.FOCUS_ALL_CONTROLS?this.get("isEnabled"):NO}.property("isEnabled"),classNames:["sc-button-view"],themeName:"square",value:null,toggleOnValue:YES,toggleOffValue:NO,localize:NO,localizeBindingDefault:SC.Binding.bool(),title:"",tooltip:"",contentTitleKey:null,icon:null,contentIconKey:null,needsEllipsis:YES,displayTitle:function(){var e=this.get("title");return e&&this.get("localize")?SC.String.loc(e):e||""}.property("title","localize").cacheable(),keyEquivalent:null,isBorderless:NO,buttonBehavior:SC.PUSH_BEHAVIOR,holdInterval:100,isDefault:NO,isDefaultBindingDefault:SC.Binding.oneWay().bool(),isCancel:NO,isCancelBindingDefault
:SC.Binding.oneWay().bool(),action:null,target:null,supportFocusRing:NO,supportsAutoResize:YES,autoResizeLayer:function(){var e=this.invokeRenderDelegateMethod("getRenderedAutoResizeLayer",this.$());return e||this.get("layer")}.property("layer").cacheable(),autoResizeText:function(){return this.get("displayTitle")}.property("displayTitle").cacheable(),autoResizePadding:SC.propertyFromRenderDelegate("autoResizePadding",10),_labelMinWidthIE7:0,triggerActionAfterDelay:function(e){return this.get("isEnabled")?(this.set("isActive",YES),this.invokeLater("triggerAction",200,e),YES):NO},triggerAction:function(e){this._action(e,YES),this.didTriggerAction(),this.set("isActive",NO)},didTriggerAction:function(){},init:function(){arguments.callee.base.apply(this,arguments);var e=this.get("keyEquivalent");e&&(this._defaultKeyEquivalent=e),SC.none(this.get("value"))||this._button_valueDidChange()},ariaRole:"button",displayProperties:["icon","displayTitle","value","displayToolTip","isDefault","isCancel","escapeHTML","needsEllipsis","tooltip","supportFocusRing","buttonBehavior","isBorderless"],renderDelegateName:"buttonRenderDelegate",contentKeys:{contentValueKey:"value",contentTitleKey:"title",contentIconKey:"icon"},_button_displayObserver:function(){this.displayDidChange()}.observes("title","icon","value"),performKeyEquivalent:function(e,t){if(!this.get("isVisibleInWindow"))return NO;if(!this.get("isEnabled"))return NO;var n=this.get("keyEquivalent");if(n){if(n===e)return this.triggerAction(t)}else if(this.get("isDefault")&&e==="return"||this.get("isCancel")&&e==="escape")return this.triggerAction
(t);return NO},computeIsSelectedForValue:function(e){var t=this.get("toggleOnValue"),n,r;return SC.typeOf(e)===SC.T_ARRAY?e.length===1?n=e[0]==t:(n=null,e.find(function(e){return r=e==t,n===null?n=r:r!==n&&(n=SC.MIXED_STATE),n===SC.MIXED_STATE})):e===SC.MIXED_STATE?n=SC.MIXED_STATE:n=e===t,n},_button_valueDidChange:function(){var e=this.get("value"),t=this.computeIsSelectedForValue(e);this.set("isSelected",t)}.observes("value"),_button_isSelectedDidChange:function(){var e=this.get("isSelected"),t=this.computeIsSelectedForValue(this.get("value"));if(e!==SC.MIXED_STATE&&t!==e){var n=e?"toggleOnValue":"toggleOffValue";this.set("value",this.get(n))}}.observes("isSelected"),_defaultKeyEquivalent:null,_isDefaultOrCancelDidChange:function(){var e=!!this.get("isDefault"),t=!e&&this.get("isCancel");e?this.set("keyEquivalent","return"):t?this.set("keyEquivalent","escape"):this.set("keyEquivalent",this._defaultKeyEquivalent)}.observes("isDefault","isCancel"),mouseDown:function(e){var t=this.get("buttonBehavior");return this.get("isEnabled")?(this.set("isActive",YES),this._isMouseDown=YES,t===SC.HOLD_BEHAVIOR?this._action(e):!this._isFocused&&t!==SC.PUSH_BEHAVIOR&&(this._isFocused=YES,this.becomeFirstResponder()),YES):YES},mouseExited:function(e){return this._isMouseDown&&this.set("isActive",NO),YES},mouseEntered:function(e){return this._isMouseDown&&this.set("isActive",YES),YES},mouseUp:function(e){this._isMouseDown&&this.set("isActive",NO),this._isMouseDown=!1;if(this.get("buttonBehavior")!==SC.HOLD_BEHAVIOR){var t=this.$().within(e.target);t&&this.get("isEnabled")&&this._action(e)}return YES
},touchStart:function(e){var t=this.get("buttonBehavior");return this.get("isEnabled")?(this.set("isActive",YES),t===SC.HOLD_BEHAVIOR?this._action(e):!this._isFocused&&t!==SC.PUSH_BEHAVIOR&&(this._isFocused=YES,this.becomeFirstResponder()),e.preventDefault(),YES):YES},touchesDragged:function(e,t){return this.touchIsInBoundary(e)?(this._touch_exited&&this.set("isActive",YES),this._touch_exited=NO):(this._touch_exited||this.set("isActive",NO),this._touch_exited=YES),e.preventDefault(),YES},touchEnd:function(e){return this._touch_exited=NO,this.set("isActive",NO),this.get("buttonBehavior")!==SC.HOLD_BEHAVIOR&&this.touchIsInBoundary(e)&&this.get("isEnabled")&&this._action(),e.preventDefault(),YES},keyDown:function(e){if(!this.get("isEnabled"))return YES;if(e.which===9||e.keyCode===9){var t=e.shiftKey?this.get("previousValidKeyView"):this.get("nextValidKeyView");return t?t.becomeFirstResponder():e.allowDefault(),YES}return e.which===32?(this.triggerActionAfterDelay(e),YES):(e.allowDefault(),NO)},_action:function(e,t){switch(this.get("buttonBehavior")){case SC.TOGGLE_BEHAVIOR:var n=this.get("isSelected");n?this.set("value",this.get("toggleOffValue")):this.set("value",this.get("toggleOnValue"));break;case SC.TOGGLE_ON_BEHAVIOR:this.set("value",this.get("toggleOnValue"));break;case SC.TOGGLE_OFF_BEHAVIOR:this.set("value",this.get("toggleOffValue"));break;case SC.HOLD_BEHAVIOR:this._runHoldAction(e,t);break;default:this._runAction(e)}},_runAction:function(e){var t=this.get("action"),n=this.get("target")||null,r;if(t){if(t&&SC.typeOf(t)===SC.T_FUNCTION){this.action(e);return}r=this.getPath
("pane.rootResponder"),r&&r.sendAction(t,n,this,this.get("pane"),null,this)}},_runHoldAction:function(e,t){this.get("isActive")&&(this._runAction(),t||(SC.RunLoop.begin(),this.invokeLater("_runHoldAction",this.get("holdInterval"),e),SC.RunLoop.end()))},didBecomeKeyResponderFrom:function(e){this._isFocused||(this._isFocused=YES,this.becomeFirstResponder(),this.get("isVisibleInWindow")&&this.$().focus())},willLoseKeyResponderTo:function(e){this._isFocused&&(this._isFocused=NO)},didAppendToDocument:function(){if(parseInt(SC.browser.msie,0)===7&&this.get("useStaticLayout")){var e=this.get("layout"),t=this.$(),n=0;if(t&&t[0]&&(n=t[0].clientWidth)&&n!==0&&this._labelMinWidthIE7===0){var r=this.$(".sc-button-label"),i=parseInt(r.css("paddingRight"),0),s=parseInt(r.css("paddingLeft"),0),o=parseInt(r.css("marginRight"),0),u=parseInt(r.css("marginLeft"),0);o=="auto"&&SC.Logger.log(o+","+u+","+i+","+s),!i&&isNaN(i)&&(i=0),!s&&isNaN(s)&&(s=0),!o&&isNaN(o)&&(o=0),!u&&isNaN(u)&&(u=0),this._labelMinWidthIE7=n-(i+s)-(o+u),r.css("minWidth",this._labelMinWidthIE7+"px")}else this.invokeLater(this.didAppendToDocument,1)}}}),SC.ButtonView.CLICK_AND_HOLD_DELAY=SC.browser.msie?600:300,SC.REGULAR_BUTTON_HEIGHT=24,SC.LIST_ITEM_ACTION_CANCEL="sc-list-item-cancel-action",SC.LIST_ITEM_ACTION_REFRESH="sc-list-item-cancel-refresh",SC.LIST_ITEM_ACTION_EJECT="sc-list-item-cancel-eject",SC.ListItemView=SC.View.extend(SC.InlineEditable,SC.Control,{classNames:["sc-list-item-view"],displayProperties:["disclosureState","escapeHTML"],content:null,contentIndex:null,hasContentIcon:NO,hasContentRightIcon:NO,hasContentBranch
:NO,contentCheckboxKey:null,icon:null,contentIconKey:null,rightIcon:null,contentRightIconKey:null,contentValueKey:null,escapeHTML:YES,contentUnreadCountKey:null,contentIsBranchKey:null,outlineIndent:16,outlineLevel:0,disclosureState:SC.LEAF_NODE,validator:null,contentKeys:{contentValueKey:"title",contentCheckboxKey:"checkbox",contentIconKey:"icon",contentRightIconKey:"rightIcon",contentUnreadCountKey:"count",contentIsBranchKey:"branch"},contentPropertyDidChange:function(){this.get("contentIsEditable")!==this.contentIsEditable()&&this.notifyPropertyChange("contentIsEditable"),this.displayDidChange()},contentIsEditable:function(){var e=this.get("content");return e&&(e.get?e.get("isEditable")!==NO:NO)}.property("content").cacheable(),inlineEditorDelegate:SC.InlineTextFieldDelegate,$label:function(){return this.$("label")},_isInsideElementWithClassName:function(e,t){var n=this.get("layer");if(!n)return NO;var r=SC.$(t.target),i=NO,s;while(!i&&r.length>0&&r[0]!==n)r.hasClass(e)&&(i=YES),r=r.parent();return r=n=null,i},_isInsideCheckbox:function(e){var t=this.displayDelegate,n=this.getDelegateProperty("contentCheckboxKey",t);return n&&this._isInsideElementWithClassName("sc-checkbox-view",e)},_isInsideDisclosure:function(e){return this.get("disclosureState")===SC.LEAF_NODE?NO:this._isInsideElementWithClassName("sc-disclosure-view",e)},_isInsideRightIcon:function(e){var t=this.displayDelegate,n=this.getDelegateProperty("hasContentRightIcon",t)||!SC.none(this.rightIcon);return n&&this._isInsideElementWithClassName("right-icon",e)},mouseDown:function(e){return this.get("contentIsEditable"
)?this._isInsideCheckbox(e)?(this._addCheckboxActiveState(),this._isMouseDownOnCheckbox=YES,this._isMouseInsideCheckbox=YES,YES):this._isInsideDisclosure(e)?(this._addDisclosureActiveState(),this._isMouseDownOnDisclosure=YES,this._isMouseInsideDisclosure=YES,YES):this._isInsideRightIcon(e)?(this._addRightIconActiveState(),this._isMouseDownOnRightIcon=YES,this._isMouseInsideRightIcon=YES,YES):NO:NO},mouseUp:function(e){var t=NO,n,r,i,s,o,u;if(this._isMouseDownOnCheckbox){if(this._isInsideCheckbox(e)){n=this.displayDelegate,r=this.getDelegateProperty("contentCheckboxKey",n),i=this.get("content");if(i&&i.get){var a=i.get(r);a=a===SC.MIXED_STATE?YES:!a,i.set(r,a),this.displayDidChange()}}this._removeCheckboxActiveState(),t=YES}else this._isMouseDownOnDisclosure?(this._isInsideDisclosure(e)&&(s=this.get("disclosureState"),o=this.get("contentIndex"),u=SC.none(o)?null:SC.IndexSet.create(o),n=this.get("displayDelegate"),s===SC.BRANCH_OPEN?(u&&n&&n.collapse?n.collapse(u):this.set("disclosureState",SC.BRANCH_CLOSED),this.displayDidChange()):s===SC.BRANCH_CLOSED&&(u&&n&&n.expand?n.expand(u):this.set("disclosureState",SC.BRANCH_OPEN),this.displayDidChange())),this._removeDisclosureActiveState(),t=YES):this._isMouseDownOnRightIcon&&(this._removeRightIconActiveState(),t=YES);return this._isMouseInsideCheckbox=this._isMouseDownOnCheckbox=NO,this._isMouseDownOnDisclosure=this._isMouseInsideDisclosure=NO,this._isMouseInsideRightIcon=this._isMouseDownOnRightIcon=NO,t},mouseMoved:function(e){return this._isMouseDownOnCheckbox&&this._isInsideCheckbox(e)?(this._addCheckboxActiveState(),this._isMouseInsideCheckbox=
YES):this._isMouseDownOnCheckbox?(this._removeCheckboxActiveState(),this._isMouseInsideCheckbox=NO):this._isMouseDownOnDisclosure&&this._isInsideDisclosure(e)?(this._addDisclosureActiveState(),this._isMouseInsideDisclosure=YES):this._isMouseDownOnDisclosure?(this._removeDisclosureActiveState(),this._isMouseInsideDisclosure=NO):this._isMouseDownOnRightIcon&&this._isInsideRightIcon(e)?(this._addRightIconActiveState(),this._isMouseInsideRightIcon=YES):this._isMouseDownOnRightIcon&&(this._removeRightIconActiveState(),this._isMouseInsideRightIcon=NO),NO},touchStart:function(e){return this.mouseDown(e)},touchEnd:function(e){return this.mouseUp(e)},touchEntered:function(e){return this.mouseEntered(e)},touchExited:function(e){return this.mouseExited(e)},_addCheckboxActiveState:function(){if(this.get("isEnabled"))if(this._checkboxRenderDelegate){var e=this._checkboxRenderSource;e.set("isActive",YES),this._checkboxRenderDelegate.update(e,this.$(".sc-checkbox-view"))}else this.$(".sc-checkbox-view").addClass("active")},_removeCheckboxActiveState:function(){if(this._checkboxRenderer){var e=this._checkboxRenderSource;e.set("isActive",NO),this._checkboxRenderDelegate.update(e,this.$(".sc-checkbox-view"))}else this.$(".sc-checkbox-view").removeClass("active")},_addDisclosureActiveState:function(){if(this.get("isEnabled"))if(this._disclosureRenderDelegate){var e=this._disclosureRenderSource;e.set("isActive",YES),this._disclosureRenderDelegate.update(e,this.$(".sc-disclosure-view"))}else this.$(".sc-disclosure-view").addClass("active")},_removeDisclosureActiveState:function(){if(this._disclosureRenderer
){var e=this._disclosureRenderSource;e.set("isActive",NO),this._disclosureRenderDelegate.update(e,this.$(".sc-disclosure-view"))}else this.$(".sc-disclosure-view").addClass("active")},_addRightIconActiveState:function(){this.$("img.right-icon").setClass("active",YES)},_removeRightIconActiveState:function(){this.$("img.right-icon").removeClass("active")},contentHitTest:function(e){var t=this.displayDelegate,n=this.getDelegateProperty("contentValueKey",t);if(!n)return NO;var r=this.$label()[0];if(!r)return NO;var i=e.target,s=this.get("layer");while(i&&i!==s&&i!==window){if(i===r)return YES;i=i.parentNode}return NO},beginEditing:function(e,t){var n=this.$label(),r=this.get("parentView");if(t&&this.scrollToVisible()){var i=this.get("owner"),s=this.get("contentIndex");return this.invokeLast(function(){var e=i.itemViewForContentIndex(s);e&&e.beginEditing&&e.beginEditing(NO)}),YES}return!r||!n||n.get("length")===0?NO:e()}.enhance(),inlineEditorWillBeginEditing:function(e,t,n){var r=this.get("content"),i=this.get("displayDelegate"),s=this.getDelegateProperty("contentValueKey",i),o=this.get("parentView"),u=this.$label(),a=this.get("validator"),f,l,c,h,p,d,v,m,g,y;l=s&&r?r.get?r.get(s):r[s]:r,f=this.computeFrameWithParentFrame(null),d=this._oldLineHeight=u.css("lineHeight"),h=u.css("fontSize"),p=this.$().css("top"),p?p=parseInt(p.substring(0,p.length-2),0):p=0,m=0,h&&d&&(g=h*1.5,g<d?(u.css({lineHeight:"1.5"}),m=(d-g)/2):oldLineHeight=null),u=u[0],c=SC.offset(u),f.x=c.x,f.y=c.y+p+m,f.height=u.offsetHeight,f.width=u.offsetWidth,v=this.get("escapeHTML"),e.set({value:l,exampleFrame:f,exampleElement
:u,multiline:NO,isCollection:YES,validator:a,escapeHTML:v})},inlineEditorShouldBeginEditing:function(e){return YES},inlineEditorDidBeginEditing:function(e,t,n,r){e(t,n,r);var i=this.$label();this._oldOpacity=i.css("opacity"),i.css("opacity",0),this._oldLineHeight&&i.css({lineHeight:this._oldLineHeight})}.enhance(),inlineEditorDidCommitEditing:function(e,t,n){var r=this.get("content"),i=this.displayDelegate,s=this.getDelegateProperty("contentValueKey",i);s&&r?r.set?r.set(s,t):r[s]=t:this.set("content",t),this.displayDidChange(),this._endEditing()},_endEditing:function(e){this.$label().css("opacity",this._oldOpacity),e()}.enhance(),render:function(e,t){var n=this.get("content"),r=this.displayDelegate,i=this.get("outlineLevel"),s=this.get("outlineIndent"),o,u,a,f=[];f.push(this.get("contentIndex")%2===0?"even":"odd"),e.setClass("disabled",!this.get("isEnabled")),a=e.begin("div").addClass("sc-outline"),i>=0&&s>0&&a.addStyle("left",s*(i+1)),u=this.get("disclosureState"),u!==SC.LEAF_NODE&&(this.renderDisclosure(a,u),f.push("has-disclosure")),o=this.getDelegateProperty("contentCheckboxKey",r),o&&(u=n?n.get?n.get(o):n[o]:NO,u!==null&&(this.renderCheckbox(a,u),f.push("has-checkbox"))),this.getDelegateProperty("hasContentIcon",r)?(o=this.getDelegateProperty("contentIconKey",r),u=o&&n?n.get?n.get(o):n[o]:null,this.renderIcon(a,u),f.push("has-icon")):this.get("icon")&&(u=this.get("icon"),this.renderIcon(a,u),f.push("has-icon")),o=this.getDelegateProperty("contentValueKey",r),u=o&&n?n.get?n.get(o):n[o]:n,u&&SC.typeOf(u)!==SC.T_STRING&&(u=u.toString()),this.get("escapeHTML")&&(u=SC.RenderContext
.escapeHTML(u)),this.renderLabel(a,u),this.getDelegateProperty("hasContentRightIcon",r)&&(o=this.getDelegateProperty("contentRightIconKey",r),u=o&&n?n.get?n.get(o):n[o]:null,this.renderRightIcon(a,u),f.push("has-right-icon")),o=this.getDelegateProperty("contentUnreadCountKey",r),u=o&&n?n.get?n.get(o):n[o]:null;if(!SC.none(u)&&u!==0){this.renderCount(a,u);var l=["zero","one","two","three","four","five"],c=u.toString().length,h=l.length,p=c<h?l[c]:l[h-1];f.push("has-count "+p+"-digit")}o=this.getDelegateProperty("listItemActionProperty",r),u=o&&n?n.get?n.get(o):n[o]:null,u&&(this.renderAction(a,u),f.push("has-action")),this.getDelegateProperty("hasContentBranch",r)&&(o=this.getDelegateProperty("contentIsBranchKey",r),u=o&&n?n.get?n.get(o):n[o]:NO,this.renderBranch(a,u),f.push("has-branch")),e.addClass(f),e=a.end()},renderDisclosure:function(e,t){var n=this.get("theme").disclosureRenderDelegate;e=e.begin("div").addClass("sc-disclosure-view").addClass("sc-regular-size").addClass(this.get("theme").classNames).addClass(n.get("className"));var r=this._disclosureRenderSource;r||(this._disclosureRenderSource=r=SC.Object.create({renderState:{},theme:this.get("theme")})),r.set("isSelected",t===SC.BRANCH_OPEN).set("isEnabled",this.get("isEnabled")).set("title",""),n.render(r,e),e=e.end(),this._disclosureRenderDelegate=n},renderCheckbox:function(e,t){var n=this.get("theme").checkboxRenderDelegate;e=e.begin("div").addClass("sc-checkbox-view").addClass("sc-regular-size").addClass(this.get("theme").classNames).addClass(n.get("className"));var r=this._checkboxRenderSource;r||(r=this._checkboxRenderSource=
SC.Object.create({renderState:{},theme:this.get("theme")})),r.set("isSelected",t&&t!==SC.MIXED_STATE).set("isEnabled",this.get("isEnabled")&&this.get("contentIsEditable")).set("isActive",this._checkboxIsActive).set("title",""),n.render(r,e),e=e.end(),this._checkboxRenderDelegate=n},renderIcon:function(e,t){var n=null,r=null,i=[];t&&SC.ImageView.valueIsUrl(t)?(n=t,r=""):(r=t,n=SC.BLANK_IMAGE_URL),i.push(r,"icon"),e.begin("img").addClass(i).attr("src",n).end()},renderLabel:function(e,t){e.push("<label>",t||"","</label>")},renderRightIcon:function(e,t){var n=null,r=null,i=[];t&&SC.ImageView.valueIsUrl(t)?(n=t,r=""):(r=t,n=SC.BLANK_IMAGE_URL),i.push("right-icon",r),e.begin("img").addClass(i).attr("src",n).end()},renderCount:function(e,t){e.push('<span class="count"><span class="inner">',t.toString(),"</span></span>")},renderAction:function(e,t){e.push('<img src="',SC.BLANK_IMAGE_URL,'" class="action" />')},renderBranch:function(e,t){var n=[];n.push("branch",t?"branch-visible":"branch-hidden"),e.begin("span").addClass(n).push("&nbsp;").end()}}),SC.ListItemView._deprecatedRenderWarningHasBeenIssued=!1,SC.DRAG_REORDER=16,SC.BENCHMARK_RELOAD=NO,SC.CollectionView=SC.View.extend(SC.CollectionViewDelegate,SC.CollectionContent,{classNames:["sc-collection-view"],displayProperties:["hasFirstResponder","isEnabled","isActive"],renderDelegateName:"collectionRenderDelegate",ACTION_DELAY:200,useFastPath:NO,content:null,contentBindingDefault:SC.Binding.multiple(),length:0,nowShowing:function(){return this.computeNowShowing()}.property("length","clippingFrame").cacheable(),selection:null,isSelectable
:YES,isSelectableBindingDefault:SC.Binding.bool(),isEnabled:YES,isEnabledBindingDefault:SC.Binding.bool(),isEditable:YES,isEditableBindingDefault:SC.Binding.bool(),canReorderContent:NO,canReorderContentBindingDefault:SC.Binding.bool(),canDeleteContent:NO,canDeleteContentBindingDefault:SC.Binding.bool(),canEditContent:NO,canEditContentBindingDefault:SC.Binding.bool(),isDropTarget:NO,useToggleSelection:NO,actOnSelect:NO,selectOnMouseDown:YES,exampleView:SC.ListItemView,contentExampleViewKey:null,groupExampleView:null,contentGroupExampleViewKey:null,action:null,target:null,contentValueKey:null,acceptsFirstResponder:NO,isActive:NO,calculatedHeight:0,calculatedWidth:0,computeLayout:function(){return null},layoutForContentIndex:function(e){return null},allContentIndexes:function(){return SC.IndexSet.create(0,this.get("length")).freeze()}.property("length").cacheable(),contentIndexesInRect:function(e){return null},computeNowShowing:function(){var e=this.contentIndexesInRect(this.get("clippingFrame"));if(!e)e=this.get("allContentIndexes");else{var t=this.get("length"),n=e.get("max");n>t&&(e=e.copy().remove(t,n-t).freeze())}return e},showInsertionPoint:function(e,t){},hideInsertionPoint:function(){},delegate:null,selectionDelegate:function(){var e=this.get("delegate"),t=this.get("content");return this.delegateFor("isCollectionViewDelegate",e,t)}.property("delegate","content").cacheable(),contentDelegate:function(){var e=this.get("delegate"),t=this.get("content");return this.delegateFor("isCollectionContent",e,t)}.property("delegate","content").cacheable(),_contentGroupIndexes:function(
){return this.get("contentDelegate").contentGroupIndexes(this,this.get("content"))}.property("contentDelegate","content").cacheable(),contentRangeDidChange:function(e,t,n,r){!t&&n==="[]"?(this.notifyPropertyChange("_contentGroupIndexes"),this.reload(r)):this.contentPropertyDidChange(t,n,r)},contentPropertyDidChange:function(e,t,n){},updateContentRangeObserver:function(){var e=this.get("nowShowing"),t=this._cv_contentRangeObserver,n=this.get("content");if(!n)return;if(t)n.updateRangeObserver(t,e);else{var r=this.contentRangeDidChange;t=n.addRangeObserver(e,this,r,null),this._cv_contentRangeObserver=t}},removeContentRangeObserver:function(){var e=this.get("content"),t=this._cv_contentRangeObserver;t&&(e&&e.removeRangeObserver(t),this._cv_contentRangeObserver=null)},contentLengthDidChange:function(){var e=this.get("content");this.set("length",e?e.get("length"):0)},_cv_contentDidChange:function(){var e=this.get("content"),t=this.contentLengthDidChange;if(e===this._content)return;this.removeContentRangeObserver(),this._content&&this._content.removeObserver("length",this,t),this._content=e,e&&e.addObserver("length",this,t),this.contentLengthDidChange(),this.contentRangeDidChange(e,null,"[]",null)}.observes("content"),_invalidIndexes:NO,reload:function(e){var t=this._invalidIndexes;return e&&t!==YES?t?t.add(e):t=this._invalidIndexes=e.clone():this._invalidIndexes=YES,this.get("isVisibleInWindow")&&this.invokeOnce(this.reloadIfNeeded),this},reloadIfNeeded:function(){var e=this._invalidIndexes;if(!e||!this.get("isVisibleInWindow"))return this;this._invalidIndexes=NO;var t=this.get("content"
),n,r,i,s=this.computeLayout(),o=SC.BENCHMARK_RELOAD,u=this.get("nowShowing"),a=this._sc_itemViews,f=this.get("containerView")||this,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C;e.isIndexSet&&e.contains(u)&&(e=YES),this.willReload&&this.willReload(e===YES?null:e),l=this.get("exampleView"),h=l?l.isReusableInCollections:NO,c=this.get("groupExampleView"),p=c?c.isReusableInCollections:NO;if(e.isIndexSet){o&&SC.Benchmark.start(o="%@#reloadIfNeeded (Partial)".fmt(this),YES),v=[],m=[],g=[],e.forEach(function(e){i=a?a[e]:null,u.contains(e)?i&&i.parentView===f?m.push(e):g.push(e):i&&i.parentView===f&&v.push(e)},this);for(n=0,r=v.length;n<r;++n)b=v[n],i=a?a[b]:null,delete a[b],T=this.get("contentDelegate"),N=this.get("_contentGroupIndexes"),C=N&&N.contains(b),C&&(C=T.contentIndexIsGroup(this,t,b)),d=C?p:h,d&&(x=C?this._GROUP_VIEW_POOL:this._VIEW_POOL,x.push(i),i.destroyLayer()),E=i.get("layer"),E&&E.parentNode&&E.parentNode.removeChild(E),f.removeChild(i),d||i.destroy();for(n=0,r=m.length;n<r;++n)b=m[n],i=a?a[b]:null,i.destroyLayer(),w=this.itemViewForContentIndex(b,YES),f.replaceChild(w,i);for(n=0,r=g.length;n<r;++n)b=g[n],w=this.itemViewForContentIndex(b,YES),f.insertBefore(w,null);o&&SC.Benchmark.end(o)}else{o&&SC.Benchmark.start(o="%@#reloadIfNeeded (Full)".fmt(this),YES),a&&(a.length=0),y=f.get("childViews"),y&&(y=y.copy()),f.beginPropertyChanges(),this.willRemoveAllChildren&&this.willRemoveAllChildren(),f.destroyLayer().removeAllChildren();if(y)for(n=0,r=y.length;n<r;++n)w=y[n],C=w.get("isGroupView"),d=C?p:h,d?(x=C?this._GROUP_VIEW_POOL:this._VIEW_POOL,x.push(w),w.destroyLayer()):w.destroy
();y=[],u.forEach(function(e){y.push(this.itemViewForContentIndex(e,YES))},this),f.set("childViews",y),f.replaceLayer(),f.endPropertyChanges(),o&&SC.Benchmark.end(o)}return s&&this.adjust(s),this.didReload&&this.didReload(e===YES?null:e),this},_TMP_ATTRS:{},_COLLECTION_CLASS_NAMES:["sc-collection-item"],_GROUP_COLLECTION_CLASS_NAMES:["sc-collection-item","sc-group-item"],_VIEW_POOL:null,_GROUP_VIEW_POOL:null,itemViewForContentIndex:function(e,t){var n,r=this._sc_itemViews;if(!r)r=this._sc_itemViews=[];else if(!t&&(n=r[e]))return n;var i=this.get("content"),s=i.objectAt(e),o=this.get("contentDelegate"),u=this.get("_contentGroupIndexes"),a=NO,f,l,c,h,p,d,v,m,g,y,b,w,E;a=u&&u.contains(e),a&&(a=o.contentIndexIsGroup(this,i,e)),a?(f=this.get("contentGroupExampleViewKey"),f&&s&&(l=s.get(f)),l||(l=this.get("groupExampleView")||this.get("exampleView")),p="_GROUP_VIEW_POOL"):(f=this.get("contentExampleViewKey"),f&&s&&(l=s.get(f)),l||(l=this.get("exampleView")),p="_VIEW_POOL"),m=this.get("containerView")||this,h=this.layerIdFor(e),g=o.contentIndexIsEnabled(this,i,e),y=o.contentIndexIsSelected(this,i,e),b=o.contentIndexOutlineLevel(this,i,e),w=o.contentIndexDisclosureState(this,i,e),E=this.isVisibleInWindow,c=this.layoutForContentIndex(e),l&&l.isReusableInCollections&&(d=this[p],d||(d=this[p]=[]),d.length>0&&(n=d.pop(),v=n.prepareForReuse,v&&v.call(n),n.beginPropertyChanges(),n.set("contentIndex",e),n.set("layerId",h),n.set("isEnabled",g),n.set("isSelected",y),n.set("outlineLevel",b),n.set("disclosureState",w),n.set("isVisibleInWindow",E),n.set("parentView",m),SC.View.views[h]=n,c?n.set
("layout",c):n.set("layout",l.prototype.layout),n.set("content",s),n.endPropertyChanges()));if(!n){var S=this._TMP_ATTRS;S.contentIndex=e,S.content=s,S.owner=S.displayDelegate=this,S.parentView=m,S.page=this.page,S.layerId=h,S.isEnabled=g,S.isSelected=y,S.outlineLevel=b,S.disclosureState=w,S.isGroupView=a,S.isVisibleInWindow=E,a?S.classNames=this._GROUP_COLLECTION_CLASS_NAMES:S.classNames=this._COLLECTION_CLASS_NAMES,c?S.layout=c:delete S.layout,n=this.createItemView(l,e,S)}return r[e]=n,n},itemViewForContentObject:function(e){return this.itemViewForContentIndex(this.get("content").indexOf(e))},_TMP_LAYERID:[],createItemView:function(e,t,n){return e.create(n)},layerIdFor:function(e){var t=this._TMP_LAYERID;return t[0]=SC.guidFor(this),t[1]=e,t.join("-")},contentIndexForLayerId:function(e){if(!e||!(e=e.toString()))return null;var t=this._baseLayerId;t||(t=this._baseLayerId=SC.guidFor(this)+"-");if(e.length<=t.length||e.indexOf(t)!==0)return null;var n=Number(e.slice(e.lastIndexOf("-")+1));return isNaN(n)?null:n},itemViewForEvent:function(e){var t=this.getPath("pane.rootResponder");if(!t)return null;var n=SC.guidFor(this)+"-",r=n.length,i=e.target,s=this.get("layer"),o=null,u,a,f;while(i&&i!==document&&i!==s){u=i?SC.$(i).attr("id"):null;if(u&&(o=this.contentIndexForLayerId(u))!==null)break;i=i.parentNode}if(o===null||i===s)return i=s=null,null;if(o>=this.get("length"))throw"layout for item view %@ was found when item view does not exist (%@)".fmt(u,this);return this.itemViewForContentIndex(o)},expand:function(e){if(!e)return this;var t=this.get("contentDelegate"),n=this.get("content"
);return e.forEach(function(e){var r=t.contentIndexDisclosureState(this,n,e);r===SC.BRANCH_CLOSED&&t.contentIndexExpand(this,n,e)},this),this},collapse:function(e){if(!e)return this;var t=this.get("contentDelegate"),n=this.get("content");return e.forEach(function(e){var r=t.contentIndexDisclosureState(this,n,e);r===SC.BRANCH_OPEN&&t.contentIndexCollapse(this,n,e)},this),this},_cv_selectionDidChange:function(){var e=this.get("selection"),t=this._cv_selection,n=this._cv_selectionContentDidChange;if(e===t)return;t&&t.removeObserver("[]",this,n),e&&e.addObserver("[]",this,n),this._cv_selection=e,this._cv_selectionContentDidChange()}.observes("selection"),_cv_selectionContentDidChange:function(){var e=this.get("selection"),t=this._cv_selindexes,n=this.get("content"),r;this._cv_selindexes=e?e.frozenCopy():null,t&&(t=t.indexSetForSource(n)),e&&(e=e.indexSetForSource(n)),e&&t?r=e.without(t).add(t.without(e)):r=e||t,r&&r.get("length")>0&&this.reloadSelectionIndexes(r)},_invalidSelection:NO,reloadSelectionIndexes:function(e){var t=this._invalidSelection;return e&&t!==YES?t?t.add(e):t=this._invalidSelection=e.copy():this._invalidSelection=YES,this.get("isVisibleInWindow")&&this.invokeOnce(this.reloadSelectionIndexesIfNeeded),this},reloadSelectionIndexesIfNeeded:function(){var e=this._invalidSelection;if(!e||!this.get("isVisibleInWindow"))return this;var t=this.get("nowShowing"),n=this._invalidIndexes,r=this.get("content"),i=this.get("selection");return this._invalidSelection=NO,n===YES||!t?this:(e===YES&&(e=t),n&&n.isIndexSet&&(e=e.without(n)),e.forEach(function(e){if(!t.contains(e))return;
var n=this.itemViewForContentIndex(e,NO);n&&n.set("isSelected",i?i.contains(r,e):NO)},this),this)},select:function(e,t){var n=this.get("content"),r=this.get("selectionDelegate"),i=this.get("_contentGroupIndexes"),s;if(!this.get("isSelectable")||!this.get("isEnabled"))return this;SC.typeOf(e)===SC.T_NUMBER&&(e=SC.IndexSet.create(e,1));if(e&&e.get("length")>0){i&&i.get("length")>0&&(e=e.copy().remove(i)),e=r.collectionViewShouldSelectIndexes(this,e,t);if(!e||e.get("length")===0)return this}else e=null;return t&&(s=this.get("selection"))?s=s.copy():s=SC.SelectionSet.create(),e&&e.get("length")>0&&(e.get("length")===1?s.addObject(n.objectAt(e.get("firstObject"))):s.add(n,e)),s=r.collectionViewSelectionForProposedSelection(this,s),s||(s=SC.SelectionSet.create()),this._selectionAnchor=null,this.set("selection",s.freeze()),this},deselect:function(e){var t=this.get("selection"),n=this.get("content"),r=this.get("selectionDelegate");return!this.get("isSelectable")||!this.get("isEnabled")?this:!t||t.get("length")===0?this:(SC.typeOf(e)===SC.T_NUMBER&&(e=SC.IndexSet.create(e,1)),e=r.collectionViewShouldDeselectIndexes(this,e),!e||e.get("length")===0?this:(t=t.copy().remove(n,e),t=r.collectionViewSelectionForProposedSelection(this,t),t||(t=SC.SelectionSet.create()),this.set("selection",t.freeze()),this))},_findNextSelectableItemFromIndex:function(e,t){var n=this.get("length"),r=SC.IndexSet.create(),i=this.get("content"),s=this.get("selectionDelegate"),o=this.get("_contentGroupIndexes"),u,a;if(!o&&s.collectionViewShouldSelectIndexes===SC.CollectionView.prototype.collectionViewShouldSelectIndexes
)return e;while(e<n){if(!o||!o.contains(e)){r.add(e),u=s.collectionViewShouldSelectIndexes(this,r);if(u&&u.get("length")>=1)return e;r.remove(e)}e++}return t===undefined&&(a=this.get("selection"),t=a?a.get("max"):-1),t},_findPreviousSelectableItemFromIndex:function(e,t){var n=SC.IndexSet.create(),r=this.get("content"),i=this.get("selectionDelegate"),s=this.get("_contentGroupIndexes"),o;SC.none(e)&&(e=-1);if(!s&&i.collectionViewShouldSelectIndexes===SC.CollectionView.prototype.collectionViewShouldSelectIndexes)return e;while(e>=0){if(!s||!s.contains(e)){n.add(e),o=i.collectionViewShouldSelectIndexes(this,n);if(o&&o.get("length")>=1)return e;n.remove(e)}e--}if(t===undefined){var u=this.get("selection");t=u?u.get("min"):-1}return SC.none(t)&&(t=-1),t},selectPreviousItem:function(e,t){SC.none(t)&&(t=1),SC.none(e)&&(e=!1);var n=this.get("selection"),r=this.get("content");n&&(n=n.indexSetForSource(r));var i=n?n.get("min"):-1,s=n?n.get("max")-1:-1,o=this._selectionAnchor;SC.none(o)&&(o=i);if(e){s>o?s-=t:i=this._findPreviousSelectableItemFromIndex(i-t);if(SC.none(i)||i<0)i=0;r.objectAt(i)||(i=n?n.get("min"):-1),s<i&&(s=i)}else{i=this._findPreviousSelectableItemFromIndex(i-t);if(SC.none(i)||i<0)i=0;r.objectAt(i)||(i=n?n.get("min"):-1),s=i,o=null}var u=i;return n=SC.IndexSet.create(i,s+1-i),this.scrollToContentIndex(u),this.select(n),this._selectionAnchor=o,this},selectNextItem:function(e,t){SC.none(t)&&(t=1),SC.none(e)&&(e=!1);var n=this.get("selection"),r=this.get("content");n&&(n=n.indexSetForSource(r));var i=n?n.get("min"):-1,s=n?n.get("max")-1:-1,o=this._selectionAnchor,u=this.get
("length");SC.none(o)&&(o=i),e?(i<o?i+=t:s=this._findNextSelectableItemFromIndex(s+t,s),s>=u&&(s=u-1),r.objectAt(s)||(s=n?n.get("max")-1:-1),i>s&&(i=s)):(s=this._findNextSelectableItemFromIndex(s+t,s),s>=u&&(s=u-1),r.objectAt(s)||(s=n?n.get("max")-1:-1),i=s,o=null);var a=s;return n=SC.IndexSet.create(i,s-i+1),this.scrollToContentIndex(a),this.select(n),this._selectionAnchor=o,this},deleteSelection:function(){if(!this.get("canDeleteContent"))return NO;var e=this.get("selection"),t=this.get("content"),n=this.get("selectionDelegate"),r=e&&t?e.indexSetForSource(t):null;return!t||!r||r.get("length")===0?NO:(r=n.collectionViewShouldDeleteIndexes(this,r),!r||r.get("length")===0?NO:(n.collectionViewDeleteContent(this,this.get("content"),r),YES))},scrollToContentIndex:function(e){var t=this.itemViewForContentIndex(e);return t&&this.scrollToItemView(t),this},scrollToItemView:function(e){return e&&e.scrollToVisible(),this},keyDown:function(e){var t=this.interpretKeyEvents(e);return t?t:NO},keyUp:function(){return!0},insertText:function(e,t){if(e===" "){var n=this.get("selection");return n&&n.get("length")>0&&this.invokeLater(this._cv_action,0,null,t),YES}return NO},selectAll:function(e){var t=this.get("content"),n=t?SC.IndexSet.create(0,t.get("length")):null;return this.select(n,NO),YES},deselectAll:function(){var e=this.get("content"),t=e?SC.IndexSet.create(0,e.get("length")):null;return this.deselect(t,NO),YES},deleteBackward:function(e){return this.deleteSelection()},deleteForward:function(e){return this.deleteSelection()},moveDown:function(e,t){return this.selectNextItem(!1,this.get
("itemsPerRow")||1),this._cv_performSelectAction(null,t,this.ACTION_DELAY),!0},moveUp:function(e,t){return this.selectPreviousItem(!1,this.get("itemsPerRow")||1),this._cv_performSelectAction(null,t,this.ACTION_DELAY),!0},moveLeft:function(e){if(e.ctrlKey||e.metaKey)return NO;if((this.get("itemsPerRow")||1)>1)this.selectPreviousItem(!1,1),this._cv_performSelectAction(null,e,this.ACTION_DELAY);else{var t=this.get("selection"),n=this.get("content"),r=t?t.indexSetForSource(n):null;if(r){var i=undefined,s=!1,o=undefined;if(r.get("length")===1){o=r.get("firstObject"),i=this.get("contentDelegate");var u=i.contentIndexDisclosureState(this,n,o);u!==SC.BRANCH_OPEN&&(s=!0)}if(s){var a=i.contentIndexOutlineLevel(this,n,o)-1;if(a>=0){var f=-1;while(f<0){var l=this._findPreviousSelectableItemFromIndex(o-1);if(l<0)return!1;o=l;var c=i.contentIndexOutlineLevel(this,n,o);c===a&&(f=l)}f!==-1&&this.select(o)}}else this.collapse(r)}}return!0},moveRight:function(e){if(e.ctrlKey||e.metaKey)return NO;if((this.get("itemsPerRow")||1)>1)this.selectNextItem(!1,1),this._cv_performSelectAction(null,e,this.ACTION_DELAY);else{var t=this.get("selection"),n=this.get("content"),r=t?t.indexSetForSource(n):null;r&&this.expand(r)}return!0},moveDownAndModifySelection:function(e,t){return this.selectNextItem(!0,this.get("itemsPerRow")||1),this._cv_performSelectAction(null,t,this.ACTION_DELAY),!0},moveUpAndModifySelection:function(e,t){return this.selectPreviousItem(!0,this.get("itemsPerRow")||1),this._cv_performSelectAction(null,t,this.ACTION_DELAY),!0},moveLeftAndModifySelection:function(e,t){return(this.get("itemsPerRow"
)||1)>1&&(this.selectPreviousItem(!0,1),this._cv_performSelectAction(null,t,this.ACTION_DELAY)),!0},moveRightAndModifySelection:function(e,t){return(this.get("itemsPerRow")||1)>1&&(this.selectNextItem(!0,1),this._cv_performSelectAction(null,t,this.ACTION_DELAY)),!0},insertNewline:function(e,t){var n=this.get("isEditable")&&this.get("canEditContent"),r,i,s,o,u;return n&&(r=this.get("selection"),i=this.get("content"),r&&r.get("length")===1&&(s=r.indexSetForSource(i),o=s?s.get("min"):-1,n=o>=0)),n&&(u=this.itemViewForContentIndex(o),n=u&&SC.typeOf(u.beginEditing)===SC.T_FUNCTION),n?(this.scrollToContentIndex(o),u=this.itemViewForContentIndex(o),u.beginEditing()):this.invokeLater(this._cv_action,0,u,null),YES},insertTab:function(e){var t=this.get("nextValidKeyView");return t?t.becomeFirstResponder():e.allowDefault(),YES},insertBacktab:function(e){var t=this.get("previousValidKeyView");return t?t.becomeFirstResponder():e.allowDefault(),YES},mouseDown:function(e){var t=this.itemViewForEvent(e),n=this.get("content"),r=t?t.get("contentIndex"):-1,i,s,o,u,a,f=NO,l=n.get("allowsMultipleSelection");if(!this.get("isEnabled"))return r>-1;if(!this.get("isSelectable"))return NO;this.becomeFirstResponder();if(this.get("useToggleSelection")){if(this.get("selectOnMouseDown")){if(!t)return;o=this.get("selection"),u=o&&o.containsObject(t.get("content")),u?this.deselect(r):l?(this.select(r,YES),f=YES):(this.select(r,NO),f=YES),f&&this.get("actOnSelect")&&this._cv_performSelectAction(t,e)}return YES}return t?(o=this.get("selection"),o&&(o=o.indexSetForSource(n)),i=this.mouseDownInfo={event:e,itemView
:t,contentIndex:r,at:Date.now()},u=o?o.contains(r):NO,i.modifierKeyPressed=a=e.ctrlKey||e.metaKey,a&&u?i.shouldDeselect=r>=0:e.shiftKey&&o&&o.get("length")>0&&l?(o=this._findSelectionExtendedByShift(o,r),s=this._selectionAnchor,this.select(o),this._selectionAnchor=s):!a&&u?i.shouldReselect=r>=0:((e.shiftKey||a)&&!l&&this.select(null,!1),this.get("selectOnMouseDown")?this.select(r,a):i.shouldSelect=r>=0),i.previousContentIndex=r,YES):(this.get("allowDeselectAll")&&this.select(null,!1),YES)},mouseUp:function(e){var t=this.itemViewForEvent(e),n=this.mouseDownInfo,r=this.get("content"),i=t?t.get("contentIndex"):-1,s,o,u,a,f,l=r.get("allowsMultipleSelection");if(!this.get("isEnabled"))return i>-1;if(!this.get("isSelectable"))return NO;if(this.get("useToggleSelection")){if(!t||this.get("selectOnMouseDown"))return NO;s=this.get("selection"),o=s&&s.containsObject(t.get("content")),o?this.deselect(i):l?this.select(i,YES):this.select(i,NO)}else n&&(f=n.contentIndex,i=t?t.get("contentIndex"):-1,n.shouldSelect&&this.select(f,n.modifierKeyPressed),n.shouldDeselect&&this.deselect(f),n.shouldReselect&&(u=this.get("isEditable")&&this.get("canEditContent"),u&&(s=this.get("selection"),u=s&&s.get("length")===1),u&&(a=this.itemViewForContentIndex(f),u=a&&(!a.contentHitTest||a.contentHitTest(e)),u=u&&a.beginEditing?a.beginEditing():NO),u||(this._cv_reselectTimer&&this._cv_reselectTimer.invalidate(),this._cv_reselectTimer=this.invokeLater(this.select,300,f,!1))),this._cleanupMouseDown());return this._cv_performSelectAction(t,e,0,e.clickCount),NO},_cleanupMouseDown:function(){var e=this.mouseDownInfo
,t;if(e)for(t in e){if(!e.hasOwnProperty(t))continue;delete e[t]}this.mouseDownInfo=null},mouseMoved:function(e){var t=this.itemViewForEvent(e),n=this._lastHoveredItem;return t!==n&&(n&&n.mouseExited&&n.mouseExited(e),t&&t.mouseEntered&&t.mouseEntered(e)),this._lastHoveredItem=t,t&&t.mouseMoved&&t.mouseMoved(e),YES},mouseExited:function(e){var t=this._lastHoveredItem;return this._lastHoveredItem=null,t&&t.mouseExited&&t.mouseExited(e),YES},touchStart:function(e,t){var n=this.itemViewForEvent(e),r=n?n.get("contentIndex"):-1;return this.get("isEnabled")?(this.becomeFirstResponder(),this._touchSelectedView=n,this.get("useToggleSelection")||n&&!n.get("isSelected")&&n.set("isSelected",YES),YES):r>-1},touchesDragged:function(e,t){t.forEach(function(e){(Math.abs(e.pageX-e.startX)>5||Math.abs(e.pageY-e.startY)>5)&&e.makeTouchResponder(e.nextTouchResponder)},this)},touchEnd:function(e){var t=this._touchSelectedView,n=t?t.get("contentIndex"):-1,r=NO,i;if(!this.get("isEnabled"))return n>-1;t&&t.set("isSelected",NO),n>-1&&(this.get("useToggleSelection")&&(i=this.get("selection"),r=i&&i.containsObject(t.get("content"))),r?this.deselect(n):(this.select(n,NO),this._cv_performSelectAction(t,e,0))),this._touchSelectedView=null},touchCancelled:function(e){this._touchSelectedView&&(this._touchSelectedView.set("isSelected",NO),this._touchSelectedView=null)},_findSelectionExtendedByShift:function(e,t){if(!e||e.get("length")===0)return SC.IndexSet.create(t);var n=this.get("content"),r=n.get("length")-1,i=e.get("min"),s=e.get("max")-1,o=this.mouseDownInfo,u=this._selectionAnchor;return SC.none(u)&&
(u=-1),t<i?(i=t,u<0&&(this._selectionAnchor=u=s)):t>s?(s=t,u<0&&(this._selectionAnchor=u=i)):t>=i&&t<=s&&(u<0&&(this._selectionAnchor=u=i),t===u?i=s=t:t>u?(i=u,s=t):t<u&&(i=t,s=u)),SC.IndexSet.create(i,s-i+1)},reorderDataType:function(){return"SC.CollectionView.Reorder."+SC.guidFor(this)}.property().cacheable(),dragContent:null,proposedInsertionIndex:null,proposedDropOperation:null,mouseDragged:function(e){var t=this.get("selectionDelegate"),n=this.get("content"),r=this.get("selection"),i=this.mouseDownInfo,s=this.get("_contentGroupIndexes"),o,u,a,f,l;if(!i||i.contentIndex<0)return YES;if(Date.now()-i.at<123)return YES;if(t.collectionViewShouldBeginDrag(this))return this.get("selectOnMouseDown")?(o=r?r.indexSetForSource(n):null,l=r):(o=SC.IndexSet.create(i.contentIndex),f=r?r.indexSetForSource(n):null,f&&f.contains(o)?(o=f,l=r):(l=SC.SelectionSet.create(),l.addObjects([i.itemView.get("content")]))),o&&s&&s.get("length")>0&&(o=o.copy().remove(s),o.get("length")===0?o=null:o.freeze()),o?(o=o.frozenCopy(),o={content:n,indexes:o,contentDragged:l},this.set("dragContent",o),u=this.get("dragDataTypes"),u&&u.get("length")>0?(a=t.collectionViewDragViewFor(this,o.indexes),a||(a=this._cv_dragViewFor(o.indexes)),a.createLayer(),SC.Drag.start({event:i.event,source:this,dragView:a,ghost:NO,ghostActsLikeCursor:t.ghostActsLikeCursor,slideBack:YES,dataSource:this}),this._cleanupMouseDown(),this._lastInsertionIndex=null):this.set("dragContent",null),YES):YES},_cv_dragViewFor:function(e){var t=this.get("nowShowing").without(e),n=this.get("layer").cloneNode(!1),r=SC.View.create({layer:n,parentView
:this}),i=0,s;return t=this.get("nowShowing").without(t),SC.$(n).css("backgroundColor","transparent").css("border","none").css("top",0).css("left",0),t.forEach(function(e){var t=this.itemViewForContentIndex(e),r,o;t&&(r=t.get("isSelected"),t.set("isSelected",NO),t.updateLayerIfNeeded(),o=t.get("layer"),o&&(o=o.cloneNode(!0)),t.set("isSelected",r),t.updateLayerIfNeeded()),o&&(n.appendChild(o),s=t.get("layout"),s.height+s.top>i&&(i=s.height+s.top)),o=null},this),r.set("layout",{height:i}),n=null,r},dragDataTypes:function(){var e=this.get("selectionDelegate"),t=e.collectionViewDragDataTypes(this),n;return this.get("canReorderContent")&&(t=t?t.copy():[],n=this.get("reorderDataType"),t.indexOf(n)<0&&t.push(n)),t?t:[]}.property(),dragDataForType:function(e,t){if(this.get("canReorderContent")&&t===this.get("reorderDataType"))return this.get("dragContent");var n=this.get("selectionDelegate");return n.collectionViewDragDataForType(this,e,t)},computeDragOperations:function(e,t){var n=SC.DRAG_NONE,r=this.get("selectionDelegate");return this.get("canReorderContent")&&e.get("dataTypes").indexOf(this.get("reorderDataType"))>=0&&(n=SC.DRAG_REORDER),n=r.collectionViewComputeDragOperations(this,e,n),n&SC.DRAG_REORDER&&(n=SC.DRAG_MOVE),n},_computeDropOperationState:function(e,t,n){var r=this.convertFrameFromView(e.get("location"),null),i=SC.DROP_BEFORE,s=this.get("selectionDelegate"),o=this.get("canReorderContent"),u,a,f,l,c,h,p=this.insertionIndexForLocation(r,SC.DROP_ON);SC.typeOf(p)===SC.T_ARRAY&&(i=p[1],p=p[0]);if(i===SC.DROP_ON){this.set("proposedInsertionIndex",p),this.set("proposedDropOperation"
,i),h=s.collectionViewValidateDragOperation(this,e,n,p,i),p=this.get("proposedInsertionIndex"),i=this.get("proposedDropOperation"),this._dropInsertionIndex=this._dropOperation=null;if(h!==SC.DRAG_NONE)return[p,i,h];i=SC.DROP_BEFORE,p=this.insertionIndexForLocation(r,SC.DROP_BEFORE),SC.typeOf(p)===SC.T_ARRAY&&(i=p[1],p=p[0])}if(p>=0&&o&&i!==SC.DROP_ON){u=e.dataForType(this.get("reorderDataType"));if(u){a=this.get("content"),i===SC.DROP_BEFORE?(f=u.indexes.contains(p-1),l=u.indexes.contains(p)):(f=u.indexes.contains(p),l=u.indexes.contains(p-1));if(f&&l)if(SC.none(this._lastInsertionIndex))if(i===SC.DROP_BEFORE)while(p>=0&&u.indexes.contains(p))p--;else{c=a?a.get("length"):0;while(p<c&&u.indexes.contains(p))p++}else p=this._lastInsertionIndex;p>=0&&(n=SC.DRAG_REORDER)}}return this.set("proposedInsertionIndex",p),this.set("proposedDropOperation",i),n=s.collectionViewValidateDragOperation(this,e,n,p,i),p=this.get("proposedInsertionIndex"),i=this.get("proposedDropOperation"),this._dropInsertionIndex=this._dropOperation=null,[p,i,n]},dragUpdated:function(e,t){var n=e.get("allowedDragOperations"),r=this._computeDropOperationState(e,t,n),i=r[0],s=r[1],o=r[2];if(o!==SC.DRAG_NONE){if(this._lastInsertionIndex!==i||this._lastDropOperation!==s){var u=this.itemViewForContentIndex(i);this.showInsertionPoint(u,s)}this._lastInsertionIndex=i,this._lastDropOperation=s}else this.hideInsertionPoint(),this._lastInsertionIndex=this._lastDropOperation=null;return o&SC.DRAG_REORDER?SC.DRAG_MOVE:o},dragExited:function(){this.hideInsertionPoint(),this._lastInsertionIndex=this._lastDropOperation=null},
acceptDragOperation:function(e,t){return YES},performDragOperation:function(e,t){var n=this._computeDropOperationState(e,null,t),r=n[0],i=n[1],s=n[2],o=this.get("selectionDelegate"),u,a,f,l,c,h;s&SC.DRAG_REORDER?t=t&SC.DRAG_MOVE?SC.DRAG_REORDER:SC.DRAG_NONE:t&=s;if(t===SC.DRAG_NONE)return t;u=o.collectionViewPerformDragOperation(this,e,t,r,i);if(u===SC.DRAG_NONE&&t&SC.DRAG_REORDER){f=e.dataForType(this.get("reorderDataType"));if(!f)return SC.DRAG_NONE;l=this.get("content"),h=f.indexes;if(h.get("length")===1&&(i===SC.DROP_BEFORE||i===SC.DROP_AFTER)&&h.get("min")===r)return SC.DRAG_MOVE;l.beginPropertyChanges(),a=[],c=0,f.indexes.forEach(function(e){a.push(l.objectAt(e-c)),l.removeAt(e-c),c++,e<r&&r--},this),i===SC.DROP_AFTER&&r++,l.replace(r,0,a,i),this.select(SC.IndexSet.create(r,a.length)),l.endPropertyChanges(),t=SC.DRAG_MOVE}return t},collectionViewShouldBeginDrag:function(e){return this.get("canReorderContent")},insertionIndexForLocation:function(e,t){return-1},_cv_isVisibleInWindowDidChange:function(){this.get("isVisibleInWindow")&&(this._invalidIndexes&&this.invokeOnce(this.reloadIfNeeded),this._invalidSelection&&this.invokeOnce(this.reloadSelectionIndexesIfNeeded))}.observes("isVisibleInWindow"),collectionViewShouldSelectItem:function(e,t){return this.get("isSelectable")},_TMP_DIFF1:SC.IndexSet.create(),_TMP_DIFF2:SC.IndexSet.create(),_cv_nowShowingDidChange:function(){var e=this.get("nowShowing"),t=this._sccv_lastNowShowing,n,r,i;t!==e&&(t&&e?(r=this._TMP_DIFF1.add(t).remove(e),i=this._TMP_DIFF2.add(e).remove(t),n=r.add(i)):n=t||e),n&&n.get("length")>0&&(this._sccv_lastNowShowing=
e?e.frozenCopy():null,this.updateContentRangeObserver(),this.reload(n)),r&&r.clear(),i&&i.clear()}.observes("nowShowing"),init:function(){arguments.callee.base.apply(this,arguments),this.useFastPath&&this.mixin(SC.CollectionFastPath),this.get("canReorderContent")&&this._cv_canReorderContentDidChange(),this._sccv_lastNowShowing=this.get("nowShowing").clone(),this.content&&this._cv_contentDidChange(),this.selection&&this._cv_selectionDidChange()},_cv_canReorderContentDidChange:function(){this.get("canReorderContent")&&(this.get("isDropTarget")||this.set("isDropTarget",YES),SC.Drag.addDropTarget(this))}.observes("canReorderContent"),_cv_performSelectAction:function(e,t,n,r){var i;n===undefined&&(n=0),r===undefined&&(r=1);if(r>1||this.get("actOnSelect"))this._cv_reselectTimer&&this._cv_reselectTimer.invalidate(),i=this.get("selection"),i=i?i.toArray():[],this._cv_actionTimer&&this._cv_actionTimer.invalidate(),this._cv_actionTimer=this.invokeLater(this._cv_action,n,e,t,i)},_cv_action:function(e,t,n){var r=this.get("action"),i=this.get("target")||null;this._cv_actionTimer=null;if(r){if(SC.typeOf(r)===SC.T_FUNCTION)return this.action(e,t);var s=this.get("pane");s&&s.rootResponder.sendAction(r,i,this,s,n)}else{if(!e)return;if(SC.typeOf(e._action)==SC.T_FUNCTION)return e._action(t);if(SC.typeOf(e.action)==SC.T_FUNCTION)return e.action(t)}}}),SC.DisclosureView=SC.ButtonView.extend({classNames:["sc-disclosure-view"],renderDelegateName:"disclosureRenderDelegate",buttonBehavior:SC.TOGGLE_BEHAVIOR,toggleOnValue:YES,toggleOffValue:NO,valueBindingDefault:SC.Binding.bool(),keyDown:function(e
){if(e.which===37||e.which===38)return this.set("value",this.get("toggleOffValue")),YES;if(e.which===39||e.which===40)return this.set("value",this.get("toggleOnValue")),YES;arguments.callee.base.apply(this,arguments)}}),SC.ListView=SC.CollectionView.extend(SC.CollectionRowDelegate,{classNames:["sc-list-view"],acceptsFirstResponder:YES,showAlternatingRows:NO,render:function(e,t){return e.setClass("alternating",this.get("showAlternatingRows")),arguments.callee.base.apply(this,arguments)},rowDelegate:function(){var e=this.delegate,t=this.get("content");return this.delegateFor("isCollectionRowDelegate",e,t)}.property("delegate","content").cacheable(),_sclv_rowDelegateDidChange:function(){var e=this._sclv_rowDelegate,t=this.get("rowDelegate"),n=this._sclv_rowHeightDidChange,r=this._sclv_customRowHeightIndexesDidChange;if(e===t)return this;this._sclv_rowDelegate=t,e&&(e.removeObserver("rowHeight",this,n),e.removeObserver("customRowHeightIndexes",this,r));if(!t)throw"Internal Inconsistancy: ListView must always have CollectionRowDelegate";return t.addObserver("rowHeight",this,n),t.addObserver("customRowHeightIndexes",this,r),this._sclv_rowHeightDidChange()._sclv_customRowHeightIndexesDidChange(),this}.observes("rowDelegate"),_sclv_rowHeightDidChange:function(){var e=this.get("rowDelegate"),t=e.get("rowHeight"),n;return t===this._sclv_rowHeight?this:(this._sclv_rowHeight=t,n=SC.IndexSet.create(0,this.get("length")),this.rowHeightDidChangeForIndexes(n),this)},_sclv_customRowHeightIndexesDidChange:function(){var e=this.get("rowDelegate"),t=e.get("customRowHeightIndexes"),n=this._sclv_customRowHeightIndexes
,r=this._sclv_customRowHeightIndexesContentDidChange;return t===n||n&&n.isEqual(t)?this:(n&&this._sclv_isObservingCustomRowHeightIndexes&&n.removeObserver("[]",this,r),(this._sclv_isObservingCustomRowHeightIndexes=t&&!t.get("isFrozen"))&&t.addObserver("[]",this,r),this._sclv_customRowHeightIndexesContentDidChange(),this)},_sclv_customRowHeightIndexesContentDidChange:function(){var e=this.get("rowDelegate"),t=e.get("customRowHeightIndexes"),n=this._sclv_customRowHeightIndexes,r;return t&&n?r=t.copy().add(n):r=t||n,this._sclv_customRowHeightIndexes=t?t.frozenCopy():null,this.rowHeightDidChangeForIndexes(r),this},rowOffsetForContentIndex:function(e){if(e===0)return 0;var t=this.get("rowDelegate"),n=t.get("rowHeight"),r,i,s,o,u,a,f;return i=e*n,r=this.get("rowSpacing"),r&&(i+=e*r),t.customRowHeightIndexes&&(s=t.get("customRowHeightIndexes"))&&(o=this._sclv_offsetCache,o||(o=[],u=a=0,s.forEach(function(e){u+=this.rowHeightForContentIndex(e)-n,o[e+1]=u,a=e},this),this._sclv_max=a+1,this._sclv_offsetCache=o),u=o[e],u===undefined&&(u=o[e]=o[e-1],u===undefined&&(a=this._sclv_max,e<a&&(a=s.indexBefore(e)+1),u=o[e]=o[a]||0)),i+=u),i},rowHeightForContentIndex:function(e){var t=this.get("rowDelegate"),n,r,i,s;return t.customRowHeightIndexes&&(s=t.get("customRowHeightIndexes"))?(r=this._sclv_heightCache,r||(r=[],i=this.get("content"),s.forEach(function(e){r[e]=t.contentIndexRowHeight(this,i,e)},this),this._sclv_heightCache=r),n=r[e],n===undefined&&(n=t.get("rowHeight"))):n=t.get("rowHeight"),n},rowHeightDidChangeForIndexes:function(e){var t=this.get("length");return this._sclv_heightCache=
this._sclv_offsetCache=null,e&&e.isIndexSet&&(e=e.get("min")),this.reload(SC.IndexSet.create(e,t-e)),this},_sclv_lengthDidChange:function(){this.adjust(this.computeLayout())}.observes("length"),computeLayout:function(){var e=this._sclv_layout;return e||(e=this._sclv_layout={}),e.minHeight=this.rowOffsetForContentIndex(this.get("length")),this.set("calculatedHeight",e.minHeight),e},layoutForContentIndex:function(e){var t=this.get("rowDelegate");return{top:this.rowOffsetForContentIndex(e),height:this.rowHeightForContentIndex(e)-t.get("rowPadding")*2,left:0,right:0}},contentIndexesInRect:function(e){var t=this.get("rowDelegate").get("rowHeight"),n=SC.minY(e),r=SC.maxY(e),i=e.height||0,s=this.get("length"),o,u,a;u=(n-n%t)/t,o=this.rowOffsetForContentIndex(u);while(u>0&&o>n)u--,o-=this.rowHeightForContentIndex(u);o+=this.rowHeightForContentIndex(u);while(u<s&&o<=n)u++,o+=this.rowHeightForContentIndex(u);u<0&&(u=0),u>=s&&(u=s),a=u+(i-i%t)/t,a>s&&(a=s),o=this.rowOffsetForContentIndex(a);while(a>=u&&o>=r)a--,o-=this.rowHeightForContentIndex(a);o+=this.rowHeightForContentIndex(a);while(a<s&&o<r)a++,o+=this.rowHeightForContentIndex(a);return a++,a<u&&(a=u),a>s&&(a=s),SC.IndexSet.create(u,a-u)},insertionPointView:SC.View.extend({classNames:"sc-list-insertion-point",render:function(e,t){t&&e.push('<div class="anchor"></div>')}}),showInsertionPoint:function(e,t){var n=this._insertionPointView;n||(n=this._insertionPointView=this.get("insertionPointView").create());var r=e.get("contentIndex"),i=this.get("length"),s=SC.clone(e.get("layout")),o=e.get("outlineLevel"),u=e.get("outlineIndent")||0
,a;r>=i&&r>0&&(a=this.itemViewForContentIndex(i-1),a.get("isGroupView")&&(o=1,u=a.get("outlineIndent"))),SC.none(o)&&(o=-1),t&SC.DROP_ON?(this.hideInsertionPoint(),e.set("isSelected",YES),this._lastDropOnView=e):(this._lastDropOnView&&(this._lastDropOnView.set("isSelected",NO),this._lastDropOnView=null),t&SC.DROP_AFTER&&(s.top+=s.height),s.height=2,s.right=0,s.left=(o+1)*u+12,delete s.width,n.set("layout",s),this.appendChild(n))},hideInsertionPoint:function(){this._lastDropOnView&&(this._lastDropOnView.set("isSelected",NO),this._lastDropOnView=null);var e=this._insertionPointView;e&&e.removeFromParent().destroy(),this._insertionPointView=null},insertionIndexForLocation:function(e,t){var n={x:e.x,y:e.y,width:1,height:1},r=this.contentIndexesInRect(n),i=r.get("min"),s=this.get("length"),o,u,a,f,l,c,h,p,d;if(SC.none(i)||i<0)s===0||e.y<=this.rowOffsetForContentIndex(0)?i=0:e.y>=this.rowOffsetForContentIndex(s)&&(i=s);o=this.rowOffsetForContentIndex(i),u=o+this.rowHeightForContentIndex(i);if(t==SC.DROP_ON){this.get("isEditable")?a=Math.min(Math.floor((u-o)*.2),5):a=0;if(e.y>=o+a||e.y<=u+a)return[i,SC.DROP_ON]}i>0&&(p=this.itemViewForContentIndex(i-1),h=(p?p.get("outlineIndent"):0)||0,c=p?p.get("outlineLevel"):0,i<s?(p=this.itemViewForContentIndex(i),f=p?p.get("outlineLevel"):0,l=(p?p.get("outlineIndent"):0)||0,l*=f):(f=p.get("isGroupView")?1:0,l=h*f),h*=c,f!==c&&l!==h&&h>l&&(i--,t=SC.DROP_AFTER));if(t===SC.DROP_BEFORE){p=i<s?this.itemViewForContentIndex(i):null;if(!p||p.get("isGroupView"))i>0?(p=this.itemViewForContentIndex(i-1),!p.get("isGroupView")||p.get("disclosureState")===SC
.BRANCH_OPEN?(i-=1,t=SC.DROP_AFTER):i=-1):i=-1;i<0&&(t=SC.DRAG_NONE)}return[i,t]},mouseWheel:function(e){var t=SC.InlineTextFieldView,n=t&&t.editor;return n&&n.get("isEditing")&&n.get("delegate").get("displayDelegate")===this&&t.commitEditing(),NO},init:function(){arguments.callee.base.apply(this,arguments),this._sclv_rowDelegateDidChange()}}),SC.SegmentView=SC.View.extend(SC.Control,{ariaRole:"tab",isSegment:YES,classNames:["sc-segment-view"],toolTip:null,isEnabled:YES,isActive:NO,isSelected:NO,controlSize:null,supportFocusRing:NO,displayProperties:["icon","displayTitle","value","displayToolTip","isDefault","isCancel","width","isSegment","isFirstSegment","isMiddleSegment","isLastSegment","isOverflowSegment","index","needsEllipsis","isBorderless"],renderDelegateName:"segmentRenderDelegate",useStaticLayout:YES,title:"",value:null,icon:null,localize:NO,keyEquivalent:null,escapeHTML:YES,needsEllipsis:YES,displayTitle:function(){var e=this.get("title");return this.get("localize")&&(e=SC.String.loc(e)),e}.property("title","localize").cacheable(),width:null,localItem:null,isBorderless:YES,widthDidChange:function(){this.adjust("width",this.get("width"))}.observes("width"),updateItem:function(e,t){var n=e.get("itemKeys"),r,i=e.get("viewKeys"),s,o;for(o=n.get("length")-1;o>=0;o--)r=e.get(n.objectAt(o)),s=i.objectAt(o),SC.none(t.get(r))||this.set(s,t.get(r));this.set("localItem",t)}}),SC.SegmentedView=SC.View.extend(SC.Control,{acceptsFirstResponder:function(){return SC.FOCUS_ALL_CONTROLS?this.get("isEnabled"):NO}.property("isEnabled").cacheable(),_focusSelectedChildView:function(){if(
this.get("isFirstResponder")){var e=document.activeElement;e&&!$.isEmptyObject(e)&&e.blur();if(!SC.isArray(this.get("value"))){var t=this.get("childViews");for(var n=0;n<t.length;n++){var r=t[n];if(r.get("isSelected")){var i=r.get("layer");i&&i.focus();return}}}var s=this.get("layer");s&&s.focus()}}.observes("paneAttached"),didBecomeFirstResponder:function(){this._focusSelectedChildView()},ariaRole:"tablist",classNames:["sc-segmented-view"],themeName:"square",value:null,isEnabled:YES,allowsEmptySelection:NO,allowsMultipleSelection:NO,selectSegmentWhenTriggeringAction:NO,localize:YES,align:SC.ALIGN_CENTER,layoutDirection:SC.LAYOUT_HORIZONTAL,items:null,itemTitleKey:null,itemValueKey:null,itemIsEnabledKey:null,itemIconKey:null,itemWidthKey:null,itemActionKey:null,itemTargetKey:null,itemLayerIdKey:null,itemKeyEquivalentKey:null,shouldHandleOverflow:NO,overflowTitle:"&raquo;",overflowToolTip:"More...",overflowIcon:null,segmentViewClass:SC.SegmentView,itemKeys:["itemTitleKey","itemValueKey","itemIsEnabledKey","itemIconKey","itemWidthKey","itemToolTipKey","itemKeyEquivalentKey","itemLayerIdKey"],viewKeys:["title","value","isEnabled","icon","width","toolTip","keyEquivalent","layerId"],init:function(){arguments.callee.base.apply(this,arguments);var e=this.get("overflowTitle"),t=this.get("overflowToolTip"),n=this.get("overflowIcon"),r;r=this.get("segmentViewClass").create({controlSize:this.get("controlSize"),localize:this.get("localize"),title:e,toolTip:t,icon:n,isLastSegment:YES,isOverflowSegment:YES,isVisible:this.get("shouldHandleOverflow")}),this.set("overflowView",r),this.appendChild
(r),this.itemsDidChange()},shouldHandleOverflowDidChange:function(){this.get("shouldHandleOverflow")?this.invokeLast(this.remeasure):this.get("overflowView").set("isVisible",NO)}.observes("shouldHandleOverflow"),itemsDidChange:function(){var e=this.get("items")||[],t,n,r,i=this.get("childViews"),s,o=i.lastObject(),u=this.get("value"),a,f=this.get("itemKeys"),l,c=this.get("viewKeys"),h,p=this.get("segmentViewClass"),d,v;if(i.get("length")-1>e.get("length")){for(d=i.get("length")-2;d>=e.get("length");d--){s=i.objectAt(d),SC.isArray(u)?u.removeObject(s.get("value")):u===s.get("value")&&(u=null),n=s.get("localItem");for(v=f.get("length")-1;v>=0;v--)l=this.get(f.objectAt(v)),l&&n.removeObserver(l,this,this.itemContentDidChange);this.removeChild(s)}this.set("value",u)}else if(i.get("length")-1<e.get("length"))for(d=i.get("length")-1;d<e.get("length");d++)s=p.create({controlSize:this.get("controlSize"),localize:this.get("localize")}),this.insertBefore(s,o);i=this.get("childViews");var m=this.get("isEnabled");for(d=0;d<e.get("length");d++){n=e.objectAt(d),s=i.objectAt(d),r=s.get("localItem");if(r&&!e.contains(r))for(v=f.get("length")-1;v>=0;v--)l=this.get(f.objectAt(v)),l&&r.removeObserver(l,this,this.itemContentDidChange);if(SC.none(n))continue;if(SC.typeOf(n)===SC.T_STRING)n=SC.Object.create({title:n.humanize().titleize(),value:n}),this.set("itemTitleKey","title"),this.set("itemValueKey","value");else if(SC.typeOf(n)===SC.T_HASH)n=SC.Object.create(n);else if(n instanceof SC.Object)for(v=f.get("length")-1;v>=0;v--)l=this.get(f.objectAt(v)),l&&(n.removeObserver(l,this,this.itemContentDidChange
),n.addObserver(l,this,this.itemContentDidChange,d));else SC.Logger.error("SC.SegmentedView items may be Strings, Objects (ie. Hashes) or SC.Objects only");a=NO;if(SC.isArray(u)?u.indexOf(n.get(this.get("itemValueKey")))>=0:u===n.get(this.get("itemValueKey")))a=YES;s.set("isSelected",a),s.setIfChanged("isEnabled",m),s.set("index",d),s.set("isFirstSegment",d===0),s.set("isMiddleSegment",d<e.get("length")-1&&d>0),s.set("isLastSegment",d===e.get("length")-1),s.updateItem(this,n)}this.get("shouldHandleOverflow")&&this.invokeLast(this.remeasure)}.observes("*items.[]"),itemContentDidChange:function(e,t,n,r){var i=this.get("items"),s=this.get("childViews"),o;o=s.objectAt(r),o?o.updateItem(this,e):SC.Logger.warn("Item content change was observed on item without matching segment child view."),this.get("shouldHandleOverflow")&&this.invokeLast(this.remeasure)},viewDidResize:function(){var e=this.$().width();this.get("shouldHandleOverflow")&&(this.isOverflowing||e<=this.cachedMinimumWidth)&&this.adjustOverflow()},isVisibleInWindowDidChange:function(){this.get("shouldHandleOverflow")&&this.invokeLast(this.remeasure)}.observes("isVisibleInWindow"),remeasure:function(){if(!this.get("shouldHandleOverflow"))return;var e=this.get("renderDelegate"),t=this.get("childViews"),n;if(this.get("isVisibleInWindow")){n=t.lastObject(),n.set("isVisible",YES);for(var r=t.get("length")-1;r>=0;r--)t.objectAt(r).set("isVisible",YES);this.cachedWidths=e.segmentWidths(this),this.cachedOverflowWidth=e.overflowSegmentWidth(this),this.adjustOverflow()}},adjustOverflow:function(){if(!this.get("shouldHandleOverflow"
))return;var e=this.get("childViews"),t,n=this.get("value"),r=e.lastObject(),i=this.$().width(),s=0,o,u,a;this.isOverflowing=NO,r.set("isSelected",NO),this.overflowItems=[],u=this.cachedWidths.length;for(a=0;a<u;a++)t=e.objectAt(a),s+=this.cachedWidths[a],o=a===u-1?s:s+this.cachedOverflowWidth,o>i?(this.overflowItems.pushObject(t.get("localItem")),this.isOverflowing=YES,t.set("isVisible",NO),a===0&&r.set("isFirstSegment",YES),(SC.isArray(n)?n.indexOf(t.get("value"))>=0:n===t.get("value"))&&r.set("isSelected",YES)):(t.set("isVisible",YES),a===0&&r.set("isFirstSegment",NO));this.isOverflowing?r.set("isVisible",YES):r.set("isVisible",NO),this.cachedMinimumWidth=s+this.cachedOverflowWidth},displayProperties:["align"],renderDelegateName:"segmentedRenderDelegate",displayItemIndexForEvent:function(e){var t=this.get("renderDelegate");if(t&&t.indexForClientPosition){var n=e.clientX,r=e.clientY;if(n===0&&r===0){var i=e.target;if(i){var s=SC.offset(i);n=s.x+Math.round(i.offsetWidth/2),r=s.y+Math.round(i.offsetHeight/2)}}return t.indexForClientPosition(this,n,r)}},keyDown:function(e){var t,n,r,i,s,o;if(e.which===9||e.keyCode===9){var u=e.shiftKey?this.get("previousValidKeyView"):this.get("nextValidKeyView");return u?u.becomeFirstResponder():e.allowDefault(),YES}if(!this.get("allowsMultipleSelection")){t=this.get("childViews"),i=t.get("length"),s=this.get("value"),o=SC.isArray(s);if(e.which===39||e.which===40){if(s)for(r=0;r<i-2;r++){n=t.objectAt(r);if(o?s.indexOf(n.get("value"))>=0:n.get("value")===s)this.triggerItemAtIndex(r+1),this._focusSelectedChildView()}else this.triggerItemAtIndex
(0),this._focusSelectedChildView();return YES}if(e.which===37||e.which===38){if(s)for(r=1;r<i-1;r++){n=t.objectAt(r);if(o?s.indexOf(n.get("value"))>=0:n.get("value")===s)this.triggerItemAtIndex(r-1),this._focusSelectedChildView()}else this.triggerItemAtIndex(i-2),this._focusSelectedChildView();return YES}}return NO},mouseDown:function(e){var t=this.get("childViews"),n,r=t.get("length")-1,i;return this.get("isEnabled")?(i=this.displayItemIndexForEvent(e),i>=0&&(n=t.objectAt(i),n.set("isActive",YES),this.activeChildView=n,i===r?this.showOverflowMenu():this._isMouseDown=YES),YES):YES},mouseUp:function(e){var t,n;return n=this.displayItemIndexForEvent(e),this._isMouseDown&&n>=0&&(this.triggerItemAtIndex(n),this.becomeFirstResponder(),this._focusSelectedChildView(),t=this.activeChildView,t.set("isActive",NO),this.activeChildView=null),this._isMouseDown=NO,YES},mouseMoved:function(e){var t=this.get("childViews"),n=t.get("length")-1,r,i,s;return this._isMouseDown&&(s=this.displayItemIndexForEvent(e),r=this.activeChildView,i=t.objectAt(s),i&&i!==r&&(r&&r.set("isActive",NO),i.set("isActive",YES),this.activeChildView=i,s===n&&(this.showOverflowMenu(),this._isMouseDown=NO))),YES},mouseEntered:function(e){var t=this.get("childViews"),n,r=t.get("length")-1,i;return this._isMouseDown&&(i=this.displayItemIndexForEvent(e),i===r?(this.showOverflowMenu(),this._isMouseDown=NO):i>=0&&(n=t.objectAt(i),n.set("isActive",YES),this.activeChildView=n)),YES},mouseExited:function(e){var t;return this._isMouseDown&&(t=this.activeChildView,t&&t.set("isActive",NO),this.activeChildView=null),YES},touchStart
:function(e){var t=this.get("childViews"),n,r=t.get("length")-1,i;return this.get("isEnabled")?(i=this.displayItemIndexForEvent(e),i>=0&&(n=t.objectAt(i),n.set("isActive",YES),this.activeChildView=n,i===r?this.showOverflowMenu():this._isTouching=YES),YES):YES},touchEnd:function(e){var t,n;return n=this.displayItemIndexForEvent(e),this._isTouching&&n>=0&&(this.triggerItemAtIndex(n),this.becomeFirstResponder(),this._focusSelectedChildView(),t=this.activeChildView,t.set("isActive",NO),this.activeChildView=null,this._isTouching=NO),YES},touchesDragged:function(e,t){var n=this.touchIsInBoundary(e),r=this.get("childViews"),i=r.get("length")-1,s,o,u;return n?(this._isTouching||this._touchDidEnter(e),u=this.displayItemIndexForEvent(e),s=this.activeChildView,o=r[u],o&&o!==s&&(s&&s.set("isActive",NO),o.set("isActive",YES),this.activeChildView=o,u===i&&(this.showOverflowMenu(),this._isMouseDown=NO))):this._isTouching&&this._touchDidExit(e),this._isTouching=n,YES},_touchDidExit:function(e){var t;return this.isTouching&&(t=this.activeChildView,t.set("isActive",NO),this.activeChildView=null),YES},_touchDidEnter:function(e){var t=this.get("childViews"),n,r=t.get("length")-1,i;return i=this.displayItemIndexForEvent(e),i===r?(this.showOverflowMenu(),this._isTouching=NO):i>=0&&(n=t.objectAt(i),n.set("isActive",YES),this.activeChildView=n),YES},triggerItemAtIndex:function(e){var t=this.get("childViews"),n,r,i,s,o,u;n=t.objectAt(e);if(!n.get("isEnabled"))return this;o=this.get("allowsEmptySelection"),u=this.get("allowsMultipleSelection"),r=n.get("value"),i=s=this.get("value"),SC.empty(i)?i=[]:SC
.isArray(i)||(i=[i]);if(!u)o&&i.get("length")===1&&i.objectAt(0)===r?i=[]:i=[r];else if(i.indexOf(r)>=0){if(i.get("length")>1||i.objectAt(0)!==r||o)i=i.without(r)}else i=i.concat([r]);switch(i.get("length")){case 0:i=null;break;case 1:i=i.objectAt(0);break;default:}var a=this.get("itemActionKey"),f=this.get("itemTargetKey"),l,c=null,h=this.getPath("pane.rootResponder"),p;a&&(p=this.get("items").objectAt(e))&&(l=p.get?p.get(a):p[a],f&&(c=p.get?p.get(f):p[f]),h&&h.sendAction(l,c,this,this.get("pane"))),s!==undefined&&(!l||this.get("selectSegmentWhenTriggeringAction"))&&this.set("value",i),l=this.get("action"),l&&h&&h.sendAction(l,this.get("target"),this,this.get("pane"))},selectOverflowItem:function(e){var t=e.get("selectedItem");this.triggerItemAtIndex(t.get("index")),e.removeObserver("selectedItem",this,"selectOverflowItem"),this.activeChildView.set("isActive",NO),this.activeChildView=null},showOverflowMenu:function(){var e=this.get("childViews"),t=e.get("length")-1,n=this.overflowItems,r,i,s,o;r=n.get("length"),i=e.get("length")-1-r,o=this.get("value"),s=SC.isArray(o);for(var u=0;u<r;u++){var a=n.objectAt(u),f=this.get("itemValueKey");(s?o.indexOf(a.get(f))>=0:o===a.get(f))?a.set("isChecked",YES):a.set("isChecked",NO),a.set("index",i+u)}var l=this,c=SC.MenuPane.create({layout:{width:200},items:n,itemTitleKey:this.get("itemTitleKey"),itemIconKey:this.get("itemIconKey"),itemIsEnabledKey:this.get("itemIsEnabledKey"),itemKeyEquivalentKey:this.get("itemKeyEquivalentKey"),itemCheckboxKey:"isChecked",modalPaneDidClick:function(){arguments.callee.base.apply(this,arguments),this.removeObserver
("selectedItem",l,"selectOverflowItem"),l.activeChildView.set("isActive",NO),l.activeChildView=null}}),h=this.get("layer"),p=h.childNodes[h.childNodes.length-1];c.popup(p),c.addObserver("selectedItem",this,"selectOverflowItem")},valueDidChange:function(){var e=this.get("value"),t,n=this.get("childViews"),r=Infinity,i=n.lastObject(),s,o;this.overflowItems&&(t=this.overflowItems.get("length"),r=n.get("length")-1-t,i.set("isSelected",NO));for(var u=n.get("length")-2;u>=0;u--)s=n.objectAt(u),(SC.isArray(e)?e.indexOf(s.get("value"))>=0:e===s.get("value"))?(s.set("isSelected",YES),u>=r&&i.set("isSelected",YES)):s.set("isSelected",NO)}.observes("value"),isEnabledDidChange:function(){var e=this.childViews,t=this.get("isEnabled");for(var n=0,r=e.length;n<r;n++)e[n].setIfChanged("isEnabled",t)}.observes("isEnabled")}),SC.MIXED_STATE="__MIXED__",SC.DataSource=SC.Object.extend({fetch:function(e,t){return NO},retrieveRecords:function(e,t,n){return this._handleEach(e,t,this.retrieveRecord,n)},commitRecords:function(e,t,n,r,i){var s,o,u;return t.length>0&&(u=this.createRecords.call(this,e,t,i)),n.length>0&&(s=this.updateRecords.call(this,e,n,i),u=SC.none(u)?s:u===s?u:SC.MIXED_STATE),r.length>0&&(o=this.destroyRecords.call(this,e,r,i),u=SC.none(u)?o:u===o?u:SC.MIXED_STATE),u||NO},cancel:function(e,t){return NO},updateRecords:function(e,t,n){return this._handleEach(e,t,this.updateRecord,null,n)},createRecords:function(e,t,n){return this._handleEach(e,t,this.createRecord,null,n)},destroyRecords:function(e,t,n){return this._handleEach(e,t,this.destroyRecord,null,n)},_handleEach:function(e,t,n,
r,i){var s=t.length,o,u,a,f;for(o=0;o<s;o++)f=r?r[o]:i,a=n.call(this,e,t[o],f),u===undefined?u=a:u===YES?u=a===YES?YES:SC.MIXED_STATE:u===NO&&(u=a===NO?NO:SC.MIXED_STATE);return SC.none(u)?null:u},updateRecord:function(e,t,n){return NO},retrieveRecord:function(e,t,n){return NO},createRecord:function(e,t,n){return NO},destroyRecord:function(e,t,n){return NO}}),SC.CascadeDataSource=SC.DataSource.extend({dataSources:null,from:function(e){var t=this.get("dataSources");return t||this.set("dataSources",t=[]),t.push(e),this},fetch:function(e,t){var n=this.get("dataSources"),r=n?n.length:0,i=NO,s,o,u;for(u=0;i!==YES&&u<r;u++)o=n.objectAt(u),s=o.fetch?o.fetch.apply(o,arguments):NO,i=this._handleResponse(i,s);return i},retrieveRecords:function(e,t,n){var r=this.get("dataSources"),i=r?r.length:0,s=NO,o,u,a;for(a=0;s!==YES&&a<i;a++)u=r.objectAt(a),o=u.retrieveRecords.apply(u,arguments),s=this._handleResponse(s,o);return s},commitRecords:function(e,t,n,r,i){var s=this.get("dataSources"),o=s?s.length:0,u=NO,a,f,l;for(l=0;u!==YES&&l<o;l++)f=s.objectAt(l),a=f.commitRecords.apply(f,arguments),u=this._handleResponse(u,a);return u},cancel:function(e,t){var n=this.get("dataSources"),r=n?n.length:0,i=NO,s,o,u;for(u=0;i!==YES&&u<r;u++)o=n.objectAt(u),s=o.cancel.apply(o,arguments),i=this._handleResponse(i,s);return i},init:function(){arguments.callee.base.apply(this,arguments);var e=this.get("dataSources"),t=e?e.get("length"):0,n;while(--t>=0)n=e[t],SC.typeOf(n)===SC.T_STRING&&(e[t]=this.get(n))},_handleResponse:function(e,t){return t===YES?YES:e===NO?t===NO?NO:SC.MIXED_STATE:SC.MIXED_STATE}}),SC.
Query=SC.Object.extend(SC.Copyable,SC.Freezable,{isQuery:YES,conditions:null,orderBy:null,recordType:null,recordTypes:null,expandedRecordTypes:function(){var e=SC.CoreSet.create(),t,n;return(t=this.get("recordType"))?this._scq_expandRecordType(t,e):(t=this.get("recordTypes"))?t.forEach(function(t){this._scq_expandRecordType(t,e)},this):this._scq_expandRecordType(SC.Record,e),n=SC.Query._scq_queriesWithExpandedRecordTypes,n||(n=SC.Query._scq_queriesWithExpandedRecordTypes=SC.CoreSet.create()),n.add(this),e.freeze()}.property("recordType","recordTypes").cacheable(),_scq_expandRecordType:function(e,t){if(t.contains(e))return;t.add(e),SC.typeOf(e)===SC.T_STRING&&(e=SC.objectForPropertyPath(e)),e.subclasses.forEach(function(e){this._scq_expandRecordType(e,t)},this)},parameters:null,location:"local",scope:null,isRemote:function(){return this.get("location")===SC.Query.REMOTE}.property("location").cacheable(),isLocal:function(){return this.get("location")===SC.Query.LOCAL}.property("location").cacheable(),isEditable:NO,contains:function(e,t){var n,r=YES;if(n=this.get("recordTypes"))r=n.find(function(t){return SC.kindOf(e,t)});else if(n=this.get("recordType"))r=SC.kindOf(e,n);if(!r)return NO;var i=this.get("scope");return i&&!i.contains(e)?NO:(this._isReady||this.parse(),this._isReady?(t===undefined&&(t=this.parameters||this),this._tokenTree.evaluate(e,t)):NO)},containsRecordTypes:function(e){var t=this.get("recordType");return t?!!e.find(function(e){return SC.kindOf(e,t)}):(t=this.get("recordTypes"))?!!t.find(function(t){return!!e.find(function(e){return SC.kindOf(e,t)})}):YES},compare
:function(e,t){var n=0,r,i,s,o;if(e===t)return 0;this._isReady||this.parse();if(!this._isReady)return SC.compare(e.get("id"),t.get("id"));i=this._order;if(SC.typeOf(i)===SC.T_FUNCTION)n=i.call(null,e,t);else{s=i?i.length:0;for(o=0;n===0&&o<s;o++)r=i[o].propertyName,SC.Query.comparisons[r]?n=SC.Query.comparisons[r](e.get(r),t.get(r)):n=SC.compare(e.get(r),t.get(r)),n!==0&&i[o].descending&&(n=-1*n)}return n!==0?n:SC.compare(e.get("id"),t.get("id"))},_isReady:NO,parse:function(){var e=this.get("conditions"),t=this.get("queryLanguage"),n,r;n=this._tokenList=this.tokenizeString(e,t),r=this._tokenTree=this.buildTokenTree(n,t),this._order=this.buildOrder(this.get("orderBy")),this._isReady=!!r&&!r.error;if(r&&r.error)throw r.error;return this._isReady},queryWithScope:function(e){var t=SC.keyFor("__query__",SC.guidFor(this)),n=e[t];return n||(e[t]=n=this.copy(),n.set("scope",e),n.freeze()),n},copyKeys:["conditions","orderBy","recordType","recordTypes","parameters","location","scope"],concatenatedProperties:["copyKeys"],copy:function(){var e={},t=this.get("copyKeys"),n=t?t.length:0,r,i,s;while(--n>=0)r=t[n],i=this.get(r),i!==undefined&&(e[r]=i);return s=this.constructor.create(e),e=null,s},queryLanguage:{UNKNOWN:{firstCharacter:/[^\s'"\w\d\(\)\{\}]/,notAllowed:/[\-\s'"\w\d\(\)\{\}]/},PROPERTY:{firstCharacter:/[a-zA-Z_]/,notAllowed:/[^a-zA-Z_0-9\.]/,evalType:"PRIMITIVE",evaluate:function(e,t){var n=this.tokenValue.split("."),r=n.length;if(r<2)return e.get(this.tokenValue);var i=e;for(var s=0;s<r;s++){if(!i)return;i.get?i=i.get(n[s]):i=i[n[s]]}return i}},NUMBER:{firstCharacter:/[\d\-]/,
notAllowed:/[^\d\-\.]/,format:/^-?\d+$|^-?\d+\.\d+$/,evalType:"PRIMITIVE",evaluate:function(e,t){return parseFloat(this.tokenValue)}},STRING:{firstCharacter:/['"]/,delimeted:!0,evalType:"PRIMITIVE",evaluate:function(e,t){return this.tokenValue}},PARAMETER:{firstCharacter:/\{/,lastCharacter:"}",delimeted:!0,evalType:"PRIMITIVE",evaluate:function(e,t){return t[this.tokenValue]}},"%@":{rememberCount:!0,reservedWord:!0,evalType:"PRIMITIVE",evaluate:function(e,t){return t[this.tokenValue]}},OPEN_PAREN:{firstCharacter:/\(/,singleCharacter:!0},CLOSE_PAREN:{firstCharacter:/\)/,singleCharacter:!0},AND:{reservedWord:!0,leftType:"BOOLEAN",rightType:"BOOLEAN",evalType:"BOOLEAN",evaluate:function(e,t){var n=this.leftSide.evaluate(e,t),r=this.rightSide.evaluate(e,t);return n&&r}},OR:{reservedWord:!0,leftType:"BOOLEAN",rightType:"BOOLEAN",evalType:"BOOLEAN",evaluate:function(e,t){var n=this.leftSide.evaluate(e,t),r=this.rightSide.evaluate(e,t);return n||r}},NOT:{reservedWord:!0,rightType:"BOOLEAN",evalType:"BOOLEAN",evaluate:function(e,t){var n=this.rightSide.evaluate(e,t);return!n}},"=":{reservedWord:!0,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(e,t){var n=this.leftSide.evaluate(e,t),r=this.rightSide.evaluate(e,t);return SC.isEqual(n,r)}},"!=":{reservedWord:!0,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(e,t){var n=this.leftSide.evaluate(e,t),r=this.rightSide.evaluate(e,t);return!SC.isEqual(n,r)}},"<":{reservedWord:!0,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(e,t){var n=this.leftSide
.evaluate(e,t),r=this.rightSide.evaluate(e,t);return SC.compare(n,r)==-1}},"<=":{reservedWord:!0,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(e,t){var n=this.leftSide.evaluate(e,t),r=this.rightSide.evaluate(e,t);return SC.compare(n,r)!=1}},">":{reservedWord:!0,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(e,t){var n=this.leftSide.evaluate(e,t),r=this.rightSide.evaluate(e,t);return SC.compare(n,r)==1}},">=":{reservedWord:!0,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(e,t){var n=this.leftSide.evaluate(e,t),r=this.rightSide.evaluate(e,t);return SC.compare(n,r)!=-1}},BEGINS_WITH:{reservedWord:!0,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(e,t){var n=this.leftSide.evaluate(e,t),r=this.rightSide.evaluate(e,t);return n&&n.indexOf(r)===0}},ENDS_WITH:{reservedWord:!0,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(e,t){var n=this.leftSide.evaluate(e,t),r=this.rightSide.evaluate(e,t);return n&&n.indexOf(r)===n.length-r.length}},CONTAINS:{reservedWord:!0,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(e,t){var n=this.leftSide.evaluate(e,t)||[],r=this.rightSide.evaluate(e,t),i=SC.typeOf(n);if(i===SC.T_STRING)return n.indexOf(r)!==-1;if(i===SC.T_ARRAY||n.toArray){i!==SC.T_ARRAY&&(n=n.toArray());var s=!1,o=0;while(s===!1&&o<n.length)r==n[o]&&(s=!0),o++;return s}}},ANY:{reservedWord:!0,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(e,t){var n=this.leftSide
.evaluate(e,t),r=this.rightSide.evaluate(e,t),i=!1,s=0;while(i===!1&&s<r.length)n==r[s]&&(i=!0),s++;return i}},MATCHES:{reservedWord:!0,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(e,t){var n=this.leftSide.evaluate(e,t),r=this.rightSide.evaluate(e,t);return r.test(n)}},TYPE_IS:{reservedWord:!0,rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(e,t){var n=SC.Store.recordTypeFor(e.storeKey),r=this.rightSide.evaluate(e,t),i=SC.objectForPropertyPath(r);return n==i}},"null":{reservedWord:!0,evalType:"PRIMITIVE",evaluate:function(e,t){return null}},"undefined":{reservedWord:!0,evalType:"PRIMITIVE",evaluate:function(e,t){return undefined}},"false":{reservedWord:!0,evalType:"PRIMITIVE",evaluate:function(e,t){return!1}},"true":{reservedWord:!0,evalType:"PRIMITIVE",evaluate:function(e,t){return!0}},YES:{reservedWord:!0,evalType:"PRIMITIVE",evaluate:function(e,t){return!0}},NO:{reservedWord:!0,evalType:"PRIMITIVE",evaluate:function(e,t){return!1}}},tokenizeString:function(e,t){function m(e,r){i=t[e],i.format&&!i.format.test(r)&&(e="UNKNOWN"),i.delimeted&&(d=!0);if(!i.delimeted)for(var s in t)t[s].reservedWord&&s==r&&(e=s);i=t[e],i&&i.rememberCount&&(v[e]||(v[e]=0),r=v[e],v[e]+=1),n.push({tokenType:e,tokenValue:r}),u=null,a=null,f=null}var n=[],r=null,i=null,s=null,o=null,u=null,a=null,f=null,l=null,c=!1,h=!1,p=!1,d=!1,v={};if(!e)return[];var g=e.length;for(var y=0;y<g;y++){c=y===g-1,r=e.charAt(y),d=!1,u&&(i=t[u],h=i.delimeted?r===l:i.notAllowed.test(r),h||(f+=r),(h||c)&&m(u,f),c&&!h&&(d=!0));if(!u&&!d){for(s in t)i=t[s],i.firstCharacter&&i.firstCharacter
.test(r)&&(u=s);u&&(i=t[u],f=r,i.delimeted&&(f="",i.lastCharacter?l=i.lastCharacter:l=r),(i.singleCharacter||c)&&m(u,f))}}return n},buildTokenTree:function(e,t){function u(e){var r=e;if(r<0)return!1;var i=t[n[r].tokenType];return i?(n[r].evaluate=i.evaluate,i):(o.push("logic for token '"+n[r].tokenType+"' is not defined"),!1)}function a(e,t){var n=t,r=u(n);if(!r)return!1;if(e=="left")return r.leftType;if(e=="right")return r.rightType}function f(e){var t=e,n=u(t);return n?n.evalType:!1}function l(e){n.splice(e,1),e<=r&&r--}function c(e){var t=e||r;return t>0?!0:!1}function h(e){var t=e;return t<0?!0:a("left",t)&&!n[t].leftSide||a("right",t)&&!n[t].rightSide}function p(e,t){var n=t<e?"left":"right";return e<0||t<0?!1:a(n,e)?f(t)?a(n,e)==f(t)?!0:!1:!1:!1}function d(e){var t=e;return h(t)?c(t)?p(t,t-1)?!0:!1:!1:!1}function v(e){var t=e;return h(t)?!1:c(t)?h(t-1)?p(t-1,t)?!0:!1:!1:!1}function m(e){var t=e;if(t<1)return!1;n[t].leftSide=n[t-1],l(t-1)}function g(e){var t=e;if(t<1)return!1;n[t-1].rightSide=n[t],l(t)}function y(e){l(e),l(i.pop())}var n=e.slice(),r=0,i=[],s=!1,o=[];if(!e||e.length===0)return{evaluate:function(){return!0}};for(r=0;r<n.length;r++)s=!1,n[r].tokenType=="UNKNOWN"&&o.push("found unknown token: "+n[r].tokenValue),n[r].tokenType=="OPEN_PAREN"&&i.push(r),n[r].tokenType=="CLOSE_PAREN"&&y(r),d(r)&&m(r),v(r)&&(g(r),s=!0),s&&r--;return n.length==1?n=n[0]:o.push("string did not resolve to a single tree"),o.length>0?{error:o.join(",\n"),tree:n}:n},buildOrder:function(e){if(!e)return[];if(SC.typeOf(e)===SC.T_FUNCTION)return e;var t=e.split(",");for(var n=0;n<t.length;
n++){var r=t[n];r=r.replace(/^\s+|\s+$/,""),r=r.replace(/\s+/,","),r=r.split(","),t[n]={propertyName:r[0]},r[1]&&r[1]=="DESC"&&(t[n].descending=!0)}return t}}),SC.Query.mixin({LOCAL:"local",REMOTE:"remote",storeKeyFor:function(e){return e?e.get("storeKey"):null},containsRecords:function(e,t,n){var r=[];for(var i=0,s=t.get("length");i<s;i++){var o=t.objectAt(i);o&&e.contains(o)&&r.push(o.get("storeKey"))}return r=SC.Query.orderStoreKeys(r,e,n),r},orderStoreKeys:function(e,t,n){if(e)var r=e.sort(function(e,r){return SC.Query.compareStoreKeys(t,n,e,r)});return e},compareStoreKeys:function(e,t,n,r){var i=t.materializeRecord(n),s=t.materializeRecord(r);return e.compare(i,s)},build:function(e,t,n,r){var i=null,s,o,u,a;if(t&&t.isQuery)return t.get("location")===e?t:t.copy().set("location",e).freeze();if(typeof t===SC.T_STRING){s=SC.objectForPropertyPath(t);if(!s)throw"%@ did not resolve to a class".fmt(t);t=s}else t&&t.isEnumerable?(s=[],t.forEach(function(e){typeof e===SC.T_STRING&&(e=SC.objectForPropertyPath(e));if(!e)throw"cannot resolve record types: %@".fmt(t);s.push(e)},this),t=s):t||(t=SC.Record);return r===undefined&&(r=null),n===undefined&&(n=null),!r&&typeof n!==SC.T_STRING&&(i=n,n=null),!r&&!i?(a=SC.Query._scq_recordTypeCache,a||(a=SC.Query._scq_recordTypeCache={}),o=a[e],o||(o=a[e]={}),t.isEnumerable?(u=t.map(function(e){return SC.guidFor(e)}),u=u.sort().join(":")):u=SC.guidFor(t),n&&(u=[u,n].join("::")),s=o[u],s||(t.isEnumerable?i={recordTypes:t.copy()}:i={recordType:t},i.location=e,i.conditions=n,s=o[u]=SC.Query.create(i).freeze())):(i||(i={}),i.location||(i.location=
e),t&&t.isEnumerable?i.recordsTypes=t:i.recordType=t,n&&(i.conditions=n),r&&(i.parameters=r),s=SC.Query.create(i).freeze()),s},local:function(e,t,n){return this.build(SC.Query.LOCAL,e,t,n)},remote:function(e,t,n){return this.build(SC.Query.REMOTE,e,t,n)},_scq_didDefineRecordType:function(){var e=SC.Query._scq_queriesWithExpandedRecordTypes;e&&(e.forEach(function(e){e.notifyPropertyChange("expandedRecordTypes")},this),e.clear())}}),SC.Query.comparisons={},SC.Query.registerComparison=function(e,t){SC.Query.comparisons[e]=t},SC.Query.registerQueryExtension=function(e,t){SC.Query.prototype.queryLanguage[e]=t},SC.Q=SC.Query.from,SC.Record=SC.Object.extend({isRecord:YES,isParentRecord:NO,primaryKey:"guid",id:function(e,t){return t!==undefined?(this.writeAttribute(this.get("primaryKey"),t),t):SC.Store.idFor(this.storeKey)}.property("storeKey").cacheable(),status:function(){return this.store.readStatus(this.storeKey)}.property("storeKey").cacheable(),store:null,storeKey:null,isDestroyed:function(){return!!(this.get("status")&SC.Record.DESTROYED)}.property("status").cacheable(),isEditable:function(e,t){return t!==undefined&&(this._screc_isEditable=t),this.get("status")&SC.Record.READY?this._screc_isEditable:NO}.property("status").cacheable(),_screc_isEditable:YES,isLoaded:function(){var e=SC.Record,t=this.get("status");return t!==e.EMPTY&&t!==e.BUSY_LOADING&&t!==e.ERROR}.property("status").cacheable(),relationships:null,attributes:function(){var e=this.get("store"),t=this.storeKey;return e.readEditableDataHash(t)}.property(),readOnlyAttributes:function(){var e=this.get("store"),t=this
.storeKey,n=e.readDataHash(t);return n&&(n=SC.clone(n,YES)),n}.property(),nestedRecordNamespace:null,isNestedRecord:function(){var e=this.get("store"),t,n=this.get("storeKey"),r=e.parentStoreKeyExists(n);return t=r?YES:NO,t}.property().cacheable(),parentRecord:function(){var e=this.storeKey,t=this.get("store");return t.materializeParentRecord(e)}.property(),refresh:function(e,t){var n=this.get("store"),r,i,s=this.get("storeKey"),o=n.parentStoreKeyExists();return i=e||SC.none(e)&&SC.none(o),i?n.refreshRecord(null,null,s,t):o&&(r=n.materializeRecord(o),r.refresh(e,t)),this},destroy:function(e){var t=this.get("store"),n,r,i=this.get("storeKey"),s=t.parentStoreKeyExists();return r=e||SC.none(e)&&SC.none(s),r?(t.destroyRecord(null,null,i),this.notifyPropertyChange("status"),this.propagateToAggregates()):s&&(n=t.materializeRecord(s),n.destroy(e)),this},recordDidChange:function(e){var t=this.get("parentRecord");return t&&t.recordDidChange(),this.get("store").recordDidChange(null,null,this.get("storeKey"),e),this.notifyPropertyChange("status"),this.propagateToAggregates(),this},toJSON:function(){return this.get("attributes")},_editLevel:0,beginEditing:function(){return this._editLevel++,this},endEditing:function(e){return--this._editLevel<=0&&(this._editLevel=0,this.recordDidChange(e)),this},readAttribute:function(e){var t=this.get("store"),n=this.storeKey,r=t.readDataHash(n);return r?r[e]:undefined},writeAttribute:function(e,t,n){var r=this.get("store"),i=this.storeKey,s;s=r.readEditableDataHash(i);if(!s)throw SC.Record.BAD_STATE_ERROR;return t!==s[e]&&(n||this.beginEditing(),s[e]=
t,e===this.get("primaryKey")&&(SC.Store.replaceIdFor(i,t),this.propertyDidChange("id")),n||this.endEditing(e)),this},propagateToAggregates:function(){var e=this.get("storeKey"),t=SC.Store.recordTypeFor(e),n=t.__sc_aggregate_keys,r,i,s,o,u,a;if(!n){n=[];for(s in this)o=this[s],o&&o.isRecordAttribute&&o.aggregate===YES&&n.push(s);t.__sc_aggregate_keys=n}var f=SC.Record,l=f.DIRTY,c=f.READY_NEW,h=f.DESTROYED,p=f.READY_CLEAN,d;d=function(e){var t,n,r,i;if(e){t=this.get("status");if(t&l||t&c||t&h)n=e.get("store"),r=e.get("storeKey"),i=n.peekStatus(r),i===p&&e.get("store").recordDidChange(e.constructor,null,e.get("storeKey"),null,YES)}};for(r=0,i=n.length;r<i;++r)s=n[r],u=this.get(s),a=SC.kindOf(u,SC.ManyArray)?u:[u],a.forEach(d,this)},storeDidChangeProperties:function(e,t){if(e)this.notifyPropertyChange("status");else{t?(this.beginPropertyChanges(),t.forEach(function(e){this.notifyPropertyChange(e)},this),this.notifyPropertyChange("status"),this.endPropertyChanges()):this.allPropertiesDidChange();var n=this.relationships,r=n?n.length:0;while(--r>=0)n[r].recordPropertyDidChange(t)}},normalize:function(e){var t=this.primaryKey,n=this.get("id"),r=this.get("store"),i=this.get("storeKey"),s={},o,u,a,f,l,c,h,p,d,v,m,g=r.readEditableDataHash(i)||{};g[t]=n,f=r.readDataHash(i);for(o in this)u=this[o],u&&(a=u.typeClass,a&&(v=u.get("key")||o,s[v]=YES,h=SC.typeOf(a.call(u))===SC.T_CLASS,p=u.isNestedRecordTransform,!h&&!p?(l=this.get(o),l===undefined||l===null&&!e?e||(s[v]=NO):(m=this[o],SC.instanceOf(m,SC.RecordAttribute)&&(l=m.fromType(this,o,l)),g[v]=l)):p?(l=this.get(o),l&&l.normalize&&l.normalize
()):h&&(l=f[v],l!==undefined?g[v]=l:(d=u.get("defaultValue"),SC.typeOf(d)===SC.T_FUNCTION?g[v]=d(this,o,d):g[v]=d))));for(o in g)s[o]||(SC.debug("%@:  Deleting key from underlying data hash due to normalization:  %@",this,o),delete g[o]);return this},unknownProperty:function(e,t){if(t!==undefined){var n=this.get("storeKey"),r=SC.Store.recordTypeFor(n);if(r.ignoreUnknownProperties===YES)return this[e]=t,t;var i=this.get("primaryKey");this.writeAttribute(e,t),e===i&&SC.Store.replaceIdFor(n,t)}return this.readAttribute(e)},commitRecord:function(e,t,n){var r=this.get("store"),i,s,o=this.get("storeKey"),u=r.parentStoreKeyExists();return s=t||SC.none(t)&&SC.none(u),s?r.commitRecord(undefined,undefined,this.get("storeKey"),e,n):u&&(i=r.materializeRecord(u),i.commitRecord(e,t,n)),this},isError:function(){return this.get("status")&SC.Record.ERROR}.property("status").cacheable(),errorValue:function(){return this.get("isError")?SC.val(this.get("errorObject")):null}.property("isError").cacheable(),errorObject:function(){if(this.get("isError")){var e=this.get("store");return e.readError(this.get("storeKey"))||SC.Record.GENERIC_ERROR}return null}.property("isError").cacheable(),set:function(e,t){var n=this[e];return n&&n.isProperty&&n.get&&!n.get("isEditable")?this:arguments.callee.base.apply(this,arguments)},toString:function(){var e=this.get("store").readDataHash(this.get("storeKey"));return"%@(%@) %@".fmt(this.constructor.toString(),SC.inspect(e),this.statusString())},statusString:function(){var e=[],t=this.get("status");for(var n in SC.Record)n.match(/[A-Z_]$/)&&SC.Record[n]===t&&e.push
(n);return e.join(" ")},registerNestedRecord:function(e,t,n){var r,i,s,o,u;return SC.none(n)&&(n=t),e&&e.get&&e.get("isRecord")?o=e:(u=this._materializeNestedRecordType(e,t),o=this.createNestedRecord(u,e)),o&&(this.isParentRecord=YES,r=this.get("store"),i=this.get("storeKey"),s=o.get("storeKey"),r.registerChildToParent(i,s,n)),o},_materializeNestedRecordType:function(e,t){var n,r,i;SC.typeOf(e)===SC.T_HASH&&(n=this.get("nestedRecordNamespace"),e.type&&!SC.none(n)&&(r=n[e.type])),!r&&t&&this[t]&&(r=this[t].get("typeClass"));if(!r||!SC.kindOf(r,SC.Record))throw"SC.Child: Error during transform: Invalid record type.";return r},createNestedRecord:function(e,t){var n,r,i,s,o=null,u=null;return SC.run(function(){t=t||{},u=t[e.prototype.primaryKey],n=this.get("store");if(SC.none(n))throw"Error: during the creation of a child record: NO STORE ON PARENT!";!r&&(s=e.prototype.primaryKey)&&(r=t[s],i=r?n.storeKeyExists(e,r):null,i?(n.writeDataHash(i,t),o=n.materializeRecord(i)):(o=n.createRecord(e,t),SC.none(r)&&(i=o.get("storeKey"),r="cr"+i,SC.Store.replaceIdFor(i,r),t=n.readEditableDataHash(i),t[s]=r))),SC.none(u)&&this.generateIdForChild&&this.generateIdForChild(o)},this),o},_nestedRecordKey:0,generateIdForChild:function(e){}}),SC.Record.mixin({ignoreUnknownProperties:NO,CLEAN:1,DIRTY:2,EMPTY:256,ERROR:4096,READY:512,READY_CLEAN:513,READY_DIRTY:514,READY_NEW:515,DESTROYED:1024,DESTROYED_CLEAN:1025,DESTROYED_DIRTY:1026,BUSY:2048,BUSY_LOADING:2052,BUSY_CREATING:2056,BUSY_COMMITTING:2064,BUSY_REFRESH:2080,BUSY_REFRESH_CLEAN:2081,BUSY_REFRESH_DIRTY:2082,BUSY_DESTROYING:2112,BAD_STATE_ERROR
:SC.$error("Internal Inconsistency"),RECORD_EXISTS_ERROR:SC.$error("Record Exists"),NOT_FOUND_ERROR:SC.$error("Not found "),BUSY_ERROR:SC.$error("Busy"),GENERIC_ERROR:SC.$error("Generic Error"),_nextChildKey:0,attr:function(e,t){return SC.RecordAttribute.attr(e,t)},fetch:function(e,t){return SC.FetchedAttribute.attr(e,t)},toMany:function(e,t){t=t||{};var n=t.nested||t.isNested,r;return n?r=SC.ChildrenAttribute.attr(e,t):r=SC.ManyAttribute.attr(e,t),r},toOne:function(e,t){t=t||{};var n=t.nested||t.isNested,r;return n?r=SC.ChildAttribute.attr(e,t):r=SC.SingleAttribute.attr(e,t),r},storeKeysById:function(){var e=SC.keyFor("storeKey",SC.guidFor(this)),t=this[e];return t||(t=this[e]={}),t},storeKeyFor:function(e){var t=this.storeKeysById(),n=t[e];return n||(n=SC.Store.generateStoreKey(),SC.Store.idsByStoreKey[n]=e,SC.Store.recordTypesByStoreKey[n]=this,t[e]=n),n},storeKeyExists:function(e){var t=this.storeKeysById(),n=t[e];return n},find:function(e,t){return e.find(this,t)},extend:function(){var e=SC.Object.extend.apply(this,arguments);return SC.Query&&SC.Query._scq_didDefineRecordType(e),e}}),SC.FixturesDataSource=SC.DataSource.extend({simulateRemoteResponse:NO,latency:50,cancel:function(e,t){return NO},fetch:function(e,t){if(t.get("location")!==SC.Query.LOCAL)throw SC.$error("SC.Fixture data source can only fetch local queries");if(!t.get("recordType")&&!t.get("recordTypes"))throw SC.$error("SC.Fixture data source can only fetch queries with one or more record types");this.get("simulateRemoteResponse")?this.invokeLater(this._fetch,this.get("latency"),e,t):this._fetch(e,t)},_fetch
:function(e,t){var n=t.get("recordType"),r=t.get("recordTypes")||[n];r.forEach(function(t){SC.typeOf(t)===SC.T_STRING&&(t=SC.objectForPropertyPath(t)),t&&this.loadFixturesFor(e,t)},this),e.dataSourceDidFetchQuery(t)},retrieveRecords:function(e,t){var n=this.get("latency"),r=this.hasFixturesFor(t);return r?(this.get("simulateRemoteResponse")?this.invokeLater(this._retrieveRecords,n,e,t):this._retrieveRecords(e,t),r):r},_retrieveRecords:function(e,t){t.forEach(function(t){var n=[],r=SC.Store.recordTypeFor(t),i=e.idFor(t),s=this.fixtureForStoreKey(e,t);n.push(t),e.dataSourceDidComplete(t,s,i)},this)},updateRecords:function(e,t,n){var r=this.get("latency"),i=this.hasFixturesFor(t);return i?(this.get("simulateRemoteResponse")?this.invokeLater(this._updateRecords,r,e,t):this._updateRecords(e,t),i):i},_updateRecords:function(e,t){t.forEach(function(t){var n=e.readDataHash(t);this.setFixtureForStoreKey(e,t,n),e.dataSourceDidComplete(t)},this)},createRecords:function(e,t,n){var r=this.get("latency");return this.get("simulateRemoteResponse")?this.invokeLater(this._createRecords,r,e,t):this._createRecords(e,t),YES},_createRecords:function(e,t){t.forEach(function(t){var n=e.idFor(t),r=e.recordTypeFor(t),i=e.readDataHash(t),s=this.fixturesFor(r);n||(n=this.generateIdFor(r,i,e,t)),this._invalidateCachesFor(r,t,n),s[n]=i,e.dataSourceDidComplete(t,null,n)},this)},destroyRecords:function(e,t,n){var r=this.get("latency"),i=this.hasFixturesFor(t);return i?(this.get("simulateRemoteResponse")?this.invokeLater(this._destroyRecords,r,e,t):this._destroyRecords(e,t),i):i},_destroyRecords:function(e,
t){t.forEach(function(t){var n=e.idFor(t),r=e.recordTypeFor(t),i=this.fixturesFor(r);this._invalidateCachesFor(r,t,n),n&&delete i[n],e.dataSourceDidDestroy(t)},this)},loadFixturesFor:function(e,t,n){var r=[],i,s,o;i=this.fixturesFor(t);for(s in i)o=t.storeKeyFor(s),e.peekStatus(o)===SC.Record.EMPTY&&r.push(i[s]),n&&n.push(o);return r&&r.length>0&&e.loadRecords(t,r),this},generateIdFor:function(e,t,n,r){return"@id%@".fmt(SC.Store.generateStoreKey())},fixtureForStoreKey:function(e,t){var n=e.idFor(t),r=e.recordTypeFor(t),i=this.fixturesFor(r);return i?i[n]:null},setFixtureForStoreKey:function(e,t,n){var r=e.idFor(t),i=e.recordTypeFor(t),s=this.fixturesFor(i);return this._invalidateCachesFor(i,t,r),s[r]=n,this},fixturesFor:function(e){this._fixtures||(this._fixtures={});var t=this._fixtures[SC.guidFor(e)];if(t)return t;var n=e?e.FIXTURES:null,r=n?n.length:0,i=e?e.prototype.primaryKey:"guid",s,o,u;this._fixtures[SC.guidFor(e)]=t={};for(s=0;s<r;s++)o=n[s],u=o[i],u||(u=this.generateIdFor(e,o)),t[u]=o;return t},fixturesLoadedFor:function(e){if(!this._fixtures)return NO;var t=[],n=this._fixtures[SC.guidFor(e)];return n?YES:NO},reset:function(){return this._fixtures=null,this},hasFixturesFor:function(e){var t=NO;return e.forEach(function(e){if(t!==SC.MIXED_STATE){var n=SC.Store.recordTypeFor(e),r=n?n.FIXTURES:null;r&&r.length&&r.length>0?t===NO&&(t=YES):t===YES&&(t=SC.MIXED_STATE)}},this),t},_invalidateCachesFor:function(e,t,n){var r=this._storeKeyCache;return r&&delete r[SC.guidFor(e)],this}}),SC.Record.fixtures=SC.FixturesDataSource.create(),SC.RelationshipSupport={_srs_inverseDidRelinquishRelationships
:function(e,t,n,r){t.forEach(function(t){this._srs_inverseDidRelinquishRelationship(e,t,n,r)},this)},_srs_inverseDidRelinquishRelationship:function(e,t,n,r){var i=e.storeKeyFor(t),s=this.readDataHash(i),o=n.inverse,u=e.prototype;if(!s||!o)return;SC.instanceOf(u[o],SC.SingleAttribute)?delete s[o]:SC.instanceOf(u[o],SC.ManyAttribute)&&SC.typeOf(s[o])===SC.T_ARRAY&&s[o].removeObject(r),this.pushRetrieve(e,t,s,undefined,!0)},_srs_inverseDidAddRelationships:function(e,t,n,r){t.forEach(function(t){this._srs_inverseDidAddRelationship(e,t,n,r)},this)},_srs_inverseDidAddRelationship:function(e,t,n,r){var i=e.storeKeyFor(t),s=this.readDataHash(i),o=this.peekStatus(i),u=e.prototype,a=n.inverse,f=u[a],l=u[u.primaryKey],c=!1;f=f&&f.get&&f.get("key")||f.key||a,o===SC.Record.EMPTY&&(SC.typeOf(n.lazilyInstantiate)===SC.T_FUNCTION&&n.lazilyInstantiate()||SC.typeOf(n.lazilyInstantiate)!==SC.T_FUNCTION&&n.lazilyInstantiate)&&(!SC.none(l)&&l.typeClass&&SC.typeOf(l.typeClass())===SC.T_CLASS&&(c=!0),s={},s[u.primaryKey]=t);if(!s||!a)return;SC.instanceOf(u[a],SC.SingleAttribute)?s[f]=r:SC.instanceOf(u[a],SC.ManyAttribute)&&(s[f]=s[f]||[],s[a].indexOf(r)<0&&s[f].push(r)),this.pushRetrieve(e,t,s,undefined,!c)},_srs_pushIterator:function(e,t,n,r){var i=e.prototype,s,o,u,a;typeof n=="undefined"&&(n=e.storeKeyFor(t)),o=this.readDataHash(n)||{};for(u in i){s=i[u];if(s&&s.typeClass&&s.inverse&&s.isMaster){a=s.typeClass();if(SC.typeOf(a)!==SC.T_CLASS)continue;r.apply(this,[a,o,s,s.get&&s.get("key")||u])}}},pushDestroy:function(e,t,n,r){var i;return this._srs_pushIterator(t,n,r,function(e,t,r,s){i=[t[s]||null
].flatten().compact().uniq(),this._srs_inverseDidRelinquishRelationships(e,i,r,n)}),e(t,n,r)}.enhance(),pushRetrieve:function(e,t,n,r,i,s){if(!s){var o,u;this._srs_pushIterator(t,n,i,function(e,t,i,s){o=[t[s]||null].flatten().compact().uniq(),u=[r[s]||null].flatten().compact().uniq(),this._srs_inverseDidRelinquishRelationships(e,o.filter(function(e){return u.indexOf(e)===-1}),i,n),this._srs_inverseDidAddRelationships(e,u,i,n)})}return i=i||t.storeKeyFor(n),e(t,n,r,i)}.enhance()},SC.RecordAttribute=SC.Object.extend({isRecordAttribute:YES,defaultValue:null,type:String,key:null,isRequired:NO,isEditable:YES,useIsoDate:YES,aggregate:NO,lazilyInstantiate:NO,typeClass:function(){var e=this.get("type");return SC.typeOf(e)===SC.T_STRING&&(e=SC.requiredObjectForPropertyPath(e)),e}.property("type").cacheable(),transform:function(){var e=this.get("typeClass")||String,t=SC.RecordAttribute.transforms,n;while(e&&!(n=t[SC.guidFor(e)]))e.superclass.hasOwnProperty("create")?e=e.superclass:e=SC.T_FUNCTION;return n}.property("typeClass").cacheable(),toType:function(e,t,n){var r=this.get("transform"),i=this.get("typeClass"),s;if(r&&r.to){n=r.to(n,this,i,e,t);if(!SC.none(n)&&(s=r.observesChildren)){var o,u=s.length,a={record:e,key:t};for(o=0;o<u;o++)n.addObserver(s[o],this,this._SCRA_childObserver,a)}}return n},_SCRA_childObserver:function(e,t,n,r){this.call(r.record,r.key,e),r.record.notifyPropertyChange(r.key)},fromType:function(e,t,n){var r=this.get("transform"),i=this.get("typeClass");return r&&r.from&&(n=r.from(n,this,i,e,t)),n},getDefaultValue:function(e,t){var n=this.get("defaultValue");return typeof 
n===SC.T_FUNCTION&&(n=n(e,t,this)),n},call:function(e,t,n){var r=this.get("key")||t,i;return n!==undefined&&this.get("isEditable")&&(i=this.fromType(e,t,n),e.writeAttribute(r,i)),n=e.readAttribute(r),SC.none(n)&&(n=this.getDefaultValue(e,t)),n=this.toType(e,t,n),n},apply:function(e,t){return this.call.apply(e,t)},isProperty:YES,isCacheable:YES,dependentKeys:[],init:function(){arguments.callee.base.apply(this,arguments),this.cacheKey="__cache__"+SC.guidFor(this),this.lastSetValueKey="__lastValue__"+SC.guidFor(this)}}),SC.RecordAttribute.mixin({attr:function(e,t){return t||(t={}),t.type||(t.type=e||String),this.create(t)},transforms:{},registerTransform:function(e,t){SC.RecordAttribute.transforms[SC.guidFor(e)]=t}}),SC.RecordAttribute.registerTransform(Boolean,{to:function(e){return SC.none(e)?null:!!e}}),SC.RecordAttribute.registerTransform(Number,{to:function(e){return SC.none(e)?null:Number(e)}}),SC.RecordAttribute.registerTransform(String,{to:function(e){return typeof e!==SC.T_STRING&&!SC.none(e)&&e.toString&&(e=e.toString()),e}}),SC.RecordAttribute.registerTransform(Array,{to:function(e){return!SC.isArray(e)&&!SC.none(e)&&(e=[]),e},observesChildren:["[]"]}),SC.RecordAttribute.registerTransform(Object,{to:function(e){return typeof e!="object"&&!SC.none(e)&&(e={}),e}}),SC.RecordAttribute.registerTransform(SC.Record,{to:function(e,t,n,r){var i=r.get("store");return SC.none(e)||e===""?null:i.find(n,e)},from:function(e){return e?e.get("id"):null}}),SC.RecordAttribute.registerTransform(SC.T_FUNCTION,{to:function(e,t,n,r){n=n.apply(r);var i=r.get("store");return i.find(n,e)},from
:function(e){return e.get("id")}}),SC.RecordAttribute.registerTransform(Date,{to:function(e,t){if(SC.none(e))return e;var n;e=e.toString()||"";if(t.get("useIsoDate")){var r="([0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(\\.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?",i=e.match(new RegExp(r)),s=0,o=new Date(i[1],0,1),u;i[3]&&o.setMonth(i[3]-1),i[5]&&o.setDate(i[5]),i[7]&&o.setHours(i[7]),i[8]&&o.setMinutes(i[8]),i[10]&&o.setSeconds(i[10]),i[12]&&o.setMilliseconds(Number("0."+i[12])*1e3),i[14]&&(s=Number(i[16])*60+Number(i[17]),s*=i[15]==="-"?1:-1),s-=o.getTimezoneOffset(),u=Number(o)+s*60*1e3,n=new Date,n.setTime(Number(u))}else n=new Date(Date.parse(e));return n},_dates:{},_zeropad:function(e){var t=Math.abs(e),n=e<0?"-":"";return n+(t<10?"0":"")+t},from:function(e){if(SC.none(e))return null;var t=this._dates[e.getTime()];if(t)return t;var n=this._zeropad,r=-e.getTimezoneOffset();if(r===0)r="Z";else{var i=r<0?"-":"+";r=Math.abs(r);var s=Math.floor(r/60),o=r%60;r=i+n(s)+":"+n(o)}return this._dates[e.getTime()]=t="%@-%@-%@T%@:%@:%@%@".fmt(n(e.getFullYear()),n(e.getMonth()+1),n(e.getDate()),n(e.getHours()),n(e.getMinutes()),n(e.getSeconds()),r),t}}),SC.DateTime&&!SC.RecordAttribute.transforms[SC.guidFor(SC.DateTime)]&&SC.RecordAttribute.registerTransform(SC.DateTime,{to:function(e,t){if(SC.none(e)||SC.instanceOf(e,SC.DateTime))return e;if(SC.none(e)||SC.instanceOf(e,Date))return SC.DateTime.create(e.getTime());var n=t.get("format");return SC.DateTime.parse(e,n?n:SC.DateTime.recordFormat)},from:function(e,t){if(SC.none(e))return e;var n=t.get("format"
);return e.toFormattedString(n?n:SC.DateTime.recordFormat)}}),SC.RecordAttribute.registerTransform(SC.Set,{to:function(e,t,n,r,i){return SC.Set.create(e)},from:function(e,t,n,r,i){return e.toArray()},observesChildren:["[]"]}),SC.ChildAttribute=SC.RecordAttribute.extend({isNestedRecordTransform:YES,toType:function(e,t,n){var r=null,i,s=this.get("typeClass");if(!e)throw"SC.Child: Error during transform: Unable to retrieve parent record.";return SC.none(n)||(r=e.registerNestedRecord(n,t)),r},fromType:function(e,t,n){var r,i,s;return e&&(SC.none(n)?(e.writeAttribute(t,n),s=n):(s=e.registerNestedRecord(n,t),s?(r=s.get("storeKey"),i=s.get("store"),e.writeAttribute(t,i.readDataHash(r))):n&&e.writeAttribute(t,n))),s},call:function(e,t,n){var r=this.get("key")||t,i,s=SC.keyFor("__kid__",SC.guidFor(this));return n!==undefined?n=this.fromType(e,t,n):(n=e.readAttribute(r),SC.none(n)&&(n=this.get("defaultValue"))?typeof n===SC.T_FUNCTION&&(n=this.defaultValue(e,t,this),e.attributes()&&e.writeAttribute(r,n,!0)):n=this.toType(e,t,n)),n}}),SC.ChildRecord=SC.Record.extend({}),SC.ChildRecord.extend=function(){return SC.Record.extend.apply(this,arguments)},SC.ChildArray=SC.Object.extend(SC.Enumerable,SC.Array,{defaultRecordType:null,record:null,propertyName:null,children:null,store:function(){return this.getPath("record.store")}.property("record").cacheable(),storeKey:function(){return this.getPath("record.storeKey")}.property("record").cacheable(),readOnlyChildren:function(){return this.get("record").readAttribute(this.get("propertyName"))}.property(),editableChildren:function(){var e=this.get
("store"),t=this.get("storeKey"),n=this.get("propertyName"),r,i;return r=e.readEditableProperty(t,n),r||(i=e.readEditableDataHash(t),r=i[n]=[]),r}.property(),length:function(){var e=this.get("readOnlyChildren");return e?e.length:0}.property("readOnlyChildren"),objectAt:function(e){var t=this._records,n=this.get("readOnlyChildren"),r,i,s=this.get("propertyName"),o=this.get("record"),u=n?n.length:0;return n?t&&(i=t[e])?i:(t||(this._records=t=[]),e>=u?undefined:(r=n.objectAt(e),r?(t[e]=i=o.registerNestedRecord(r,s,s+"."+e),i):undefined)):undefined},replace:function(e,t,n){var r=this.get("editableChildren"),i=n?n.get?n.get("length"):n.length:0,s=this.get("record"),o,u=this.get("propertyName"),a,f;return o=this._processRecordsToHashes(n),r.replace(e,t,o),o!==this._prevChildren&&(this._performRecordPropertyChange(null,!1),this.arrayContentWillChange(e,t,i),this._childrenContentDidChange(e,t,i)),s.recordDidChange(u),this},_processRecordsToHashes:function(e){var t,n;return e=e||[],e.forEach(function(r,i){r.isNestedRecord&&(t=r.get("store"),n=r.storeKey,e[i]=t.readDataHash(n))}),e},normalize:function(){this.forEach(function(e,t){e.normalize&&e.normalize()})},recordPropertyDidChange:function(e){return this._performRecordPropertyChange(e,!0),this},_performRecordPropertyChange:function(e,t){if(e&&!e.contains(this.get("propertyName")))return this;var n=this.get("readOnlyChildren"),r=0,i=0,s=this._prevChildren,o=this._childrenContentDidChange;return t=SC.none(t)?!0:t,n===s?this:(s&&(s.removeArrayObservers({target:this,willChange:this.arrayContentWillChange,didChange:o}),r=s.get("length"))
,n&&(n.addArrayObservers({target:this,willChange:this.arrayContentWillChange,didChange:o}),i=n.get("length")),this._prevChildren=n,t&&(this.arrayContentWillChange(0,r,i),this._childrenContentDidChange(0,r,i)),this)},_childrenContentDidChange:function(e,t,n){this._records=null,this.arrayContentDidChange(e,t,n)},init:function(){arguments.callee.base.apply(this,arguments),this.recordPropertyDidChange()}}),SC.ChildrenAttribute=SC.ChildAttribute.extend({toType:function(e,t,n){var r=this.get("key")||t,i=SC.keyFor("__kidsArray__",SC.guidFor(this)),s=e[i],o=this.get("typeClass"),u;return s||(s=SC.ChildArray.create({record:e,propertyName:r,defaultRecordType:o}),e[i]=s,u=e.get("relationships"),u||e.set("relationships",u=[]),u.push(s)),s},fromType:function(e,t,n){var r,i,s=SC.keyFor("__kidsArray__",SC.guidFor(this)),o=e[s];return e&&(e.writeAttribute(t,n),o&&(o=o.recordPropertyDidChange())),o}}),SC.FetchedAttribute=SC.RecordAttribute.extend({paramValueKey:"link",paramOwnerKey:"owner",paramRelKey:"rel",queryKey:null,isEditable:NO,toType:function(e,t,n){var r=e.get("store");if(!r)return null;var i=this.get("paramValueKey"),s=this.get("paramOwnerKey"),o=this.get("paramRelKey"),u=this.get("queryKey")||this.get("typeClass"),a={};return i&&(a[i]=n),s&&(a[s]=e),o&&(a[o]=this.get("key")||t),r.findAll(u,a)},fromType:function(e,t,n){return n}}),SC.ManyArray=SC.Object.extend(SC.Enumerable,SC.Array,{recordType:null,record:null,propertyName:null,manyAttribute:null,store:function(){return this.get("record").get("store")}.property("record").cacheable(),storeKey:function(){return this.get("record").get
("storeKey")}.property("record").cacheable(),readOnlyStoreIds:function(){return this.get("record").readAttribute(this.get("propertyName"))}.property(),editableStoreIds:function(){var e=this.get("store"),t=this.get("storeKey"),n=this.get("propertyName"),r,i;return r=e.readEditableProperty(t,n),r||(i=e.readEditableDataHash(t),r=i[n]=[]),r!==this._prevStoreIds&&this.recordPropertyDidChange(),r}.property(),isEditable:function(){var e=this.manyAttribute;return e?e.get("isEditable"):NO}.property("manyAttribute").cacheable(),inverse:function(){var e=this.manyAttribute;return e?e.get("inverse"):null}.property("manyAttribute").cacheable(),isMaster:function(){var e=this.manyAttribute;return e?e.get("isMaster"):null}.property("manyAttribute").cacheable(),orderBy:function(){var e=this.manyAttribute;return e?e.get("orderBy"):null}.property("manyAttribute").cacheable(),length:function(){var e=this.get("readOnlyStoreIds");return e?e.get("length"):0}.property("readOnlyStoreIds"),objectAt:function(e){var t=this._records,n=this.get("readOnlyStoreIds"),r=this.get("store"),i=this.get("recordType"),s,o,u;return!n||!r?undefined:t&&(o=t[e])?o:(t||(this._records=t=[]),u=n.objectAt(e),u&&(s=r.storeKeyFor(i,u),r.readStatus(s)===SC.Record.EMPTY&&r.retrieveRecord(i,null,s),t[e]=o=r.materializeRecord(s)),o)},replace:function(e,t,n){if(!this.get("isEditable"))throw"%@.%@[] is not editable".fmt(this.get("record"),this.get("propertyName"));var r=this.get("editableStoreIds"),i=n?n.get?n.get("length"):n.length:0,s=this.get("record"),o=this.get("propertyName"),u,a,f,l,c,h,p;f=[];for(u=0;u<i;u++)f[u]=n.objectAt
(u).get("id");c=this.get("inverse");if(c&&t>0){l=SC.ManyArray._toRemove,l?SC.ManyArray._toRemove=null:l=[];for(u=0;u<t;u++)l[u]=this.objectAt(e+u)}r.replace(e,t,f);if(c){for(u=0;u<t;u++)p=l[u],h=p?p[c]:null,h&&h.inverseDidRemoveRecord&&h.inverseDidRemoveRecord(p,c,s,o);l&&(l.length=0,SC.ManyArray._toRemove||(SC.ManyArray._toRemove=l));for(u=0;u<i;u++)p=n.objectAt(u),h=p?p[c]:null,h&&h.inverseDidAddRecord&&h.inverseDidAddRecord(p,c,s,o)}return s&&(!c||this.get("isMaster"))&&s.recordDidChange(o),this.enumerableContentDidChange(e,t,i-t),this},removeInverseRecord:function(e){if(!e)return this;var t=e.get("id"),n=this.get("editableStoreIds"),r=n&&t?n.indexOf(t):-1,i;return r>=0&&(n.removeAt(r),this.get("isMaster")&&(i=this.get("record"))&&i.recordDidChange(this.get("propertyName"))),this},addInverseRecord:function(e){if(!e)return this;var t=e.get("id"),n=this.get("editableStoreIds"),r=this.get("orderBy"),i=n.get("length"),s,o;return r?s=this._findInsertionLocation(e,0,i,r):s=i,n.insertAt(s,e.get("id")),this.get("isMaster")&&(o=this.get("record"))&&o.recordDidChange(this.get("propertyName")),this},_findInsertionLocation:function(e,t,n,r){var i=t+Math.floor((n-t)/2),s=this.objectAt(i),o=this._compare(e,s,r);return o<0?i===0?i:this._findInsertionLocation(e,0,i,r):o>0?i>=n?i:this._findInsertionLocation(e,i,n,r):i},_compare:function(e,t,n){var r=SC.typeOf(n),i,s,o;if(r===SC.T_FUNCTION)i=n(e,t);else if(r===SC.T_STRING)i=SC.compare(e,t);else{o=n.get("length"),i=0;for(s=0;i===0&&s<o;s++)i=SC.compare(e,t)}return i},recordPropertyDidChange:function(e){if(e&&!e.contains(this.get("propertyName"
)))return this;var t=this.get("readOnlyStoreIds"),n,r,i=this._prevStoreIds,s=this._storeIdsContentDidChange;if(t===i)return this;i?(i.removeArrayObservers({target:this,willChange:this.arrayContentWillChange,didChange:s}),n=i.get("length")):n=0,t?(t.addArrayObservers({target:this,willChange:this.arrayContentWillChange,didChange:s}),r=t.get("length")):r=0,this.arrayContentWillChange(0,n,r),this._prevStoreIds=t,this._storeIdsContentDidChange(0,n,r)},_storeIdsContentDidChange:function(e,t,n){this._records=null,this.arrayContentDidChange(e,t,n)},unknownProperty:function(e,t){var n;return SC.typeOf(e)===SC.T_STRING&&(n=this.reducedProperty(e,t)),n===undefined?arguments.callee.base.apply(this,arguments):n},init:function(){arguments.callee.base.apply(this,arguments),this.recordPropertyDidChange()}}),SC.ManyAttribute=SC.RecordAttribute.extend({inverse:null,isMaster:YES,orderBy:null,toType:function(e,t,n){var r=this.get("typeClass"),i=this.get("key")||t,s=SC.keyFor("__manyArray__",SC.guidFor(this)),o=e[s],u;return o||(o=SC.ManyArray.create({recordType:r,record:e,propertyName:i,manyAttribute:this}),e[s]=o,u=e.get("relationships"),u||e.set("relationships",u=[]),u.push(o)),o},fromType:function(e,t,n){var r=[];if(!SC.isArray(n))throw"Expects toMany attribute to be an array";var i=n.get("length");for(var s=0;s<i;s++)r[s]=n.objectAt(s).get("id");return r},inverseDidRemoveRecord:function(e,t,n,r){var i=e.get(t);i&&i.removeInverseRecord(n)},inverseDidAddRecord:function(e,t,n,r){var i=e.get(t);i&&i.addInverseRecord(n)}}),SC.SingleAttribute=SC.RecordAttribute.extend({inverse:null,isMaster:YES,call
:function(e,t,n){var r=this.get("key")||t,i,s,o,u,a,f;if(n!==undefined&&this.get("isEditable")){if(n&&!SC.kindOf(n,SC.Record))throw"%@ is not an instance of SC.Record".fmt(n);i=this.get("inverse"),i&&(o=this._scsa_call(e,t)),f=this.fromType(e,t,n),e.writeAttribute(r,f,!this.get("isMaster")),a=n,i&&o!==n&&(o&&(u=o[i])&&u.inverseDidRemoveRecord(o,i,e,t),n&&(u=n[i])&&u.inverseDidAddRecord(n,i,e,t))}else a=this._scsa_call(e,t,n);return a},_scsa_call:SC.RecordAttribute.prototype.call,inverseDidRemoveRecord:function(e,t,n,r){var i=this.get("inverse"),s=this._scsa_call(e,t),o=this.get("isMaster"),u;e.writeAttribute(t,null,!o),e.notifyPropertyChange(t),(s!==n||r!==i)&&s&&(u=s[i])&&u.inverseDidRemoveRecord(s,i,e,t)},inverseDidAddRecord:function(e,t,n,r){var i=this.get("inverse"),s=this._scsa_call(e,t),o=this.get("isMaster"),u,a;a=this.fromType(e,t,n),e.writeAttribute(t,a,!o),e.notifyPropertyChange(t),(s!==n||r!==i)&&s&&(u=s[i])&&u.inverseDidRemoveRecord(s,i,e,t)}}),SC.Store=SC.Object.extend({name:null,nestedStores:null,dataSource:null,isNested:NO,commitRecordsAutomatically:NO,from:function(e){return this.set("dataSource",e),this},_getDataSource:function(){var e=this.get("dataSource");return typeof e===SC.T_STRING&&(e=SC.requiredObjectForPropertyPath(e),e.isClass&&(e=e.create()),this.set("dataSource",e)),e},cascade:function(e){var t=SC.A(arguments);return e=SC.CascadeDataSource.create({dataSources:t}),this.from(e)},chain:function(e,t){e||(e={}),e.parentStore=this;if(t){if(SC.typeOf(t)!=="class")throw new Error("%@ is not a valid class".fmt(t));if(!SC.kindOf(t,SC.NestedStore))throw new 
Error("%@ is not a type of SC.NestedStore".fmt(t))}else t=SC.NestedStore;e.childRecords=this.childRecords?SC.clone(this.childRecords):{},e.parentRecords=this.parentRecords?SC.clone(this.parentRecords):{};var n=t.create(e),r=this.nestedStores;return r||(r=this.nestedStores=[]),r.push(n),n},willDestroyNestedStore:function(e){return this.nestedStores&&this.nestedStores.removeObject(e),this},hasNestedStore:function(e){while(e&&e!==this)e=e.get("parentStore");return e===this},dataHashes:null,statuses:null,revisions:null,editables:null,changelog:null,recordErrors:null,queryErrors:null,childRecords:null,parentRecords:null,storeKeyEditState:function(e){var t=this.editables,n=this.locks;return t&&t[e]?SC.Store.EDITABLE:SC.Store.LOCKED},readDataHash:function(e){return this.dataHashes[e]},readEditableDataHash:function(e){var t=this.dataHashes[e];if(!t)return t;var n=this.editables;return n||(n=this.editables=[]),n[e]||(n[e]=1,t=this.dataHashes[e]=SC.clone(t,YES)),t},readEditableProperty:function(e,t){var n=this.readEditableDataHash(e),r=this.editables[e],i=n[t];return r===1&&(r=this.editables[e]={}),r[t]||(i=n[t],i&&i.isCopyable&&(i=n[t]=i.copy(YES)),r[t]=YES),i},writeDataHash:function(e,t,n){t&&(this.dataHashes[e]=t),n&&(this.statuses[e]=n);var r=this.editables;r||(r=this.editables=[]),r[e]=1;var i=this;return this._propagateToChildren(e,function(e){i.writeDataHash(e,null,n)}),this},removeDataHash:function(e,t){this.dataHashes[e]=null,this.statuses[e]=t||SC.Record.EMPTY;var n=this.editables;return n&&(n[e]=0),this},readStatus:function(e){return this.readDataHash(e),this.statuses[e]||SC
.Record.EMPTY},peekStatus:function(e){return this.statuses[e]||SC.Record.EMPTY},writeStatus:function(e,t){return this.writeDataHash(e,null,t)},dataHashDidChange:function(e,t,n,r){t||(t=SC.Store.generateStoreKey());var i,s,o,u;i=SC.typeOf(e)===SC.T_ARRAY,i?s=e.length:(s=1,u=e);var a=this;for(o=0;o<s;o++)i&&(u=e[o]),this.revisions[u]=t,this._notifyRecordPropertyChange(u,n,r),this._propagateToChildren(u,function(e){a.dataHashDidChange(e,null,n,r)});return this},_notifyRecordPropertyChange:function(e,t,n){var r=this.records,i=this.get("nestedStores"),s=SC.Store,o,u,a,f,l,c,h;a=i?i.length:0;for(f=0;f<a;f++){l=i[f],c=l.peekStatus(e),u=l.storeKeyEditState(e);if(u===s.INHERITED)l._notifyRecordPropertyChange(e,t,n);else if(c&SC.Record.BUSY){if(l.get("hasChanges"))throw s.CHAIN_CONFLICT_ERROR;l.reset()}}var p=this.recordPropertyChanges;return p||(p=this.recordPropertyChanges={storeKeys:SC.CoreSet.create(),records:SC.CoreSet.create(),hasDataChanges:SC.CoreSet.create(),propertyForStoreKeys:{}}),p.storeKeys.add(e),r&&(o=r[e])&&(p.records.push(e),t||p.hasDataChanges.push(e),n?((h=p.propertyForStoreKeys[e])||(h=p.propertyForStoreKeys[e]=SC.CoreSet.create()),h!=="*"&&h.add(n)):p.propertyForStoreKeys[e]="*"),this.invokeOnce(this.flush),this},flush:function(){if(!this.recordPropertyChanges)return this;var e=this.recordPropertyChanges,t=e.storeKeys,n=e.hasDataChanges,r=e.records,i=e.propertyForStoreKeys,s=SC.CoreSet.create(),o,u,a,f,l,c,h;return t.forEach(function(e){r.contains(e)&&(a=n.contains(e)?NO:YES,o=this.records[e],h=i?i[e]:null,h==="*"&&(h=null),r.remove(e),o&&o.storeDidChangeProperties
(a,h)),u=SC.Store.recordTypeFor(e),s.add(u)},this),t.get("length")>0&&this._notifyRecordArrays(t,s),t.clear(),n.clear(),r.clear(),this.recordPropertyChanges.propertyForStoreKeys={},this},reset:function(){this.dataHashes={},this.revisions={},this.statuses={},this.chainedChanges=this.locks=this.editables=null,this.changelog=null,this.recordErrors=null,this.queryErrors=null;var e=this.get("dataSource");e&&e.reset&&e.reset();var t=this.records,n;if(t)for(n in t){if(!t.hasOwnProperty(n))continue;this._notifyRecordPropertyChange(parseInt(n,10),NO)}this.set("hasChanges",NO)},commitChangesFromNestedStore:function(e,t,n){n||this._verifyLockRevisions(t,e.locks);var r=t.length,i,s,o,u,a,f,l,c,h,p,d,v,m;f=this.revisions,o=this.dataHashes,u=this.statuses,a=this.editables,l=this.parentRecords?this.parentRecords:this.parentRecords={},c=this.childRecords?this.childRecords:this.childRecords={},a||(a=this.editables=[]),h=e.dataHashes,d=e.revisions,p=e.statuses,v=e.parentRecords||{},m=e.childRecords||{};for(i=0;i<r;i++)s=t[i],o[s]=h[s],u[s]=p[s],f[s]=d[s],l[s]=v[s],c[s]=m[s],a[s]=0,this._notifyRecordPropertyChange(s,NO);var g=this.changelog,y=e.changelog;return y&&(g||(g=this.changelog=SC.CoreSet.create()),g.addEach(y)),this.changelog=g,this.get("parentStore")||this.flush(),this},_verifyLockRevisions:function(e,t){var n=e.length,r=this.revisions,i,s,o,u;if(t&&r)for(i=0;i<n;i++){s=e[i],o=t[s]||1,u=r[s]||1;if(o<u)throw SC.Store.CHAIN_CONFLICT_ERROR}return this},find:function(e,t){SC.typeOf(e)===SC.T_STRING&&(e=SC.objectForPropertyPath(e));if(arguments.length===1&&!(e&&e.get&&e.get("isRecord"))){
if(!e)throw new Error("SC.Store#find() must pass recordType or query");return e.isQuery||(e=SC.Query.local(e)),this._findQuery(e,YES,YES)}return this._findRecord(e,t)},findAll:function(e,t,n){SC.Logger.warn("SC.Store#findAll() will be removed in a future version of SproutCore.  Use SC.Store#find() instead");if(!e||!e.isQuery)e=SC.Query.local(e,t,n);return this._findQuery(e,YES,YES)},_findQuery:function(e,t,n){var r=this._scst_recordArraysByQuery,i=SC.guidFor(e),s,o;return r||(r=this._scst_recordArraysByQuery={}),s=r[i],!s&&t&&(r[i]=s=SC.RecordArray.create({store:this,query:e}),o=this.get("recordArrays"),o||this.set("recordArrays",o=SC.Set.create()),o.add(s),n&&this.refreshQuery(e)),this.flush(),s},_findRecord:function(e,t){var n;return e&&e.get&&e.get("isRecord")?n=e.get("storeKey"):n=SC.none(t)?null:e.storeKeyFor(t),n&&this.readStatus(n)===SC.Record.EMPTY&&(n=this.retrieveRecord(e,t)),n?this.materializeRecord(n):null},recordArrayWillDestroy:function(e){var t=this._scst_recordArraysByQuery,n=this.get("recordArrays");return t&&delete t[SC.guidFor(e.get("query"))],n&&n.remove(e),this},refreshQuery:function(e){if(!e)throw new Error("refreshQuery() requires a query");var t=this._scst_recordArraysByQuery,n=t?t[SC.guidFor(e)]:null,r=this._getDataSource();return r&&r.fetch&&(n&&n.storeWillFetchQuery(e),r.fetch.call(r,this,e)),this},_notifyRecordArrays:function(e,t){var n=this.get("recordArrays");return n?(n.forEach(function(n){n&&n.storeDidChangeStoreKeys(e,t)},this),this):this},recordsFor:function(e){var t=[],n=e.storeKeysById(),r,i,s;for(r in n)i=n[r],this.readStatus(i)!==SC.RECORD_EMPTY&&
t.push(i);return t.length>0?s=SC.RecordArray.create({store:this,storeKeys:t}):s=t,s},_TMP_REC_ATTRS:{},materializeRecord:function(e){var t=this.records,n,r,i;return t||(t=this.records={}),n=t[e],n?n:(r=SC.Store.recordTypeFor(e),r?(i=this._TMP_REC_ATTRS,i.storeKey=e,i.store=this,n=t[e]=r.create(i),n):null)},createRecord:function(e,t,n){var r,i,s,o=SC.Record,u,a,f;!n&&(r=e.prototype.primaryKey)&&(n=t[r],a=e.prototype[r]?e.prototype[r].defaultValue:null,!n&&SC.typeOf(a)===SC.T_FUNCTION&&(n=t[r]=a())),i=n?e.storeKeyFor(n):SC.Store.generateStoreKey(),s=this.readStatus(i);if(s&o.BUSY||s&o.READY||s===o.DESTROYED_DIRTY)throw n?o.RECORD_EXISTS_ERROR:o.BAD_STATE_ERROR;if(!!n||s!==SC.DESTROYED_CLEAN&&s!==SC.ERROR)return this.writeDataHash(i,t?t:{},o.READY_NEW),SC.Store.replaceRecordTypeFor(i,e),this.dataHashDidChange(i),u=this.changelog,u||(u=SC.Set.create()),u.add(i),this.changelog=u,this.get("commitRecordsAutomatically")&&this.invokeLast(this.commitRecords),f=this.materializeRecord(i),f&&f.propagateToAggregates(),f;throw o.BAD_STATE_ERROR},createRecords:function(e,t,n){var r=[],i,s,o,u=t.length,a;o=SC.typeOf(e)===SC.T_ARRAY,o||(i=e);for(a=0;a<u;a++)o&&(i=e[a]||SC.Record),s=n?n[a]:undefined,r.push(this.createRecord(i,t[a],s));return r},unloadRecord:function(e,t,n,r){n===undefined&&(n=e.storeKeyFor(t));var i=this.readStatus(n),s=SC.Record;r=r||s.EMPTY;if(i===s.BUSY_DESTROYING||i&s.DESTROYED)return this;if(i&s.BUSY)throw s.BUSY_ERROR;i=r,this.removeDataHash(n,i),this.dataHashDidChange(n);var o=this;return this._propagateToChildren(n,function(e){o.unloadRecord(null,null,e,r)}),this},unloadRecords
:function(e,t,n,r){var i,s,o,u,a,f;if(n===undefined){s=SC.typeOf(e)===SC.T_ARRAY,s||(a=e);if(t===undefined){i=s?e.length:1;for(o=0;o<i;o++)s&&(a=e[o]),n=this.storeKeysFor(a),this.unloadRecords(undefined,undefined,n,r)}else{i=t.length;for(o=0;o<i;o++)s&&(a=e[o]||SC.Record),u=t?t[o]:undefined,this.unloadRecord(a,u,undefined,r)}}else{i=n.length;for(o=0;o<i;o++)f=n?n[o]:undefined,this.unloadRecord(undefined,undefined,f,r)}return this},destroyRecord:function(e,t,n){n===undefined&&(n=e.storeKeyFor(t));var r=this.readStatus(n),i,s=SC.Record;if(r===s.BUSY_DESTROYING||r&s.DESTROYED)return this;if(r&s.BUSY)throw s.BUSY_ERROR;r===s.READY_NEW?r=s.DESTROYED_CLEAN:r=s.DESTROYED_DIRTY,this.writeStatus(n,r),this.dataHashDidChange(n),i=this.changelog,i||(i=this.changelog=SC.Set.create()),r&s.DIRTY?i.add(n):i.remove(n),this.changelog=i,this.get("commitRecordsAutomatically")&&this.invokeLast(this.commitRecords);var o=this;return this._propagateToChildren(n,function(e){o.destroyRecord(null,null,e)}),this},destroyRecords:function(e,t,n){var r,i,s,o,u,a;if(n===undefined){r=t.length,i=SC.typeOf(e)===SC.T_ARRAY,i||(u=e);for(s=0;s<r;s++)i&&(u=e[s]||SC.Record),o=t?t[s]:undefined,this.destroyRecord(u,o,undefined)}else{r=n.length;for(s=0;s<r;s++)a=n?n[s]:undefined,this.destroyRecord(undefined,undefined,a)}return this},registerChildToParent:function(e,t,n){var r,i,s,o,u;i=this.childRecords||{},r=this.parentRecords||{},s=i[t],s&&(o=r[s],delete o[t]),u=r[e]||{},u[t]=n||YES,r[e]=u,i[t]=e,this.writeStatus(t,this.statuses[e]),this.childRecords=i,this.parentRecords=r},materializeParentRecord:function(e){var t
,n;return SC.none(e)?null:(n=this.childRecords,t=n?this.childRecords[e]:null,SC.none(t)?null:this.materializeRecord(t))},parentStoreKeyExists:function(e){if(SC.none(e))return;var t=this.childRecords||{};return t[e]},_propagateToChildren:function(e,t){if(SC.none(this.parentRecords))return;var n=this.parentRecords[e]||{};if(SC.none(t))return;for(var r in n)n.hasOwnProperty(r)&&t(r)},recordDidChange:function(e,t,n,r,i){n===undefined&&(n=e.storeKeyFor(t));var s=this.readStatus(n),o,u=SC.Record;if(s&u.BUSY)throw u.BUSY_ERROR;if(!(s&u.READY))throw u.NOT_FOUND_ERROR;return s!=u.READY_NEW&&this.writeStatus(n,u.READY_DIRTY),this.dataHashDidChange(n,null,i,r),o=this.changelog,o||(o=this.changelog=SC.Set.create()),o.add(n),this.changelog=o,this.get("commitRecordsAutomatically")&&this.invokeLast(this.commitRecords),this},recordsDidChange:function(e,t,n){var r,i,s,o,u,a;if(n===undefined){r=t.length,i=SC.typeOf(e)===SC.T_ARRAY,i||(u=e);for(s=0;s<r;s++)i&&(u=e[s]||SC.Record),o=t?t[s]:undefined,a=n?n[s]:undefined,this.recordDidChange(u,o,a)}else{r=n.length;for(s=0;s<r;s++)a=n?n[s]:undefined,this.recordDidChange(undefined,undefined,a)}return this},retrieveRecords:function(e,t,n,r,i){var s=this._getDataSource(),o=SC.typeOf(e)===SC.T_ARRAY,u=SC.typeOf(i)===SC.T_ARRAY,a=n?n.length:t.length,f=[],l=SC.Store.generateStoreKey(),c=SC.Record,h,p,d,v,m,g;o||(h=e);for(p=0;p<a;p++){n?d=n[p]:(o&&(h=e[p]),d=h.storeKeyFor(t[p])),g=u?i[p]:i,v=this.readStatus(d);if(v==c.EMPTY||v==c.ERROR||v==c.DESTROYED_CLEAN)this.writeStatus(d,c.BUSY_LOADING),this.dataHashDidChange(d,l,YES),f.push(d),this._setCallbackForStoreKey
(d,g,u,n);else if(r)if(v&c.READY)this.writeStatus(d,c.BUSY_REFRESH|v&3),this.dataHashDidChange(d,l,YES),f.push(d),this._setCallbackForStoreKey(d,g,u,n);else{if(v==c.BUSY_DESTROYING||v==c.BUSY_CREATING||v==c.BUSY_COMMITTING)throw c.BUSY_ERROR;if(v==c.DESTROYED_DIRTY)throw c.BAD_STATE_ERROR}}m=NO,s&&(m=s.retrieveRecords.call(s,this,f,t));if(!m){a=f.length,l=SC.Store.generateStoreKey();for(p=0;p<a;p++)d=f[p],v=this.readStatus(d),v===c.BUSY_LOADING?(this.writeStatus(d,c.ERROR),this.dataHashDidChange(d,l,YES)):v&c.BUSY_REFRESH&&(this.writeStatus(d,c.READY|v&3),this.dataHashDidChange(d,l,YES));f.length=0}return f},_TMP_RETRIEVE_ARRAY:[],_callback_queue:{},_setCallbackForStoreKey:function(e,t,n,r){var i=this._callback_queue;n?i[e]={callback:t,otherKeys:r}:i[e]=t},_retreiveCallbackForStoreKey:function(e){var t=this._callback_queue,n=t[e],r,i;n&&(SC.typeOf(n)===SC.T_FUNCTION?(n.call(),delete t[e]):SC.typeOf(n)==SC.T_HASH&&(n.completed=YES,i=n.storeKeys,i.forEach(function(e){t[e].completed||(r=YES)}),r&&(n.callback.call(),i.forEach(function(e){delete t[e]}))))},_cancelCallback:function(e){var t=this._callback_queue;t[e]&&delete t[e]},retrieveRecord:function(e,t,n,r,i){var s=this._TMP_RETRIEVE_ARRAY,o;return n?(s[0]=n,n=s,t=null):(s[0]=t,t=s),o=this.retrieveRecords(e,t,n,r,i),s.length=0,o[0]},refreshRecord:function(e,t,n,r){return!!this.retrieveRecord(e,t,n,YES,r)},refreshRecords:function(e,t,n,r){var i=this.retrieveRecords(e,t,n,YES,r);return i&&i.length>0},commitRecords:function(e,t,n,r,i){var s=this._getDataSource(),o=SC.typeOf(e)===SC.T_ARRAY,u=SC.typeOf(i)===SC.T_ARRAY,a=[],f=[],l=
[],c=SC.Store.generateStoreKey(),h=SC.Record,p,d,v,m,g,y,b,w;!e&&!t&&!n&&(n=this.changelog),b=n?n.get("length"):t?t.get("length"):0;for(d=0;d<b;d++){n?v=n[d]:(o?p=e[d]||SC.Record:p=e,v=p.storeKeyFor(t[d])),w=u?i[d]:i,m=this.readStatus(v);if(m==h.EMPTY||m==h.ERROR)throw h.NOT_FOUND_ERROR;m==h.READY_NEW?(this.writeStatus(v,h.BUSY_CREATING),this.dataHashDidChange(v,c,YES),a.push(v),this._setCallbackForStoreKey(v,w,u,n)):m==h.READY_DIRTY?(this.writeStatus(v,h.BUSY_COMMITTING),this.dataHashDidChange(v,c,YES),f.push(v),this._setCallbackForStoreKey(v,w,u,n)):m==h.DESTROYED_DIRTY?(this.writeStatus(v,h.BUSY_DESTROYING),this.dataHashDidChange(v,c,YES),l.push(v),this._setCallbackForStoreKey(v,w,u,n)):m==h.DESTROYED_CLEAN&&this.dataHashDidChange(v,c,YES)}return s&&(b>0||r)&&(y=s.commitRecords.call(s,this,a,f,l,r)),y&&!e&&!t&&(n===this.changelog?this.changelog=null:this.changelog.removeEach(n)),y},commitRecord:function(e,t,n,r,i){var s=this._TMP_RETRIEVE_ARRAY,o;return t===undefined&&n===undefined?NO:(n!==undefined?(s[0]=n,n=s,t=null):(s[0]=t,t=s),o=this.commitRecords(e,t,n,r,i),s.length=0,o)},cancelRecords:function(e,t,n){var r=this._getDataSource(),i=SC.typeOf(e)===SC.T_ARRAY,s=SC.Record,o=[],u,a,f,l,c,h;a=n===undefined?t.length:n.length;for(f=0;f<a;f++){i?c=e[f]||SC.Record:c=e||SC.Record,l=t?t[f]:undefined,n===undefined?h=c.storeKeyFor(l):h=n?n[f]:undefined;if(h){u=this.readStatus(h);if(u==s.EMPTY||u==s.ERROR)throw s.NOT_FOUND_ERROR;o.push(h),this._cancelCallback(h)}}return r&&r.cancel.call(r,this,o),this},cancelRecord:function(e,t,n){var r=this._TMP_RETRIEVE_ARRAY,i;return n!==undefined?
(r[0]=n,n=r,t=null):(r[0]=t,t=r),i=this.cancelRecords(e,t,n),r.length=0,this},loadRecord:function(e,t,n){var r=SC.Record,i,s,o;return e=e||SC.Record,s=e.prototype.primaryKey,n=n||t[s],i=o=e.storeKeyFor(n),this.readStatus(o)&r.BUSY?this.dataSourceDidComplete(o,t,n):this.pushRetrieve(e,n,t,o),i},loadRecords:function(e,t,n){var r=SC.typeOf(e)===SC.T_ARRAY,i=t.get("length"),s=[],o=SC.Record,u,a,f,l,c,h;r||(u=e||SC.Record,f=u.prototype.primaryKey);for(l=0;l<i;l++)c=t.objectAt(l),r&&(u=e.objectAt(l)||SC.Record,f=u.prototype.primaryKey),a=n?n.objectAt(l):c[f],s[l]=this.loadRecord(u,c,a);return s},readError:function(e){var t=this.recordErrors;return t?t[e]:undefined},readQueryError:function(e){var t=this.queryErrors;return t?t[SC.guidFor(e)]:undefined},dataSourceDidCancel:function(e){var t=this.readStatus(e),n=SC.Record;if(!(t&n.BUSY))throw n.BAD_STATE_ERROR;switch(t){case n.BUSY_LOADING:t=n.EMPTY;break;case n.BUSY_CREATING:t=n.READY_NEW;break;case n.BUSY_COMMITTING:t=n.READY_DIRTY;break;case n.BUSY_REFRESH_CLEAN:t=n.READY_CLEAN;break;case n.BUSY_REFRESH_DIRTY:t=n.READY_DIRTY;break;case n.BUSY_DESTROYING:t=n.DESTROYED_DIRTY;break;default:throw n.BAD_STATE_ERROR}return this.writeStatus(e,t),this.dataHashDidChange(e,null,YES),this._cancelCallback(e),this},dataSourceDidComplete:function(e,t,n){var r=this.readStatus(e),i=SC.Record,s;if(!(r&i.BUSY))throw i.BAD_STATE_ERROR;if(r===i.BUSY_DESTROYING)throw i.BAD_STATE_ERROR;r=i.READY_CLEAN,this.writeStatus(e,r),t&&this.writeDataHash(e,t,r),n&&SC.Store.replaceIdFor(e,n),s=t||n?NO:YES,this.dataHashDidChange(e,null,s);var o=this.materializeRecord
(e);return o!=null&&o.notifyPropertyChange("status"),this._retreiveCallbackForStoreKey(e),this},dataSourceDidDestroy:function(e){var t=this.readStatus(e),n=SC.Record;if(!(t&n.BUSY))throw n.BAD_STATE_ERROR;t=n.DESTROYED_CLEAN,this.removeDataHash(e,t),this.dataHashDidChange(e);var r=this.materializeRecord(e);return r!=null&&r.notifyPropertyChange("status"),this._retreiveCallbackForStoreKey(e),this},dataSourceDidError:function(e,t){var n=this.readStatus(e),r=this.recordErrors,i=SC.Record;if(!(n&i.BUSY))throw i.BAD_STATE_ERROR;n=i.ERROR,t&&t.isError&&(r||(r=this.recordErrors=[]),r[e]=t),this.writeStatus(e,n),this.dataHashDidChange(e,null,YES);var s=this.materializeRecord(e);return s!=null&&s.notifyPropertyChange("status"),this._retreiveCallbackForStoreKey(e),this},pushRetrieve:function(e,t,n,r){var i=SC.Record,s;return r===undefined&&(r=e.storeKeyFor(t)),s=this.readStatus(r),s==i.EMPTY||s==i.ERROR||s==i.READY_CLEAN||s==i.DESTROYED_CLEAN?(s=i.READY_CLEAN,n===undefined?this.writeStatus(r,s):this.writeDataHash(r,n,s),this.dataHashDidChange(r),r):NO},pushDestroy:function(e,t,n){var r=SC.Record,i;return n===undefined&&(n=e.storeKeyFor(t)),i=this.readStatus(n),i==r.EMPTY||i==r.ERROR||i==r.READY_CLEAN||i==r.DESTROYED_CLEAN?(i=r.DESTROYED_CLEAN,this.removeDataHash(n,i),this.dataHashDidChange(n),n):NO},pushError:function(e,t,n,r){var i=SC.Record,s,o=this.recordErrors;return r===undefined&&(r=e.storeKeyFor(t)),s=this.readStatus(r),s==i.EMPTY||s==i.ERROR||s==i.READY_CLEAN||s==i.DESTROYED_CLEAN?(s=i.ERROR,n&&n.isError&&(o||(o=this.recordErrors=[]),o[r]=n),this.writeStatus(r,s),this.dataHashDidChange
(r,null,YES),r):NO},loadQueryResults:function(e,t){if(e.get("location")===SC.Query.LOCAL)throw new Error("Cannot load query results for a local query");var n=this._findQuery(e,YES,NO);return n&&n.set("storeKeys",t),this.dataSourceDidFetchQuery(e),this},dataSourceDidFetchQuery:function(e){return this._scstore_dataSourceDidFetchQuery(e,YES)},_scstore_dataSourceDidFetchQuery:function(e,t){var n=this._findQuery(e,t,NO),r=this.get("nestedStores"),i=r?r.get("length"):0;n&&n.storeDidFetchQuery(e);while(--i>=0)r[i]._scstore_dataSourceDidFetchQuery(e,NO);return this},dataSourceDidCancelQuery:function(e){return this._scstore_dataSourceDidCancelQuery(e,YES)},_scstore_dataSourceDidCancelQuery:function(e,t){var n=this._findQuery(e,t,NO),r=this.get("nestedStores"),i=r?r.get("length"):0;n&&n.storeDidCancelQuery(e);while(--i>=0)r[i]._scstore_dataSourceDidCancelQuery(e,NO);return this},dataSourceDidErrorQuery:function(e,t){var n=this.queryErrors;return t&&t.isError&&(n||(n=this.queryErrors={}),n[SC.guidFor(e)]=t),this._scstore_dataSourceDidErrorQuery(e,YES)},_scstore_dataSourceDidErrorQuery:function(e,t){var n=this._findQuery(e,t,NO),r=this.get("nestedStores"),i=r?r.get("length"):0;n&&n.storeDidErrorQuery(e);while(--i>=0)r[i]._scstore_dataSourceDidErrorQuery(e,NO);return this},init:function(){arguments.callee.base.apply(this,arguments),this.reset()},toString:function(){var e=this.get("name");if(!e)return arguments.callee.base.apply(this,arguments);var t=arguments.callee.base.apply(this,arguments);return"%@ (%@)".fmt(e,t)},idFor:function(e){return SC.Store.idFor(e)},recordTypeFor:function(e){
return SC.Store.recordTypeFor(e)},storeKeyFor:function(e,t){return e.storeKeyFor(t)},storeKeyExists:function(e,t){return e.storeKeyExists(t)},storeKeysFor:function(e){var t=[],n=e&&e.isEnumerable,r,i,s;if(!this.statuses)return t;for(i in SC.Store.recordTypesByStoreKey)r=SC.Store.recordTypesByStoreKey[i],n?s=e.contains(r):s=r===e,s&&this.statuses[i]&&t.push(parseInt(i,10));return t},storeKeys:function(){var e=[],t;if(!this.statuses)return e;for(t in this.statuses)this.statuses[t]!=SC.Record.EMPTY&&e.push(parseInt(t,10));return e},statusString:function(e){var t=this.materializeRecord(e);return t.statusString()}}),SC.Store.mixin({CHAIN_CONFLICT_ERROR:new Error("Nested Store Conflict"),NO_PARENT_STORE_ERROR:new Error("Parent Store Required"),NESTED_STORE_UNSUPPORTED_ERROR:new Error("Unsupported In Nested Store"),NESTED_STORE_RETRIEVE_DIRTY_ERROR:new Error("Cannot Retrieve Dirty Record in Nested Store"),EDITABLE:"editable",LOCKED:"locked",INHERITED:"inherited",idsByStoreKey:[],recordTypesByStoreKey:{},queriesByStoreKey:[],nextStoreKey:1,generateStoreKey:function(){return this.nextStoreKey++},idFor:function(e){return this.idsByStoreKey[e]},queryFor:function(e){return this.queriesByStoreKey[e]},recordTypeFor:function(e){return this.recordTypesByStoreKey[e]},replaceIdFor:function(e,t){var n=this.idsByStoreKey[e],r,i;if(n!==t){r=this.recordTypeFor(e);if(!r)throw new Error("replaceIdFor: storeKey %@ does not exist".fmt(e));this.idsByStoreKey[e]=t,i=r.storeKeysById(),delete i[n],i[t]=e}return this},replaceRecordTypeFor:function(e,t){return this.recordTypesByStoreKey[e]=t,this}}),SC.Store
.prototype.nextStoreIndex=1,SC.Store._getDefaultStore=function(){var e=this._store;return e||(this._store=e=SC.Store.create()),e},SC.Store.updateRecords=function(e,t,n,r){SC.Logger.warn("SC.Store.updateRecords() is deprecated.  Use loadRecords() instead");var i=this._getDefaultStore(),s=e.length,o,u;if(!n){n=[];for(o=0;o<s;o++)n[o]=e[o].recordType}u=i.loadRecords(n,e),s=u.length;for(o=0;o<s;o++)u[o]=i.materializeRecord(u[o]);return u},SC.Store.find=function(e,t){return this._getDefaultStore().find(t,e)},SC.Store.findAll=function(e,t){return this._getDefaultStore().findAll(e,t)},SC.NestedStore=SC.Store.extend({hasChanges:NO,parentStore:null,isNested:YES,lockOnRead:YES,locks:null,chainedChanges:null,find:function(e){if(e&&e.isQuery&&e.get("location")!==SC.Query.LOCAL)throw"SC.Store#find() can only accept LOCAL queries in nested stores";return arguments.callee.base.apply(this,arguments)},commitChanges:function(e){if(this.get("hasChanges")){var t=this.get("parentStore");t.commitChangesFromNestedStore(this,this.chainedChanges,e)}return this.reset(),this},discardChanges:function(){var e,t;if((e=this.records)&&(t=this.locks)){var n=this.get("parentStore"),r=n.revisions,i=this.revisions,s,o,u;for(s in e){if(!e.hasOwnProperty(s))continue;if(!(o=t[s]))continue;u=r[s],(u!==o||i[s]>u)&&this._notifyRecordPropertyChange(parseInt(s,10))}}return this.reset(),this.flush(),this},destroy:function(){this.discardChanges();var e=this.get("parentStore");return e&&e.willDestroyNestedStore(this),arguments.callee.base.apply(this,arguments),this},reset:function(){var e,t,n,r=this.get("parentStore");if(!
r)throw SC.Store.NO_PARENT_STORE_ERROR;this.dataHashes=SC.beget(r.dataHashes),this.revisions=SC.beget(r.revisions),this.statuses=SC.beget(r.statuses),this.childRecords=r.childRecords?SC.beget(r.childRecords):{},this.parentRecords=r.parentRecords?SC.beget(r.parentRecords):{},this.chainedChanges=this.locks=this.editables=null,this.changelog=null,this.set("hasChanges",NO)},refreshQuery:function(e){var t=this.get("parentStore");return t&&t.refreshQuery(e),this},readError:function(e){var t=this.get("parentStore");return t?t.readError(e):null},readQueryError:function(e){var t=this.get("parentStore");return t?t.readQueryError(e):null},storeKeyEditState:function(e){var t=this.editables,n=this.locks;return t&&t[e]?SC.Store.EDITABLE:n&&n[e]?SC.Store.LOCKED:SC.Store.INHERITED},_lock:function(e){var t=this.locks,n,r,i,s,o,u,a,f;if(t&&t[e])return this;t||(t=this.locks=[]),r=this.editables,r&&(r[e]=0);var l=this.get("parentStore"),c;while(l&&(c=l.storeKeyEditState(e))===SC.Store.INHERITED)l=l.get("parentStore");return l&&c===SC.Store.EDITABLE?(i=this.childRecords[e],i?(this._lock(i),s=this.parentRecords[i],s&&(o=s[e],u=o?SC.tupleForPropertyPath(o,this.dataHashes[i]):null,u&&(a=u[0],f=u[1]),this.dataHashes[e]=a&&f?a[f]:null)):this.dataHashes[e]=SC.clone(l.dataHashes[e],YES),r||(r=this.editables=[]),r[e]=1):this.dataHashes[e]=l.dataHashes[e],this.statuses[e]=this.statuses[e],n=this.revisions[e]=this.revisions[e],t[e]=n||1,this},readDataHash:function(e){return this.get("lockOnRead")&&this._lock(e),this.dataHashes[e]},readEditableDataHash:function(e){return this._lock(e),arguments.callee.base
.apply(this,arguments)},writeDataHash:function(e,t,n){var r=this.locks,i=NO,s;t?this.dataHashes[e]=t:(this._lock(e),i=YES),n?this.statuses[e]=n:i||(this.statuses[e]=this.statuses[e]||SC.Record.READY_NEW),i||(s=this.revisions[e]=this.revisions[e],r||(r=this.locks=[]),r[e]||(r[e]=s||1));var o=this.editables;return o||(o=this.editables=[]),o[e]=1,this},removeDataHash:function(e,t){var n=this.locks;return n||(n=this.locks=[]),n[e]||(n[e]=this.revisions[e]||1),arguments.callee.base.apply(this,arguments)},dataHashDidChange:function(e,t,n,r){t||(t=SC.Store.generateStoreKey());var i,s,o,u;i=SC.typeOf(e)===SC.T_ARRAY,i?s=e.length:(s=1,u=e);var a=this.chainedChanges;a||(a=this.chainedChanges=SC.Set.create());for(o=0;o<s;o++)i&&(u=e[o]),this._lock(u),this.revisions[u]=t,a.add(u),this._notifyRecordPropertyChange(u,n,r);return this.setIfChanged("hasChanges",YES),this},commitChangesFromNestedStore:function(e,t,n){arguments.callee.base.apply(this,arguments);var r=this.get("parentStore"),i=r.revisions,s,o=this.locks,u=this.chainedChanges,a,f;o||(o=this.locks=[]),u||(u=this.chainedChanges=SC.Set.create()),a=t.length;for(s=0;s<a;s++)f=t[s],o[f]||(o[f]=i[f]||1),u.add(f);return this.setIfChanged("hasChanges",u.get("length")>0),this.flush(),this},queryFor:function(e,t,n){return this.get("parentStore").queryFor(e,t,n)},findAll:function(e,t,n,r,i){return i||(i=this),this.get("parentStore").findAll(e,t,n,r,i)},retrieveRecords:function(e,t,n,r){var i=this.get("parentStore"),s,o,u,a=n?n.length:t.length,f=SC.Record,l;if(r)for(s=0;s<a;s++){o=n?n[s]:i.storeKeyFor(e,t[s]),l=this.peekStatus(o);if(l&f.DIRTY
)throw SC.Store.NESTED_STORE_RETRIEVE_DIRTY_ERROR;var c=this.dataHashes,h=this.revisions,p=this.statuses,d=this.editables,v=this.locks,m=NO,g=NO;c&&c.hasOwnProperty(o)&&(delete c[o],m=YES),h&&h.hasOwnProperty(o)&&(delete h[o],m=YES),d&&delete d[o],v&&delete v[o],p&&p.hasOwnProperty(o)&&(delete p[o],m||(g=YES),m=YES),m&&this._notifyRecordPropertyChange(o,g)}return i.retrieveRecords(e,t,n,r)},commitRecords:function(e,t,n){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},commitRecord:function(e,t,n){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},cancelRecords:function(e,t,n){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},cancelRecord:function(e,t,n){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},dataSourceDidCancel:function(e){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},dataSourceDidComplete:function(e,t,n){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},dataSourceDidDestroy:function(e){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},dataSourceDidError:function(e,t){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},pushRetrieve:function(e,t,n,r){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},pushDestroy:function(e,t,n){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},pushError:function(e,t,n,r){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR}}),SC.RecordArray=SC.Object.extend(SC.Enumerable,SC.Array,{store:null,query:null,storeKeys:null,status:SC.Record.EMPTY,isEditable:function(){var e=this.get("query");return e?e.get("isEditable"):YES}.property("query").cacheable(),length:function(){this.flush();var e=this.get("storeKeys");return e?e.get("length"):0}.property("storeKeys").cacheable(),
_scra_records:null,objectAt:function(e){this.flush();var t=this._scra_records,n=this.get("storeKeys"),r=this.get("store"),i,s;return!n||!r?undefined:t&&(s=t[e])?s:(t||(this._scra_records=t=[]),i=n.objectAt(e),i&&(r.peekStatus(i)===SC.Record.EMPTY&&r.retrieveRecord(null,null,i),t[e]=s=r.materializeRecord(i)),s)},forEach:function(e,t){this.flush();var n=this._scra_records,r=this.get("storeKeys"),i=this.get("store"),s=r?r.get("length"):0,o,u,a;if(!r||!i)return this;n||(n=this._scra_records=[]),t||(t=this);for(o=0;o<s;o++)a=n[o],a||(a=n[o]=i.materializeRecord(r.objectAt(o))),e.call(t,a,o,this);return this},replace:function(e,t,n){this.flush();var r=this.get("storeKeys"),i=n?n.get?n.get("length"):n.length:0,s,o;if(!r)throw"Unable to edit an SC.RecordArray that does not have its storeKeys property set.";if(!this.get("isEditable"))throw SC.RecordArray.NOT_EDITABLE;o=[];for(s=0;s<i;s++)o[s]=n.objectAt(s).get("storeKey");return r.replace(e,t,o),this},contains:function(e){return this.indexOf(e)>=0},indexOf:function(e,t){if(!SC.kindOf(e,SC.Record))return SC.Logger.warn("Using indexOf on %@ with an object that is not an SC.Record".fmt(e)),-1;this.flush();var n=e.get("storeKey"),r=this.get("storeKeys");return r?r.indexOf(n,t):-1},lastIndexOf:function(e,t){if(!SC.kindOf(e,SC.Record))return SC.Logger.warn("Using lastIndexOf on %@ with an object that is not an SC.Record".fmt(e)),-1;this.flush();var n=e.get("storeKey"),r=this.get("storeKeys");return r?r.lastIndexOf(n,t):-1},add:function(e){return SC.kindOf(e,SC.Record)?(this.indexOf(e)<0&&this.pushObject(e),this):this},remove:function(e){return SC
.kindOf(e,SC.Record)?(this.removeObject(e),this):this},find:function(e,t,n){return t&&t.isQuery?this.get("store").find(t.queryWithScope(this)):e.apply(this,SC.$A(arguments).slice(1))}.enhance(),refresh:function(){return this.get("store").refreshQuery(this.get("query")),this},reload:function(){return this.flush(YES),this},destroy:function(){this.get("isDestroyed")||this.get("store").recordArrayWillDestroy(this),arguments.callee.base.apply(this,arguments)},storeWillFetchQuery:function(e){var t=this.get("status"),n=SC.Record;if(t===n.EMPTY||t===n.ERROR)t=n.BUSY_LOADING;return t&n.READY&&(t=n.BUSY_REFRESH),this.setIfChanged("status",t),this},storeDidFetchQuery:function(e){return this.setIfChanged("status",SC.Record.READY_CLEAN),this},storeDidCancelQuery:function(e){var t=this.get("status"),n=SC.Record;return t===n.BUSY_LOADING?t=n.EMPTY:t===n.BUSY_REFRESH&&(t=n.READY_CLEAN),this.setIfChanged("status",t),this},storeDidErrorQuery:function(e){return this.setIfChanged("status",SC.Record.ERROR),this},storeDidChangeStoreKeys:function(e,t){var n=this.get("query");if(n.get("location")!==SC.Query.LOCAL)return this;if(!n.containsRecordTypes(t))return this;var r=this._scq_changedStoreKeys;return r||(r=this._scq_changedStoreKeys=SC.IndexSet.create()),r.addEach(e),this.set("needsFlush",YES),this.get("storeKeys")&&this.flush(),this},flush:function(e){if(this._insideFlush)return this.set("needsFlush",YES),this;if(!this.get("needsFlush")&&!e)return this;this.set("needsFlush",NO);var t=this.get("query"),n=this.get("store");if(!n||!t||t.get("location")!==SC.Query.LOCAL)return this;this._insideFlush=
YES;var r=this.get("storeKeys"),i=this._scq_changedStoreKeys,s=NO,o=SC.Record,u=[],a=new Date,f,l,c,h,p,d,v=r;if(r&&!e)i&&(i.forEach(function(e){if(u.length>0||new Date-a>SC.RecordArray.QUERY_MATCHING_THRESHOLD){u.push(e);return}l=n.peekStatus(e),!(l&o.EMPTY)&&!(l&o.DESTROYED||l===o.BUSY_DESTROYING)?(f=n.materializeRecord(e),d=!!f&&!!t.contains(f)):d=NO,d?r.indexOf(e)<0&&(s||(r=r.copy()),r.pushObject(e)):r.indexOf(e)>=0&&(s||(r=r.copy()),r.removeObject(e))},this),s=YES);else{if(p=t.get("scope"))h=p.flush().get("storeKeys");else if(c=t.get("expandedRecordTypes"))h=SC.IndexSet.create(),c.forEach(function(e){h.addEach(n.storeKeysFor(e))});r=[],h.forEach(function(e){if(u.length>0||new Date-a>SC.RecordArray.QUERY_MATCHING_THRESHOLD){u.push(e);return}l=n.peekStatus(e),!(l&o.EMPTY)&&!(l&o.DESTROYED||l===o.BUSY_DESTROYING)&&(f=n.materializeRecord(e),f&&t.contains(f)&&r.push(e))}),s=YES}if(u.length>0){var m=this;window.setTimeout(function(){SC.run(function(){if(!m||m.get("isDestroyed"))return;m.set("needsFlush",YES),m._scq_changedStoreKeys=SC.IndexSet.create().addEach(u),m.flush()})},1)}return i&&i.clear(),s&&(r&&r===v&&(r=r.copy()),r=SC.Query.orderStoreKeys(r,t,n),SC.compare(v,r)!==0&&this.set("storeKeys",SC.clone(r))),this._insideFlush=NO,this},needsFlush:YES,isError:function(){return this.get("status")&SC.Record.ERROR}.property("status").cacheable(),errorValue:function(){return this.get("isError")?SC.val(this.get("errorObject")):null}.property("isError").cacheable(),errorObject:function(){if(this.get("isError")){var e=this.get("store");return e.readQueryError(this.get("query"))||SC
.Record.GENERIC_ERROR}return null}.property("isError").cacheable(),propertyWillChange:function(e,t){if(e==="storeKeys"){var n=this.get("storeKeys"),r=n?n.get("length"):0,i=t?t.get("length"):0;this.arrayContentWillChange(0,r,i)}return arguments.callee.base.apply(this,arguments)},_storeKeysDidChange:function(){var e=this.get("storeKeys"),t=this._prevStoreKeys,n,r,i=this._storeKeysContentDidChange,s=this._storeKeysStateDidChange;if(e===t)return;t?(t.removeArrayObservers({target:this,willChange:this.arrayContentWillChange,didChange:this._storeKeysContentDidChange}),n=t.get("length")):n=0,this._prevStoreKeys=e,e?(e.addArrayObservers({target:this,willChange:this.arrayContentWillChange,didChange:this._storeKeysContentDidChange}),r=e.get("length")):r=0,this._storeKeysContentDidChange(0,n,r)}.observes("storeKeys"),addArrayObservers:function(){return this.flush(),SC.Array.addArrayObservers.apply(this,arguments)},_storeKeysContentDidChange:function(e,t,n){this._scra_records&&(this._scra_records.length=0),this.arrayContentDidChange(e,t,n)},init:function(){arguments.callee.base.apply(this,arguments),this._storeKeysDidChange()}}),SC.RecordArray.mixin({NOT_EDITABLE:SC.Error.desc("SC.RecordArray is not editable"),QUERY_MATCHING_THRESHOLD:100}),Function.prototype.handleEvents=function(){return this.isEventHandler=YES,this.events=arguments,this},Function.prototype.stateObserves=function(){return this.isStateObserveHandler=YES,this.args=SC.A(arguments),this},SC.StatechartEventDelegate={isStatechartEventDelegate:YES,tryToPerform:function(e,t,n){if(!this.respondsTo(e))return NO;if(SC.typeOf(this
[e])===SC.T_FUNCTION){var r=this[e](t,n);if(r!==NO)return YES}return!!this.sendEvent(e,t,n)},sendEvent:function(e,t,n){}},SC.StatechartRoutingDelegate={isStatechartDelegate:YES,isStatechartRoutingDelegate:YES,statechartUpdateLocationForState:function(e,t,n){SC.routes.set("location",t)},statechartAcquireLocationForState:function(e,t){return SC.routes.get("location")},statechartBindStateToRoute:function(e,t,n,r){SC.routes.add(n,t,r)},statechartShouldStateHandleTriggeredRoute:function(e,t,n){return YES},statechartStateCancelledHandlingTriggeredRoute:function(e,t,n){}},SC.StatechartDelegate=SC.StatechartRoutingDelegate,SC.StatePathMatcher=SC.Object.extend({state:null,expression:null,tokens:null,init:function(){arguments.callee.base.apply(this,arguments),this._parseExpression()},_parseExpression:function(){var e=this.expression?this.expression.split("."):[],t=e.length,n=0,r,i=null,s,o=[];for(;n<t;n+=1){r=e[n];if(r.indexOf("~")>=0){r=r.split("~");if(r.length>2)throw"Invalid use of '~' at part %@".fmt(n);s=SC.StatePathMatcher._ExpandToken.create({start:r[0],end:r[1]})}else if(r==="this"){if(o.length>0)throw"Invalid use of 'this' at part %@".fmt(n);s=SC.StatePathMatcher._ThisToken.create()}else s=SC.StatePathMatcher._BasicToken.create({value:r});s.owner=this,o.push(s)}this.set("tokens",o);var u=SC.clone(o);this._chain=i=u.pop();while(s=u.pop())i.nextToken=s,i=s},lastPart:function(){var e=this.get("tokens"),t=e?e.length:0,n=t>0?e[t-1]:null;return n.get("lastPart")}.property("tokens").cacheable(),match:function(e){return this._stack=e.split("."),SC.empty(e)||SC.typeOf(e)!==SC.T_STRING?
NO:this._chain.match()},_pop:function(){return this._lastPopped=this._stack.pop(),this._lastPopped}}),SC.StatePathMatcher._Token=SC.Object.extend({type:null,owner:null,nextToken:null,lastPart:null,match:function(){return NO}}),SC.StatePathMatcher._BasicToken=SC.StatePathMatcher._Token.extend({type:"basic",value:null,lastPart:function(){return this.value}.property("value").cacheable(),match:function(){var e=this.owner._pop(),t=this.nextToken;return this.value!==e?NO:t?t.match():YES}}),SC.StatePathMatcher._ExpandToken=SC.StatePathMatcher._Token.extend({type:"expand",start:null,end:null,lastPart:function(){return this.end}.property("end").cacheable(),match:function(){var e=this.start,t=this.end,n,r=this.nextToken;n=this.owner._pop();if(n!==t)return NO;while(n=this.owner._pop())if(n===e)return r?r.match():YES;return NO}}),SC.StatePathMatcher._ThisToken=SC.StatePathMatcher._Token.extend({type:"this",lastPart:"this",match:function(){var e=this.owner.state,t=e.get("substates"),n=t.length,r=0,i;i=this.owner._lastPopped;if(!i||this.owner._stack.length!==0)return NO;for(;r<n;r+=1)if(t[r].get("name")===i)return YES;return NO}}),SC.Async=SC.Object.extend({func:null,arg1:null,arg2:null,tryToPerform:function(e){var t=this.get("func"),n=this.get("arg1"),r=this.get("arg2"),i=SC.typeOf(t);i===SC.T_STRING?e.tryToPerform(t,n,r):i===SC.T_FUNCTION&&t.apply(e,[n,r])}}),SC.Async.mixin({perform:function(e,t,n){return SC.Async.create({func:e,arg1:t,arg2:n})}}),SC.State=SC.Object.extend({name:null,parentState:null,historyState:null,initialSubstate:null,substatesAreConcurrent:NO,substates:null,statechart
:null,stateIsInitialized:NO,currentSubstates:null,enteredSubstates:null,representRoute:null,trace:function(){var e=this.getPath("statechart.statechartTraceKey");return this.getPath("statechart.%@".fmt(e))}.property().cacheable(),owner:function(){var e=this.get("statechart"),t=e?e.get("statechartOwnerKey"):null,n=e?e.get(t):null;return n?n:e}.property().cacheable(),statechartDelegate:function(){return this.getPath("statechart.statechartDelegate")}.property().cacheable(),routingDelegate:function(){return this.getPath("statechart.routingDelegateValue")}.property().cacheable(),location:function(e,t){var n=this.get("statechart"),r=this.get("routingDelegate");return t!==undefined&&r.statechartUpdateLocationForState(n,t,this),r.statechartAcquireLocationForState(n,this)}.property().idempotent(),init:function(){arguments.callee.base.apply(this,arguments),this._registeredEventHandlers={},this._registeredStringEventHandlers={},this._registeredRegExpEventHandlers=[],this._registeredStateObserveHandlers={},this._registeredSubstatePaths={},this._registeredSubstates=[],this._isEnteringState=NO,this._isExitingState=NO;var e=this.get("statechart"),t=e?e.get("statechartOwnerKey"):null,n=e?e.get("statechartTraceKey"):null;e&&(e.addObserver(t,this,"_statechartOwnerDidChange"),e.addObserver(n,this,"_statechartTraceDidChange"))},destroy:function(){var e=this.get("statechart"),t=e?e.get("statechartOwnerKey"):null,n=e?e.get("statechartTraceKey"):null;e&&(e.removeObserver(t,this,"_statechartOwnerDidChange"),e.removeObserver(n,this,"_statechartTraceDidChange"));var r=this.get("substates");r&&r.forEach
(function(e){e.destroy()}),this._teardownAllStateObserveHandlers(),this.set("substates",null),this.set("currentSubstates",null),this.set("enteredSubstates",null),this.set("parentState",null),this.set("historyState",null),this.set("initialSubstate",null),this.set("statechart",null),this.notifyPropertyChange("trace"),this.notifyPropertyChange("owner"),this._registeredEventHandlers=null,this._registeredStringEventHandlers=null,this._registeredRegExpEventHandlers=null,this._registeredStateObserveHandlers=null,this._registeredSubstatePaths=null,this._registeredSubstates=null,arguments.callee.base.apply(this,arguments)},initState:function(){if(this.get("stateIsInitialized"))return;this._registerWithParentStates(),this._setupRouteHandling();var e=null,t=null,n=null,r=null,i=this.constructor,s=null,o=[],u=NO,a=this.get("initialSubstate"),f=this.get("substatesAreConcurrent"),l=this.get("statechart"),c=0,h=0,p=NO,d=null;this.set("substates",o),a&&a.isClass&&SC.kindOf(a,SC.HistoryState)&&(d=this.createSubstate(a),this.set("initialSubstate",d),SC.none(d.get("defaultState"))&&(this.stateLogError("Initial substate is invalid. History state requires the name of a default state to be set"),this.set("initialSubstate",null),d=null));for(e in this){t=this[e];if(!t)continue;r=t,n=t.isClass,p=!n&&t instanceof Function;if(p){if(t.isEventHandler){this._registerEventHandler(e,t);continue}if(t.isStateObserveHandler){this._registerStateObserveHandler(e,t);continue}t.statePlugin&&(t=t.apply(this))}t&&t.isClass&&r!==i&&SC.kindOf(t,SC.State)&&(s=this._addSubstate(e,t),e===a?(this.set("initialSubstate",s
),u=YES):d&&d.get("defaultState")===e&&(d.set("defaultState",s),u=YES))}!SC.none(a)&&!u&&this.stateLogError("Unable to set initial substate %@ since it did not match any of state's %@ substates".fmt(a,this)),o.length===0?SC.none(a)||this.stateLogWarning("Unable to make %@ an initial substate since state %@ has no substates".fmt(a,this)):o.length>0&&(s=this._addEmptyInitialSubstateIfNeeded(),!s&&a&&f&&(this.set("initialSubstate",null),this.stateLogWarning("Can not use %@ as initial substate since substates are all concurrent for state %@".fmt(a,this)))),this.notifyPropertyChange("substates"),this.set("currentSubstates",[]),this.set("enteredSubstates",[]),this.set("stateIsInitialized",YES)},_setupRouteHandling:function(){var e=this.get("representRoute"),t=this.get("statechart"),n=this.get("routingDelegate");if(!e)return;if(this.get("isConcurrentState")){this.stateLogError("State %@ cannot handle route '%@' since state is concurrent".fmt(this,e));return}n.statechartBindStateToRoute(t,this,e,this.routeTriggered)},routeTriggered:function(e){if(this._isEnteringState)return;var t=this.get("statechart"),n=this.get("routingDelegate"),r=this.get("location"),i={state:this,location:r,params:e,handler:this.routeTriggered},s=this.createStateRouteHandlerContext(i);n.statechartShouldStateHandleTriggeredRoute(t,this,s)?(this.get("trace")&&r&&this.stateLogTrace("will handle route '%@'".fmt(r)),this.handleTriggeredRoute(s)):n.statechartStateCancelledHandlingTriggeredRoute(t,this,s)},createStateRouteHandlerContext:function(e){return SC.StateRouteHandlerContext.create(e)},handleTriggeredRoute:function(
e){this.gotoState(this,e)},_addEmptyInitialSubstateIfNeeded:function(){var e=this.get("initialSubstate"),t=this.get("substatesAreConcurrent");if(e||t)return null;var n=this.createSubstate(SC.EmptyState);return this.set("initialSubstate",n),this.get("substates").push(n),this[n.get("name")]=n,n.initState(),this.stateLogWarning("state %@ has no initial substate defined. Will default to using an empty state as initial substate".fmt(this)),n},_addSubstate:function(e,t,n){var r=this.get("substates");return n=SC.clone(n)||{},n.name=e,t=this.createSubstate(t,n),r.push(t),this[e]=t,t.initState(),t},addSubstate:function(e,t,n){if(SC.empty(e))return this.stateLogError("Can not add substate. name required"),null;if(this[e]!==undefined)return this.stateLogError("Can not add substate '%@'. Already a defined property".fmt(e)),null;if(!this.get("stateIsInitialized"))return this.stateLogError("Can not add substate '%@'. this state is not yet initialized".fmt(e)),null;var r=arguments.length;r===1?t=SC.State:r===2&&SC.typeOf(t)===SC.T_HASH&&(n=t,t=SC.State);var i=t&&t.isClass&&SC.kindOf(t,SC.State);return i?(t=this._addSubstate(e,t,n),this._addEmptyInitialSubstateIfNeeded(),this.notifyPropertyChange("substates"),t):(this.stateLogError("Can not add substate '%@'. must provide a state class".fmt(e)),null)},createSubstate:function(e,t){return t=t||{},e.create({parentState:this,statechart:this.get("statechart")},t)},_registerEventHandler:function(e,t){var n=t.events,r=null,i=n.length,s=0;this._registeredEventHandlers[e]=t;for(;s<i;s+=1){r=n[s];if(SC.typeOf(r)===SC.T_STRING){this._registeredStringEventHandlers
[r]={name:e,handler:t};continue}if(r instanceof RegExp){this._registeredRegExpEventHandlers.push({name:e,handler:t,regexp:r});continue}this.stateLogError("Invalid event %@ for event handler %@ in state %@".fmt(r,e,this))}},_registerStateObserveHandler:function(e,t){var n=0,r=t.args,i=r.length,s,o=YES;for(;n<i;n+=1){s=r[n];if(SC.typeOf(s)!==SC.T_STRING||SC.empty(s))this.stateLogError("Invalid argument %@ for state observe handler %@ in state %@".fmt(s,e,this)),o=NO}if(!o)return;this._registeredStateObserveHandlers[e]=t.args},_registerWithParentStates:function(){var e=this.get("parentState");while(!SC.none(e))e._registerSubstate(this),e=e.get("parentState")},_registerSubstate:function(e){var t=e.pathRelativeTo(this);if(SC.none(t))return;this._registeredSubstates.push(e);var n=this._registeredSubstatePaths;n[e.get("name")]===undefined&&(n[e.get("name")]={});var r=n[e.get("name")];r[t]=e},pathRelativeTo:function(e){var t=this.get("name"),n=this.get("parentState");while(!SC.none(n)&&n!==e)t="%@.%@".fmt(n.get("name"),t),n=n.get("parentState");return n!==e&&e!==this?(this.stateLogError("Can not generate relative path from %@ since it not a parent state of %@".fmt(e,this)),null):t},getSubstate:function(e,t,n){if(!e)return null;var r=SC.typeOf(e);if(r===SC.T_OBJECT)return this._registeredSubstates.indexOf(e)>-1?e:null;if(r!==SC.T_STRING)return this.stateLogError("Can not find matching subtype. value must be an object or string: %@".fmt(e)),null;var i=SC.StatePathMatcher.create({state:this,expression:e}),s=[],o;if(i.get("tokens").length===0)return null;var u=this._registeredSubstatePaths
[i.get("lastPart")];if(!u)return this._notifySubstateNotFound(t,n,e);for(o in u)i.match(o)&&s.push(u[o]);if(s.length===1)return s[0];if(s.length>1){var a=[];for(o in u)a.push(o);if(t)return this._notifySubstateNotFound(t,n,e,a);var f="Can not find substate matching '%@' in state %@. Ambiguous with the following: %@";this.stateLogError(f.fmt(e,this.get("fullPath"),a.join(", ")))}return this._notifySubstateNotFound(t,n,e)},_notifySubstateNotFound:function(e,t,n,r){return e?e.call(t||this,this,n,r):null},getState:function(e){return e===this.get("name")?this:SC.kindOf(e,SC.State)?e:this.getSubstate(e,this._handleSubstateNotFound)},_handleSubstateNotFound:function(e,t,n){var r=this.get("parentState");if(r)return r.getState(t);if(n){var i="Can not find state matching '%@'. Ambiguous with the following: %@";this.stateLogError(i.fmt(t,n.join(", ")))}return null},gotoState:function(e,t){var n=this.getState(e);if(!n){var r="can not go to state %@ from state %@. Invalid value.";this.stateLogError(r.fmt(e,this));return}var i=this.findFirstRelativeCurrentState(n);this.get("statechart").gotoState(n,i,!1,t)},gotoHistoryState:function(e,t,n){var r=this.getState(e);if(!r){var i="can not go to history state %@ from state %@. Invalid value.";this.stateLogError(i.fmt(e,this));return}var s=this.findFirstRelativeCurrentState(r);this.get("statechart").gotoHistoryState(r,s,t,n)},resumeGotoState:function(){this.get("statechart").resumeGotoState()},stateIsCurrentSubstate:function(e){SC.typeOf(e)===SC.T_STRING&&(e=this.get("statechart").getState(e));var t=this.get("currentSubstates");return!!t&&t.indexOf
(e)>=0},stateIsEnteredSubstate:function(e){SC.typeOf(e)===SC.T_STRING&&(e=this.get("statechart").getState(e));var t=this.get("enteredSubstates");return!!t&&t.indexOf(e)>=0},isRootState:function(){return this.getPath("statechart.rootState")===this}.property(),isCurrentState:function(){return this.stateIsCurrentSubstate(this)}.property("currentSubstates").cacheable(),isConcurrentState:function(){return this.getPath("parentState.substatesAreConcurrent")}.property(),isEnteredState:function(){return this.stateIsEnteredSubstate(this)}.property("enteredSubstates").cacheable(),hasSubstates:function(){return this.getPath("substates.length")>0}.property("substates"),hasCurrentSubstates:function(){var e=this.get("currentSubstates");return!!e&&e.get("length")>0}.property("currentSubstates").cacheable(),hasEnteredSubstates:function(){var e=this.get("enteredSubstates");return!!e&&e.get("length")>0}.property("enteredSubstates").cacheable(),findFirstRelativeCurrentState:function(e){if(this.get("isCurrentState"))return this;var t=this.get("currentSubstates")||[],n=t.get("length"),r=this.get("parentState");if(n===0)return r?r.findFirstRelativeCurrentState():null;if(n>1){e=this.getSubstate(e);if(e)return e.findFirstRelativeCurrentState()}return t[0]},reenter:function(){this.get("isEnteredState")?this.gotoState(this):SC.Logger.error("Can not re-enter state %@ since it is not an entered state in the statechart".fmt(this))},tryToHandleEvent:function(e,t,n){var r=this.get("trace"),i=this.get("statechart"),s;if(this._registeredEventHandlers[e])return this.stateLogWarning("state %@ can not handle event '%@' since it is a registered event handler"
.fmt(this,e)),NO;if(this._registeredStateObserveHandlers[e])return this.stateLogWarning("state %@ can not handle event '%@' since it is a registered state observe handler".fmt(this,e)),NO;if(SC.typeOf(this[e])===SC.T_FUNCTION)return r&&this.stateLogTrace("will handle event '%@'".fmt(e)),i.stateWillTryToHandleEvent(this,e,e),s=this[e](t,n)!==NO,i.stateDidTryToHandleEvent(this,e,e,s),s;var o=this._registeredStringEventHandlers[e];if(o)return r&&this.stateLogTrace("%@ will handle event '%@'".fmt(o.name,e)),i.stateWillTryToHandleEvent(this,e,o.name),s=o.handler.call(this,e,t,n)!==NO,i.stateDidTryToHandleEvent(this,e,o.name,s),s;var u=this._registeredRegExpEventHandlers.length,a=0;for(;a<u;a+=1){o=this._registeredRegExpEventHandlers[a];if(e.match(o.regexp))return r&&this.stateLogTrace("%@ will handle event '%@'".fmt(o.name,e)),i.stateWillTryToHandleEvent(this,e,o.name),s=o.handler.call(this,e,t,n)!==NO,i.stateDidTryToHandleEvent(this,e,o.name,s),s}return SC.typeOf(this.unknownEvent)===SC.T_FUNCTION?(r&&this.stateLogTrace("unknownEvent will handle event '%@'".fmt(e)),i.stateWillTryToHandleEvent(this,e,"unknownEvent"),s=this.unknownEvent(e,t,n)!==NO,i.stateDidTryToHandleEvent(this,e,"unknownEvent",s),s):NO},enterState:function(e){},stateWillBecomeEntered:function(e){this._isEnteringState=YES},stateDidBecomeEntered:function(e){this._setupAllStateObserveHandlers(),this._isEnteringState=NO},exitState:function(e){},stateWillBecomeExited:function(e){this._isExitingState=YES,this._teardownAllStateObserveHandlers()},stateDidBecomeExited:function(e){this._isExitingState=NO},_setupAllStateObserveHandlers
:function(){this._configureAllStateObserveHandlers("addObserver")},_teardownAllStateObserveHandlers:function(){this._configureAllStateObserveHandlers("removeObserver")},_configureAllStateObserveHandlers:function(e){var t,n,r,i,s,o,u,a;for(t in this._registeredStateObserveHandlers){n=this._registeredStateObserveHandlers[t];for(u=0;u<n.length;u+=1)s=n[u],o=t,i=s.indexOf("."),i<0?this[e](s,this,o):s.indexOf("*")===0?this[e](s.slice(1),this,o):(a=null,i===0?(a=this,s=s.slice(1)):i===4&&s.slice(0,5)==="this."?(a=this,s=s.slice(5)):i<0&&s.length===4&&s==="this"&&(a=this,s=""),SC.Observers[e](s,this,o,a))}},performAsync:function(e,t,n){return SC.Async.perform(e,t,n)},respondsToEvent:function(e){if(this._registeredEventHandlers[e])return!1;if(SC.typeOf(this[e])===SC.T_FUNCTION)return!0;if(this._registeredStringEventHandlers[e])return!0;if(this._registeredStateObserveHandlers[e])return!1;var t=this._registeredRegExpEventHandlers.length,n=0,r;for(;n<t;n+=1){r=this._registeredRegExpEventHandlers[n];if(e.match(r.regexp))return!0}return SC.typeOf(this.unknownEvent)===SC.T_FUNCTION},fullPath:function(){var e=this.getPath("statechart.rootState");return e?this.pathRelativeTo(e):this.get("name")}.property("name","parentState").cacheable(),toString:function(){return this.get("fullPath")},_enteredSubstatesDidChange:function(){this.notifyPropertyChange("enteredSubstates")}.observes("*enteredSubstates.[]"),_currentSubstatesDidChange:function(){this.notifyPropertyChange("currentSubstates")}.observes("*currentSubstates.[]"),_statechartTraceDidChange:function(){this.notifyPropertyChange("trace")},_statechartOwnerDidChange
:function(){this.notifyPropertyChange("owner")},stateLogTrace:function(e){var t=this.get("statechart");t.statechartLogTrace("%@: %@".fmt(this,e))},stateLogWarning:function(e){var t=this.get("statechart");t.statechartLogWarning(e)},stateLogError:function(e){var t=this.get("statechart");t.statechartLogError(e)}}),SC.State.plugin=function(e){var t=SC.A(arguments);t.shift();var n=function(){var n=SC.objectForPropertyPath(e);return n?!n.isClass||!n.kindOf(SC.State)?(console.error("SC.State.plugin: Unable to extend. %@ must be a class extending from SC.State".fmt(e)),undefined):n.extend.apply(n,t):(console.error("SC.State.plugin: Unable to determine path %@".fmt(e)),undefined)};return n.statePlugin=YES,n},SC.State.design=SC.State.extend,SC.EMPTY_STATE_NAME="__EMPTY_STATE__",SC.EmptyState=SC.State.extend({name:SC.EMPTY_STATE_NAME,enterState:function(){var e="No initial substate was defined for state %@. Entering default empty state";this.stateLogWarning(e.fmt(this.get("parentState")))}}),SC.HistoryState=SC.Object.extend({isRecursive:NO,defaultState:null,statechart:null,parentState:null,state:function(){var e=this.get("defaultState"),t=this.getPath("parentState.historyState");return t?t:e}.property().cacheable(),parentHistoryStateDidChange:function(){this.notifyPropertyChange("state")}.observes("*parentState.historyState")}),SC.StateRouteHandlerContext=SC.Object.extend({state:null,location:null,params:null,handler:null,retry:function(){var e=this.get("state"),t=this.get("params"),n=this.get("handler");SC.typeOf(n)===SC.T_STRING&&(n=e[n]),SC.typeOf(n)===SC.T_FUNCTION&&n.apply(e,[t])}
}),SC.StatechartManager={isResponderContext:YES,isStatechart:YES,statechartIsInitialized:NO,name:null,rootState:null,rootStateExample:SC.State,initialState:null,statesAreConcurrent:NO,monitorIsActive:NO,monitor:null,statechartTraceKey:"trace",trace:NO,statechartOwnerKey:"owner",owner:null,autoInitStatechart:YES,suppressStatechartWarnings:NO,delegate:null,statechartDelegate:function(){var e=this.get("delegate");return this.delegateFor("isStatechartDelegate",e)}.property("delegate"),routingDelegate:null,eventDelegate:null,routingDelegateValue:function(){var e=this.get("routingDelegate"),t=this.get("delegate");return this.delegateFor("isStatechartRoutingDelegate",e,t)}.property("routingDelegate").cacheable(),initMixin:function(){this.get("autoInitStatechart")&&this.initStatechart()},destroyMixin:function(){var e=this.get("rootState"),t=this.get("statechartTraceKey");this.removeObserver(t,this,"_statechartTraceDidChange"),e.destroy(),this.set("rootState",null)},initStatechart:function(){if(this.get("statechartIsInitialized"))return;this._gotoStateLocked=NO,this._sendEventLocked=NO,this._pendingStateTransitions=[],this._pendingSentEvents=[],this.sendAction=this.sendEvent,this.get("monitorIsActive")&&this.set("monitor",SC.StatechartMonitor.create({statechart:this}));var e=this.get("statechartTraceKey");this.addObserver(e,this,"_statechartTraceDidChange"),this._statechartTraceDidChange();var t=this.get("allowStatechartTracing"),n=this.get("rootState"),r;t&&this.statechartLogTrace("BEGIN initialize statechart"),n?SC.typeOf(n)===SC.T_FUNCTION&&n.statePlugin&&(n=n.apply(this)):n=this.
_constructRootStateClass();if(!SC.kindOf(n,SC.State)||!n.isClass)throw r="Unable to initialize statechart. Root state must be a state class",this.statechartLogError(r),r;n=this.createRootState(n,{statechart:this,name:SC.ROOT_STATE_NAME}),this.set("rootState",n),n.initState();if(SC.kindOf(n.get("initialSubstate"),SC.EmptyState))throw r="Unable to initialize statechart. Root state must have an initial substate explicilty defined",this.statechartLogError(r),r;if(!SC.empty(this.get("initialState"))){var i="initialState";this.set(i,n.get(this.get(i)))}this.set("statechartIsInitialized",YES),this.gotoState(n),t&&this.statechartLogTrace("END initialize statechart")},createRootState:function(e,t){return t||(t={}),e=e.create(t),e},currentStates:function(){return this.getPath("rootState.currentSubstates")}.property().cacheable(),firstCurrentState:function(){var e=this.get("currentStates");return e?e.objectAt(0):null}.property("currentStates").cacheable(),currentStateCount:function(){return this.getPath("currentStates.length")}.property("currentStates").cacheable(),stateIsCurrentState:function(e){return this.get("rootState").stateIsCurrentSubstate(e)},enteredStates:function(){return this.getPath("rootState.enteredSubstates")}.property().cacheable(),stateIsEntered:function(e){return this.get("rootState").stateIsEnteredSubstate(e)},doesContainState:function(e){return!SC.none(this.getState(e))},getState:function(e){var t=this.get("rootState");return t===e?t:t.getSubstate(e)},gotoState:function(e,t,n,r){if(!this.get("statechartIsInitialized")){this.statechartLogError("can not go to state %@. statechart has not yet been initialized"
.fmt(e));return}if(this.get("isDestroyed")){this.statechartLogError("can not go to state %@. statechart is destroyed".fmt(this));return}var i=this._processGotoStateArgs(arguments);e=i.state,t=i.fromCurrentState,n=i.useHistory,r=i.context;var s=null,o=[],u=[],a=this.get("allowStatechartTracing"),f=this.get("rootState"),l=e,c=t,h;e=this.getState(e);if(SC.none(e)){this.statechartLogError("Can not to goto state %@. Not a recognized state in statechart".fmt(l));return}if(this._gotoStateLocked){this._pendingStateTransitions.push({state:e,fromCurrentState:t,useHistory:n,context:r});return}this._gotoStateLocked=YES;if(t){t=this.getState(t);if(SC.none(t)||!t.get("isCurrentState")){h="Can not to goto state %@. %@ is not a recognized current state in statechart",this.statechartLogError(h.fmt(l,c)),this._gotoStateLocked=NO;return}}else t=e.findFirstRelativeCurrentState(),t||(t=this.get("firstCurrentState"));a&&(this.statechartLogTrace("BEGIN gotoState: %@".fmt(e)),h="starting from current state: %@",h=h.fmt(t?t:"---"),this.statechartLogTrace(h),h="current states before: %@",h=h.fmt(this.getPath("currentStates.length")>0?this.get("currentStates"):"---"),this.statechartLogTrace(h)),SC.none(t)||(o=this._createStateChain(t)),u=this._createStateChain(e),s=this._findPivotState(o,u);if(s){a&&this.statechartLogTrace("pivot state = %@".fmt(s));if(s.get("substatesAreConcurrent")&&s!==e){this.statechartLogError("Can not go to state %@ from %@. Pivot state %@ has concurrent substates.".fmt(e,t,s)),this._gotoStateLocked=NO;return}}var p=[];this._traverseStatesToExit(o.shift(),o,s,p),s!==e?this._traverseStatesToEnter
(u.pop(),u,s,n,p):(this._traverseStatesToExit(s,[],null,p),this._traverseStatesToEnter(s,null,null,n,p)),this._gotoStateActions=p,this._executeGotoStateActions(e,p,null,r)},gotoStateActive:function(){return this._gotoStateLocked}.property(),gotoStateSuspended:function(){return this._gotoStateLocked&&!!this._gotoStateSuspendedPoint}.property(),resumeGotoState:function(){if(!this.get("gotoStateSuspended")){this.statechartLogError("Can not resume goto state since it has not been suspended");return}var e=this._gotoStateSuspendedPoint;this._executeGotoStateActions(e.gotoState,e.actions,e.marker,e.context)},_executeGotoStateActions:function(e,t,n,r){var i=null,s=t.length,o=null;n=SC.none(n)?0:n;for(;n<s;n+=1){this._currentGotoStateAction=i=t[n];switch(i.action){case SC.EXIT_STATE:o=this._exitState(i.state,r);break;case SC.ENTER_STATE:o=this._enterState(i.state,i.currentState,r)}if(SC.kindOf(o,SC.Async)){this._gotoStateSuspendedPoint={gotoState:e,actions:t,marker:n+1,context:r},o.tryToPerform(i.state);return}}this.beginPropertyChanges(),this.notifyPropertyChange("currentStates"),this.notifyPropertyChange("enteredStates"),this.endPropertyChanges(),this.get("allowStatechartTracing")&&(this.statechartLogTrace("current states after: %@".fmt(this.get("currentStates"))),this.statechartLogTrace("END gotoState: %@".fmt(e))),this._cleanupStateTransition()},_cleanupStateTransition:function(){this._currentGotoStateAction=null,this._gotoStateSuspendedPoint=null,this._gotoStateActions=null,this._gotoStateLocked=NO,this._flushPendingStateTransition()},_exitState:function(e,t){var n;if(e.get("currentSubstates"
).indexOf(e)>=0){n=e.get("parentState");while(n)n.get("currentSubstates").removeObject(e),n=n.get("parentState")}n=e;while(n)n.get("enteredSubstates").removeObject(e),n=n.get("parentState");this.get("allowStatechartTracing")&&this.statechartLogTrace("<-- exiting state: %@".fmt(e)),e.set("currentSubstates",[]),e.stateWillBecomeExited(t);var r=this.exitState(e,t);return e.stateDidBecomeExited(t),this.get("monitorIsActive")&&this.get("monitor").pushExitedState(e),e._traverseStatesToExit_skipState=NO,r},exitState:function(e,t){return e.exitState(t)},_enterState:function(e,t,n){var r=e.get("parentState");r&&!e.get("isConcurrentState")&&r.set("historyState",e);if(t){r=e;while(r)r.get("currentSubstates").pushObject(e),r=r.get("parentState")}r=e;while(r)r.get("enteredSubstates").pushObject(e),r=r.get("parentState");this.get("allowStatechartTracing")&&this.statechartLogTrace("--> entering state: %@".fmt(e)),e.stateWillBecomeEntered(n);var i=this.enterState(e,n);return e.stateDidBecomeEntered(n),this.get("monitorIsActive")&&this.get("monitor").pushEnteredState(e),i},enterState:function(e,t){return e.enterStateByRoute&&SC.kindOf(t,SC.StateRouteHandlerContext)?e.enterStateByRoute(t):e.enterState(t)},gotoHistoryState:function(e,t,n,r){if(!this.get("statechartIsInitialized")){this.statechartLogError("can not go to state %@'s history state. Statechart has not yet been initialized".fmt(e));return}var i=this._processGotoStateArgs(arguments);e=i.state,t=i.fromCurrentState,n=i.useHistory,r=i.context,e=this.getState(e);if(!e){this.statechartLogError("Can not to goto state %@'s history state. Not a recognized state in statechart"
.fmt(e));return}var s=e.get("historyState");n?this.gotoState(e,t,YES,r):s?this.gotoState(s,t,r):this.gotoState(e,t,r)},sendEvent:function(e,t,n){if(this.get("isDestroyed")){this.statechartLogError("can send event %@. statechart is destroyed".fmt(e));return}var r=NO,i=this.get("currentStates").slice(),s={},o=[],u=NO,a=0,f=0,l=null,c=this.get("allowStatechartTracing");if(this._sendEventLocked||this._goStateLocked){this._pendingSentEvents.push({event:e,arg1:t,arg2:n});return}this._sendEventLocked=YES;var h=this.get("eventDelegate");h&&(r=h.sendEvent(e,t,n),r&&c&&this.statechartLogTrace("eventDelegate handled event: '%@'".fmt(e)));if(!r){c&&this.statechartLogTrace("BEGIN sendEvent: '%@'".fmt(e)),a=i.get("length");for(;f<a;f+=1){l=i[f];if(!l.get("isCurrentState"))continue;while(l){var p=SC.hashFor(l);if(l.get("substatesAreConcurrent")){s[p]?s[p]++:s[p]=1;if(s[p]<l.substates.length||o.indexOf(l)!=-1)break}u=l.tryToHandleEvent(e,t,n),r=r||u;var d=l.get("parentState");u&&d&&d.get("substatesAreConcurrent")&&o.push(d);if(u)break;l=l.get("parentState")}}c&&(r||this.statechartLogTrace("No state was able handle event %@".fmt(e)),this.statechartLogTrace("END sendEvent: '%@'".fmt(e)))}this._sendEventLocked=NO;var v=this._flushPendingSentEvents();return r?this:v?this:null},stateWillTryToHandleEvent:function(e,t,n){this._stateHandleEventInfo={state:e,event:t,handler:n}},stateDidTryToHandleEvent:function(e,t,n,r){this._stateHandleEventInfo=null},_createStateChain:function(e){var t=[];while(e)t.push(e),e=e.get("parentState");return t},_findPivotState:function(e,t){if(e.length===0||t.length===0
)return null;var n=e.find(function(e,n){if(t.indexOf(e)>=0)return YES});return n},_traverseStatesToExit:function(e,t,n,r){if(!e||e===n)return;var i=this.get("allowStatechartTracing");if(e.get("substatesAreConcurrent")){var s=0,o=e.get("currentSubstates"),u=o.length,a=null;for(;s<u;s+=1){a=o[s];if(a._traverseStatesToExit_skipState===YES)continue;var f=this._createStateChain(a);this._traverseStatesToExit(f.shift(),f,e,r)}}r.push({action:SC.EXIT_STATE,state:e}),e.get("isCurrentState")&&(e._traverseStatesToExit_skipState=YES),this._traverseStatesToExit(t.shift(),t,n,r)},_traverseStatesToEnter:function(e,t,n,r,i){if(!e)return;var s=this.get("allowStatechartTracing");if(n)e!==n?this._traverseStatesToEnter(t.pop(),t,n,r,i):this._traverseStatesToEnter(t.pop(),t,null,r,i);else if(!t||t.length===0){var o={action:SC.ENTER_STATE,state:e,currentState:NO};i.push(o);var u=e.get("initialSubstate"),a=e.get("historyState");e.get("substatesAreConcurrent")?this._traverseConcurrentStatesToEnter(e.get("substates"),null,r,i):e.get("hasSubstates")&&a&&r?this._traverseStatesToEnter(a,null,null,r,i):u?(SC.kindOf(u,SC.HistoryState)&&(r||(r=u.get("isRecursive")),u=u.get("state")),this._traverseStatesToEnter(u,null,null,r,i)):o.currentState=YES}else if(t.length>0){i.push({action:SC.ENTER_STATE,state:e});var f=t.pop();this._traverseStatesToEnter(f,t,null,r,i),e.get("substatesAreConcurrent")&&this._traverseConcurrentStatesToEnter(e.get("substates"),f,r,i)}},respondsTo:function(e){var t=this.get("currentStates"),n=t.get("length"),r=0,i=null;for(;r<n;r+=1){i=t.objectAt(r);while(i){if(i.respondsToEvent(e))return!0
;i=i.get("parentState")}}return SC.typeOf(this[e])===SC.T_FUNCTION},invokeStateMethod:function(e,t,n){if(e==="unknownEvent"){this.statechartLogError("can not invoke method unkownEvent");return}t=SC.A(arguments),t.shift();var r=t.length,i=r>0?t[r-1]:null,s=SC.typeOf(i)===SC.T_FUNCTION?t.pop():null,o=this.get("currentStates"),u=0,a=null,f={},l,c=undefined,h=0;r=o.get("length");for(;u<r;u+=1){a=o.objectAt(u);while(a){if(f[a.get("fullPath")])break;f[a.get("fullPath")]=YES,l=a[e];if(SC.typeOf(l)===SC.T_FUNCTION&&!l.isEventHandler){c=l.apply(a,t),s&&s.call(this,a,c),h+=1;break}a=a.get("parentState")}}return h===1?c:undefined},_traverseConcurrentStatesToEnter:function(e,t,n,r){var i=0,s=e.length,o=null;for(;i<s;i+=1)o=e[i],o!==t&&this._traverseStatesToEnter(o,null,null,n,r)},_flushPendingStateTransition:function(){if(!this._pendingStateTransitions){this.statechartLogError("Unable to flush pending state transition. _pendingStateTransitions is invalid");return}var e=this._pendingStateTransitions.shift();if(!e)return;this.gotoState(e.state,e.fromCurrentState,e.useHistory,e.context)},_flushPendingSentEvents:function(){var e=this._pendingSentEvents.shift();return e?this.sendEvent(e.event,e.arg1,e.arg2):null},_monitorIsActiveDidChange:function(){this.get("monitorIsActive")&&SC.none(this.get("monitor"))&&this.set("monitor",SC.StatechartMonitor.create())}.observes("monitorIsActive"),_processGotoStateArgs:function(e){var t={state:null,fromCurrentState:null,useHistory:!1,context:null},n=null,r=null;e=SC.$A(e),e=e.filter(function(e){return e!==undefined}),n=e.length;if(n<1)return t;t.state=e[0
];if(n===2){r=e[1];switch(SC.typeOf(r)){case SC.T_BOOL:t.useHistory=r;break;case SC.T_HASH:case SC.T_OBJECT:SC.kindOf(r,SC.State)||(t.context=r);break;default:t.fromCurrentState=r}}else n===3?(r=e[1],SC.typeOf(r)===SC.T_BOOL?(t.useHistory=r,t.context=e[2]):(t.fromCurrentState=r,r=e[2],SC.typeOf(r)===SC.T_BOOL?t.useHistory=r:t.context=r)):(t.fromCurrentState=e[1],t.useHistory=e[2],t.context=e[3]);return t},_constructRootStateClass:function(){var e="rootStateExample",t=this.get(e),n=this.get("initialState"),r=this.get("statesAreConcurrent"),i=0,s,o,u,a={};SC.typeOf(t)===SC.T_FUNCTION&&t.statePlugin&&(t=t.apply(this));if(!SC.kindOf(t,SC.State)||!t.isClass)return this._logStatechartCreationError("Invalid root state example"),null;if(r&&!SC.empty(n))this._logStatechartCreationError("Can not assign an initial state when states are concurrent");else if(r)a.substatesAreConcurrent=YES;else{if(SC.typeOf(n)!==SC.T_STRING)return this._logStatechartCreationError("Must either define initial state or assign states as concurrent"),null;a.initialSubstate=n}for(s in this){if(s===e)continue;o=this[s],u=SC.typeOf(o)===SC.T_FUNCTION,u&&o.statePlugin&&(o=o.apply(this)),SC.kindOf(o,SC.State)&&o.isClass&&this[s]!==this.constructor&&(a[s]=o,i+=1)}return i===0?(this._logStatechartCreationError("Must define one or more states"),null):t.extend(a)},_logStatechartCreationError:function(e){SC.Logger.error("Unable to create statechart for %@: %@.".fmt(this,e))},statechartLogTrace:function(e){SC.Logger.info("%@: %@".fmt(this.get("statechartLogPrefix"),e))},statechartLogError:function(e){SC.Logger.error("ERROR %@: %@"
.fmt(this.get("statechartLogPrefix"),e))},statechartLogWarning:function(e){if(this.get("suppressStatechartWarnings"))return;SC.Logger.warn("WARN %@: %@".fmt(this.get("statechartLogPrefix"),e))},statechartLogPrefix:function(){var e=SC._object_className(this.constructor),t=this.get("name"),n;return SC.empty(t)?n="%@<%@>".fmt(e,SC.guidFor(this)):n="%@<%@, %@>".fmt(e,t,SC.guidFor(this)),n}.property().cacheable(),allowStatechartTracing:function(){var e=this.get("statechartTraceKey");return this.get(e)}.property().cacheable(),_statechartTraceDidChange:function(){this.notifyPropertyChange("allowStatechartTracing")},details:function(){var e={initialized:this.get("statechartIsInitialized")};this.get("name")&&(e.name=this.get("name"));if(!this.get("statechartIsInitialized"))return e;e["current-states"]=[],this.get("currentStates").forEach(function(t){e["current-states"].push(t.get("fullPath"))});var t={active:this.get("gotoStateActive"),suspended:this.get("gotoStateSuspended")};if(this._gotoStateActions){t["transition-sequence"]=[];var n=this._gotoStateActions,r=function(e){var t=e.action===SC.ENTER_STATE?"enter":"exit";return"%@ %@".fmt(t,e.state.get("fullPath"))};n.forEach(function(e){t["transition-sequence"].push(r(e))}),t["current-transition"]=r(this._currentGotoStateAction)}e["state-transition"]=t;if(this._stateHandleEventInfo){var i=this._stateHandleEventInfo;e["handling-event"]={state:i.state.get("fullPath"),event:i.event,handler:i.handler}}else e["handling-event"]=!1;return e}.property(),toStringWithDetails:function(){var e="",t=this.toString(),n=this.get("details");return e+=
t+"\n",e+=this._hashToString(n,2),e},_hashToString:function(e,t){var n="";for(var r in e){var i=e[r];i instanceof Array?n+=this._arrayToString(r,i,t)+"\n":i instanceof Object?(n+="%@%@:\n".fmt(" ".mult(t),r),n+=this._hashToString(i,t+2)):n+="%@%@: %@\n".fmt(" ".mult(t),r,i)}return n},_arrayToString:function(e,t,n){if(t.length===0)return"%@%@: []".fmt(" ".mult(n),e);var r="%@%@: [\n".fmt(" ".mult(n),e);return t.forEach(function(e,t){r+="%@%@\n".fmt(" ".mult(n+2),e)},this),r+=" ".mult(n)+"]",r}},SC.supplement(SC.StatechartManager,SC.StatechartRoutingDelegate,SC.StatechartEventDelegate,SC.DelegateSupport),SC.ROOT_STATE_NAME="__ROOT_STATE__",SC.EXIT_STATE=0,SC.ENTER_STATE=1,SC.Statechart=SC.Object.extend(SC.StatechartManager,{autoInitStatechart:NO}),SC.Statechart.design=SC.Statechart.extend,SC.DateFormatter=function(e,t){if(!e)throw"No date passed to date formatter.";if(!e.getFullYear)throw"Object passed to date formatter was not a date!";if(!t)throw"No formatting string passed to date formatter. Date: "+e;var n=t.length,r=t[0],i;for(i=1;i<n;i++)if(t[i]!==r)throw"Invalid format string for a date; all characters must be the same: "+t+"; date: "+e;var s=SC.DateFormatter[r];if(!s)throw"No formatter `"+r+"` exists for date: "+e;return s(e,n)},SC.DateFormatter.G=function(e,t){var n="SC.Date.Era.";n+=e.getFullYear()>=0?"AD":"BC";if(t<=3)return(n+".Abbreviated").loc();if(t===4)return(n+".Full").loc();if(t===5)return(n+".Letter").loc();throw"Invalid era format: expected at most 5 digits; found "+t+"."},SC.DateFormatter.y=function(e,t){var n=e.getFullYear();t===1&&(t=n.length);var r=Math
.abs(n).toString();while(r.length<t)r="0"+r;return r=r.substr(r.length-t),r},SC.DateFormatter.Y=function(e,t){return SC.DateFormatter.y(e,t)},SC.DateFormatter.u=function(e,t){var n=e.getFullYear();t===1&&(t=n.length);var r=n<0,i=Math.abs(n).toString();while(i.length<t)i="0"+i;return i=i.substr(i.length-t),(r?"-":"")+i},SC.DateFormatter.Q=function(e,t,n){var r=e.getMonth(),i=Math.floor(r/3)+1,s="SC.Date.Quarter."+(n?"StandAlone.":"")+"Q"+i;if(t===1)return""+i;if(t===2)return"0"+i;if(t===3)return(s+".Abbreviated").loc();if(t==4)return(s+".Full").loc();throw"Unrecognized number of characters for quarter: "+t},SC.DateFormatter.q=function(e,t){return SC.DateFormatter.Q(e,t,YES)},SC.DateFormatter.ENGLISH_MONTH_NAMES=["January","February","March","April","May","June","July","August","September","October","November","December"],SC.DateFormatter.M=function(e,t,n){var r=e.getMonth(),i=""+(r+1),s="SC.Date.Month."+(n?n:"")+SC.DateFormatter.ENGLISH_MONTH_NAMES[r];if(t===1)return i;if(t===2)return i.length<2&&(i="0"+i),i;if(t===3)return(s+".Abbreviated").loc();if(t===4)return(s+".Full").loc();if(t===5)return(s+".Letter").loc();throw"The number of Ms or Ls must be from 1 to 5. Supplied: "+t},SC.DateFormatter.L=function(e,t){var n="StandAlone.";return SC.DateFormatter.M(e,t,n)},SC.DateFormatter.P=function(e,t){var n="Prepositional.";return SC.DateFormatter.M(e,t,n)},SC.DateFormatter.l=function(){throw"`l` date formatter not implemented."},SC.DateFormatter.w=function(e,t){throw"Week number currently not supported for date formatting."},SC.DateFormatter.W=function(e,t){throw"Week number currently not supported for date formatting."
},SC.DateFormatter.d=function(e,t){var n=""+e.getDate();return t>n.length&&(n="0"+n),n},SC.DateFormatter.D=function(e,t){var n=new Date(e.getFullYear(),0,1),r=n.getTime(),i=e.getTime()-r,s=Math.floor(i/864e5)+1;s=""+s;while(s.length<t)s="0"+s;return s},SC.DateFormatter.F=function(e,t){throw"Day of week in month (F) is not supported in date formatting"},SC.DateFormatter.g=function(e,t){throw"Julian day not supported in date formatting."},SC.DateFormatter.ENGLISH_DAY_NAMES=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],SC.DateFormatter.E=function(e,t){return t<3&&(t=3),SC.DateFormatter.e(e,t)},SC.DateFormatter.e=function(e,t,n){var r=e.getDay(),i=""+(r+1),s="SC.Date.Day."+(n?"StandAlone.":"")+SC.DateFormatter.ENGLISH_DAY_NAMES[r];if(t===1)return i;if(t===2)return i="0"+i,i;if(t===3)return(s+".Abbreviated").loc();if(t===4)return(s+".Full").loc();if(t===5)return(s+".Letter").loc();throw"Unrecognized number of `e`s, `c`s, or `E`s in date format string."},SC.DateFormatter.c=function(e,t){return SC.DateFormatter.e(e,t,YES)},SC.DateFormatter.a=function(e,t){if(t!==1)throw"`a` can only be included in a date format string once.";var n="SC.Date.Period."+(e.getHours()>11?"PM":"AM");return n.loc()},SC.DateFormatter._h=function(e,t,n,r){var i=e.getHours();n||(i%=12),r&&(n?i===0&&(i=24):i===0&&(i=12));var s=""+i;return s.length<t&&(s="0"+s),s},SC.DateFormatter.h=function(e,t){return SC.DateFormatter._h(e,t,NO,1)},SC.DateFormatter.H=function(e,t){return SC.DateFormatter._h(e,t,YES,0)},SC.DateFormatter.K=function(e,t){return SC.DateFormatter._h(e,t,NO,0)},SC.DateFormatter
.k=function(e,t){return SC.DateFormatter._h(e,t,YES,1)},SC.DateFormatter.m=function(e,t){var n=""+e.getMinutes();return n.length<t&&(n="0"+n),n},SC.DateFormatter.s=function(e,t){var n=""+e.getSeconds();return n.length<t&&(n="0"+n),n},SC.DateFormatter.S=function(e,t){var n=e.getMilliseconds()/1e3,r=Math.pow(10,t);n=Math.round(n*r),n=""+n;while(n.length<t)n="0"+n;return n},SC.DateFormatter.A=function(e,t){var n=(new Date(e.getFullYear(),e.getMonth(),e.getDay())).getTime(),r=e.getTime()-n;r=""+r;while(r.length<t)r="0"+r;return r},SC.DateFormatter.z=SC.DateFormatter.Z=SC.DateFormatter.v=SC.DateFormatter.V=function(e,t){throw"Timezone not supported in date format strings."},function(e){function a(e){return e.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function f(e){return String(Object.prototype.toString.call(e))==="[object Array]"}function l(t,n){var r={},i,s;if(f(n))for(i=0,s=n.length;i<s;i++)r[n[i]]=!0;else r[n]=!0;for(i=0,s=t.length;i<s;i++)r[t[i]]!==e&&(t.splice(i,1),s--,i--);return t}var t=typeof module!="undefined"&&module.exports,n=function(e){return t?require("./"+e):window[e]},r=n("punycode"),i=n("IPv6"),s=n("SecondLevelDomains"),o=function(t,n){return this instanceof o?(t===e&&(t=location.href+""),this.href(t),n!==e?this.absoluteTo(n):this):new o(t)},u=o.prototype;o.idn_expression=/[^a-z0-9\.-]/i,o.punycode_expression=/(xn--)/i,o.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,o.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/
,o.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/ig,o.defaultPorts={http:"80",https:"443",ftp:"21"},o.invalid_hostname_characters=/[^a-zA-Z0-9\.-]/,o.encode=encodeURIComponent,o.decode=decodeURIComponent,o.iso8859=function(){o.encode=escape,o.decode=unescape},o.unicode=function(){o.encode=encodeURIComponent,o.decode=decodeURIComponent},o.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}}},o.encodeQuery=function(e){return o.encode(e+"").replace(/%20/g,"+")},o.decodeQuery=function(e){return o.decode((e+"").replace(/\+/g,"%20"))},o.recodePath=function(e){var t=(e+"").split("/");for(var n=0,r=t.length;n<r;n++)t[n]=o.encodePathSegment(o.decode(t[n]));return t.join("/")},o.decodePath=function(e){var t=(e+"").split("/");for(var n=0,r=t.length;n<r;n++)t[n]=o.decodePathSegment(t[n]);return t.join("/")};var c={encode:"encode",decode:"decode"},h,p=function(e){return function(t){return o[e](t+"").replace(o.characters.pathname[e].expression,function(t){return o.characters.pathname[e].map[t]})}};for(h in c)o[h+"PathSegment"]=p(c[h]);o.parse=function(e){var t,n,r={};return t=e.indexOf("#"),t>-1&&(r.fragment=e.substring(t+1)||null,e=e.substring(0,t)),t=e.indexOf("?"),t>-1&&(r.query=e.substring(t+1)||null,e=e.substring(0,t)),e.substring(0,2)==="//"?
(r.protocol="",e=e.substring(2),e=o.parseAuthority(e,r)):(t=e.indexOf(":"),t>-1&&(r.protocol=e.substring(0,t),e.substring(t+1,t+3)==="//"?(e=e.substring(t+3),e=o.parseAuthority(e,r)):(e=e.substring(t+1),r.urn=!0))),r.path=e,r},o.parseHost=function(e,t){var n=e.indexOf("/"),r;n===-1&&(n=e.length);if(e[0]==="["){var i=e.indexOf("]");t.hostname=e.substring(1,i)||null,t.port=e.substring(i+2,n)||null}else e.indexOf(":")!==e.lastIndexOf(":")?(t.hostname=e.substring(0,n)||null,t.port=null):(r=e.substring(0,n).split(":"),t.hostname=r[0]||null,t.port=r[1]||null);return t.hostname&&e.substring(n)[0]!=="/"&&(n++,e="/"+e),e.substring(n)||"/"},o.parseAuthority=function(e,t){return e=o.parseUserinfo(e,t),o.parseHost(e,t)},o.parseUserinfo=function(e,t){var n=e.indexOf("@"),r=e.indexOf("/"),i;return n>-1&&(r===-1||n<r)?(i=e.substring(0,n).split(":"),t.username=i[0]?o.decode(i[0]):null,t.password=i[1]?o.decode(i[1]):null,e=e.substring(n+1)):(t.username=null,t.password=null),e},o.parseQuery=function(e){if(!e)return{};e=e.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,"");if(!e)return{};var t={},n=e.split("&"),r=n.length;for(var i=0;i<r;i++){var s=n[i].split("="),u=o.decodeQuery(s.shift()),a=s.length?o.decodeQuery(s.join("=")):null;t[u]?(typeof t[u]=="string"&&(t[u]=[t[u]]),t[u].push(a)):t[u]=a}return t},o.build=function(e){var t="";return e.protocol&&(t+=e.protocol+":"),!e.urn&&(t||e.hostname)&&(t+="//"),t+=o.buildAuthority(e)||"",typeof e.path=="string"&&(e.path[0]!=="/"&&typeof e.hostname=="string"&&(t+="/"),t+=e.path),typeof e.query=="string"&&(t+="?"+e.query),typeof e.fragment=="string"&&(t+="#"+
e.fragment),t},o.buildHost=function(e){var t="";return e.hostname?(o.ip6_expression.test(e.hostname)?e.port?t+="["+e.hostname+"]:"+e.port:t+=e.hostname:(t+=e.hostname,e.port&&(t+=":"+e.port)),t):""},o.buildAuthority=function(e){return o.buildUserinfo(e)+o.buildHost(e)},o.buildUserinfo=function(e){var t="";return e.username&&(t+=o.encode(e.username),e.password&&(t+=":"+o.encode(e.password)),t+="@"),t},o.buildQuery=function(t,n){var r="";for(var i in t)if(Object.hasOwnProperty.call(t,i)&&i)if(f(t[i])){var s={};for(var u=0,a=t[i].length;u<a;u++)t[i][u]!==e&&s[t[i][u]+""]===e&&(r+="&"+o.buildQueryParameter(i,t[i][u]),n!==!0&&(s[t[i][u]+""]=!0))}else t[i]!==e&&(r+="&"+o.buildQueryParameter(i,t[i]));return r.substring(1)},o.buildQueryParameter=function(e,t){return o.encodeQuery(e)+(t!==null?"="+o.encodeQuery(t):"")},o.addQuery=function(t,n,r){if(typeof n=="object")for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&o.addQuery(t,i,n[i]);else{if(typeof n!="string")throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");if(t[n]===e){t[n]=r;return}typeof t[n]=="string"&&(t[n]=[t[n]]),f(r)||(r=[r]),t[n]=t[n].concat(r)}},o.removeQuery=function(t,n,r){if(f(n))for(var i=0,s=n.length;i<s;i++)t[n[i]]=e;else if(typeof n=="object")for(var u in n)Object.prototype.hasOwnProperty.call(n,u)&&o.removeQuery(t,u,n[u]);else{if(typeof n!="string")throw new TypeError("URI.addQuery() accepts an object, string as the first parameter");r!==e?t[n]===r?t[n]=e:f(t[n])&&(t[n]=l(t[n],r)):t[n]=e}},o.commonPath=function(e,t){var n=Math.min(e.length,t.length),r;for(r=0;r<n;r++)
if(e[r]!==t[r]){r--;break}return r<1?e[0]===t[0]&&e[0]==="/"?"/":"":(e[r]!=="/"&&(r=e.substring(0,r).lastIndexOf("/")),e.substring(0,r+1))},o.withinString=function(e,t){return e.replace(o.find_uri_expression,t)},o.ensureValidHostname=function(e){if(e.match(o.invalid_hostname_characters)){if(!r)throw new TypeError("Hostname '"+e+"' contains characters other than [A-Z0-9.-] and Punycode.js is not available");if(r.toASCII(e).match(o.invalid_hostname_characters))throw new TypeError("Hostname '"+e+"' contains characters other than [A-Z0-9.-]")}},u.build=function(t){if(t===!0)this._deferred_build=!0;else if(t===e||this._deferred_build)this._string=o.build(this._parts),this._deferred_build=!1;return this},u.toString=function(){return this.build(!1)._string},u.valueOf=function(){return this.toString()},c={protocol:"protocol",username:"username",password:"password",hostname:"hostname",port:"port"},p=function(t){return function(n,r){return n===e?this._parts[t]||"":(this._parts[t]=n,this.build(!r),this)}};for(h in c)u[h]=p(c[h]);c={query:"?",fragment:"#"},p=function(t,n){return function(r,i){return r===e?this._parts[t]||"":(r!==null&&(r+="",r[0]===n&&(r=r.substring(1))),this._parts[t]=r,this.build(!i),this)}};for(h in c)u[h]=p(h,c[h]);c={search:["?","query"],hash:["#","fragment"]},p=function(e,t){return function(n,r){var i=this[e](n,r);return typeof i=="string"&&i.length?t+i:i}};for(h in c)u[h]=p(c[h][1],c[h][0]);u.pathname=function(t,n){if(t===e||t===!0){var r=this._parts.path||(this._parts.urn?"":"/");return t?o.decodePath(r):r}return this._parts.path=t?o.recodePath(t):"/",this.build
(!n),this},u.path=u.pathname,u.href=function(t,n){if(t===e)return this.toString();this._string="",this._parts={protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null};var r=t instanceof o,i=typeof t=="object"&&(t.hostname||t.path),s;if(typeof t=="string")this._parts=o.parse(t);else{if(!r&&!i)throw new TypeError("invalid input");var u=r?t._parts:t;for(s in u)Object.hasOwnProperty.call(this._parts,s)&&(this._parts[s]=u[s])}return this.build(!n),this},u.is=function(e){var t=!1,n=!1,r=!1,i=!1,u=!1,a=!1,f=!1,l=!this._parts.urn;this._parts.hostname&&(l=!1,n=o.ip4_expression.test(this._parts.hostname),r=o.ip6_expression.test(this._parts.hostname),t=n||r,i=!t,u=i&&s&&s.has(this._parts.hostname),a=i&&o.idn_expression.test(this._parts.hostname),f=i&&o.punycode_expression.test(this._parts.hostname));switch(e.toLowerCase()){case"relative":return l;case"absolute":return!l;case"domain":case"name":return i;case"sld":return u;case"ip":return t;case"ip4":case"ipv4":case"inet4":return n;case"ip6":case"ipv6":case"inet6":return r;case"idn":return a;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return f}return null};var d=u.protocol,v=u.port,m=u.hostname;u.protocol=function(t,n){if(t!==e&&t){t=t.replace(/:(\/\/)?$/,"");if(t.match(/[^a-zA-z0-9\.+-]/))throw new TypeError("Protocol '"+t+"' contains characters other than [A-Z0-9.+-]")}return d.call(this,t,n)},u.scheme=u.protocol,u.port=function(t,n){if(this._parts.urn)return t===e?"":this;if(t!==e){t===0&&(t=null);if(t){t+="",t[0]===":"&&(t=t.substring(1));if(
t.match(/[^0-9]/))throw new TypeError("Port '"+t+"' contains characters other than [0-9]")}}return v.call(this,t,n)},u.hostname=function(t,n){if(this._parts.urn)return t===e?"":this;if(t!==e){var r={};o.parseHost(t,r),t=r.hostname}return m.call(this,t,n)},u.host=function(t,n){return this._parts.urn?t===e?"":this:t===e?this._parts.hostname?o.buildHost(this._parts):"":(o.parseHost(t,this._parts),this.build(!n),this)},u.authority=function(t,n){return this._parts.urn?t===e?"":this:t===e?this._parts.hostname?o.buildAuthority(this._parts):"":(o.parseAuthority(t,this._parts),this.build(!n),this)},u.userinfo=function(t,n){if(this._parts.urn)return t===e?"":this;if(t===e){if(!this._parts.username)return"";var r=o.buildUserinfo(this._parts);return r.substring(0,r.length-1)}return t[t.length-1]!=="@"&&(t+="@"),o.parseUserinfo(t,this._parts),this.build(!n),this},u.subdomain=function(t,n){if(this._parts.urn)return t===e?"":this;if(t===e){if(!this._parts.hostname||this.is("IP"))return"";var r=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,r)||""}var i=this._parts.hostname.length-this.domain().length,s=this._parts.hostname.substring(0,i),u=new RegExp("^"+a(s));return t&&t[t.length-1]!=="."&&(t+="."),t&&o.ensureValidHostname(t),this._parts.hostname=this._parts.hostname.replace(u,t),this.build(!n),this},u.domain=function(t,n){if(this._parts.urn)return t===e?"":this;typeof t=="boolean"&&(n=t,t=e);if(t===e){if(!this._parts.hostname||this.is("IP"))return"";var r=this._parts.hostname.match(/\./g);if(!r||r.length<2)return this._parts.hostname;var i=this
._parts.hostname.length-this.tld(n).length-1;return i=this._parts.hostname.lastIndexOf(".",i-1)+1,this._parts.hostname.substring(i)||""}if(!t)throw new TypeError("cannot set domain empty");o.ensureValidHostname(t);if(!this._parts.hostname||this.is("IP"))this._parts.hostname=t;else{var s=new RegExp(a(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(s,t)}return this.build(!n),this},u.tld=function(t,n){if(this._parts.urn)return t===e?"":this;typeof t=="boolean"&&(n=t,t=e);if(t===e){if(!this._parts.hostname||this.is("IP"))return"";var r=this._parts.hostname.lastIndexOf("."),i=this._parts.hostname.substring(r+1);return n!==!0&&s&&s.list[i.toLowerCase()]?s.get(this._parts.hostname)||i:i}var o;if(!t)throw new TypeError("cannot set TLD empty");if(t.match(/[^a-zA-Z0-9-]/)){if(!s||!s.is(t))throw new TypeError("TLD '"+t+"' contains characters other than [A-Z0-9]");o=new RegExp(a(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(o,t)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");o=new RegExp(a(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(o,t)}return this.build(!n),this},u.directory=function(t,n){if(this._parts.urn)return t===e?"":this;if(t===e||t===!0){if(!this._parts.path||this._parts.path==="/")return"/";var r=this._parts.path.length-this.filename().length-1,i=this._parts.path.substring(0,r)||"/";return t?o.decodePath(i):i}var s=this._parts.path.length-this.filename().length,u=this._parts.path.substring(0,s),f=new RegExp("^"+a(u));return this.is("relative")||(t||(t="/"
),t[0]!=="/"&&(t="/"+t)),t&&t[t.length-1]!=="/"&&(t+="/"),t=o.recodePath(t),this._parts.path=this._parts.path.replace(f,t),this.build(!n),this},u.filename=function(t,n){if(this._parts.urn)return t===e?"":this;if(t===e||t===!0){if(!this._parts.path||this._parts.path==="/")return"";var r=this._parts.path.lastIndexOf("/"),i=this._parts.path.substring(r+1);return t?o.decodePathSegment(i):i}var s=!1;t[0]==="/"&&(t=t.substring(1)),t.match(/\.?\//)&&(s=!0);var u=new RegExp(a(this.filename())+"$");return t=o.recodePath(t),this._parts.path=this._parts.path.replace(u,t),s?this.normalizePath(n):this.build(!n),this},u.suffix=function(t,n){if(this._parts.urn)return t===e?"":this;if(t===e||t===!0){if(!this._parts.path||this._parts.path==="/")return"";var r=this.filename(),i=r.lastIndexOf("."),s,u;return i===-1?"":(s=r.substring(i+1),u=/^[a-z0-9%]+$/i.test(s)?s:"",t?o.decodePathSegment(u):u)}t[0]==="."&&(t=t.substring(1));var f=this.suffix(),l;if(!f){if(!t)return this;this._parts.path+="."+o.recodePath(t)}else t?l=new RegExp(a(f)+"$"):l=new RegExp(a("."+f)+"$");return l&&(t=o.recodePath(t),this._parts.path=this._parts.path.replace(l,t)),this.build(!n),this};var g=u.query;u.query=function(t,n){return t===!0?o.parseQuery(this._parts.query):t!==e&&typeof t!="string"?(this._parts.query=o.buildQuery(t),this.build(!n),this):g.call(this,t,n)},u.addQuery=function(e,t,n){var r=o.parseQuery(this._parts.query);return o.addQuery(r,e,t),this._parts.query=o.buildQuery(r),typeof e!="string"&&(n=t),this.build(!n),this},u.removeQuery=function(e,t,n){var r=o.parseQuery(this._parts.query);return o.removeQuery
(r,e,t),this._parts.query=o.buildQuery(r),typeof e!="string"&&(n=t),this.build(!n),this},u.addSearch=u.addQuery,u.removeSearch=u.removeQuery,u.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},u.normalizeProtocol=function(e){return typeof this._parts.protocol=="string"&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!e)),this},u.normalizeHostname=function(e){return this._parts.hostname&&(this.is("IDN")&&r?this._parts.hostname=r.toASCII(this._parts.hostname):this.is("IPv6")&&i&&(this._parts.hostname=i.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!e)),this},u.normalizePort=function(e){return typeof this._parts.protocol=="string"&&this._parts.port===o.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!e)),this},u.normalizePath=function(e){if(this._parts.urn)return this;if(!this._parts.path||this._parts.path==="/")return this;var t,n,r=this._parts.path,i,s;r[0]!=="/"&&(r[0]==="."&&(n=r.substring(0,r.indexOf("/"))),t=!0,r="/"+r),r=r.replace(/(\/(\.\/)+)|\/{2,}/g,"/");for(;;){i=r.indexOf("/../");if(i===-1)break;if(i===0){r=r.substring(3);break}s=r.substring(0,i).lastIndexOf("/"),s===-1&&(s=i),r=r.substring(0,s)+r.substring(i+3)}return t&&this.is("relative")&&(n?r=n+r:r=r.substring(1)),r=o.recodePath(r),this._parts.path=r,this.build(!e),this},u.normalizePathname=u.normalizePath,u.normalizeQuery=
function(e){return typeof this._parts.query=="string"&&(this._parts.query.length?this.query(o.parseQuery(this._parts.query)):this._parts.query=null,this.build(!e)),this},u.normalizeFragment=function(e){return this._parts.fragment||(this._parts.fragment=null,this.build(!e)),this},u.normalizeSearch=u.normalizeQuery,u.normalizeHash=u.normalizeFragment,u.iso8859=function(){var e=o.encode,t=o.decode;return o.encode=escape,o.decode=decodeURIComponent,this.normalize(),o.encode=e,o.decode=t,this},u.unicode=function(){var e=o.encode,t=o.decode;return o.encode=encodeURIComponent,o.decode=unescape,this.normalize(),o.encode=e,o.decode=t,this},u.readable=function(){var t=new o(this);t.username("").password("").normalize();var n="";t._parts.protocol&&(n+=t._parts.protocol+"://"),t._parts.hostname&&(t.is("punycode")&&r?(n+=r.toUnicode(t._parts.hostname),t._parts.port&&(n+=":"+t._parts.port)):n+=t.host()),t._parts.hostname&&t._parts.path&&t._parts.path[0]!=="/"&&(n+="/"),n+=t.path(!0);if(t._parts.query){var i="";for(var s=0,u=t._parts.query.split("&"),a=u.length;s<a;s++){var f=(u[s]||"").split("=");i+="&"+o.decodeQuery(f[0]).replace(/&/g,"%26"),f[1]!==e&&(i+="="+o.decodeQuery(f[1]).replace(/&/g,"%26"))}n+="?"+i.substring(1)}return n+=t.hash(),n},u.absoluteTo=function(e){if(this._parts.urn)throw new Error("URNs do not have any generally defined hierachical components");if(!this.is("relative"))throw new Error("Cannot resolve non-relative URL");e instanceof o||(e=new o(e));var t=new o(this),n=["protocol","username","password","hostname","port"];for(var r=0,i;i=n[r];r++)t._parts[i]=e._parts[i];
return t.path()[0]!=="/"&&(t._parts.path=e.directory()+"/"+t._parts.path,t.normalizePath()),t.build(),t},u.relativeTo=function(e){if(this._parts.urn)throw new Error("URNs do not have any generally defined hierachical components");e instanceof o||(e=new o(e));if(this.path()[0]!=="/"||e.path()[0]!=="/")throw new Error("Cannot calculate common path from non-relative URLs");var t=new o(this),n=["protocol","username","password","hostname","port"],r=o.commonPath(t.path(),e.path()),i=e.directory();for(var s=0,u;u=n[s];s++)t._parts[u]=null;if(!r||r==="/")return t;if(i+"/"===r)t._parts.path="./"+t.filename();else{var f="../",l=new RegExp("^"+a(r)),c=i.replace(l,"/").match(/\//g).length-1;while(c--)f+="../";t._parts.path=t._parts.path.replace(l,f)}return t.build(),t},u.equals=function(e){var t=new o(this),n=new o(e),r={},i={},s={},u,a,l;t.normalize(),n.normalize();if(t.toString()===n.toString())return!0;u=t.query(),a=n.query(),t.query(""),n.query("");if(t.toString()!==n.toString())return!1;if(u.length!==a.length)return!1;r=o.parseQuery(u),i=o.parseQuery(a);for(l in r)if(Object.prototype.hasOwnProperty.call(r,l)){if(!f(r[l])){if(r[l]!==i[l])return!1}else{if(!f(i[l]))return!1;if(r[l].length!==i[l].length)return!1;r[l].sort(),i[l].sort();for(var c=0,h=r[l].length;c<h;c++)if(r[l][c]!==i[l][c])return!1}s[l]=!0}for(l in i)if(Object.prototype.hasOwnProperty.call(i,l)&&!s[l])return!1;return!0},typeof module!="undefined"&&module.exports?module.exports=o:window.URI=o}(),function(e,t){var n=e.prototype;n.baseEquals=function(t){var n=(new e(this)).normalize(),r=(new e(t)).normalize(),i=n.protocol
()+"://"+n.domain()+":"+n.port(),s=r.protocol()+"://"+r.domain()+":"+r.port();return i===s}}(window.URI),function(e,t){var n=e.prototype;n.sortQuery=function(){var t=this._parts.query;if(!t.length)this._parts.query=null;else{var n=e.parseQuery(t),r,i,s,o;this.query(null),o=CW.invertHash(n).sort();for(r=0,i=o.length;r<i;r++)s=o[r],this.addQuery(s,n[s])}return this}}(window.URI),CW=SC.Object.create({NAMESPACE:"CW",VERSION:"1.0.0"}),CW.mixin({upperCaseUUID:function(){return this.UUID().toString().toUpperCase()},UUID:function(){var e,t=[],n=0;while(n<36)t.push((Math.random()*16|0).toString(16)),n+=1;return t[8]=t[13]=t[18]=t[23]="-",t[14]="4",t[19]="89ab".charAt(Math.random()*4|0),e=t.join(""),e},invertArray:function(e){e||CW.fatalError("invertArray():  You must specify an array to invert");var t,n,r,i={};for(t=0,n=e.length;t<n;++t)r=e[t],i[r]=!0;return i},invertArrayWithOrder:function(e){e||CW.fatalError("invertArrayWithOrder():  You must specify an array to invert");var t,n,r,i={};for(t=0,n=e.length;t<n;++t)r=e[t],i[r]=t;return i},invertHash:function(e,t){e||CW.fatalError("invertHash():  You must specify an hash to invert");var n,r,i=[];if(t)for(n in e)r=e[n],r&&i.push(parseInt(n,10));else for(n in e)r=e[n],r&&i.push(n);return i},combineHashes:function(e,t){var n=SC.clone(e),r;for(r in t)n[r]=t[r];return n},hashDifferencesBreakdown:function(e,t,n){(!e||!t)&&CW.fatalError("hashDifferencesBreakdown() must be called with two hashes"),e===t&&CW.fatalError("hashDifferencesBreakdown() must be called with two different hashes");var r=[],i=[],s=[],o=[],u,a,f,l;n&&(u=this.invertArray(n
));var c=CW.getSimpleTypes(),h={},p,d,v,m;for(a in e){h[a]=!0;if(u&&u[a])continue;p=e[a],d=t[a],d===undefined?s.push(a):(v=p===d,v||(m=SC.typeOf(p),c[m]?v=!1:v=CW.valuesAreEqual(p,d,m)),v?r.push(a):i.push(a))}for(a in t)h[a]||o.push(a);return{equal:r,different:i,firstHashOnly:s,secondHashOnly:o}},valuesAreEqual:function(e,t,n,r){if(e===t)return!0;n||(n=SC.typeOf(e));var i=CW.getSimpleTypes();if(i[n])return!1;r||(r=SC.typeOf(t));if(n!==r)return!1;if(n===SC.T_DATE)return e.getTime()===t.getTime();if(n===SC.T_REGEXP)return e.toString()===t.toString();if(n===SC.T_HASH){var s=0,o,u,a,f;for(o in e){++s,u=e[o],a=t[o];if(u!==a){f=SC.typeOf(u);if(i[f])return!1;if(!CW.valuesAreEqual(u,a,f))return!1}}for(o in t)--s;return s===0}if(n===SC.T_ARRAY){var l=e.length,c=t.length;if(l!==c)return!1;for(var h=l-1;h>=0;--h){u=e[h],a=t[h];if(u!==a){f=SC.typeOf(u);if(i[f])return!1;if(!CW.valuesAreEqual(u,a,f))return!1}}return!0}CW.fatalError("Unsupported type for CW.valuesAreEqual:  '%@'".fmt(n))},getSimpleTypes:function(){var e=CW._simpleTypes;return e||(e=CW._simpleTypes={},e[SC.T_STRING]=!0,e[SC.T_NUMBER]=!0,e[SC.T_BOOL]=!0,e[SC.T_UNDEFINED]=!0,e[SC.T_NULL]=!0),e},getUrlParameters:function(e){e||(e=location.search);var t=new URI.parse(e);return t.query?URI.parseQuery(t.query):{}},escapeRegexCharacters:function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#]/g,"\\$&")},formatNumber:function(e,t,n){if(SC.none(e))return"";SC.none(t)&&(t=","),SC.none(n)&&(n="."),e=e.toString();var r=e.split("."),i=r[0],s=r[1],o=/(\d+?)(?=(?:\d{3})+$)/g,u="$1"+t;return i=i.replace(o,u),s?i+n+s:i},preloadTargetImages:function(
e){if(SC.APP_IMAGE_ASSETS)for(var t=0,n=SC.APP_IMAGE_ASSETS.length;t<n;t++)(!e||SC.APP_IMAGE_ASSETS[t].indexOf(e)!==-1)&&SC.imageQueue.loadImage(SC.APP_IMAGE_ASSETS[t])}}),SC.ready(function(){setTimeout(function(){CW.preloadTargetImages()},2e3)}),CW.mixin({fatalError:function(e,t){var n=this.recordStack(YES,YES),r;throw e instanceof Error?r=e:r=new Error(e),t&&SC.mixin(r,t),r.recordedStack=n,r},recordStack:function(e,t){if(t||!this.get("hasSymbolicated"))try{this.symbolicate()}catch(n){}var r=arguments.callee,i=r?r.caller:null,s=0,o=[],u={},a,f,l,c,h,p;i&&e&&(i=i.caller);while(i&&s<26){a=i.displayName,a||(a=i.name),a||(a=i.toString()),a.length>150&&(a=a.substring(0,150)),l={func:a},f=i.arguments;if(f){c=[];for(h=0;h<5;++h)p=f[h],p&&(p.toString?p=p.toString():p="(argument without .toString() method)"),c.push(p);l.args=c}o[s++]=l;if(u[a]){o[s++]="(Because "+a+" was called recursively, no more of the stack is available)";break}u[a]=!0,i=i.caller}return o},hasSymbolicated:NO,namespacesToSymbolicate:["SC"],symbolicate:function(){if(!SC.Object.toString()){SC.warn("Cannot yet properly symbolicate because SproutCore is not yet in a position to provide class names");return}this.hasSymbolicated||(this.hasSymbolicated=!0);if(!SC||!SC.typeOf)return;var e=new Date;this._symbolicateClassAndSubclasses(SC.Object);var t=this.namespacesToSymbolicate,n=CW.invertArray(t),r,i,s,o,u,a,f,l,c,h;if(!t)return;for(r in window){if(n[r])continue;i=r.charAt(0);if(i.toUpperCase()===i)try{f=window[r],f&&f.isObject&&t.push(r)}catch(p){}}for(u=0,a=t.length;u<a;++u){s=t[u],o=window[s];for(r in o){if(!o.hasOwnProperty
(r))continue;f=o[r];if(!f)continue;if(f instanceof Function)f.displayName||(l=s+"."+r,f.displayName=l);else if(f instanceof Object&&!f.isClass)for(c in f){if(!f.hasOwnProperty(c))continue;try{h=f[c],h instanceof Function&&(h.displayName||(l=s+"."+r+"."+c,h.displayName=l))}catch(d){SC.warn("Can not symbolicate %@: %@",c,d)}}}}SC.info("Spent %@ ms symbolicating",new Date-e)},_symbolicateClassAndSubclasses:function(e){var t=e.toString(),n,r,i,s,o,u;if(!t)return;for(n in e){if(!e.hasOwnProperty(n))continue;r=e[n],r instanceof Function&&(r.displayName||(i=t+"."+n,r.displayName=i))}s=e.prototype;for(n in s){if(!s.hasOwnProperty(n))continue;r=s[n],r instanceof Function&&(r.displayName||(i=t+"#"+n,r.displayName=i))}o=e.subclasses;for(n in o)u=o[n],u&&u.isClass&&this._symbolicateClassAndSubclasses(u)}}),CW.FakeReply=SC.Object.extend({isFakeReply:YES,shouldProcessRequestNormally:NO,applyToBackgroundRequests:NO,status:undefined,statusText:undefined,responseText:undefined,urlFilter:undefined,delay:undefined,headers:undefined,readyState:undefined,_lowercaseHeaders:null,getAllResponseHeaders:function(){var e=this.get("headers"),t="";for(var n in e){var r=e[n];t+=n+": "+r+"\n"}return t},getResponseHeader:function(e){if(!e)return;var t=this._lowercaseHeaders;if(!t){t=this._lowercaseHeaders={};var n=this.get("headers");for(var r in n){var i=n[r];t[r.toLowerCase()]=i}}return t[e.toLowerCase()]},abort:function(){},toString:function(){if(this.get("shouldProcessRequestNormally"))return"will be sent normally";var e=[],t=CW.FakeReply.allowableCreationParams,n,r,i,s;for(n=0,r=t.length;n<r;++n){i=t[
n],s=this.get(i);if(s!==undefined){if(i==="applyToBackgroundRequests"&&!s)continue;SC.typeOf(s)===SC.T_STRING?e.push("%@=“%@”".fmt(i,s)):e.push("%@=%@".fmt(i,s))}}return e.join(",  ")}}),SC.mixin(CW.FakeReply,{allowableCreationParams:["applyToBackgroundRequests","status","statusText","responseText","responseHash","urlFilter","delay","headers"],_allowableCreationParamsHash:null,createFakeReply:function(e){var t=CW.FakeReply,n=t._allowableCreationParamsHash,r,i,s,o;if(!n){n=t._allowableCreationParamsHash={},i=t.allowableCreationParams;for(s=0,o=i.length;s<o;++s)r=i[s],n[r]=YES}if(e===null)return t.create({shouldProcessRequestNormally:YES});e||CW.fatalError("You must specify params for the fake reply");var u=NO;for(r in e)n[r]||(console.error&&console.error("Fake reply has an unrecognized parameter “%@”:".fmt(r),e),u=YES);u&&CW.fatalError("Unrecognized parameter in fake reply");var a=0,f=e.status;f===undefined?(console.error&&console.error("Fake reply does not include a status:",e),++a):f||(console.error&&console.error("Fake reply has an invalid status of 0:",e),++a);var l=e.responseText,c=e.responseHash;l===undefined&&!c?l=e.responseText="Fake reply with status "+f:l!==undefined&&c?(console.error&&console.error("Fake reply has both a responseText and a responseHash:",e),++a):l!==undefined&&SC.typeOf(l)!==SC.T_STRING?(console.error&&console.error("Fake reply has an invalid responseText (it should be a string):",e),++a):c&&SC.typeOf(c)!==SC.T_HASH&&(console.error&&console.error("Fake reply has an invalid responseHash (it should be a hash):",e),++a);var h=e.urlFilter;h&&!(h instanceof 
RegExp)&&(SC.typeOf(h)===SC.T_STRING?e.urlFilter=new RegExp(h):(console.error&&console.error("Fake reply has an invalid urlFilter (it should be a string or a RegExp instance):",e),++a));if(c&&a===0){delete e.responseHash;try{e.responseText=SC.json.encode(c)}catch(p){console.error&&console.error("There was an error encoding JSON from the responseHash:  "+p+",  fake reply:",e),++a}}if(a===1)CW.fatalError("There was one error with the fake reply parameters");else{if(!(a>0))return t.create(e);CW.fatalError("There were %@ errors with the fake reply parameters".fmt(a))}}}),CW.mixin({requestLoggingLevel:null,fakeReplyQueue:null,addFakeReply:function(e,t){SC.typeOf(e)!==SC.T_ARRAY&&(e=SC.$A(e));var n=CW.FakeReply,r=[],i,s,o,u;for(i=0,s=e.length;i<s;++i){o=e[i],u=null;try{u=n.createFakeReply(o)}catch(a){}u&&r.push(u)}var f=e.length,l=r.length;if(f!==l){var c=f-l;c===1?CW.fatalError("Errors prevented your fake reply from being added.  The fake reply queue was not changed."):CW.fatalError("Errors prevented %@ of your %@ fake replies from being added.  The fake reply queue was not changed.".fmt(c,f))}var h=this.get("fakeReplyQueue");h||(h=[],this.set("fakeReplyQueue",h)),h.beginPropertyChanges();for(i=0,s=r.length;i<s;++i)u=r[i],h.pushObject(u);h.endPropertyChanges(),t||(console.log("The fake reply queue is now:"),this.listFakeReplyQueue())},listFakeReplyQueue:function(){var e=this.get("fakeReplyQueue");if(!e)console.log("(no fake reply queue)");else{var t=[],n,r,i;for(n=0,r=e.length;n<r;++n)i=e[n],t.push("[%@]  %@".fmt(n,i));console.log(t.join("\n"))}},_recordingCount:0,_logRequestIfAppropriateFor
:function(e){e||CW.fatalError("_logRequestIfAppropriateFor():  A response must be specified");var t=this.get("requestLoggingLevel"),n=++this._recordingCount,r,i,s,o,u,a,f;t&&(e._recordingID=n,e._sentAt=new Date,r=e.get("request"),i=r.get("type"),s=r.getFullAddress(),o=this._sortAndStringifyHeaders(r.get("headers")),u=r.get("cookies"),r.get("bodyShouldBeLogged")?(a=r.get("encodedBody"),a||(a="(empty)")):a="(omitted)",f="-->  Request "+n+":   "+i+" to "+s+",  headers: "+o+(u?",  cookies: "+u:"")+",  body: "+a,SC.Logger._handleMessage(t,NO,f))},_logResponseIfAppropriate:function(e){e||CW.fatalError("_logResponseIfAppropriateFor():  A response must be specified");var t=this.get("requestLoggingLevel"),n=new Date,r,i,s,o,u,a,f,l,c;if(t){r=e._recordingID,i=e._sentAt,s=e._receivedAtWhileSuspended,o=e.get("timedOut"),o?u="  (timed out)":s?u=i?"  ("+(s-i)+"ms, suspended for "+(n-s)+"ms)":"  (unknown)":u=i?"  ("+(n-i)+"ms)":"  (unknown)",a=e.get("status");try{f=this._sortAndStringifyHeaders(e.get("headers"))}catch(h){}e.get("bodyShouldBeLogged")?(l=e.get("encodedBody"),l||(l="(empty)")):l="(omitted)",c="<--  Response "+r+":  "+a+u+",  headers: "+f+"  body: "+l,SC.Logger._handleMessage(t,NO,c)}},_sortAndStringifyHeaders:function(e){var t,n,r,i,s,o=[];for(t in e)o.push(t);o.sort(),r="";for(i=0,s=o.length;i<s;++i)t=o[i],n=e[t],i!==0&&(r+=", "),r+=t+"="+n;return r}}),CW.DATE_ONLY=0,CW.DATE_TIME=1,CW.DATE_TIME_TO_MIDNIGHT=3,CW.DATE_TIME_SEC=4,CW.DAY_MIN_DUR=1440,CW.DAY_MILLIS_DUR=864e5,CW.Date={value:null,dateType:CW.DATE_ONLY,timeFormat:null,fullDateFormat:null,dateFormat:null,_dateObj:null
,_timezoneOffset:0,incrementSeconds:function(e){return this.seconds(this.seconds()+e),this},incrementMinutes:function(e){return this.minutes(this.minutes()+e),this},incrementHours:function(e){return this.hours(this.hours()+e),this},incrementDate:function(e){return this.date(this.date()+e),this},incrementMonth:function(e){return this.month(this.month()+e),this},incrementYear:function(e){return this.year(this.year()+e),this},now:function(){this._dateObj=new Date;var e=this._dateObj.getTime(),t=this._dateObj.getTimezoneOffset()*6e4;return this._dateObj.setTime(e-t),this._dateObj._isUsingUTC=!0,this._dateComponentDidChange(),this},dateComponent:function(){var e=this.value;return e?e[0]:null},date:function(e){return e!==undefined?(this._dateObj.setUTCDate(e),this._dateComponentDidChange()):this.value[3]},dateObject:function(){return this._dateObj},day:function(){return this._dateObj.getUTCDay()},fullYear:function(e){return e!==undefined?(this._dateObj.setUTCFullYear(e),this._dateComponentDidChange()):this.value[1]},hours:function(e){return e!==undefined?(this._dateObj.setUTCHours(e),this._dateComponentDidChange()):this.value[4]},minutes:function(e){return e!==undefined?(this._dateObj.setUTCMinutes(e),this._dateComponentDidChange()):this.value[5]},seconds:function(e){return this.dateType===CW.DATE_TIME_SEC?e!==undefined?(this._dateObj.setUTCSeconds(e),this._dateComponentDidChange()):this.value[6]:0},month:function(e){return e!==undefined?(this._dateObj.setUTCMonth(e),this._dateComponentDidChange()):this._dateObj.getUTCMonth()},time:function(e){return e!==undefined?(this._dateObj.setTime
(e),this._dateComponentDidChange()):this._dateObj.getTime()},timezoneOffset:function(e){return e!==undefined?(this.set("_timezoneOffset",e),this._dateComponentDidChange()):this.get("_timezoneOffset")},year:function(e){return this.fullYear(e)},changeDateType:function(e){return e===this.dateType?this:(e===CW.DATE_ONLY||e===CW.DATE_TIME||e===CW.DATE_TIME_TO_MIDNIGHT||e===CW.DATE_TIME_SEC?(this.dateType=e,this._dateComponentDidChange()):CW.fatalError("You must provide a valid date type."),this)},weekNumber:function(e){e=e?e:this._dateObj;var t=new Date(e.getUTCFullYear(),0,1),n=1,r=t.getUTCDay()-n,i=Math.floor((e.getTime()-t.getTime())/CW.DAY_MILLIS_DUR)+1,s,o,u,a,f;return r=r>=0?r:r+7,r<4?(s=Math.floor((i+r-1)/7)+1,s>52&&(o=new Date(e.getUTCFullYear()+1,0,1),u=o.getUTCDay()-n,u=u>=0?u:u+7,s=u<4?1:53)):(a=Math.floor((i+r-1)/7),s=a===0?53:a),f=e.getUTCFullYear(),s===53&&e.getUTCMonth()===0?f--:s===1&&e.getUTCMonth()===11&&f++,[f,s]},weekNumberToDate:function(e,t){e=parseInt(e,0),t=parseInt(t,0);var n=new Date(t,0,10,12,0,0),r=new Date(t,0,4,12,0,0),i=new Date(r.getTime()-n.getUTCDay()*CW.DAY_MILLIS_DUR),s=new Date(i.getTime()+(e-1)*6048e5),o=new Date(s.getTime()+5184e5),u=[s,o];return u},dateRangeOfWeek:function(){var e=this._dateObj,t=e.getUTCDay(),n;t===0?n=6:n=t+1;var r=new Date(e.valueOf());r.setDate(e.getUTCDate()-n);var i=new Date(e.valueOf());return i.setDate(e.getUTCDate()+(7-e.getUTCDay())),[r,i]},daysInMonth:function(){var e=this.year(),t=this.month(),n=[31,28,31,30,31,30,31,31,30,31,30,31];return t===1&&(e%4===0&&e%100!==0||e%400===0)?29:n[t]},toTimeString:function(e){
return e?this.format(e):this.timeFormat?this.format(this.timeFormat):this._dateObj.toString().substr(16,5)},toString:function(e){if(e)return this.format(e);if(this.fullDateFormat)return this.format(this.fullDateFormat);var t=this._dateObj;return t?t.toString():"null"},toDateString:function(e){return e?this.format(e):this.dateFormat?this.format(this.dateFormat):this._dateObj.toString().substr(0,15)},parse:function(e){var t=this._dateObj;return SC.typeOf(e)===SC.T_ARRAY?(isNaN(e[3])||t.setUTCDate(e[3]),isNaN(e[1])||t.setUTCFullYear(e[1]),isNaN(e[2])||t.setUTCMonth(e[2]-1),!isNaN(e[3])&&e[3]!==t.getUTCDate()&&t.setUTCDate(e[3]),this.dateType===CW.DATE_ONLY?(t.setUTCHours(12),t.setUTCMinutes(0)):(isNaN(e[4])||t.setUTCHours(e[4]),isNaN(e[5])||t.setUTCMinutes(e[5]),this.dateType===CW.DATE_TIME_SEC&&(isNaN(e[6])||t.setUTCSeconds(e[6])))):e&&e.getTime&&(e._isUsingUTC?(t.setUTCFullYear(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()),t.setUTCHours(e.getUTCHours()),t.setUTCMinutes(e.getUTCMinutes()),this.dateType===CW.DATE_TIME_SEC&&t.setUTCSeconds(e.getUTCSeconds())):(t.setUTCFullYear(e.getFullYear(),e.getMonth(),e.getDate()),t.setUTCHours(e.getHours()),t.setUTCMinutes(e.getMinutes()),this.dateType===CW.DATE_TIME_SEC&&t.setUTCSeconds(e.getSeconds()))),this.dateType!==CW.DATE_TIME_SEC&&t.setUTCSeconds(0),t.setUTCMilliseconds(0),t._isUsingUTC=!0,this._dateObj=t,this._dateComponentDidChange(),this},format:function(e,t){e+="",t&&(e=e.loc());var n=this._dateObj,r=this.value||{},i=e.length,s="",o=0,u="",a="",f=r[1]+"",l=r[2],c=r[3],h=n.getUTCDay(),p=r[4],d=r[5],v=n.getUTCSeconds(),m,g,y,
b,w,E,S,x,T,N,C,k,L,A,O,M,_;f.length<3&&(f>=0&&f<=28?f=""+(f+2e3):f>=28&&f<=99&&(f=""+(f+1900))),r.y=""+f,r.yyyy=f,r.yy=f.substring(2,4),r.M=l,r.MM=LZ(l),r.MMM=MONTH_NAMES[l-1],r.NNN=MONTH_NAMES[l+11],r.d=c,r.dd=LZ(c),r.E=DAY_NAMES[h+7],r.EE=DAY_NAMES[h],r.H=p,r.HH=LZ(p),p===0?r.h=12:p>12?r.h=p-12:r.h=p,r.hh=LZ(r.h),p>11?r.K=p-12:r.K=p,r.k=p+1,r.KK=LZ(r.K),r.kk=LZ(r.k),p>11?r.a="SC.Date.Period.PM".loc():r.a="SC.Date.Period.AM".loc(),r.m=d,r.mm=LZ(d),r.s=v,r.ss=LZ(v);while(o<i){u=e.charAt(o),a="";while(e.charAt(o)==u&&o<i)a+=e.charAt(o++);M=r[a],SC.none(M)?s+=a:(_=M.toString().loc(),s+=_?_:M)}return s},done:function(){return CW.Date._pool.indexOf(this)===-1&&CW.Date._pool.push(this),this.timeFormat=this.fullTimeFormat=this.dateFormat=null,SC.clone(this.value)},components:function(){return SC.clone(this.value)},clone:function(e){return CW.Date.create(SC.clone(this.value),e?e:this.dateType)},setValue:function(e){this.value=SC.clone(e),this._dateComponentDidChange()},_dateComponentDidChange:function(){var e=[0,0,0,0,0,0,0],t=this._dateObj;return e[1]=t.getUTCFullYear(),e[2]=t.getUTCMonth()+1,e[3]=t.getUTCDate(),e[0]=parseInt(e[1]+(e[2]<10?"0":"")+e[2]+(e[3]<10?"0":"")+e[3],0),this.dateType!==CW.DATE_ONLY&&(e[4]=t.getUTCHours(),e[5]=t.getUTCMinutes(),this.dateType===CW.DATE_TIME_SEC?e[6]=t.getUTCSeconds():e[6]=this.dateType===CW.DATE_TIME_TO_MIDNIGHT?CW.DAY_MIN_DUR-(e[4]*60+e[5]):e[4]*60+e[5]),this.value=e,this}},SC.mixin(CW.Date,{_pool:[],parseDate:function(e,t){var n=new Date;return SC.typeOf(e)!==SC.T_ARRAY?n:(n.setUTCFullYear(e[1]),n.setUTCMonth(e[2]),n.setUTCDate(e[3]),t||(n
.setUTCHours(e[4]),n.setUTCMinutes(e[5])),n.setUTCSeconds(0),n.setUTCMilliseconds(0),n)},dateComponentsEqual:function(e,t){return SC.typeOf(e)!==SC.T_ARRAY&&SC.typeOf(t)===SC.T_ARRAY?NO:e[0]===t[0]},datesEqual:function(e,t){if(e===t)return YES;var n=SC.typeOf(e),r=SC.typeOf(t);return n!==r?NO:e.value[0]===t.value[0]},dateTimesEqual:function(e,t){return SC.typeOf(e)!==SC.T_ARRAY&&SC.typeOf(t)===SC.T_ARRAY?NO:e[0]===t[0]&&e[4]===t[4]&&e[5]===t[5]},create:function(e,t){var n;return CW.Date._pool.length>0?(n=CW.Date._pool.pop(),n.value=null,n.dateType=CW.DATE_ONLY):n=SC.beget(CW.Date),n._dateObj=new Date,n._dateObj._isUsingUTC=!0,e&&SC.typeOf(e)===SC.T_NUMBER&&(t=e,e=null),t!==undefined&&(n.dateType=t),n.parse(e),n},createFromDateObject:function(e,t){var n;return CW.Date._pool.length>0?(n=CW.Date._pool.pop(),n.value=null,n.dateType=CW.DATE_ONLY):n=SC.beget(CW.Date),n._dateObj=e,n.dateType=t||CW.DATE_ONLY,n},createFromDateComponent:function(e){e||CW.fatalError("createFromDateComponent():  No date component was specified");var t=Math.floor(e/1e4),n=Math.floor(e/100)-t*100,r=e-t*1e4-n*100,i=[e,t,n,r],s=CW.Date.create(i,CW.DATE_ONLY);return s},areDatesInRange:function(e,t,n,r){return!e||!t?NO:t[0]===n[0]&&t[6]===1440?NO:e[0]>=n[0]&&e[0]<=r[0]||t[0]>=n[0]&&t[0]<=r[0]||e[0]<=n[0]&&t[0]>=r[0]},compareDates:function(e,t,n){if(!e||!t)return e||t;var r,i,s,o;return r=e._dateObj?e.components():e,i=t._dateObj?t.components():t,r[0]<i[0]?n?t:e:r[0]===i[0]?(s=r[4]*60+r[5],o=i[4]*60+i[5],s<o?n?t:e:s>o?n?e:t:null):n?e:t},greaterThan:function(e,t){SC.typeOf(e)===SC.T_ARRAY&&(e=CW.Date.create(e)),
SC.typeOf(t)===SC.T_ARRAY&&(t=CW.Date.create(t));var n=this.compareDates(e,t,YES);return n===e?YES:NO}}),CW.ImagePreloader=SC.Object.extend({images:null,callBack:null,init:function(){this.loadImages()},loadImages:function(){this._numLoaded=0,this._numProcessed=0,this._allImages=[],this._numImages=this.get("images").length;for(var e=0;e<this._numImages;e++)this.preload(this.get("images")[e])},preload:function(e){var t=new Image;this._allImages.push(t),theImage=this,t.onload=function(){theImage.onload.call(theImage)},t.onerror=function(){theImage.onerror.call(theImage)},t.onabort=function(){theImage.onabort.call(theImage)},t.sLoaded=!1,t.src=e},onComplete:function(){this._numProcessed++,this._numProcessed===this._numImages&&this.callBack(this._allImages,this._numLoaded)},onload:function(){this.sLoaded=!0,this._numLoaded++,this.onComplete()},onerror:function(){this.sError=!0,this.onComplete()},onabort:function(){this.sAbort=!0,this.onComplete()}}),CW.LOG_NOTIFICATIONS=NO,CW.notificationCenter=SC.Object.create({_subscriptions:{},postNotification:function(e){var t=this._subscriptions;if(!t[e]){CW.LOG_NOTIFICATIONS&&SC.info("Notification Center: Could not find any subscribers for %@, returning.".fmt(e));return}var n=t[e],r=n.length,i=SC.A(arguments).slice(1);i||(i=[]),CW.LOG_NOTIFICATIONS&&SC.info("Notification Center: Posting notification %@".fmt(e));for(var s=0;s<r;s++){var o=n[s];if(o){var u=o.action,a=o.target;u.apply(a,i)}}},_targetForTargetName:function(e){return SC.typeOf(e)===SC.T_STRING?SC.objectForPropertyPath(e):e},_methodForMethodNameInTarget:function(e,t){return SC.typeOf
(e)===SC.T_STRING?SC.objectForPropertyPath(e,t):e},subscribeToNotification:function(e,t,n){t=this._targetForTargetName(t),n=this._methodForMethodNameInTarget(n,t);if(!n)throw"You must pass a action to subscribeToNotification()";var r=this._subscriptions,i=r[e];i||(i=r[e]=[]);var s=!1,o=i.length;for(var u=0;u<o;u++){var a=i[u];a.action===n&&a.target===t&&(s=!0)}s||(CW.LOG_NOTIFICATIONS&&SC.info("Notification Center: Subscribed to %@".fmt(e)),r[e].push({action:n,target:t}),this._subscriptions=r)},unsubscribeFromNotification:function(e,t,n){var r=this._subscriptions;t=this._targetForTargetName(t),n=this._methodForMethodNameInTarget(n,t);if(!n)throw"You must pass a action to subscribeToNotification()";var i=r[e];if(!i)return;var s=i.length,o=-1;for(var u=0;u<s;u++){var a=i[u];a.action===n&&a.target===t&&(o=u)}o!==-1&&(CW.LOG_NOTIFICATIONS&&SC.info("Notification Center: Subscribed to %@".fmt(e)),r[e].splice(o,1),this._subscriptions=r)}}),CW.Response=SC.XHRResponse.extend({bodyShouldBeLogged:function(){var e=this.get("status");return!SC.none(e)&&e!==200}.property("status"),fakeReply:null,overallTimeoutTimer:null,addedToOutgoingQueueTimestamp:null,getFullAddress:function(){return this.get("request").getFullAddress()},notify:function(){var e=arguments.callee.base.apply(this,arguments),t=CW.RequestManagement,n;return t&&(n=t.sharedInstance()),n&&n.removeOutstandingResponse(this),e},fire:function(e){var t=this.get("request"),n=t?t.get("source"):null;n&&n.willSend&&n.willSend(t,this),t.freeze(),this.get("isCancelled")||this.invokeTransport(e);var r=t.get("timeout");if(r){var i=SC.Timer
.schedule({target:this,action:"timeoutReached",interval:r,repeats:NO});this.set("timeoutTimer",i)}!this.get("isCancelled")&&n&&n.didSend&&n.didSend(t,this)},timeoutReached:function(){var e=this.get("timeoutTimer");return e&&e.invalidate(),e=this.get("overallTimeoutTimer"),e&&e.invalidate(),arguments.callee.base.apply(this,arguments)},receive:function(e,t){var n=this.get("overallTimeoutTimer");return n&&n.invalidate(),arguments.callee.base.apply(this,arguments)},invokeTransport:function(){var e=this.get("fakeReply"),t;if(!e){var n=this.createRequest(),r,i,s;return this.set("rawRequest",n),s=!!this.getPath("request.isAsynchronous"),s&&(!SC.browser.msie&&!SC.browser.opera?SC.Event.add(n,"readystatechange",this,this.finishRequest,n):(r=this,i=function(){if(!r)return null;var e=r.finishRequest();return e&&(r=null),e},n.onreadystatechange=i)),n.open(this.get("type"),this.getFullAddress(),s),this.setRequestHeaders(),this.getPath("request.useCrossDomain")&&this.getPath("request.withCredentials")&&(n.withCredentials=!0),n.send(this.getPath("request.encodedBody")),s||this.finishRequest(),n}this.set("rawRequest",e),t=e.get("delay"),this.invokeLater(this._triggerFakeReply,t)},setRequestHeaders:function(){var e=this.get("rawRequest"),t=this.getPath("request.headers");for(var n in t)e.setRequestHeader(n,t[n])},cancelTransport:function(){var e=this.get("fakeReply");if(e)return;return arguments.callee.base.apply(this,arguments)},_triggerFakeReply:function(){var e=this.get("fakeReply");e&&(e.set("readyState",4),this.finishRequest(undefined))}}),CW.Request=SC.Request.extend({COPY_KEYS:SC.Request
.prototype.COPY_KEYS.concat(["overallTimeout","addressPrefix","useCrossDomain","withCredentials","id","isCancelled","destinationDomain","cycle","action","isBackgroundRequest","_crossDomainMethod","_queryParameters","_isRead","isRead","isWrite","_isPending","_cycleWhenPended","_cycleWhenSent"]),responseClass:undefined,timeout:3e4,overallTimeout:null,addressPrefix:null,useCrossDomain:NO,withCredentials:NO,iFrameScriptLocation:"ajax_sender.html",id:null,isCancelled:NO,cycle:null,action:null,isBackgroundRequest:NO,isRead:function(e,t){if(t!==undefined)return this._isRead=t,t;var n=this._isRead;if(n!==undefined)return n;var r=this.get("type");if(!!r)return r.toLowerCase()==="get";CW.fatalError("No type was specified, so we don’t know whether this request is a read or a write.")}.property("type").cacheable(),isWrite:function(e,t){return t===undefined?!this.get("isRead"):(this.set("isRead",!t),t)}.property("isRead").cacheable(),bodyShouldBeLogged:NO,queryParameter:function(e,t){var n;if(SC.typeOf(e)===SC.T_STRING)return n=this._queryParameters,arguments.length===1?n?n[e]:null:(this.propertyWillChange("queryParameters"),n||(n=this._queryParameters={}),n[e]=t,this.propertyDidChange("queryParameters"),this);if(t===undefined){n=e,this.beginPropertyChanges();for(e in n){if(!n.hasOwnProperty(e))continue;this.queryParameter(e,n[e])}return this.endPropertyChanges(),this}return CW.fatalError("queryParameter():  You must pass in either a key or a hash of query parameters",{target:this}),this},clearQueryParameters:function(){this.propertyWillChange("queryParameters"),this._queryParameters={},
this.propertyDidChange("queryParameters")},queryParameters:function(){return this._queryParameters}.property().cacheable(),addressWithQueryParameters:function(){var e=URI(this.get("address")).addQuery(this.get("queryParameters")).sortQuery().normalize().toString();return e}.property("address","queryParameters").cacheable(),send:function(e,t){this._determineResponseClassAndMethod();var n;this.get("isAsynchronous")===NO&&(n=this._crossDomainMethod,n&&n!=="cors"&&CW.fatalError("You cannot send a synchronous request using iframes with postMessage",{target:this}));var r=CW.RequestManagement,i=r?r.sharedInstance():null,s,o,u,a;this._isPending=NO,this._cycleWhenPended=null,this._cycleWhenSent=this.get("cycle"),o=this._getFakeReply();var f=this.get("timeout");if(f&&!this.get("isAsynchronous"))throw"Timeout values cannot be used with synchronous requests";if(f===0)throw"The timeout value must either not be specified or must be greater than 0";e&&this.set("body",e);var l=SC.clone(this._queryParameters);return a=this.copy()._prep(),a._queryParameters=l,o&&(a._fakeReplyToUse=o),s=SC.Request.manager.sendRequest(a),s&&i&&i.addOutstandingResponse(s),t&&i&&i.removePendingRequest(this),s},sendAfterDelay:function(e,t){t||CW.fatalError("sendAfterDelay():  You must specify a delay",{target:this});var n=CW.RequestManagement,r=n?n.sharedInstance():null;this._isPending=YES,this._cycleWhenPended=this.get("cycle"),r&&r.addPendingRequest(this),this.invokeLater(this.send,t,e,YES)},resend:function(e,t){var n=this._getFakeReply(),r,i,s,o;return i=this.get("source")?this:this.copy()._prep(),n&&(i._fakeReplyToUse=
n),r=SC.Request.manager.sendRequest(i,e),r&&(s=CW.RequestManagement,o=s?s.sharedInstance():null,o&&o.addOutstandingResponse(r)),t&&o&&o.removePendingRequest(this),r},resendAfterDelay:function(e,t){t||CW.fatalError("resendAfterDelay():  You must specify a delay",{target:this});var n=CW.RequestManagement,r=n?n.sharedInstance():null;this._isPending=YES,this._cycleWhenPended=this.get("cycle"),r&&r.addPendingRequest(this),this.invokeLater(this.resend,t,e,YES)},getFullAddress:function(){var e=this.get("addressPrefix"),t=this.get("addressWithQueryParameters");return e&&(t=e+t),t},didSend:function(e,t){var n;CW._logRequestIfAppropriateFor(t),n=t.get("rawRequest"),n&&n.isFakeReply&&SC.info("Using fake reply (%@) for request:  %@",n,e)},didReceive:function(e,t){var n=CW.Request,r;n._responseSuspendCount>0?(t._receivedAtWhileSuspended=new Date,r=n._suspendedResponses,r?r.push(t):r=n._suspendedResponses=[t],t.get("isCancelled")||(t._receivedWhenSuspended=YES,t.set("isCancelled",YES))):CW._logResponseIfAppropriate(t)},destinationDomain:function(){var e=this.getFullAddress(),t=null,n,r;if(e){if(URI(e).protocol()===""||URI(e).host()==="")return SC.error("Malformed URL: "+e),null;t=URI(e).protocol()+"://"+URI(e).host()}return t}.property("addressPrefix","address"),cycleDidChange:function(){var e=CW.RequestManagement,t=e?e.sharedInstance():null,n,r;t&&(n=this.get("cycle"),this._isPending?n!==this._cycleWhenPended&&t.cycleDidChangeForPendingRequest():(r=this._cycleWhenSent,r&&n!==r&&t.cycleDidChangeForOutstandingResponse()))}.observes("cycle"),toString:function(){var e=arguments.callee.base.apply
(this,arguments),t=this.get("address");return t&&(e+=" ("+t+")"),e},_crossDomainMethod:null,_queryParameters:null,_isPending:NO,_cycleWhenPended:null,_cycleWhenSent:null,_determineResponseClassAndMethod:function(){var e=SC.kindOf,t,n;if(this.get("useCrossDomain")){t=this.get("responseClass"),t||(XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?t=CW.Response:this._isAppropriateForXDomainRequest()?t=CW.XDRResponse:window.postMessage?t=CW.IFramePostMessageResponse:SC.browser.msie&&SC.browser.version<=7&&(t=CW.IFrameDocumentDomainResponse));if(!this._crossDomainMethod){if(e(t,CW.IFramePostMessageResponse))n="postMessage";else if(e(t,CW.IFrameDocumentDomainResponse))n="documentDomain";else if(e(t,CW.Response)||e(t,CW.XDRResponse))n="cors";n&&(this._crossDomainMethod=n)}}else t=CW.Response;!this.get("responseClass")&&t&&this.set("responseClass",t)},_isAppropriateForXDomainRequest:function(){var e=this.get("headers"),t=YES,n;if(e)for(n in e)if(n.toLowerCase()!=="content-type"||e[n]!=="text/plain")t=NO;return t&&SC.browser.msie&&SC.browser.version<=9&&!this.get("withCredentials")?YES:NO},_getFakeReply:function(){var e=CW.get("fakeReplyQueue"),t=e?e.length:0,n=null,r,i,s,o,u,a;if(t>0){r=this.get("isBackgroundRequest"),i=null;for(s=0;s<t;++s){o=e[s];if(r&&!o.get("applyToBackgroundRequests"))continue;u=o.get("urlFilter");if(u){a=this.get("address");if(!a||!u.test(a))continue}e.removeAt(s,1),i=o;break}i&&(i.get("shouldProcessRequestNormally")||(n=i))}return n}}),CW.Request.mixin({suspendResponses:function(){++this._responseSuspendCount},resumeResponses:function(){var e=--this._responseSuspendCount
,t,n,r,i,s,o;e<0&&(SC.warn("CW.Response.resumeResponses() was called without a paired suspendResponses() invocation; ignoring…"),this._responseSuspendCount=0);var u=function(){i.get("isCancelled")&&i._receivedWhenSuspended&&(i.set("isCancelled",NO),s=i.get("request"),o=s.get("source"),o&&o.didReceive&&o.didReceive(s,i),i.get("isCancelled")||i.notify())};t=this._suspendedResponses,r=t?t.length:0;for(n=0;n<r;++n)i=t[n],SC.run(u)},_responseSuspendCount:0,_suspendedResponses:null}),SC.Request.manager.mixin({crossDomainIFrames:{},_requestId:0,_crossDomainXHRLoaderURL:"",shouldFireRequest:null,_createCrossDomainIFrame:function(e,t){e||CW.fatalError("_createCrossDomainIFrame():  A destination domain must be specified",{target:this}),t||CW.fatalError("_createCrossDomainIFrame():  An AJAX sender URL must be specified",{target:this,destinationDomain:e});var n=document.createElement("iframe"),r=this;t[0]!=="/"&&(t="/"+t),n.loaded=!1,n.onload=n.onreadystatechange=function(){!n.loaded&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")&&(n.loaded=!0,r.fireRequestIfNeeded())},e[e.length-1]==="/"&&(e=e.substr(0,e.length-1)),n.src=e+t,n.style.display="none",document.body.appendChild(n),n.className="crossdomain-iframe",SC.Event.add(window,"message",this,"_messageWasReceived",null,!0),this.get("crossDomainIFrames")[e]=n,this.notifyPropertyChange("crossDomainIFrames")},_messageWasReceived:function(e){var t=e.originalEvent,n=SC.json.decode(t.data);if(!n.isIFramePostMessageResponse)return;var r=n.headers,i=this.get("inflight"),s,o,u;for(u=0,s=i.length;u<s;u++){o=i[u];if(
o.requestId===n.requestId){if(!URI(t.origin).baseEquals(URI(o.get("destinationDomain")))){CW.fatalError("Potential cross domain attack, postMessage from unknown origin, %@",t.origin);return}o.set("rawResponse",n),o.set("rawRequest",n),o.finishRequest();return}}},sendRequest:function(e,t){if(!e)return null;var n=this._requestId,r=e.get("responseClass").create({request:e,requestId:n}),i,s,o,u;if(r.get("isCrossDomain")){var a=e.get("destinationDomain"),f=e._crossDomainMethod;(f==="postMessage"||f==="documentDomain")&&!this.get("crossDomainIFrames")[a]&&this._createCrossDomainIFrame(a,e.get("iFrameScriptLocation")),r.set("destinationDomain",a)}return t&&r.set("retryOf",t),this._requestId=++n,r.set("addedToOutgoingQueueTimestamp",new Date),i=e._fakeReplyToUse,i&&(r.set("fakeReply",i),delete e._fakeReplyToUse),s=e.get("timeout"),o=e.get("overallTimeout"),o===null&&s&&(o=s,e.set("overallTimeout",s)),o&&(u=SC.Timer.schedule({target:r,action:"timeoutReached",interval:o,repeats:NO}),r.set("overallTimeoutTimer",u)),this.get("pending").pushObject(r),this.fireRequestIfNeeded(),r},fireRequestIfNeeded:function(){var e=this.get("pending"),t=this.get("inflight"),n=this.get("maxRequests"),r=e.length,i,s,o,u;if(r>0&&t.length<n){i=this.shouldFireRequest;if(i)for(u=0;u<r;++u){s=e.objectAt(u);if(i(s)){o=s,e.removeAt(u);break}}else o=e.shiftObject();if(!o)return;if(o.get("isCrossDomain")){var a=this.get("crossDomainIFrames")[o.get("destinationDomain")];if(!a||!a.loaded){SC.debug("CW.Request.manager: postponing the sending of %@ since the necessary iframe is not loaded…",o),e.unshift(o);return}}t.pushObject
(o),this.set("inflight",t);var f=o.get("requestId");o.fire(f)}this.propertyDidChange("inflight")}}),CW.RequestManagement=SC.Object.extend({pendingRequests:null,outstandingResponses:null,addPendingRequest:function(e){var t=this.get("pendingRequests");t.pushObject(e)},addOutstandingResponse:function(e){if(!e.getPath("request.isAsynchronous")){SC.debug("Skipping response registration for synchronous response %@…",e);return}var t=this.get("outstandingResponses");t.pushObject(e)},removePendingRequest:function(e){var t=this.get("pendingRequests"),n=t.indexOf(e);n!==-1&&t.removeAt(n,1)},removeOutstandingResponse:function(e){var t=this.get("outstandingResponses"),n=t.indexOf(e);n!==-1&&t.removeAt(n,1)},pendingRequestsForCycle:function(e){var t=this.get("pendingRequests"),n=null,r,i,s;for(r=0,i=t.length;r<i;++r)s=t[r],s.get("cycle")===e&&(n?n.push(s):n=[s]);return n},outstandingResponsesForCycle:function(e){var t=this.get("outstandingResponses"),n=null,r,i,s;for(r=0,i=t.length;r<i;++r)s=t[r],s.getPath("request.cycle")===e&&(n?n.push(s):n=[s]);return n},cycleDidChangeForPendingRequest:function(){this.get("pendingRequests").enumerableContentDidChange()},cycleDidChangeForOutstandingResponse:function(){this.get("outstandingResponses").enumerableContentDidChange()},numberOfPendingOrOutstandingReadsForCycle:function(e){return this.numberOfPendingReadRequestsForCycle(e)+this.numberOfOutstandingReadResponsesForCycle(e)},numberOfPendingReadRequestsForCycle:function(e){var t,n,r,i=0,s=this.pendingRequestsForCycle(e);if(s)for(t=0,n=s.length;t<n;++t)r=s[t],r.get("isRead")&&i++;return i},numberOfOutstandingReadResponsesForCycle
:function(e){var t,n,r,i=0,s=this.outstandingResponsesForCycle(e);if(s)for(t=0,n=s.length;t<n;++t)r=s[t],r.getPath("request.isRead")&&i++;return i},numberOfPendingOrOutstandingWritesForCycle:function(e){return this.numberOfPendingWriteRequestsForCycle(e)+this.numberOfOutstandingWriteResponsesForCycle(e)},numberOfPendingWriteRequestsForCycle:function(e){var t,n,r,i=0,s=this.pendingRequestsForCycle(e);if(s)for(t=0,n=s.length;t<n;++t)r=s[t],r.get("isWrite")&&i++;return i},numberOfOutstandingWriteResponsesForCycle:function(e){var t,n,r,i=0,s=this.outstandingResponsesForCycle(e);if(s)for(t=0,n=s.length;t<n;++t)r=s[t],r.getPath("request.isWrite")&&i++;return i},init:function(){var e=arguments.callee.base.apply(this,arguments);return this.pendingRequests=[],this.outstandingResponses=[],e}}),CW.RequestManagement.mixin({sharedInstance:function(){var e=this._singleton;return e||(e=this._singleton=CW.RequestManagement.create()),e},_singleton:null}),CW.mixin({CJK_UNICODE_RANGES:[[4352,4607],[11904,12031],[12032,12255],[12288,12351],[12352,12447],[12448,12543],[12544,12591],[12592,12687],[12688,12703],[12704,12735],[12800,13055],[13056,13311],[13312,19893],[19968,40959],[40960,42127],[42128,42191],[44032,55203],[63744,64255],[65072,65103]],characterCodeIsCJK:function(e){var t=this.CJK_UNICODE_RANGES,n;if(SC.none(e))return NO;for(var r=0,i=t.length;r<i;++r){n=t[r];if(e>=n[0]&&e<=n[1])return YES}return NO},stringIsCJK:function(e){e=e.trim();if(SC.empty(e))return NO;var t=0,n=e.length-1;while(t<=n)if(!this.characterCodeIsCJK(e.charCodeAt(t++))||!this.characterCodeIsCJK(e.charCodeAt(n--)))return NO
;return YES}}),SC.stringsFor("English",{"SC.Date.Era.AD.Abbreviated":"AD","SC.Date.Era.AD.Full":"Anno Domini","SC.Date.Era.AD.Letter":"A","SC.Date.Era.BC.Abbreviated":"BC","SC.Date.Era.BC.Full":"Before Christ","SC.Date.Era.BC.Letter":"B","SC.Date.Quarter.Q1.Abbreviated":"Q1","SC.Date.Quarter.Q1.Full":"1st quarter","SC.Date.Quarter.StandAlone.Q1.Abbreviated":"Q1","SC.Date.Quarter.StandAlone.Q1.Full":"1st Quarter","SC.Date.Quarter.Q2.Abbreviated":"Q2","SC.Date.Quarter.Q2.Full":"2nd quarter","SC.Date.Quarter.StandAlone.Q2.Abbreviated":"Q2","SC.Date.Quarter.StandAlone.Q2.Full":"2nd Quarter","SC.Date.Quarter.Q3.Abbreviated":"Q3","SC.Date.Quarter.Q3.Full":"3rd quarter","SC.Date.Quarter.StandAlone.Q3.Abbreviated":"Q3","SC.Date.Quarter.StandAlone.Q3.Full":"3rd Quarter","SC.Date.Quarter.Q4.Abbreviated":"Q4","SC.Date.Quarter.Q4.Full":"4th quarter","SC.Date.Quarter.StandAlone.Q4.Abbreviated":"Q4","SC.Date.Quarter.StandAlone.Q4.Full":"4th Quarter","SC.Date.Month.January.Abbreviated":"Jan","SC.Date.Month.January.Full":"January","SC.Date.Month.January.Letter":"J","SC.Date.Month.StandAlone.January.Abbreviated":"Jan","SC.Date.Month.StandAlone.January.Full":"January","SC.Date.Month.StandAlone.January.Letter":"J","SC.Date.Month.Prepositional.January.Abbreviated":"Jan","SC.Date.Month.Prepositional.January.Full":"January","SC.Date.Month.Prepositional.January.Letter":"J","SC.Date.Month.February.Abbreviated":"Feb","SC.Date.Month.February.Full":"February","SC.Date.Month.February.Letter":"F","SC.Date.Month.StandAlone.February.Abbreviated":"Feb","SC.Date.Month.StandAlone.February.Full":"February","SC.Date.Month.StandAlone.February.Letter"
:"F","SC.Date.Month.Prepositional.February.Abbreviated":"Feb","SC.Date.Month.Prepositional.February.Full":"February","SC.Date.Month.Prepositional.February.Letter":"F","SC.Date.Month.March.Abbreviated":"Mar","SC.Date.Month.March.Full":"March","SC.Date.Month.March.Letter":"M","SC.Date.Month.StandAlone.March.Abbreviated":"Mar","SC.Date.Month.StandAlone.March.Full":"March","SC.Date.Month.StandAlone.March.Letter":"M","SC.Date.Month.Prepositional.March.Abbreviated":"Mar","SC.Date.Month.Prepositional.March.Full":"March","SC.Date.Month.Prepositional.March.Letter":"M","SC.Date.Month.April.Abbreviated":"Apr","SC.Date.Month.April.Full":"April","SC.Date.Month.April.Letter":"A","SC.Date.Month.StandAlone.April.Abbreviated":"Apr","SC.Date.Month.StandAlone.April.Full":"April","SC.Date.Month.StandAlone.April.Letter":"A","SC.Date.Month.Prepositional.April.Abbreviated":"Apr","SC.Date.Month.Prepositional.April.Full":"April","SC.Date.Month.Prepositional.April.Letter":"A","SC.Date.Month.May.Abbreviated":"May","SC.Date.Month.May.Full":"May","SC.Date.Month.May.Letter":"M","SC.Date.Month.StandAlone.May.Abbreviated":"May","SC.Date.Month.StandAlone.May.Full":"May","SC.Date.Month.StandAlone.May.Letter":"M","SC.Date.Month.Prepositional.May.Abbreviated":"May","SC.Date.Month.Prepositional.May.Full":"May","SC.Date.Month.Prepositional.May.Letter":"M","SC.Date.Month.June.Abbreviated":"Jun","SC.Date.Month.June.Full":"June","SC.Date.Month.June.Letter":"J","SC.Date.Month.StandAlone.June.Abbreviated":"Jun","SC.Date.Month.StandAlone.June.Full":"June","SC.Date.Month.StandAlone.June.Letter":"J","SC.Date.Month.Prepositional.June.Abbreviated"
:"Jun","SC.Date.Month.Prepositional.June.Full":"June","SC.Date.Month.Prepositional.June.Letter":"J","SC.Date.Month.July.Abbreviated":"Jul","SC.Date.Month.July.Full":"July","SC.Date.Month.July.Letter":"J","SC.Date.Month.StandAlone.July.Abbreviated":"Jul","SC.Date.Month.StandAlone.July.Full":"July","SC.Date.Month.StandAlone.July.Letter":"J","SC.Date.Month.Prepositional.July.Abbreviated":"Jul","SC.Date.Month.Prepositional.July.Full":"July","SC.Date.Month.Prepositional.July.Letter":"J","SC.Date.Month.August.Abbreviated":"Aug","SC.Date.Month.August.Full":"August","SC.Date.Month.August.Letter":"A","SC.Date.Month.StandAlone.August.Abbreviated":"Aug","SC.Date.Month.StandAlone.August.Full":"August","SC.Date.Month.StandAlone.August.Letter":"A","SC.Date.Month.Prepositional.August.Abbreviated":"Aug","SC.Date.Month.Prepositional.August.Full":"August","SC.Date.Month.Prepositional.August.Letter":"A","SC.Date.Month.September.Abbreviated":"Sep","SC.Date.Month.September.Full":"September","SC.Date.Month.September.Letter":"S","SC.Date.Month.StandAlone.September.Abbreviated":"Sep","SC.Date.Month.StandAlone.September.Full":"September","SC.Date.Month.StandAlone.September.Letter":"S","SC.Date.Month.Prepositional.September.Abbreviated":"Sep","SC.Date.Month.Prepositional.September.Full":"September","SC.Date.Month.Prepositional.September.Letter":"S","SC.Date.Month.October.Abbreviated":"Oct","SC.Date.Month.October.Full":"October","SC.Date.Month.October.Letter":"O","SC.Date.Month.StandAlone.October.Abbreviated":"Oct","SC.Date.Month.StandAlone.October.Full":"October","SC.Date.Month.StandAlone.October.Letter"
:"O","SC.Date.Month.Prepositional.October.Abbreviated":"Oct","SC.Date.Month.Prepositional.October.Full":"October","SC.Date.Month.Prepositional.October.Letter":"O","SC.Date.Month.November.Abbreviated":"Nov","SC.Date.Month.November.Full":"November","SC.Date.Month.November.Letter":"N","SC.Date.Month.StandAlone.November.Abbreviated":"Nov","SC.Date.Month.StandAlone.November.Full":"November","SC.Date.Month.StandAlone.November.Letter":"N","SC.Date.Month.Prepositional.November.Abbreviated":"Nov","SC.Date.Month.Prepositional.November.Full":"November","SC.Date.Month.Prepositional.November.Letter":"N","SC.Date.Month.December.Abbreviated":"Dec","SC.Date.Month.December.Full":"December","SC.Date.Month.December.Letter":"D","SC.Date.Month.StandAlone.December.Abbreviated":"Dec","SC.Date.Month.StandAlone.December.Full":"December","SC.Date.Month.StandAlone.December.Letter":"D","SC.Date.Month.Prepositional.December.Abbreviated":"Dec","SC.Date.Month.Prepositional.December.Full":"December","SC.Date.Month.Prepositional.December.Letter":"D","SC.Date.Day.Monday.Abbreviated":"Mon","SC.Date.Day.Monday.Full":"Monday","SC.Date.Day.Monday.Letter":"M","SC.Date.Day.StandAlone.Monday.Abbreviated":"Mon","SC.Date.Day.StandAlone.Monday.Full":"Monday","SC.Date.Day.StandAlone.Monday.Letter":"M","SC.Date.Day.Tuesday.Abbreviated":"Tue","SC.Date.Day.Tuesday.Full":"Tuesday","SC.Date.Day.Tuesday.Letter":"T","SC.Date.Day.StandAlone.Tuesday.Abbreviated":"Tue","SC.Date.Day.StandAlone.Tuesday.Full":"Tuesday","SC.Date.Day.StandAlone.Tuesday.Letter":"T","SC.Date.Day.Wednesday.Abbreviated":"Wed","SC.Date.Day.Wednesday.Full"
:"Wednesday","SC.Date.Day.Wednesday.Letter":"W","SC.Date.Day.StandAlone.Wednesday.Abbreviated":"Wed","SC.Date.Day.StandAlone.Wednesday.Full":"Wednesday","SC.Date.Day.StandAlone.Wednesday.Letter":"W","SC.Date.Day.Thursday.Abbreviated":"Thu","SC.Date.Day.Thursday.Full":"Thursday","SC.Date.Day.Thursday.Letter":"R","SC.Date.Day.StandAlone.Thursday.Abbreviated":"Thu","SC.Date.Day.StandAlone.Thursday.Full":"Thursday","SC.Date.Day.StandAlone.Thursday.Letter":"R","SC.Date.Day.Friday.Abbreviated":"Fri","SC.Date.Day.Friday.Full":"Friday","SC.Date.Day.Friday.Letter":"F","SC.Date.Day.StandAlone.Friday.Abbreviated":"Fri","SC.Date.Day.StandAlone.Friday.Full":"Friday","SC.Date.Day.StandAlone.Friday.Letter":"F","SC.Date.Day.Saturday.Abbreviated":"Sat","SC.Date.Day.Saturday.Full":"Saturday","SC.Date.Day.Saturday.Letter":"S","SC.Date.Day.StandAlone.Saturday.Abbreviated":"Sat","SC.Date.Day.StandAlone.Saturday.Full":"Saturday","SC.Date.Day.StandAlone.Saturday.Letter":"S","SC.Date.Day.Sunday.Abbreviated":"Sun","SC.Date.Day.Sunday.Full":"Sunday","SC.Date.Day.Sunday.Letter":"S","SC.Date.Day.StandAlone.Sunday.Abbreviated":"Sun","SC.Date.Day.StandAlone.Sunday.Full":"Sunday","SC.Date.Day.StandAlone.Sunday.Letter":"S","SC.Date.Period.AM":"AM","SC.Date.Period.PM":"PM"}),CW.DateFormatter=function(e,t){var n=e.dateObject(),r=new Date(n.getTime());return n._isUsingUTC&&r.setMinutes(r.getMinutes()+r.getTimezoneOffset()),SC.DateFormatter(r,t)},window.CM||(CM={}),CM.Defaults={FAMILYNAME_BEFORE_GIVENNAME:!0},CM=SC.Object.create(window.CM||{},{NAMESPACE:"CM",VERSION:"1.0.0",applicationUsesNativeButtonBar:YES,applicationWillCallResize
:YES,init:function(){var e=window.__loc_strings;e&&(SC.stringsFor(SC.Locale.currentLanguage,e),delete window.__loc_strings);var t=document.body,n=CM.Defaults;n&&n.USE_RTL?t.dir="rtl":t.dir="ltr",arguments.callee.base.apply(this,arguments)},validateLatinCharacters:function(e){var t=/^[a-zA-Z]*$/g;return e.match(t)?!1:!0}}),CM.configurationController=SC.Object.create({allowShareLocation:window.configuration.allowShareLocation!==!1,allowChildAccountCreation:window.configuration.allowChildAccountCreation!==!1,maximumChildAccountAge:window.configuration.maximumChildAccountAge+1,maximumChildAccountAgeForDisplay:window.configuration.maximumChildAccountAgeForDisplay,maximumAskToBuyAge:window.configuration.maximumAskToBuyAge+1,maximumFamilySize:window.configuration.maximumFamilySize,iTunesAccountChangeWaitingPeriod:window.configuration.iTunesAccountChangeWaitingPeriod,isAuthKitEnabled:window.configuration.isAuthKitEnabled,smsCodeResendTimeThreshold:window.configuration.smsCodeResendTimeThreshold,smsCodeResendNoOfTimeThreshold:window.configuration.smsCodeResendNoOfTimeThreshold,appleIdAndPrivacyLink:window.configuration.appleIdAndPrivacyLink,isFamilyV2Enabled:window.configuration.isFamilyV2Enabled,minimumQuotaStorageInBytes:window.configuration.minimumQuotaStorageInBytes}),CM.nativeClientController=SC.Object.create({getAppleId:function(){var e=InternetAccount2.account,t;return e&&(t=e.appleId||e.appleID),t},getDSID:function(){var e=InternetAccount2.account,t;return e&&(t=e.dsid),t},_getiTunesStoreAccount:function(){var e=this._getStoreAccount("iTunesAccount");if(!e){var t=InternetAccount2
.workflow;if(t){var n=t.iTunesAppleId,r=t.iTunesDSID;!SC.empty(n)&&!SC.empty(r)&&(e={appleId:n,dsid:r})}}return e},_getAppStoreAccount:function(){return this._getStoreAccount("MASAccount")},_getiBooksAccount:function(){return this._getStoreAccount("iBooksAccount")},getPreferredAccountForSharedPurchases:function(){var e=this._getiTunesStoreAccount();return e||(e=this._getAppStoreAccount()),e||(e=this._getiBooksAccount()),e||(e={appleId:this.getAppleId(),dsid:this.getDSID()}),e},preferredSharedPurchasesAccountIsNotiCloudAccount:function(){var e=this.getDSID(),t=this.getPreferredAccountForSharedPurchases();return e!==t.dsid},currentUserBinding:SC.Binding.oneWay("CM.currentUser"),showAlert:function(e){var t={},n=e.messagePrefix,r=e.messageText,i=e.informativeText,s=e.messageArguments;n&&(r=r||n+".Title",i=i||n+".Description"),r&&(r=r.loc(s)),t.messageText=r,i&&(i=i.loc(s)),t.informativeText=i;var o=e.style;SC.none(o)?t.style=2:t.style=o;var u=e.useSheet;SC.none(u)?t.useSheet=t.style===2:t.useSheet=u;var a=e.target,f=[],l=[],c=e.buttons,h,p,d,v,m,g;for(h=0,p=c.length;h<p;++h)d=c[h],v=d.title,v?v=v.loc():CW.fatalError("Each button must have a 'title'",{options:e}),l.push(v),m=d.target||null,g=d.action||null,f.push([m,g]);t.buttons=l;var y=function(e){e>=1e3&&(e-=1e3),--e;var t=f[e],n=t[0],r=t[1];n||(n=a),SC.run(function(){r&&SC.typeOf(r)===SC.T_FUNCTION?r.call(n):SC.RootResponder.responder.sendAction(r,n)})};InternetAccount2.showAlert(t,y)},reauthenticate:function(e,t){var n=function(e){SC.run(function(){t(e)})};InternetAccount2.reauthenticateAlways?InternetAccount2.reauthenticateAlways
(e,n):InternetAccount2.reauthenticate(e,n)},exit:function(){this._exitHasBeenCalled=!0,InternetAccount2.exit()},endSheet:function(e){this._endSheetHasBeenCalled=!0,InternetAccount2.endSheet(e)},log:function(e,t){InternetAccount2.log(e,t)},openURL:function(e){InternetAccount2.openExternalURL(e)},getContactInfoAndPreferLocalPhoto:function(e,t,n){this._getContactInfo(e,n,!0,!1,t)},getContactInfoAndPreferServerPhoto:function(e,t,n){this._getContactInfo(e,n,!0,!0,t)},getContactInfoWithOnlyLocalPhoto:function(e,t){this._getContactInfo(e,t,!1)},_getContactInfo:function(e,t,n,r,i){var s=function(e){var n,r,i,s;e&&(n=e.firstName,r=e.lastName,i=e.nickname,s=e.photoData),SC.run(function(){t.call(null,n,r,i,s)})};if(InternetAccount2.getContactInfoNew&&this.buildIsGreaterThan(10,10,0,"14A252")){n===undefined&&(n=!0);if(!n||r===undefined)r=!1;n&&!i&&CW.fatalError("#_getContactInfo requires a DSID if retrieving from the server"),InternetAccount2.getContactInfoNew(e,s,n,r,i)}else InternetAccount2.getContactInfo(e,s)},isResizeEnabled:YES,resize:function(e,t,n){if(!this.get("isResizeEnabled")){this._bufferedResize={width:e,height:t,callback:n},SC.debug("Buffering call to resize(width=%@, height=%@) because resizing is currently disabled",e,t);return}var r=function(){SC.run(n)};if(e===this._previousResizeWidth&&t===this._previousResizeHeight){SC.debug("Ignoring redundant call to resize(width=%@, height=%@)",e,t),r.call(null,e,t);return}SC.debug("Calling resize with width=%@, height=%@",e,t),InternetAccount2.resize(e,t,r),this.set("resizeHasBeenCalled",!0),this._signalWebClientIsReadyIfAppropriate
(),this._previousResizeWidth=e,this._previousResizeHeight=t},webClientHasLoaded:function(){var e=InternetAccount2.webClientHasLoaded;e&&e.call(InternetAccount2)},webClientIsReady:function(){this.set("_ourWebClientIsReadyHasBeenCalled",!0),this._signalWebClientIsReadyIfAppropriate()},resizeHasBeenCalled:!1,_bufferedResize:undefined,_buttonBarHasBeenSet:!1,_ourWebClientIsReadyHasBeenCalled:!1,nativeWebClientIsReadyHasBeenCalled:!1,_buttonBar:null,init:function(){this._isResizeEnabledDidChange();var e=SC.Logger;e.__originalOutputMessage=e._outputMessage,e._outputMessage=function(e,t,n,r,i){return InternetAccount2.log&&InternetAccount2.log(e,r),this.__originalOutputMessage.call(this,e,t,n,r,i)};var t=SC.LOGGER_LEVEL_DEBUG;SC.Logger.set("logOutputLevel",t),CW.set("requestLoggingLevel",t)},_isResizeEnabledDidChange:function(){var e=this._previousIsResizeEnabled,t=this.get("isResizeEnabled"),n;this._previousIsResizeEnabled=t,e===NO&&t&&(n=this._bufferedResize,n&&(SC.debug("Invoking buffered resize…"),this._bufferedResize=null,this.resize(n.width,n.height,n.callback)))}.observes("isResizeEnabled"),_signalWebClientIsReadyIfAppropriate:function(){if(this.get("nativeWebClientIsReadyHasBeenCalled"))return;var e=CM.get("applicationUsesNativeButtonBar"),t=this._buttonBarHasBeenSet,n=CM.get("applicationWillCallResize"),r=this.resizeHasBeenCalled,i=!e||t,s=!n||r,o=this._ourWebClientIsReadyHasBeenCalled;i&&s&&o&&(InternetAccount2.webClientIsReady(),this.set("nativeWebClientIsReadyHasBeenCalled",!0))},_getStoreAccount:function(e){var t=InternetAccount2.account,n=t&&t[e];if(n){var r=n.appleID,
i=n.dsid;if(r&&i)return{appleId:r,dsid:i}}},buildIsGreaterThan:function(e,t,n,r){var i=InternetAccount2.environment,s=[i.osMajorVersion,i.osMinorVersion,i.osRevision];for(var o=0,u=3;o<u;o++){var a=s[o],f=arguments[o];if(SC.none(f))return!1;if(a===f)continue;return a>f}if(r){var l=i.osBuild;if(r===l)return!1;var c=/(\d+)(\D)(\d+)(\D)?/i,h=l.match(c),p=r.match(c);for(o=1,u=p.length;o<u;o++){var d=h[o],v=p[o];if(!v)return!1;o%2===1&&(d=Number(d),v=Number(v));if(d===v)continue;return d>v}}return!1},_pendingSpinners:0,showSpinner:function(e){this._pendingSpinners++;if(this._pendingSpinners>1)return;var t=this._buttonBar,n={isVisible:!0,label:e||""};t?t.spinner=n:t={spinner:n},this._updateButtonBar(t)},hideSpinner:function(){this._pendingSpinners--;if(this._pendingSpinners>0)return;var e=this._buttonBar,t={isVisible:!1};e?e.spinner=t:e={spinner:t},this._updateButtonBar(e)},showButtons:function(e){var t=this._buttonBar;t?t.buttons=e:t={buttons:e},this._updateButtonBar(t)},updateButton:function(e,t){var n=this._buttonBar;if(n&&n.buttons)n.buttons[e]=t;else{var r=[];r[e]=t,n?n.buttons=r:n={buttons:r}}this._updateButtonBar(n)},hideButtons:function(){this._updateButtonBar(null)},disableButtons:function(){var e=this._buttonBar,t=e&&e.buttons;if(t)for(var n=0,r=t.length;n<r;n++){var i=t[n];i&&(i.isEnabled=NO)}this._updateButtonBar(e)},_buttonBarIsDisabled:NO,enableButtonBar:function(){this._buttonBarIsDisabled=NO},disableButtonBar:function(){this._buttonBarIsDisabled=YES},_updateButtonBar:function(e){this._buttonBar=e,window.ButtonBar&&(e=new ButtonBar(e)),setTimeout(function(){var t=CM
.nativeClientController;t&&(t._buttonBarIsDisabled||t._exitHasBeenCalled||t._endSheetHasBeenCalled||(InternetAccount2.buttonBar=SC.clone(e,YES),t._buttonBarHasBeenSet=!0,t._signalWebClientIsReadyIfAppropriate()))},1)},showHelpButton:function(e){var t=this._buttonBar;t?t.helpButton=e:t={helpButton:e},this._updateButtonBar(t)},resetToInitialState:function(){this.set("_buttonBarHasBeenSet",!1),this.set("resizeHasBeenCalled",!1),this.set("_previousResizeWidth",undefined),this.set("_previousResizeHeight",undefined),this.set("nativeWebClientIsReadyHasBeenCalled",!1)},authenticateUser:function(e){var t=e.username,n=e.password,r=e.title?e.title:"",i=e.message?e.message:"",s=e.defaultButtonTitle?e.defaultButtonTitle:"",o=e.cancelButtonTitle?e.cancelButtonTitle:"",u=e.shouldPromptForPasswordOnly?e.shouldPromptForPasswordOnly:!1,a=e.isEphemeral?e.isEphemeral:!0,f=function(t){SC.run(function(){e.callback(t)})};InternetAccount2.authenticateUser(t,n,r,i,s,o,u,a,f)},isLoboOrHigher:function(){return CM.nativeClientController.buildIsGreaterThan(10,13,0,"17A291i")}});var nativeClientController=CM.nativeClientController;CM.errorDelegate=SC.Object.create({reauthenticate:nativeClientController.reauthenticate,exit:nativeClientController.exit,showAlert:nativeClientController.showAlert,log:nativeClientController.log,openURL:nativeClientController.openURL}),CM.currentUser=SC.Object.create({appleId:null,firstName:null,lastName:null,nickname:null,displayName:function(){var e=this.get("firstName"),t=this.get("lastName"),n=this.get("appleId"),r=this.get("nickname");return CoreFamily.displayNameFor(e,t,n
,null,r)}.property("firstName","lastName","appleId","nickname").cacheable(),nameInitials:function(){var e=this.get("firstName"),t=this.get("lastName"),n="",r="";return e&&(n=e.charAt(0).toUpperCase()),t&&(r=t.charAt(0).toUpperCase()),CoreFamily.displayNameFor(n,r).replace(/\s+/g,"")}.property("firstName","lastName").cacheable(),photoData:function(e,t){t!==undefined&&(this._photoData=t);var n=this._photoData;return!n&&!this._hasFetchedPhotoFromServer&&(this._hasFetchedPhotoFromServer=YES,this._fetchPhotoFromServer()),this._photoData||this._defaultPhotoData}.property(),isDefaultPhoto:function(){return this.get("photoData")===this._defaultPhotoData}.property("photoData"),init:function(){var e=InternetAccount2.account;this.set({firstName:e.firstName,lastName:e.lastName,nickname:e.nickname,appleId:CM.nativeClientController.getAppleId()}),this._fetchContactInfoFromNativeClient()},prefetchPhotoData:function(){return this.get("photoData")},_defaultPhotoData:"data:image/gif;base64,R0lGODlhAQABAJAAAP///wAAACH5BAUQAAAALAAAAAABAAEAAAICBAEAOw==",_fetchContactInfoFromNativeClient:function(){var e=CM.nativeClientController,t=e.getAppleId(),n=e.getDSID();e.getContactInfoAndPreferLocalPhoto(t,n,function(e,t,n,r){e&&this.set("firstName",e),t&&this.set("lastName",t),n&&this.set("nickname",n),r&&this.set("photoData",r)}.bind(this))},_fetchPhotoFromServer:function(){CM.Request.create({method:"GET",address:"https://setup.icloud.com/setup/account/getPhoto",isJSON:NO,responseClass:CM.ImageResponse}).notify(this,function(e){var t=e.header("X-MMe-Setup-Family-Photo"),n=t&&t.split(",");if(n&&n.length===4
){var r=e.get("responseImage"),i=parseInt(n[2],10),s=parseInt(n[3],10),o=parseInt(n[0],10),u=r.naturalHeight-parseInt(n[1],10)-s;CM.ImageUtils.crop(r,o,u,i,s,function(e){e&&this.set("photoData",e)}.bind(this))}}).send()}}),SC.ExceptionHandler.handleException=function(e){var t=!1;try{t=CM.nativeClientController.nativeWebClientIsReadyHasBeenCalled}catch(n){t=!1}t||InternetAccount2.webClientIsReady(),InternetAccount2.log("error","Web client crashed with: "+e.toString()),InternetAccount2.log("error","Web client stack: "+e.stack),InternetAccount2.showAlert({useSheet:!1,messageText:"CoreMac.FatalException.Title".loc(),informativeText:"CoreMac.FatalException.Message".loc(),style:0,buttons:["OK"]},function(){InternetAccount2.exit({})})},CM.imageManager=SC.Object.create({imageCount:0,loadedImageCount:0,outstandingLoadedImageCount:function(){return this.get("imageCount")-this.get("loadedImageCount")}.property("imageCount","loadedImageCount"),imageDidLoad:function(e){var t=this.incrementProperty("loadedImageCount");t===this.get("imageCount")&&this.imagesDidLoad()},imagesDidLoad:function(){}}),CM.ImageUtils={crop:function(e,t,n,r,i,s){var o=document.createElement("canvas");o.width=r,o.height=i,document.body.appendChild(o),SC.RunLoop.currentRunLoop.invokeLast(this,function(){var u=o.getContext("2d");u.drawImage(e,t,n,r,i,0,0,r,i),s.call(null,o.toDataURL()),o.remove()})}},CM.Response=CW.Response.extend({bodyShouldBeLogged:YES}),CM.ImageResponse=CM.Response.extend({bodyShouldBeLogged:NO,responseImage:null,createRequest:function(){var e=arguments.callee.base.apply(this,arguments);return e.responseType="arraybuffer"
,e},receive:function(e,t){var n=new Image;this.set("responseImage",n),n.onload=function(){CM.Response.prototype.receive.call(this,e,t)}.bind(this),n.src=this.get("_responseDataURL")},_responseDataURL:function(){var e=this.header("Content-Type"),t=e?e.split(";")[0]:"image/jpg",n=new Uint8Array(this.getPath("rawRequest.response")),r=new Blob([n],{type:t});return URL.createObjectURL(r)}.property("status").cacheable()}),CM.Request=CW.Request.extend({bodyShouldBeLogged:YES,responseClass:CM.Response,init:function(){var e=arguments.callee.base.apply(this,arguments);if(!this.get("source")){var t=InternetAccount2.account;if(t){var n=CM.nativeClientController.getAppleId(),r=t.dsid,i=t.password;if(i)this.header("Authorization","Basic "+window.btoa(n+":"+i));else{var s=t.legacyAuthToken||t.authToken;s||CW.fatalError("There is no authentication token defined",{accountInfo:t}),this.header("Authorization","Basic "+window.btoa(r+":"+s))}var o=t.gsiCloudAuthToken;o&&this.header("X-Apple-GS-Token",window.btoa(r+":"+o));var u=t.annnisteOTP;u&&this.header("X-Apple-MD",u);var a=t.annnisteMID;a&&this.header("X-Apple-MD-M",a);var f=t.apnsPushToken;f&&this.header("X-APNS-Push-Token",f);var l=t.adsid;l&&this.header("X-Apple-ADSID",l),n&&this.header("X-MMe-LoggedIn-AppleID",n)}else CW.fatalError("There is no InternetAccount2.account definition");this.header("X-Mme-Setup-FCE048DE-F34F-4FAF-A6DD-6C8AC9DF0C54",!0);var c=window.BUILD_INFO,h=c?c.currentUrl:null,p,d;h&&(p=h.match(/\/resource\/(.+?)\//),p&&(d=p[1])),d||(d=SC.buildNumber);var v=InternetAccount2.environment,m=v.clientVersion||"unknown",g="<%{device}> <%{os};%{osMajorVersion}.%{osMinorVersion}.%{osRevision};%{osBuild}> <webclient/%{webClientVersion} (%{client}/%{clientVersion})>"
.fmt({device:v.device,os:v.platform==="Mac"?"Mac OS X":"Unknown",osMajorVersion:v.osMajorVersion,osMinorVersion:v.osMinorVersion,osRevision:v.osRevision,osBuild:v.osBuild,webClientVersion:d,client:v.client,clientVersion:m});this.header("X-MMe-Client-Info",g);var y=v.udid;y&&this.header("X-Mme-Device-Id",y)}return e}}),CM.View=SC.View.extend({useStaticLayout:YES,clippingFrame:function(){return{x:0,y:0,width:0,height:0}}.property().cacheable()}),CM.ImageView=CM.View.extend({attributeBindings:["src"],tagName:"img",value:"data:image/gif;base64,R0lGODlhAQABAJAAAP///wAAACH5BAUQAAAALAAAAAABAAEAAAICBAEAOw==",srcBinding:SC.Binding.oneWay(".value")}),CM.AccountPhotoView=CM.View.extend({tagName:"figure",classNames:["account-photo"],childViews:["image"],isDefaultPhotoBinding:SC.Binding.oneWay("*content.isDefaultPhoto"),nameInitialsBinding:SC.Binding.oneWay("*content.nameInitials"),attributeBindings:["data-title"],"data-title":function(){var e="";return this.get("showMonogram")&&(e=this.get("nameInitials")),e}.property("*content.nameInitials","showMonogram"),showMonogram:function(){var e=this.get("isDefaultPhoto"),t=this.get("nameInitials"),n=!!this.get("nameInitials");return n&&CM.validateLatinCharacters(t)?!1:e&&n}.property("*content.isDefaultPhoto","*content.nameInitials"),showSilhouette:function(){return!this.get("showMonogram")&&this.get("isDefaultPhoto")}.property("showMonogram","isDefaultPhoto"),showPhotoBinding:SC.Binding.oneWay(".isDefaultPhoto").not(),classNameBindings:["showPhoto:showPhoto","showMonogram:showMonogram","showSilhouette:showSilhouette"],image:CM.ImageView.design(
{valueBinding:SC.Binding.oneWay("*parentView.content.photoData")})}),CM.ContainerView=SC.ContainerView.extend({useStaticLayout:YES,nowShowingDidChange:function(){var e=this.get("nowShowing"),t=this._previousNowShowing;if(e!==t)return this._previousNowShowing=e,arguments.callee.base.apply(this,arguments)},_previousNowShowing:undefined,clippingFrame:function(){return{x:0,y:0,width:0,height:0}}.property().cacheable()}),CM.FieldView=CM.View.extend({classNames:["field-view"],isField:!0,fieldName:null,value:null}),CM.ButtonView=CM.View.extend({attributeBindings:["disabled"],classNames:["button"],displayProperties:["value"],tagName:"button",value:null,target:window,action:null,disabledBinding:SC.Binding.not(".isEnabled"),justClicked:!1,applyAttributesToContext:function(e,t){var n=this.get("disabled");e(t),t.removeClass("disabled"),t.attr("aria-disabled",null)}.enhance(),render:function(e){e.text(this.get("value")),arguments.callee.base.apply(this,arguments)},didCreateLayer:function(){this.$().click(this.didClick.bind(this))},didClick:function(){SC.RunLoop.begin(),this.get("justClicked")||(this._runAction(),this.set("justClicked",!0),this.invokeLater(function(){this.set("justClicked",!1)},1e3)),SC.RunLoop.end()},_runAction:function(e){var t=this.get("action"),n=this.get("target")||null,r;if(t){if(t&&SC.typeOf(t)===SC.T_FUNCTION){this.action(e);return}r=this.getPath("pane.rootResponder"),r&&r.sendAction(t,n,this,this.get("pane"),null,this)}}}),CM.InputView=CM.FieldView.extend({attributeBindings:["value","disabled","type"],classNames:["input-view"],tagName:"input",type:"text",isEnabled
:YES,disabledBinding:SC.Binding.not(".isEnabled"),$input:function(){return this.$()}.property()}),CM.CheckboxView=CM.InputView.extend({attributeBindings:["checked"],classNames:["checkbox"],checkedBinding:SC.Binding.bool(".value"),type:"checkbox",didCreateLayer:function(){var e=this.$input();e.change(this.valueDidChange.bind(this))},valueDidChange:function(){SC.RunLoop.begin(),this.set("value",this.$input().is(":checked")),SC.RunLoop.end()}}),CM.LabelView=CM.View.extend({classNames:["cm-label-view"],displayProperties:["text"],tagName:"label",escapeHTML:YES,text:null,render:function(e,t){var n=arguments.callee.base.apply(this,arguments),r=this.get("text")||" ",i=this.get("escapeHTML")?SC.RenderContext.escapeHTML(r):r;i=this.get("escapeHTML")?$("<div/>").html(i).text():i;if(t)this.renderChildViews(e,t),e.push(i);else{var s=this.$()[0];if(s){var o=s.childNodes,u,a,f;for(u=0,a=o.length;u<a;++u){f=o[u];if(f.nodeType===3){f.textContent=i;break}}f||e.push(i)}}return n}}),CM.LabelledCheckboxView=CM.LabelView.extend({classNames:["labelled-checkbox"],classNameBindings:["value:checked"],attributeBindings:["disabled"],childViews:["checkboxView"],isField:!0,fieldName:null,value:!1,disabledBinding:SC.Binding.not(".isEnabled"),text:null,checkboxView:CM.CheckboxView.extend({valueBinding:".parentView.value",disabledBinding:".parentView.disabled"}),$input:function(){return this.get("checkboxView").$()}}),CM.RadioView=CM.InputView.extend({attributeBindings:["checked","name"],classNames:["radio"],type:"radio",isSelected:NO,checkedBinding:SC.Binding.oneWay(".isSelected"),nameBinding:SC.Binding.oneWay
(".fieldName"),didCreateLayer:function(){var e=this.$input();e.get(0)._sc_view=this,e.bind("change",this.checkedDidChange.bind(this))},checkedDidChange:function(){SC.RunLoop.begin(),$("input[name="+this.get("name")+"]").forEach(function(e){var t=e._sc_view;t.set("isSelected",e.checked)}),SC.RunLoop.end()}}),CM.LabelledRadioView=CM.LabelView.extend({classNames:["labelled-radio"],attributeBindings:["disabled"],childViews:["radioView"],isField:YES,fieldName:null,value:null,isEnabled:YES,isSelected:NO,text:null,radioView:CM.RadioView.extend({fieldNameBinding:".parentView.fieldName",valueBinding:".parentView.value",disabledBinding:SC.Binding.not(".parentView.isEnabled"),isSelectedBinding:".parentView.isSelected"}),$input:function(){return this.get("radioView").$()}}),CM.FAKE_PASSWORD={},CM.TextFieldView=CM.InputView.extend({classNames:["text-field"],attributeBindings:["placeholder","spellcheck","maxLength","autocorrect","autocapitalization"],isTextSelectable:!0,isMultiline:!1,tagName:function(){return this.get("isMultiline")?"textarea":"input"}.property("isMultiline"),isPassword:!1,type:function(){return this.get("isPassword")?"password":"text"}.property("isPassword"),placeholderValue:null,placeholder:function(){var e=this.get("placeholderValue")||"";return e.loc()}.property("placeholderValue"),shouldSpellcheck:!1,spellcheck:function(){return this.get("shouldSpellcheck")?"true":"false"}.property("shouldSpellcheck"),shouldAutoCapitalize:!0,autocapitalization:function(){return this.get("shouldAutoCapitalize")?"on":"off"}.property("shouldAutoCapitalize"),shouldAutoCorrect:!1,autocorrect
:function(){return this.get("shouldAutoCorrect")?"on":"off"}.property("shouldAutoCorrect"),maxLength:null,minLength:null,didCreateLayer:function(){var e=this.get("$input");e.bind("input",this.valueDidChange.bind(this))},valueDidChange:function(){SC.RunLoop.begin(),this.set("value",this.$input().val()),SC.RunLoop.end()},focus:function(){var e=this.$input()[0];e&&e.focus()},clear:function(){this.set("value","")}}),CM.NumericInputWidget=CM.TextFieldView.extend({BACKSPACE_KEY:8,LEFT_ARROW:37,RIGHT_ARROW:39,FORWARD_DELETE_KEY:46,RETURN_KEY:13,TAB_KEY:9,_keyDownEvent:function(e){var t=e.which||e.keyCode,n=e.target,r=n.value,i=e.type;n.select();var s=n.nextElementSibling,o=n.previousElementSibling;t===this.BACKSPACE_KEY?SC.empty(r)?o&&(o.value="",this.set("value",""),o.focus(),o.select()):(n.value="",this.notifyPropertyChange("value")):t===this.FORWARD_DELETE_KEY?SC.empty(r)?s&&(s.value="",this.set("value",""),s.focus(),s.select()):(n.value="",this.notifyPropertyChange("value")):t===this.LEFT_ARROW?o&&(e.preventDefault(),e.stopPropagation(),o.focus(),o.select()):t===this.RIGHT_ARROW&&s&&(e.preventDefault(),e.stopPropagation(),s.focus(),s.select())},_keyUpEvent:function(e){var t=e.which||e.keyCode,n=e.target,r=n.value,i=e.type;n.select();var s=n.nextElementSibling,o=n.previousElementSibling;(t>=48&&t<=57||t>=96&&t<=105)&&s&&!this.isViewHidden(s)&&(e.preventDefault(),e.stopPropagation(),s.focus(),s.select())},_didInput:function(){var e=event.target.value;event.target.value=e.replace(/\D/g,"")},didCreateLayer:function(){this.get("$input").bind("keyup",this._keyUpEvent.bind(this)),this
.get("$input").bind("keydown",this._keyDownEvent.bind(this)),this.get("$input").bind("input",this._didInput.bind(this)),arguments.callee.base.apply(this,arguments)},isViewHidden:function(e){return e.classList.contains("sc-hidden")?!0:!1}}),CM.NumericTextFieldView=CM.TextFieldView.extend({_didInput:function(e){var t=e.target.value;e.target.value=t.replace(/\D/g,"")},didCreateLayer:function(){this.get("$input").bind("input",this._didInput.bind(this)),arguments.callee.base.apply(this,arguments)}}),CM.SelectFieldView=CM.FieldView.extend({classNames:["select-field"],displayProperties:["placeholderValue","options","optionsTextKey","optionsValueKey"],tagName:"select",placeholderValue:null,options:null,optionsTextKey:"text",optionsValueKey:"value",autoFocusFollowingInput:!0,render:function(e,t){var n=this.get("placeholderValue"),r=this.get("options"),i=this.get("optionsTextKey"),s=this.get("optionsValueKey"),o=this.get("value"),u;n&&r.unshift(n);for(var a=0,f=r.length;a<f;a++){var l=r[a],c=SC.typeOf(l)===SC.T_HASH,h=c?l[i]:l,p=String(c?l[s]:l);e=e.begin("option"),e.attr("value",p),o===p&&(e.attr("selected",!0),u=o),e.push(h),e=e.end()}if(!u&&!n){var d=r[0],v=String(SC.typeOf(d)===SC.T_HASH?d[s]:d);u=v}o!==u&&this.set("value",u)},$input:function(){return this.$()},getNextInput:function(){return this.$().next("input")},focus:function(){var e=this.$input()[0];e&&e.focus()},didCreateLayer:function(){var e=this.$input();e.bind("change",this.valueDidChange.bind(this))},valueDidChange:function(){SC.RunLoop.begin();var e=this.$input().val();e===this.get("placeholderValue")&&(e=null),this.set
("value",e),SC.RunLoop.end();if(this.get("autoFocusFollowingInput")){var t=this.getNextInput();t&&t.focus()}}}),CM.LinkView=CM.LabelView.extend({attributeBindings:["href","tabIndex"],classNames:["link-view"],tagName:"a",href:null,tabIndex:-1,didCreateLayer:function(){this.$().bind("click",this._didClick.bind(this))},_didClick:function(e){var t=this.get("href");SC.run(function(){InternetAccount2.openExternalURL(t),e.preventDefault()})}}),CM.RadioGroupView=CM.FieldView.extend({classNames:["radio-group-view"],init:function(){var e=arguments.callee.base.apply(this,arguments);return this.invokeLater(function(){this.notifyPropertyChange("value")}),e},createChildView:function(e){var t=arguments.callee.base.apply(this,arguments);return t.addObserver("isSelected",this,function(){this.notifyPropertyChange("value")}),t},value:function(){var e=this.get("childViews"),t=e.find(function(e){var t=e.$input&&e.$input();if(t)return t.is(":checked")});if(t)return t.get("value")}.property("childView","*childViews.[]")}),CM.SourceListItemView=SC.ListItemView.extend({displayProperties:["iconURL","iconDataTitleAttr","title","titleIndicatorText","subtitle"],contentKeys:{contentIconURLKey:"iconURL",contentIconDataTitleAttrKey:"iconDataTitleAttr",contentTitleKey:"title",contentTitleIndicatorTextKey:"titleIndicatorText",contentSubtitleKey:"subtitle"},attributeBindings:["aria-selected"],"aria-selected":function(){var e=this.get("isSelected");return e?"true":"false"}.property(".isSelected"),contentPropertyDidChange:SC.ContentValueSupport.contentPropertyDidChange,render:function(e,t){var n=this.get("iconURL"
),r=this.get("iconDataTitleAttr"),i=this.get("title"),s=this.get("titleIndicatorText"),o=this.get("subtitle"),u=SC.RenderContext.escapeHTML;i=i?u(i):"",s=s?u(s):"",o=o?u(o):"",r=r?u(r):"",i=$("<div/>").html(i).text();if(t)n&&(CM.imageManager.incrementProperty("imageCount"),e.begin("figure").attr("data-title",r).begin("img").attr("src",n).end().end()),e.push('<label style="overflow: hidden;"><div><div style="text-overflow: ellipsis; overflow: hidden; display: block;">'+i+"</div><span>"+s+"</span></div><i>"+o+"</i></label>");else{var a=this.$("img").length>0,f=!!n;if(a!==f)return this.render(e,YES);var l=this.$("label")[0];if(l){if(l.childNodes[0]){var c=l.childNodes,h=c[0].childNodes,p;if(p=h[0])p.textContent=i;if(p=h[1])p.textContent=s;if(p=c[1])p.textContent=o}l=this.$("figure")[0],l&&(l.dataset.title=r)}var d=this.$("img");d.length>0&&d.attr("src",n)}}}),CM.TermsBox=CM.LabelView.extend({isTextSelectable:YES,tagName:"div",classNames:["terms-box"],escapeHTML:NO}),CM.TextView=CM.View.extend({displayProperties:["text"],tagName:"p",escapeHTML:YES,text:null,render:function(e){var t=this.get("text");return displayText=this.get("escapeHTML")?SC.RenderContext.escapeHTML(t):t,e.push(displayText),arguments.callee.base.apply(this,arguments)}}),window.WorkflowKit={},WorkflowKit.ErrorController=SC.Object.extend({init:function(){this._fieldNamesToFields={},this._errorLabels=[]},registerFields:function(e){SC.mixin(this._fieldNamesToFields,e)},resetErrors:function(){var e=this._errorLabels;for(var t=0,n=e.length;t<n;t++){var r=e[t];r.set("hasError",NO)}e.length=0},_renderError:function(e,t
,n,r){if(!e)return;var i;e.focus();var s=e.get("descriptionLabel");s&&s.get("text")===t?(i=s,i.set("hasError",YES)):(i=this._generateErrorLabel(t),n.insertBefore(i,r)),this._errorLabels.push(i)}}),WorkflowKit.Button=SC.Object.extend({title:"",callback:SC.K,isEnabled:YES,type:"normal",form:null,formIsActiveBinding:SC.Binding.oneWay("*form.isActive"),buttonIndex:null,wrappedCallback:function(){SC.run(function(){this.invokeLast(function(){if(this.get("isEnabled")!==NO&&this.get("formIsActive")){CM.nativeClientController.disableButtons();var e=this.get("callback");e&&e.call(this)}})},this)},_updateNativeButton:function(){var e=this.get("buttonIndex");e!==null&&CM.nativeClientController.updateButton(e,this.toNativeButton())}.observes("title","callback","isEnabled","type"),toNativeButton:function(){return{title:this.get("title"),callback:this.wrappedCallback.bind(this),isEnabled:this.get("isEnabled"),type:this.get("type")}}}),WorkflowKit.FormView=CM.View.extend({childViews:["headerView","contentView"],classNames:["form-view"],title:null,step:null,content:null,escapeTitleHTML:YES,isActiveBinding:SC.Binding.oneWay("*workflowAction.isRunning"),init:function(){var e=arguments.callee.base.apply(this,arguments),t=this.get("fields");if(t)for(var n in t){var r=t[n];r.set("form",this)}return e},headerView:CM.View.extend({tagName:"header",childViews:["titleView","stepView"],titleView:CM.LabelView.extend({tagName:"h1",classNames:["form-title-view"],escapeHTMLBinding:SC.Binding.oneWay(".parentView.parentView.escapeTitleHTML"),textBinding:SC.Binding.notNull(".parentView.parentView.title",null)
}),stepView:CM.TextView.extend({tagName:"small",classNames:["form-step-view"],textBinding:SC.Binding.notNull(".parentView.parentView.step",null)})}),contentView:CM.View.extend({classNames:["form-content-view"],createChildViews:function(){var e=this.getPath("parentView.content");return e&&(this.set("content",e),this.get("childViews").push("content")),arguments.callee.base.apply(this,arguments)}}),isVisibleInWindowDidChange:function(){this.get("isVisibleInWindow")&&this.invokeLast(function(){var e=this.findInitiallyFocusedField(this);e&&e.focus()})}.observes("isVisibleInWindow"),findInitiallyFocusedField:function(e){if((e.kindOf(CM.TextFieldView)||e.kindOf(CM.SelectFieldView))&&e.get("isVisible"))return e;var t=e.get("childViews");for(var n=0,r=t.get("length");n<r;++n){var i=t.objectAt(n),s=this.findInitiallyFocusedField(i);if(s)return s}return null},didCreateLayer:function(){var e=this.get("$");this.$().bind("keydown",this._handleKeyPress.bind(this))},_handleKeyPress:function(e){if(!this.get("isVisibleInWindow"))return;SC.RunLoop.begin();var t=e.which,n;t===13?n="default":t===27&&(n="cancel");if(n){var r=this.get("buttons"),i=r.findProperty("type",n);i&&i.get("isEnabled")&&i.wrappedCallback()}SC.RunLoop.end()},buttons:null,_updateNativeButtons:function(){if(!this.get("isVisibleInWindow"))return;var e=this.get("buttons");e?(e=e.map(function(e,t){return e.set({form:this,buttonIndex:t}),e.toNativeButton()},this),CM.nativeClientController.showButtons(e)):CM.nativeClientController.hideButtons()}.observes("buttons","buttons.[]","isVisibleInWindow"),fields:function(){var e={},t=this
.get("childViews"),n=SC.clone(t);while(n.length>0){var r=n.pop();n.pushObjects(r.get("childViews"));var i=r.get("isField"),s=i&&r.get("fieldName");i&&s&&(e[s]=r)}return e}.property("childViews").cacheable(),value:function(){var e=this.get("fields"),t={};for(var n in e){var r=e[n];t[r.get("fieldName")]=r.get("value")}return t}.property("fields"),clear:function(){var e=this.get("fields");for(var t in e){var n=e[t];n&&n.clear&&n.clear()}}}),window.AssemblyLine=SC.Object.create({NAMESPACE:"AssemblyLine",VERSION:"1.0"}),AssemblyLine.Action=SC.State.extend({completeAction:function(){this.statechart.sendEvent("actionCompleted")},failAction:function(){this.statechart.sendEvent("actionFailed")},performAction:function(){}}),AssemblyLine.SequenceAction=AssemblyLine.Action.extend({initState:function(){var e=this.get("actions")||[],t=e.length,n;if(t===0)throw"You cannot define a SequenceAction without actions";for(n=0;n<t;n++){var r=e[n],i;if(r)if(r.isClass)i=r.toString().match(/[^.]*$/)[0]+n,this[i]=r;else{if(typeof r!="string")throw"invalid action";i=r,r=this[i]}if(!r)throw"missing action";e[n]="this."+i,n===0&&(this.initialSubstate=i)}arguments.callee.base.apply(this,arguments)},enterState:function(){var e=this.get("actions"),t=e.slice(1);t.push(this.finishState),this.set("outstandingActions",t)},actions:null,finishState:SC.State.design({enterState:function(){this.get("parentState").completeAction()}}),performNextAction:function(){var e=this.get("outstandingActions"),t=e.shift();return t?(this.gotoState(t),!0):!1},actionCompleted:function(){return this.performNextAction()},actionFailed
:function(){return this.statechart.sendEvent("fatalError")}}),AssemblyLine.WorkflowAction=AssemblyLine.Action.extend({concatenatedProperties:["preActions","postActions"],initialSubstate:"shouldPerformState",init:function(){var e=this.get("preActions"),t=this.get("postActions"),n=AssemblyLine.WorkflowAction,r=n.prototype;return(!e||e.length===0)&&this.preState===r.preState&&(this.preState=null),(!t||t.length===0)&&this.postState===r.postState&&(this.postState=null),arguments.callee.base.apply(this,arguments)},shouldPerform:function(){return!0},shouldPerformAfterPreAction:function(){return!0},didPerform:null,shouldPerformState:SC.State.design({enterState:function(){var e=this.get("parentState"),t=e.shouldPerform();t?e.gotoPreOrActionState():e.completeAction(),e.set("didPerform",t)}}),preActions:null,preState:AssemblyLine.SequenceAction.design({initState:function(){this.actions=SC.A(this.getPath("parentState.preActions")),arguments.callee.base.apply(this,arguments)},completeAction:function(){var e=this.get("parentState"),t=e.shouldPerformAfterPreAction();t?e.gotoActionState():e.completeAction(),e.set("didPerform",t)}}),action:function(){},isSynchronous:!0,performAction:function(){var e=this.get("action"),t;switch(SC.typeOf(e)){case SC.T_STRING:this.statechart.sendEvent(e);break;case SC.T_FUNCTION:t=e.call(this);break;default:return}t===!1?this.failAction():this.get("isSynchronous")&&this.completeAction()},actionState:SC.State.extend({enterState:function(){this.parentState.performAction()},actionCompleted:function(){return this.parentState.gotoPostIfAvailable()}}),postActions:null
,postState:AssemblyLine.SequenceAction.design({initState:function(){this.actions=SC.A(this.getPath("parentState.postActions")),arguments.callee.base.apply(this,arguments)}}),nextState:null,gotoPreOrActionState:function(){this.preState?this.gotoState("this.preState"):this.gotoActionState()},gotoActionState:function(){this.gotoState("this.actionState")},gotoPostIfAvailable:function(){return this.postState&&this.shouldPerformPostAction()?this.gotoState("this.postState"):!1},gotoNextStateIfAvailable:function(){return this.nextState?(this.gotoState("this."+this.nextState),!0):!1},isRunningBinding:SC.Binding.oneWay(".actionState.isCurrentState"),_isActiveState:function(){var e=this.get("substates").slice();e.push(this);var t=this.preState;if(t){var n=t.get("substates");e.push(n,n.mapProperty("substates"))}var r=this.postState;if(r){var i=r.get("substates");e.push(i,i.mapProperty("substates"))}return e=e.flatten(),e.indexOf(this.getPath("currentSubstates.firstObject"))>=0},actionCompleted:function(){return this._isActiveState()?this.gotoNextStateIfAvailable():!1},actionReversed:function(){return this.canReverseTo()?(this.gotoState(this),!0):!1},canReverseTo:function(){return this.get("didPerform")&&!this._isActiveState()},restartAction:function(){var e=this.statechart.getPath("currentStates.firstObject"),t=e.get("parentState"),n,r;while(t&&t!==e){if(n&&e.kindOf(AssemblyLine.WorkflowAction)&&n.kindOf(AssemblyLine.WorkflowAction))break;e.kindOf(AssemblyLine.WorkflowAction)&&(r=e),n=e,e=e.get("parentState"),t=e.get("parentState")}var i;return e.kindOf(AssemblyLine.WorkflowAction)&&n.kindOf
(AssemblyLine.WorkflowAction)?i=this.gotoState(n):r?i=this.gotoState(r):i=!1,i},actionFailed:function(){this.statechart.sendEvent("fatalError")},fatalError:function(){return this.get("errorState")?(this.gotoState("this.errorState"),!0):!1},shouldPerformPostAction:function(){return!0}}),AssemblyLine.DecisionAction=AssemblyLine.WorkflowAction.extend({branches:{},init:function(){var e=this.get("branches"),t=this.get("actionState"),n=this._branchStates={};for(var r in e)if(e.hasOwnProperty(r)){var i=this[r];this[r]=null,n[r]=i}return n.defaultBranch=this.defaultBranch,this.defaultBranch=null,arguments.callee.base.apply(this,arguments)},isSynchronous:NO,branchTaken:undefined,action:function(){var e=this.get("branches"),t=this.get("actionState"),n;for(n in e)if(e.hasOwnProperty(n)&&e[n].call(this))return this.gotoBranch(t.get(n));var r=t.get("defaultBranch");r?this.gotoBranch(r):(this.set("branchTaken",null),this.completeAction())},gotoBranch:function(e){this.set("branchTaken",e.name),this.gotoState(e)},unknownEvent:function(e,t,n){var r=this.get("branchTaken"),i=NO,s,o;return r&&(s=this.getPath("actionState."+r),s&&(o=s[e],o&&(i=o.call(s,t,n)))),i},actionState:SC.State.design({initialSubstate:"initial",initial:SC.State.extend({enterState:function(){var e=this.getPath("parentState.parentState");e.performAction()}}),initState:function(){var e=this.getPath("parentState._branchStates");for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);return arguments.callee.base.apply(this,arguments)},actionCompleted:function(){var e=this.parentState,t=e.nextState,n=this.statechart.getPath("currentStates.firstObject"
),r=n.get("parentWorkflowAction");if(t&&!r.nextState){var i=e.get("branchTaken"),s=this.get(i);return s.hasSubAction&&!s.hasSubAction(r)||!s.hasSubAction&&this!==r.parentState?!1:(r.nextState=t,r[t]=e[t],r[t].set("parentState",r),this.statechart.sendEvent("actionCompleted"),!0)}return this.parentState.gotoPostIfAvailable()}}),actionReversed:function(){return NO},defaultBranch:null}),AssemblyLine.FormAction=AssemblyLine.WorkflowAction.extend({isSynchronous:!1,form:null,action:function(){this.showForm()},showForm:function(){var e=this.get("form");SC.typeOf(e)===SC.T_STRING&&(e=SC.objectForPropertyPath(e)),e&&e.isClass&&(e=e.create()),e&&(this.set("form",e),e.set("workflowAction",this),this.get("statechart").sendEvent("changeCurrentView",e))}}),AssemblyLine.Workflow=SC.State.extend({actions:[],initialSubstate:"startAction",init:function(){var e=SC.A(this.get("actions")),t,n,r,i;while(t=e.pop())n?(r=n.toString().match(/[^.]*$/)[0],i={nextState:r},i[r]=n,n=t.extend(i)):n=t;this[this.initialSubstate]=n,arguments.callee.base.apply(this,arguments)},fatalError:function(){return this.get("errorState")?(this.gotoState("this.errorState"),!0):!1}}),CW.HashAttributeCommon={isOrphan:NO,parent:null,parentKey:null,parentIsRecord:function(){var e=this.get("parent");return e?e.kindOf(SC.Record):NO}.property("parent").cacheable(),readAttribute:function(e){var t=this.peekAttributes();return t?t[e]:undefined},attributes:function(){if(this.get("isOrphan"))return SC.warn("%@:  Requesting 'attributes' on orphaned instance",this),null;var e=this.get("parent"),t=this.get("parentKey"),n;return e||CW.fatalError
("Cannot access 'attributes' because there is no parent",{hashAttributeOrArray:this}),SC.none(t)&&CW.fatalError("Cannot access 'attributes' because there is no parentKey",{hashAttributeOrArray:this}),this.get("parentIsRecord")?n=e.get("store").readEditableDataHash(e.get("storeKey")):n=e.get("attributes"),n?n[t]:null}.property("parent","isOrphan"),hashAttributeDidChange:function(e,t,n){this.childHashDidChange(e,t,n)},destroy:function(){var e=this.get("parent"),t,n;e&&(t=this.get("parentKey"),t||CW.fatalError("There is a parent but no parentKey",{target:this,parent:e}),n=e.get("attributes"),n&&(delete n[t],this.hashAttributeDidChange(),this.orphan())),arguments.callee.base.apply(this,arguments)},getAncestorRecord:function(){var e=this.get("parent"),t;return e&&(this.get("parentIsRecord")?t=e:t=e.getAncestorRecord()),t},orphan:function(){this._orphan&&this._orphan(),this.beginPropertyChanges(),this.set("isOrphan",YES),this.set("parent",null),this.parentDidChange&&this.parentDidChange(),this.set("parentKey",null),this.destroy(),this.allPropertiesDidChange(),this.endPropertyChanges()},peekAttributes:function(e){var t=this.get("parent"),n=this.get("parentKey"),r;return t&&!SC.none(n)&&(r=t.readAttribute(n)),r}},CW.HashAttributeSupport={hashAttributeFor:function(e){var t=this._hashAttributes,n=null,r;return t&&(r=t[e],r&&(n=r)),n},childHashDidChange:function(e,t,n){t||(e?this.notifyPropertyChange(e):this.allPropertiesDidChange());var r=this.get("parent"),i=this.get("parentKey");this._ignoreChangePropogation=YES,r.childHashDidChange(i,YES,n),this._ignoreChangePropogation=NO},attributeIsDefault
:function(e){var t=this[e],n=this.readAttribute(e),r;return!t||!t.isRecordAttribute?n===undefined:(r=t.getDefaultValue(this,e),n===r||SC.none(r)&&SC.none(n))},normalize:function(e,t){var n={},r,i,s,o,u,a,f,l,c,h,p,d=this.get("attributes");for(r in this)i=this[r],i&&(s=i.typeClass,s&&(h=i.get("key")||r,p=s.call(i),o=undefined,n[h]=YES,f=SC.typeOf(s.call(i))===SC.T_CLASS,l=i.isNestedRecordTransform||p.isHashAttribute,!f&&!l?o=d[h]:l?(u=this.get(r),u&&(u.normalize&&u.normalize(e,t),!t&&u.isEmpty&&u.isEmpty()?o=null:o=u.get("attributes"))):f&&(u=this.get(r),u&&(o=d[h])),SC.none(o)&&(o=i.getDefaultValue(this,r)),o===null&&!e&&(o=undefined),o===undefined?delete d[h]:d[h]=o,u&&(u.isHashAttribute?u.underlyingContentDidChange():u.isHashAttributeArray&&u.recordPropertyDidChange())));for(r in d)n[r]||(SC.debug("%@:  Deleting key from underlying data hash due to normalization:  %@",this,r),delete d[r]);return this},registerHashAttribute:function(e,t){var n=this._hashAttributes,r,i;n||(n=this._hashAttributes={}),r=t.get("parent"),i=t.get("parentKey"),this!==r&&CW.fatalError("registerChildHashAttribute():  The specified child hash attribute does not have the proper parent",{key:e,target:this,parent:r}),e!==i&&CW.fatalError("registerChildHashAttribute():  The specified child hash attribute does not have the proper parentKey",{target:this,key:e,parentKey:i}),n[e]=t},unregisterHashAttribute:function(e,t){var n=this._hashAttributes,r;n||CW.fatalError("unregisterChildHashAttribute():  There is no “child hash attributes” structure",{target:this}),r=n[e],r||CW.fatalError("unregisterChildHashAttribute():  There is no registered child hash attribute for the specified key"
,{target:this,key:e}),delete n[e]},_hashAttributes:null},CW.MergeDelegate={shouldMergeOutdatedChangesWhenCommitting:NO,parentStoreRecordPropertyDidChange:function(e,t,n,r,i){},mergeConflictDuringCommit:function(e,t,n,r,i){return undefined},mergeConflictDuringNotify:function(e,t,n,r,i,s,o){return NO}},CW.MergeSupport={extendedLogging:NO,propagateStatusIfAppropriateFromStore:function(e,t){var n=SC.Record,r=e.peekStatus(t),i=this.peekStatus(t),s;r!==i&&(r===n.ERROR?(SC.debug("%@:  Propagating ERROR status for storeKey %@ from %@…",this,t,e),s=n.ERROR):r&n.DESTROYED?i===n.READY_NEW?(SC.debug("%@:  Propagating destroyed status for storeKey %@ from %@ (it was READY_NEW, so marking it as DESTROYED_CLEAN)…",this,t,e),s=n.DESTROYED_CLEAN):i===n.READY_CLEAN?(SC.debug("%@:  Propagating destroyed status for storeKey %@ from %@ (it was READY_CLEAN, so marking it as DESTROYED_CLEAN)…",this,t,e),s=n.DESTROYED_CLEAN):(SC.debug("%@:  Propagating destroyed status for storeKey %@ from %@ (it was not READY_CLEAN, so marking as DESTROYED_DIRTY)…",this,t,e),s=n.DESTROYED_DIRTY):i===n.ERROR&&(r===n.READY_CLEAN||r===n.DESTROYED_CLEAN)&&(SC.debug("%@:  Propagating status %@ to override our ERROR status for storeKey %@ from %@…",this,r,t,e),s=r)),s&&(this.writeStatus(t,s),this.dataHashDidChange(t,null,!0))},mergeDataFromStore:function(e,t,n,r,i){var s=e.readDataHash(t),o=this.readDataHash(t),u=e.previousDataHashesForNotify[t],a=SC.Record,f,l,c,h,p,d,v,m;e||CW.fatalError("mergeDataFromStore():  A store must be specified",{target:this,storeKey:t}),t||CW.fatalError("mergeDataFromStore():  A storeKey must be specified"
,{target:this,mergeFromStore:e});if(!s&&!o){if(a.DESTROYED&e.peekStatus(t)&this.peekStatus(t)){SC.debug("mergeDataFromStore():  The record for storeKey %@ was destroyed in both %@ and %@.  Skipping merge…",t,e,this);return}CW.fatalError("mergeDataFromStore():  There is no data for the specified storeKey in either the lower-level store or the nested store.  Merge should never be triggered in this scenario.",{mergeFromStore:e,target:this,storeKey:t})}else{if(!s){f=this.peekStatus(t),f===a.READY_NEW?f=a.DESTROYED_CLEAN:f=a.DESTROYED_DIRTY,this.writeStatus(t,f),SC.debug("There is no data for storeKey %@ in the lower-level store (%@) but there is in the nested store (%@).  Marking it as destroyed.",t,e,this);return}if(!o)CW.fatalError("mergeDataFromStore():  There is data for the specified storeKey in the lower-level store but not in the nested store.  Merge should never be triggered in this scenario.",{mergeFromStore:e,target:this,storeKey:t});else if(!u){SC.warn("There is no original data for storeKey %@ in the lower-level store (%@).  We cannot merge without this information.  (This usually means that dataHashDidChange is being called unnecessarily.)",t,e);return}}if(n){if(i)for(l=0,c=i.length;l<c;++l){h=i[l];if(h.indexOf(n)!==-1){SC.debug("Merging '%@' for storeKey %@ from %@ up to %@, but since it’s defined as part of a merge group (%@), merging all properties from %@…",n,t,e,this,h,e),p=YES;break}}if(!p){SC.debug("Merging '%@' for storeKey %@ from %@ up to %@…",n,t,e,this);if(r&&r.indexOf(n)!==-1){SC.debug("  >  We were requested to ignore this property.  Skipping merge…");
return}m=this.mergePropertyAsPossible(n,s,o,u,YES,e.get("name"),this.get("name")),m.changed&&(d=[n]),m.mergeConflict&&(v=[n])}}m||(r?SC.debug("Merging all properties except %@ for %@ with storeKey %@ from %@ up to %@…",r,e.materializeRecord(t).get("shortTypeString"),t,e,this):SC.debug("Merging all properties for %@ with storeKey %@ from %@ up to %@…",e.materializeRecord(t).get("shortTypeString"),t,e,this),m=this.mergeHashesAsPossible(s,o,u,i,YES,e.get("name"),this.get("name"),r),d=m.changedKeys.concat(m.addedKeys,m.removedKeys),v=m.mergeConflictKeys);if(d&&d.length>0)this.dataHashDidChange(t,null,NO);else{var g=SC.Store.generateStoreKey();this.revisions[t]=g}if(v&&v.length>0){var y=NO,b=this.get("delegate");b&&(y=this.invokeDelegateMethod(b,"mergeConflictDuringNotify",e,this,t,d,v));if(!y)throw SC.Store.CHAIN_CONFLICT_ERROR}this._updateLock(t)},mergePropertyAsPossible:function(e,t,n,r,i,s,o){var u=this.get("extendedLogging"),a,f,l,c,h,p,d,v,m,g,y,b,w,E;a=f=!1,s||(s="mergeFrom"),o||(o="mergeTo"),i?(l=t,h=s,c=n,p=o):(l=n,h=o,c=t,p=s),d=t[e],v=n[e],m=r[e];var S=CW.getSimpleTypes();g=d===m,g||(w=SC.typeOf(d),E=SC.typeOf(m),S[w]?g=!1:g=CW.valuesAreEqual(d,m,w,E)),y=v===m,y||(b=SC.typeOf(v),S[b]?y=!1:y=CW.valuesAreEqual(v,m,b,E));if(y)g?u&&SC.debug("  >  no need to merge '%@' ('%@'), since it hasn’t changed in any hash…",e,d):(SC.debug("  >  taking value from %@ for '%@' ('%@'), since it didn’t change in %@ (it was '%@')…",s,e,d,o,v),f=!0);else if(g)SC.debug("  >  preserving current value for '%@' ('%@') in %@, since it didn’t change in %@…",e,v,o,s),a=!1,f=!1;else{var x=l[e],T=c[
e];CW.valuesAreEqual(t[e],n[e])?SC.debug("  >  no need to merge '%@' ('%@'), even though it changed in both, since both changed it to the same value…",e,x):(SC.debug("  >  Merge conflict for '%@' (both changed the value).  Preferring value '%@' from %@ over value '%@' from %@ (preferMergeFromIfConflict=%@, and the original value was '%@')…",e,x,h,T,p,!!i,r[e]),a=!0,i&&(f=!0))}return f&&(n[e]=t[e]),{mergeConflict:a,changed:f}},mergeHashesAsPossible:function(e,t,n,r,i,s,o,u){e===t&&CW.fatalError("'mergeFrom' and 'mergeTo' are both the same hash, which is not allowed",{mergeFrom:e,original:n}),e===n&&CW.fatalError("'mergeFrom' and 'original' are both the same hash, which is not allowed",{mergeFrom:e,mergeTo:t}),t===n&&CW.fatalError("'mergeTo' and 'original' are both the same hash, which is not allowed",{mergeFrom:e,mergeTo:t});var a=this.get("extendedLogging"),f=[],l=[],c=[],h=[],p={},d,v,m,g,y,b;s||(s="mergeFrom"),o||(o="mergeTo"),i?(d=e,m=s,v=t,g=o):(d=t,m=o,v=e,g=s),y=CW.hashDifferencesBreakdown(e,n,u),b=CW.hashDifferencesBreakdown(t,n,u);var w=y.equal,E=b.equal,S=y.different,x=b.different,T=y.firstHashOnly,N=b.firstHashOnly,C=y.secondHashOnly,k=b.secondHashOnly,L=CW.invertArray(w),A=CW.invertArray(E),O=CW.invertArray(S),M=CW.invertArray(x),_=CW.invertArray(T),D=CW.invertArray(N),P=CW.invertArray(C),H=CW.invertArray(k),B=S.concat(T).concat(C),j=x.concat(N).concat(k),F=CW.invertArray(B),I=CW.invertArray(j),q=CW.combineHashes(F,I),R;for(R in F)q[R]=!0;for(R in I)q[R]=!0;var U=CW.invertHash(q),z,W,X,V,$,J=SC.clone(q,YES),K=[],Q;if(r)for(z=0,W=r.length;z<W;++z){Q=[],X=r[z];for(V=0
,$=X.length;V<$;++V)R=X[V],Q.push(R),delete J[R];K.push(Q)}for(R in J)K.push(R),delete J[R];var G,Y,Z,et,tt,nt,rt,it;for(z=0,W=K.length;z<W;++z){Q=K[z],Y=Z=null,G=!(Q instanceof Array);if(G){R=Q,Y=F[R]?R:null,Z=I[R]?R:null;if(Y||Z)et=CW.valuesAreEqual(e[R],t[R]),Y=Y&&!et?R:null,Z=Z&&!et?R:null}else for(V=0,$=Q.length;V<$;++V)R=Q[V],F[R]?I[R]?CW.valuesAreEqual(e[R],t[R])||(Y?Y.push(R):Y=[R],Z?Z.push(R):Z=[R]):Y?Y.push(R):Y=[R]:I[R]&&(Z?Z.push(R):Z=[R]);if(Y&&Z)if(G)f.indexOf(R)===-1&&f.push(R),tt=d[R],nt=v[R],O[R]&&M[R]?(SC.debug("  >  Merge conflict for '%@' (both changed the value).  Preferring value '%@' from %@ over value '%@' from %@ (preferMergeFromIfConflict=%@, and the original value was '%@')…",R,tt,m,nt,g,!!i,n[R]),i&&l.push(R)):_[R]&&D[R]?(SC.debug("  >  Merge conflict for '%@' (both added a value for this key, but they do not match).  Preferring value '%@' from %@ over value '%@' from %@ (preferMergeFromIfConflict=%@)…",R,tt,m,nt,g,!!i),i&&l.push(R)):O[R]&&H[R]?i?(SC.debug("  >  Merge conflict for '%@' (%@ changed the value, %@ removed it).  Preferring value '%@' from %@ over removal from %@ (preferMergeFromIfConflict=%@)…",R,s,o,tt,m,g,!!i),c.push(R)):SC.debug("  >  Merge conflict for '%@' (%@ changed the value, %@ removed it).  Preferring removal from %@ over value '%@' from %@ (preferMergeFromIfConflict=%@)…",R,s,o,m,nt,g,!!i):P[R]&&M[R]?i?(SC.debug("  >  Merge conflict for '%@' (%@ changed the value, %@ removed it).  Preferring removal from %@ over value '%@' from %@ (preferMergeFromIfConflict=%@)…",R,o,s,m,nt,g,!!i),h.push(R)):SC.debug("  >  Merge conflict for '%@' (%@ changed the value, %@ removed it).  Preferring value '%@' from %@ over removal from %@ (preferMergeFromIfConflict=%@)…"
,R,o,s,tt,m,g,!!i):CW.fatalError("Bad merge state:  We’re claiming that there’s a merge conflict for a single key, but the combination doesn’t make sense",{key:R,mergeFrom:s,mergeFromValue:e[R],changedInMergeFrom:O[R],addedInMergeFrom:_[R],removedInMergeFrom:P[R],mergeTo:o,mergeToValue:t[R],changedInMergeTo:M[R],addedInMergeTo:D[R],removedInMergeTo:H[R]});else{SC.debug("  >  Merge conflict for grouped properties [%@]:  dirty in %@: [%@],  dirty in %@: [%@]",Q,s,Y,o,Z);if(i){SC.debug("  >  Will prefer all values for this group as they are in %@",s);for(V=0,$=Q.length;V<$;++V)R=Q[V],!L[R]&&f.indexOf(R)===-1&&f.push(R),rt=e[R],it=t[R],it===undefined?rt!==undefined&&(SC.debug("       -  adding '%@' ('%@') from %@, since it’s not in %@…",R,rt,s,o),c.push(R)):rt===undefined?(SC.debug("       -  removing '%@' ('%@') from %@, since it’s not in %@…",R,it,o,s),h.push(R)):CW.valuesAreEqual(rt,it)||(SC.debug("       -  taking '%@' ('%@') from %@, which will overwrite %@’s previous value ('%@')…",R,rt,s,o,it),l.push(R))}else{SC.debug("  >  Will prefer all values for this group as they are in %@",o);for(V=0,$=Q.length;V<$;++V)R=Q[V],!L[R]&&f.indexOf(R)===-1&&f.push(R)}}else if(G)rt=e[R],it=t[R],O[R]?M[R]?SC.debug("  >  no need to merge '%@' ('%@'), even though it changed in both, since both changed it to the same value…",R,rt):(SC.debug("  >  taking value from %@ for '%@' ('%@'), since it didn’t change in %@ (it was '%@')…",s,R,rt,o,it),l.push(R)):_[R]?D[R]?SC.debug("  >  no need to merge '%@' ('%@'), even though it was added to both, since both added the same value…",R,rt):(SC.debug("  >  taking value from %@ for '%@' ('%@'), since it was only added there…"
,s,R,rt),c.push(R)):P[R]&&(H[R]?SC.debug("  >  no need to merge '%@' ('%@'), because it was removed from both…",R,rt):(SC.debug("  >  removing value for '%@' ('%@') from %@, since it was removed from %@…",R,it,o,s),h.push(R)));else{a&&SC.debug("  >  Considering group of keys [%@]…",Q);for(V=0,$=Q.length;V<$;++V)R=Q[V],rt=e[R],it=t[R],O[R]?(SC.debug("       -  taking '%@' ('%@') from %@, which will overwrite %@’s previous value ('%@')…",R,rt,s,o,it),l.push(R)):_[R]?(SC.debug("       -  adding '%@' ('%@') from %@, since it’s not in %@…",R,rt,s,o),c.push(R)):P[R]?(SC.debug("       -  removing '%@' ('%@') from %@, since it’s not in %@…",R,it,o,s),h.push(R)):a&&SC.debug("       -  no need to take '%@' ('%@') from %@, since it’s the same value in %@…",R,rt,s,o)}}var st=l.concat(c),ot;for(z=0,ot=st.length;z<ot;++z)R=st[z],t[R]=SC.clone(e[R],YES);for(z=0,ot=h.length;z<ot;++z)R=h[z],delete t[R];return{mergeConflictKeys:f,changedKeys:l,addedKeys:c,removedKeys:h}},_updateLock:function(e){var t=this.locks,n,r;t||CW.fatalError("Store has no locks defined, and we expected the specified storeKey to be locked during the merge.",{target:this,storeKey:e}),t[e]||CW.fatalError("Store has no lock for the specified storeKey, and we expected it to be locked during the merge.",{target:this,storeKey:e}),n=this.revisions[e],t[e]=n||1}},CW.StoreCommon={delegate:null,chain:function(e,t){return t||(t=CW.NestedStore),arguments.callee.base.call(this,e,t)},storageManager:null,getCurrentCommitCycle:function(){var e=null,t=this.getPath("storageManager.currentCycle");return t&&t.get("type")===CW.StorageCycle.
COMMIT_CYCLE&&(e=t),e},commitAgentsFor:function(e){var t=this.commitAgents;return t?t[e]:null},lastCommitAgentWithParam:function(e,t){var n=this.commitAgents,r=null,i,s,o,u;if(n){n=n[e];if(n)for(s=n.length,i=s-1;i>=0;--i){o=n[i],u=o.get("params");if(u&&u.hasOwnProperty(t)){r=o;break}}}return r},notifyCommitAgents:function(e,t,n){var r=this.commitAgentsFor(e),i,s,o,u;if(r)for(i=0,s=r.length;i<s;++i)o=r[i],o&&(u=o[t],u&&u.call(o,e,n))},previousDataHashesForNotify:null,commitAgents:null,_notifyRecordPropertyChange:function(e,t,n){var r=this.records,i=this.get("nestedStores"),s=SC.Store,o,u,a,f,l,c,h;a=i?i.length:0;for(f=0;f<a;f++){l=i[f],c=l.peekStatus(e),u=l.storeKeyEditState(e);if(u===s.INHERITED)l._notifyRecordPropertyChange(e,t,n);else if(c&SC.Record.BUSY){if(l.get("hasChanges"))throw s.CHAIN_CONFLICT_ERROR;l.reset()}else if(!l._isCommitting){var p=l.get("delegate");p?l.invokeDelegateMethod(p,"parentStoreRecordPropertyDidChange",this,l,e,t,n):SC.warn("%@:  Record with storeKey %@ changed underneath us, but since we have no merge delegate set, we won’t inherit the changes",l,e)}!t&&!this.get("parentStore")&&(delete this.previousDataHashesForNotify[e],this._savePreviousDataHashForNotify(e))}var d=this.recordPropertyChanges;return d||(d=this.recordPropertyChanges={storeKeys:SC.CoreSet.create(),records:SC.CoreSet.create(),hasDataChanges:SC.CoreSet.create(),propertyForStoreKeys:{}}),d.storeKeys.add(e),r&&(o=r[e])&&(d.records.push(e),t||d.hasDataChanges.push(e),n?((h=d.propertyForStoreKeys[e])||(h=d.propertyForStoreKeys[e]=SC.CoreSet.create()),h!=="*"&&h.add(n)):d.propertyForStoreKeys
[e]="*"),this.invokeOnce(this.flush),this},_verifyLockRevisions:function(e,t,n){var r=this._mergedProperties,i=this._mergedDataHashes,s=!!n.getPath("delegate.shouldMergeOutdatedChangesWhenCommitting"),o,u,a,f,l=SC.Record,c=CW.StorageCycleAction,h=e.length,p=this.revisions,d,v,m,g;if(t&&p)for(d=0;d<h;d++){v=e[d],m=t[v]||1,g=p[v]||1;if(m<g){var y=SC.Store.recordTypeFor(v);SC.debug("Potential conflict while committing from %@ down to %@:  storeKey %@, of type %@:",n,this,v,y);var b=n.peekStatus(v),w=this.peekStatus(v),E=SC.Record.DESTROYED,S=SC.Record.READY_NEW,x=b&E?c.STORAGE_OPERATION_DESTROY:c.STORAGE_OPERATION_UPDATE,T=NO,N,C,k;if(!s)throw SC.Store.CHAIN_CONFLICT_ERROR;SC.debug("  >  lock=%@,  current revision=%@",m,g),SC.debug("Version in %@:",n),SC.debug("%@",n.materializeRecord(v)),SC.debug("Version in %@:",this),SC.debug("%@",this.materializeRecord(v)),w&E?b&E?SC.debug("This record was destroyed in both stores, so ignoring it in the commit…"):C=c.ERROR_NOT_FOUND:b&E?C=c.ERROR_CONFLICT:(b===S&&w!==S&&n.writeStatus(v,SC.Record.READY_DIRTY),C=c.ERROR_CONFLICT);if(C){var L=n.get("delegate");L&&(T=n.invokeDelegateMethod(L,"mergeConflictDuringCommit",this,n,v,C,x))}if(T===NO)SC.debug("Removing this commit from %@’s changelog…",this.get("name")),k=n.changelog,k&&k.remove(v),k=n.chainedChanges,k&&k.remove(v),a=this.getCurrentCommitCycle(),a&&(f=a.get("changelog"),f&&f.remove(v)),this.notifyCommitAgents(v,"commitWasUnnecessaryAtStore");else if(T!==YES)throw SC.Store.CHAIN_CONFLICT_ERROR}}return this}},CW.HashAttribute=SC.Object.extend(CW.HashAttributeCommon,CW.HashAttributeSupport
,{isHashAttribute:YES,normalize:function(e,t,n){this.get("isOrphan")&&CW.fatalError("normalize():  Cannot write to an orphan hash attribute",{target:this});var r=this.get("attributes"),i,s,o;r||(this._neverHadAHash||CW.fatalError("normalize():  We once had a hash but no longer do",{target:this}),i=this.get("parent"),s=this.get("parentKey"),i?s?i.isHashAttributeArray&&CW.fatalError("normalize():  There are no attributes but the parent is a hash attribute array",{target:this,parent:i}):CW.fatalError("normalize():  There is no parentKey",{target:this,parent:i}):CW.fatalError("normalize():  There is no parent",{target:this}),r={},i.writeAttribute(s,r),this._neverHadAHash=NO),e(t,n)}.enhance(),_checkedKeys:SC.CoreSet.create(),isEmpty:function(){var e,t,n,r=this._checkedKeys.clear();for(e in this){t=this[e];if(!t||!t.isRecordAttribute)continue;n=this.get("key");if(n&&n.isEmpty&&n.isEmpty()||!this.attributeIsDefault(e))return NO;r.add(e)}var i=this.get("attributes");for(e in i)if(!r.contains(e))return NO;return YES},beginEditing:function(){return this._editLevel++,this},endEditing:function(e){return--this._editLevel<=0&&(this._editLevel=0,this.hashAttributeDidChange(e)),this},writeAttribute:function(e,t,n){if(this.get("isOrphan"))return SC.debug("writeAttribute():  Cannot write to an orphan hash attribute"),this;var r=this.get("attributes"),i,s,o;return r?t!==r[e]&&(n||this.beginEditing(),r[e]=t,n||this.endEditing(e)):(this._neverHadAHash||CW.fatalError("writeAttribute():  We once had a hash but no longer do",{target:this}),i=this.get("parent"),s=this.get("parentKey"),i?s?i.isHashAttributeArray&&
CW.fatalError("writeAttribute():  There are no attributes but the parent is a hash attribute array",{target:this,parent:i}):CW.fatalError("writeAttribute():  There is no parentKey",{target:this,parent:i}):CW.fatalError("writeAttribute():  There is no parent",{target:this}),r={},r[e]=t,i.writeAttribute(s,r),this._neverHadAHash=NO),this},storeDidChangeProperties:function(e,t){t?(this.beginPropertyChanges(),t.forEach(function(e){this.notifyPropertyChange(e)},this),this.endPropertyChanges()):this.allPropertiesDidChange();var n=this.relationships,r=n?n.length:0;while(--r>=0)n[r].recordPropertyDidChange(t)},unknownProperty:function(e,t){var n;return t!==undefined?(n=this.constructor,n.ignoreUnknownProperties===YES?this[e]=t:this.writeAttribute(e,t),t):this.readAttribute(e)},toString:function(){var e=arguments.callee.base.apply(this,arguments),t=this.peekAttributes();return e+="  "+SC.inspect(t),e},parentDidChange:function(){var e=this._previousParent,t=this.get("parent"),n=this.get("parentKey"),r;if(SC.none(n))return;e!==t&&(r=this.underlyingContentDidChange,e&&(e.unregisterHashAttribute&&e.unregisterHashAttribute(n,this),e.removeObserver(n,this,r)),t&&(t.registerHashAttribute&&t.registerHashAttribute(n,this),t.addObserver(n,this,r)),this._previousParent=t,r.call(this))}.observes("parent"),underlyingContentDidChange:function(){if(this._ignoreChangePropogation){this._ignoreChangePropogation=NO;return}if(this.get("isOrphan"))return;!this._neverHadAHash&&!this.peekAttributes()?this.orphan():this.allPropertiesDidChange()},init:function(){arguments.callee.base.apply(this,arguments);var e=
this.get("parent");e||CW.fatalError("A hash attribute must have a parent",{hashAttribute:this}),!e.isRecord&&!e.isHashAttribute&&!e.isHashAttributeArray&&CW.fatalError("A hash attribute array’s parent must either be a record, a hash attribute, or a hash attribute array",{hashAttribute:this,parent:e}),this.peekAttributes()||(this._neverHadAHash=YES),this.parentDidChange()},_editLevel:0,_neverHadAHash:NO}),CW.HashAttribute.mixin({instantiateHashAttribute:function(e,t,n){return SC.kindOf(e,CW.HashAttribute)||CW.fatalError("%@ is not a kind of CW.HashAttribute".fmt(e)),e.create({parent:t,parentKey:n})},isComplex:YES,isHashAttribute:YES}),SC.RecordAttribute.registerTransform(CW.HashAttribute,{to:function(e,t,n,r,i){var s;return r?!r.kindOf(CW.Record)&&!r.kindOf(CW.HashAttribute)?CW.fatalError("The parent must be either an instance of subclass of either CW.Record or CW.HashAttribute",{parent:r,parentKey:i}):(s=r.hashAttributeFor(i),s||(s=CW.HashAttribute.instantiateHashAttribute(n,r,i))):CW.fatalError("Error during transform:  A parent must be specified"),s},from:function(e){e&&e.isHashAttribute&&CW.fatalError("You should never set a hash attribute directly",{target:this,instance:e})}}),CW.ManyHashAttribute=SC.RecordAttribute.extend({toType:function(e,t,n){var r=this.get("typeClass"),i=this.get("key")||t,s=SC.keyFor("__cw__hashAttributeArray__",SC.guidFor(this)),o=e[s],u,a;return e&&e.isRecord&&(u=e.get("store"),u&&!u.isCoreWebStore&&CW.fatalError("Hash attribute arrays require the ancestor record to belong to a CoreWeb store rather than an SC.Store",{target:this,parent:e,store:u}
)),o||(o=CW.HashAttributeArray.create({objectType:r,parent:e,parentKey:i,manyAttribute:this}),e[s]=o,a=e.get("relationships"),a?(a.push(o),a.enumerableContentDidChange()):e.set("relationships",[o])),o},fromType:function(e,t,n){var r=[],i,s;SC.isArray(n)||CW.fatalError("CW.ManyHashAttribute#fromType:  The toMany attribute should be an array");for(i=0,s=n.get("length");i<s;++i)r[i]=SC.clone(n.objectAt(i).get("attributes"),YES);return r}}),CW.Record=SC.Record.extend(CW.HashAttributeSupport,{typeString:function(){var e=this.get("store");if(!e)return null;var t=this.get("storeKey");if(!t)return null;var n=e.recordTypeFor(this.get("storeKey"));return n?n.typeString:null}.property("store","storeKey").cacheable(),childHashDidChange:function(e,t,n){var r=this.get("store");r.recordDidChange(null,null,this.get("storeKey"),e,YES),this.propagateToAggregates(),n||r.flush()},shortTypeString:function(){var e=this.get("store");if(!e)return null;var t=this.get("storeKey");if(!t)return null;var n=e.recordTypeFor(this.get("storeKey"));return n?n.shortTypeString():null}.property("store","storeKey").cacheable(),shortString:function(){var e=this.get("shortTypeString"),t;return e?(e=e.toLowerCase(),t=this.get("title"),t?e+=" “%@”".fmt(t):e+=" with ID %@".fmt(this.get(this.get("primaryKey")))):e=this.toString(),e},ownerProperty:null,owner:function(){var e=this.get("ownerProperty");return e?this.get("property"):null}.property("ownerProperty"),rootOwner:function(){var e=this.get("owner");return e?e.get("rootOwner"):this}.property("owner"),isAggregate:function(){var e=this.get("ownerProperty"),t=NO,n;return e&&
(n=this[e],t=n&&n.aggregate),t}.property("ownerProperty"),aggregates:function(){var e=[],t,n,r,i,s,o,u,a,f,l,c,h,p,d,v;for(t in this){n=this[t];if(n){r=n.typeClass;if(r){r=r.call(n),i=SC.typeOf(r)===SC.T_CLASS;if(i){s=n.inverse;if(s){o=r.prototype[s];if(o){u=o.aggregate;if(u){a=this.get(t);if(a)for(f=0,l=a.get("length");f<l;++f){c=a.objectAt(f),e.push(c),h=c.get("aggregates");if(h)for(p=0,d=h.length;p<d;++p)v=h[p],e.push(v)}}}}}}}}return e.length?e:null}.property(),usesHashAttributes:function(){var e=NO,t=this._hashAttributes,n,r,i,s;t&&t.length>0&&(e=YES);if(!e){n=this.relationships;if(n)for(r=0,i=n.length;r<i;++r){s=n[r];if(SC.kindOf(s,CW.HashAttributeArray)){e=YES;break}}}return e}.property().cacheable()}),SC.mixin(CW.Record,{toMany:function(e,t){return SC.kindOf(e,CW.HashAttribute)?CW.ManyHashAttribute.attr(e,t):SC.Record.toMany(e,t)},shortTypeString:function(){var e=this.typeString;return e&&(e=e.split("."),e=e[e.length-1]),e},storeKeyIfValid:function(e,t){e||CW.fatalError("storeKeyIfValid():  You must specify an ID."),t||CW.fatalError("storeKeyIfValid():  You must specify a store.");var n=this.storeKeyExists(e),r;return n&&(r=t.peekStatus(n),r===this.DESTROYED_CLEAN&&(n=null)),n}}),CW.AutoMergingNestedStoreDelegate=SC.Object.extend(CW.MergeDelegate,{shouldMergeOutdatedChangesWhenCommitting:YES,parentStoreRecordPropertyDidChange:function(e,t,n,r,i){if(r){t.propagateStatusIfAppropriateFromStore(e,n);return}var s=e.recordTypeFor(n),o,u;if(!s){SC.warn("%@:  Cannot determine the record type for storeKey=%@, which was changed in our parent store (%@)",this,n,e);return}o=i?"'"+
i+"'":"all keys",SC.debug("%@:  Our parent store (%@) changed %@ of storeKey %@, which is a record of type %@.  Merging data…",t,e,o,n,s),u=s.propertyMergeGroups,t.propagateStatusIfAppropriateFromStore(e,n),t.mergeDataFromStore(e,n,i,undefined,u)},mergeConflictDuringCommit:function(e,t,n,r,i){var s,o,u,a=e.recordTypeFor(n),f=NO,l=t.previousDataHashesForCommit[n];l||CW.fatalError("The nested store does not have a record of the original values of its data hash for a particular storeKey, which we need in order to commit.",{target:this,nestedStore:t,storeKey:n,recordType:a});var c=SC.clone(e.readDataHash(n),YES),h=t.readDataHash(n),p=e.mergeHashesAsPossible;if(p){SC.debug("Merging data for storeKey %@ from %@ down into %@…",n,t,this),u=p.call(this,h,c,l,a.propertyMergeGroups,NO,t.get("name"),this.get("name")),s=u.changedKeys.concat(u.addedKeys,u.removedKeys),o=u.mergeConflictKeys;if(s.length===0)return SC.debug("The merge for storeKey %@ resulted in there being no actual changes in %@…",n,this.get("name")),NO;f=o.length===0}if(f)return YES;this._reportMergeConflict(t,e,n,o,r,i);var d=a.typeString||a.toString();return SC.warn("Merge conflict for storeKey %@ (%@) during commit:  %@",n,d,o),NO},mergeConflictDuringNotify:function(e,t,n,r,i,s,o){var u=e.recordTypeFor(n),a=u.typeString||u.toString();return SC.warn("Merge conflict for storeKey %@ (%@) during notify:  %@",n,a,i),YES},_reportMergeConflict:function(e,t,n,r,i,s){var o=CW.StorageCycleAction,u=CW.errorController,a;if(!u)return;i||(i=o.ERROR_CONFLICT),s||(s=o.STORAGE_OPERATION_UPDATE),a=o.create({name:"Merging storeKey %@ from %@ to %@"
.fmt(n,e,t,this),type:o.TYPE_UPDATE,storageOperation:s,storeKeys:[n],status:o.STATUS_ERROR,error:i});var f=this.getPath("storageManager.errorController");f&&f.addActions([a])}}),CW.CommitAgent=SC.Object.extend({storeKeys:null,params:null,recordWasCommittedToStore:function(e,t){},commitWasUnnecessaryAtStore:function(e,t,n){},recordWasCommittedToServer:function(e,t){},commitToServerFailed:function(e,t){}}),CW.HashAttributeArray=SC.Object.extend(CW.HashAttributeCommon,CW.HashAttributeSupport,SC.Enumerable,SC.Array,{isHashAttributeArray:YES,objectType:null,manyAttribute:null,normalize:function(e,t){var n=this._getReadOnlyUnderlyingArray(),r=n?n.get("length"):0,i,s;for(i=0;i<r;i++)s=this.objectAt(i),s.normalize(e,t);return this},length:function(){var e=this._getReadOnlyUnderlyingArray();return e?e.length:0}.property("parent","parentKey"),objectAt:function(e){var t=this._hashAttributes,n,r,i,s;return t&&(s=t[e]),s||(n=this._getReadOnlyUnderlyingArray(),n&&(r=n[e],r&&(SC.typeOf(r)!==SC.T_HASH&&CW.fatalError("objectAt():  The object in the array is not a hash",{hashAttributeArray:this,index:e}),i=this.get("objectType"),s=CW.HashAttribute.instantiateHashAttribute(i,this,e),t||(t=this._hashAttributes=[]),t[e]=s))),s},replace:function(e,t,n){var r=this._getEditableUnderlyingArray(),i=[],s=n?n.get?n.get("length"):n.length:0,o,u;this.arrayContentWillChange(e,t,s);for(o=0;o<s;++o)u=n.objectAt(o),SC.kindOf(u,CW.HashAttribute)?u=SC.clone(u.get("attributes"),YES):SC.typeOf(u)!==SC.T_HASH&&CW.fatalError("Illegal type of item specified in replace()",{target:this,index:o,items:n}),i.push(u);r.replace
(e,t,i);var a=this._hashAttributes;if(a){var f=r?r.length:0,l=e+t,c=e+s;for(o=e;o<l;++o)u=a[o],u&&u.orphan();a.splice(e,t);for(o=e;o<f;++o)o<c?a.splice(o,0,null):(u=a[o])&&u.set("parentKey",o);f!==a.length&&CW.fatalError("Hash attribute array length is different from underlying array length",{target:this})}return this.arrayContentDidChange(e,t,s),this.enumerableContentDidChange(),this.hashAttributeDidChange(null,YES),this},isEmpty:function(){var e=this._getReadOnlyUnderlyingArray();return!e||e.get("length")===0},_getReadOnlyUnderlyingArray:function(){var e=this.get("parent"),t=this.get("parentKey");return e||CW.fatalError("No parent defined"),t||CW.fatalError("No parentKey defined"),e.readAttribute(t)},_getEditableUnderlyingArray:function(){var e=this.get("parent"),t=this.get("parentKey"),n,r;return e||CW.fatalError("No parent defined"),t||CW.fatalError("No parentKey defined"),n=e.get("attributes"),r=n[t],r||(r=n[t]=[],this.recordPropertyDidChange(SC.Set.create([t])),this.hashAttributeDidChange(null,YES,YES)),r},recordPropertyDidChange:function(e){if(e&&!e.contains(this.get("parentKey")))return this;var t=this._previousUnderlyingArray,n=this._getReadOnlyUnderlyingArray(),r=0,i=0;t&&(r=t.get("length")),this._previousUnderlyingArray=n,n&&(i=n.get("length"));var s=Math.max(0,r-i),o=Math.max(0,i-r),u=Math.min(i,r);this.arrayContentWillChange(u,s,o);var a=this._hashAttributes;if(a){var f,l,c=Math.max(r,i);for(f=0;f<c;f++)l=a[f],l&&(f<i?l.allPropertiesDidChange():l.orphan());a.length=i}this.arrayContentDidChange(u,s,o),this.enumerableContentDidChange()},_orphan:function(){var e=this
._hashAttributes,t,n,r;if(e){for(t=0,n=e.length;t<n;++t)r=e[t],r&&r.orphan();this._hashAttributes=null}},init:function(){arguments.callee.base.apply(this,arguments);var e=this.get("parent");e||CW.fatalError("A hash attribute array must have a parent",{hashAttributeArray:this}),!e.isRecord&&!e.isHashAttribute&&CW.fatalError("A hash attribute array’s parent must either be a record or a hash attribute",{hashAttributeArray:this}),this.recordPropertyDidChange()},_hashAttributes:null,_previousUnderlyingArray:null}),CW.HashAttributeArray.mixin({isComplex:YES,isHashAttributeArray:YES}),CW.NestedStore=SC.NestedStore.extend(CW.StoreCommon,SC.DelegateSupport,{isCoreWebStore:YES,hasChangesInStoreHierarchy:function(){if(this.get("hasChanges"))return YES;var e=this.get("nestedStores"),t,n,r;if(e)for(t=0,n=e.length;t<n;++t){r=e[t];if(r.get("hasChangesInStoreHierarchy"))return YES}return NO},commitChanges:function(e,t,n){this._isCommitting=YES;var r=this,i,s,o,u,a,f,l,c,h,p;n&&(s=this.chainedChanges,s||CW.fatalError("Requested to commit a subset of storeKeys but there is no chainedChanges set",{target:this,storeKeys:n}),n.forEach(function(e){s.contains(e)||CW.fatalError("Requested to commit a storeKey that is not in the chainedChanges set",{target:this,storeKeys:n,chainedChanges:s})}),i=this.changelog,i&&i.removeEach(n),s&&s.removeEach(n),this._dataHashesToRestore={},this._revisionsToRestore={},this._statusesToRestore={},this._locksToRestore={},this._editablesToRestore={},this._previousDataHashesForNotifyToRestore={},this._previousDataHashesForCommitToRestore={},this._commitAgentsToRestore=
{},u=["dataHashes","revisions","statuses","locks","editables","previousDataHashesForNotify","previousDataHashesForCommit","commitAgents"],a=u.length,s.forEach(function(e){for(f=0;f<a;++f)l=u[f],c=r[l],c&&c.hasOwnProperty(e)&&(h="_"+l+"ToRestore",r[h][e]=c[e])}),this._changelogAfterCommit=i,this._chainedChangesAfterCommit=s,this.changelog=this.chainedChanges=n);if(t){var d=t.get("storeKeys");d||(d=SC.CoreSet.create(),s=this.chainedChanges,s&&d.addEach(s));var v=this.commitAgents;v||(v=this.commitAgents={}),d.forEach(function(e){var n=v[e];n||(n=v[e]=[],n.push(t))})}var m=arguments.callee.base.apply(this,arguments);if(n){i=this._changelogAfterCommit,s=this._chainedChangesAfterCommit,this._changelogAfterCommit=null,this._chainedChangesAfterCommit=null;if(s.get("length")>0){var g;s.forEach(function(e){for(f=0;f<a;++f)l=u[f],h="_"+l+"ToRestore",c=r[h],c.hasOwnProperty(e)&&(g=r[l],g||(g=r[l]={}),g[e]=c[e])}),this.changelog=i,this.chainedChanges=s,this.set("hasChanges",YES)}}return this._isCommitting=NO,m},reset:function(){var e=this.get("parentStore");if(!e)throw SC.Store.NO_PARENT_STORE_ERROR;var t=this.dataHashes,n=this.statuses;this.dataHashes=SC.beget(e.dataHashes),this.revisions=SC.beget(e.revisions),this.statuses=SC.beget(e.statuses);var r=this.get("nestedStores"),i,s,o;if(r)for(i=0,s=r.length;i<s;++i)o=r[i],o._fixUpProtypeChainsAfterParentReset||CW.fatalError("The nested store is not a CW.NestedStore, and it needs to be for correct behavior.  A critical bugfix we have made for persistent nested stores has not yet made its way into SproutCore.",{target:this,nestedStore:o}),o
._fixUpProtypeChainsAfterParentReset();this.previousDataHashesForNotify=SC.beget(e.previousDataHashesForNotify),this.previousDataHashesForCommit={},this.commitAgents=null,this.chainedChanges=this.locks=this.editables=null,this.changelog=null;var u={},a={},f;if(t){var l,c,h=this.dataHashes,p=CW.valuesAreEqual;for(f in t){if(!t.hasOwnProperty(f))continue;l=t[f],c=h[f],p(l,c)||(u[f]=YES)}}if(n){var d,v,m=this.statuses;for(f in n){if(!n.hasOwnProperty(f))continue;d=n[f],v=m[f],d!==v&&(a[f]=YES)}}var g;for(f in a)u[f]?(g=NO,delete u[f]):g=YES,this._notifyRecordPropertyChange(parseInt(f,10),g);for(f in u)this._notifyRecordPropertyChange(parseInt(f,10),NO);this.set("hasChanges",NO)},commitChangesFromNestedStore:function(e,t,n){CW.Store.prototype.commitChangesFromNestedStore.apply(this,arguments);var r=this.get("parentStore"),i=r.revisions,s,o=this.locks,u=this.chainedChanges,a,f;o||(o=this.locks=[]),u||(u=this.chainedChanges=SC.Set.create()),a=t.length;for(s=0;s<a;s++)f=t[s],o[f]||(o[f]=i[f]||1),u.add(f);return this.setIfChanged("hasChanges",u.get("length")>0),this.flush(),this},_isCommitting:NO,previousDataHashesForCommit:null,readEditableDataHash:function(e){var t=this.recordTypeFor(e);return this._savePreviousDataHashForNotify(e,t),this._savePreviousDataHashForCommit(e,t),arguments.callee.base.apply(this,arguments)},writeDataHash:function(e,t,n){return t&&(this._savePreviousDataHashForNotify(e),this._savePreviousDataHashForCommit(e)),arguments.callee.base.apply(this,arguments)},_savePreviousDataHashForNotify:function(e,t){var n=this.get("nestedStores");if(n&&n.length>0){var r=this
.previousDataHashesForNotify;if(!r[e]||!r.hasOwnProperty(e))r[e]=SC.clone(this.dataHashes[e],YES)}},_savePreviousDataHashForCommit:function(e){var t=this.previousDataHashesForCommit;if(!t[e]||!t.hasOwnProperty(e))t[e]=SC.clone(this.dataHashes[e],YES)},_lock:function(e){var t=this.locks,n,r;if(t&&t[e])return this;t||(t=this.locks=[]),r=this.editables,r&&(r[e]=0);var i=this.get("parentStore"),s;while(i&&(s=i.storeKeyEditState(e))===SC.Store.INHERITED)i=i.get("parentStore");var o=this.recordTypeFor(e);return this._savePreviousDataHashForNotify(e,o),this._savePreviousDataHashForCommit(e,o),i&&s===SC.Store.EDITABLE?(this.dataHashes[e]=SC.clone(i.dataHashes[e],YES),r||(r=this.editables=[]),r[e]=1):i&&s===SC.Store.LOCKED?this.dataHashes[e]=SC.clone(i.dataHashes[e],YES):this.dataHashes[e]=this.dataHashes[e],this.statuses[e]=this.statuses[e],n=this.revisions[e]=this.revisions[e],t[e]=n||1,this},_fixUpProtypeChainsAfterParentReset:function(){var e=this.get("parentStore");if(!e)throw SC.Store.NO_PARENT_STORE_ERROR;var t=this.__fieldsForWhichToFixPrototypes,n,r,i,s,o,u;for(n=0,r=t.length;n<r;++n){i=t[n],s=this[i],o={};for(u in s)s.hasOwnProperty(u)&&(o[u]=s[u]);var a=SC.beget(e[i]);this[i]=a;for(u in o)a[u]=o[u]}var f=this.get("nestedStores"),l;if(f)for(n=0,r=f.length;n<r;++n)l=f[n],l._fixUpProtypeChainsAfterParentReset()},__fieldsForWhichToFixPrototypes:["dataHashes","revisions","statuses"]}),CW.ManagedNestedStore=CW.NestedStore.extend(CW.MergeSupport,{storageManager:null,extendedLogging:NO,lockOnRead:NO,commitChanges:function(e,t){var n=this.get("parentStore"),r=this.get("extendedLogging"
),i,s,o,u,a,f,l,c;n||CW.fatalError("A managed nested store must have a parent store",{managedNestedStore:this}),n.get("parentStore")&&CW.fatalError("A managed nested store’s parent store must be a root-level store",{managedNestedStore:this}),t&&(i=t.get("storeKeys"),i||(i=SC.CoreSet.create(),s=this.chainedChanges,s&&i.addEach(s)),o=this.commitAgents,o||(o=this.commitAgents={}),i.forEach(function(e){var n=o[e];n||(n=o[e]=[],n.push(t))})),u=YES,a=CW.StorageCycle.COMMIT_CYCLE,f=this._getStorageManager();if(f.get("currentCycle")){r&&SC.debug("%@:  The storage manager says there’s an ongoing cycle, so we'll enqueue this commit request…",this);var h=f.pendingCycleOfType(a);h&&(r&&SC.debug("%@:  …but there is already a commit cycle pending, so I don’t need to schedule another one.",this),e&&(c=h.get("params"),c?(c.force=YES,h.notifyPropertyChange("params")):(c={force:YES},h.set("params",c))),u=NO)}return u&&(l=CW.StorageCycle.createCycle(a,f),e&&l.set("params",{force:YES}),f.scheduleCycle(l)),this},commitChangesFromNestedStore:function(e,t,n){return arguments.callee.base.apply(this,arguments),this.get("extendedLogging")&&SC.debug("%@:  Store keys were committed to the managed store:  %@",this,t),this.commitChanges(n)},init:function(){arguments.callee.base.apply(this,arguments);var e=this.get("delegate");e&&SC.typeOf(e)===SC.T_CLASS&&this.set("delegate",e.create())},_getStorageManager:function(){var e=this.get("storageManager");return e||CW.fatalError("Managed nested store has no storage manager defined",{target:this}),e}}),CW.StorageCycleAction=SC.Object.extend({name:null,type:null
,storageOperation:null,status:null,storeKeys:null,responses:null,params:null,error:null,errorHandled:null,addStoreKeys:function(e){var t=this.get("storeKeys");t||(t=[],this.set("storeKeys",t)),SC.typeOf(e)===SC.T_ARRAY?(t=t.concat(e),this.set("storeKeys",t)):(t.push(e),t.enumerableContentDidChange())},getSingleStoreKey:function(){var e=this.get("storeKeys");return e&&e.length===1?e[0]:null},addResponse:function(e){var t=this.get("responses");t?t.pushObject(e):(t=[e],this.set("responses",t))},setParam:function(e,t){var n=this.get("params");n||(n={},this.set("params",n)),n[e]=t},paramValueForKey:function(e,t){var n=this.get("params");return n?n[e]:undefined},init:function(){this.get("storageOperation")||CW.fatalError("A storage cycle action must have a storage operation"),this.get("status")||this.set("status",CW.StorageCycleAction.STATUS_ONGOING)},toString:function(){var e="",t=arguments.callee.base.apply(this,arguments),n=["name","type","storageOperation","status","storeKeys","params","responses","error","errorHandled"],r,i,s,o,u,a,f;for(r=0,i=n.length;r<i;++r){s=n[r];if(s)if(s==="params"){f=[],o=this.get("params");for(u in o)f.push(u+"="+o[u]);f="{"+f.join(", ")+"}",e+=s+"="+f}else e+=s+"='%@'".fmt(this.get(s));r!==i-1&&(e+=",  ")}return e+="  ("+t+")",e}}),CW.StorageCycleAction.mixin({TYPE_CREATE:"CREATE",TYPE_UPDATE:"UPDATE",TYPE_DESTROY:"DESTROY",STORAGE_OPERATION_CREATE:"CREATE",STORAGE_OPERATION_UPDATE:"UPDATE",STORAGE_OPERATION_DESTROY:"DESTROY",STORAGE_OPERATION_RETRIEVE:"RETRIEVE",STORAGE_OPERATION_FETCH:"FETCH",STATUS_ONGOING:"ongoing",STATUS_SUCCESS:"success",STATUS_ERROR
:"error",ERROR_CONFLICT:"CONFLICT",ERROR_NOT_FOUND:"NOT_FOUND",ERROR_NOT_ALLOWED:"NOT_ALLOWED",ERROR_EXCEPTION:"EXCEPTION",ERROR_NOT_AUTHORIZED:"NOT_AUTHORIZED",ERROR_QUOTA_EXCEEDED:"QUOTA_EXCEEDED"}),CW.StorageCycle=SC.Object.extend({extendedLogging:NO,type:null,storageManager:null,params:null,currentStageIndex:null,currentStage:function(){var e=this.constructor.stages[this.get("currentStageIndex")];return e||(e="beginning"),e}.property("currentStageIndex").cacheable(),getManagedStore:function(){return this.getPath("storageManager.managedStore")},getMainStore:function(){return this.getPath("storageManager.mainStore")},actions:null,addNewAction:function(e,t,n,r){var i=CW.StorageCycleAction.create({name:e,type:t,storageOperation:n});return r&&i.addStoreKeys(r),this.addAction(i),i},addAction:function(e){var t=this.get("actions");t?t.pushObject(e):(t=[e],this.set("actions",t))},actionsForStoreKey:function(e){var t=this.get("actions"),n=null,r,i,s,o;if(t)for(r=0,i=t.length;r<i;++r)s=t[r],o=s.get("storeKeys"),o&&o.indexOf(e)!==-1&&(n?n.push(s):n=[s]);return n},actionsForStoreKeyAndStorageOperation:function(e,t){var n=this.actionsForStoreKey(e),r=null;if(n){var i,s,o;for(i=0,s=n.length;i<s;++i)o=n[i],o.get("storageOperation")===t&&(r?r.push(o):r=[o])}return r},lastActionForStoreKeyAndStorageOperation:function(e,t){var n=this.actionsForStoreKeyAndStorageOperation(e,t);return n?n[n.length-1]:null},dataChangeFunctions:null,scheduleDataChange:function(e){var t=this.get("currentStage"),n=this.constructor,r=n.DATA_CHANGE_STAGE,i;t===r?e.call():n.scheduleOrderForStage(t)>n.scheduleOrderForStage
(r)?CW.fatalError("You cannot schedule a data change after the “data change” stage has already passed"):(i=this.get("dataChangeFunctions"),i?i.pushObject(e):(i=[e],this.set("dataChangeFunctions",i)))},"data change":function(){var e=this.get("dataChangeFunctions"),t,n,r;if(e)for(t=0,n=e.length;t<n;++t)r=e[t],r.call()},_hasEnded:NO,begin:function(){this.advanceToNextStage()},end:function(){if(this.get("_hasEnded"))return;this.set("_hasEnded",YES),this.invokeLater(this._end)},_end:function(){var e=this.get("storageManager");if(!e)throw new"A storage manager must be defined";e.cycleDidEnd(this)},advanceToNextStage:function(){if(this.get("_hasEnded"))return;var e=CW.StorageCycle,t=this.constructor.stages,n=this.get("currentStageIndex"),r;SC.none(n)?r=0:r=n+1,r>=t.length?this.end():(this.get("extendedLogging")&&SC.debug("Transitioning ongoing %@ cycle from '%@' to '%@' stage…",this.get("type"),this.get("currentStage"),t[r]),this.set("currentStageIndex",r),this.currentStageDidChange())},stageWillBegin:function(e){},init:function(){arguments.callee.base.apply(this,arguments),this.get("type")||CW.fatalError("Every cycle must have a 'type' specified.",{target:this})},currentStageDidChange:function(){if(this.get("_hasEnded"))return;var e=CW.StorageCycle,t=this.get("currentStage"),n=this.get("extendedLogging"),r,i,s,o,u,a,f;t||CW.fatalError("There is no stage defined",{target:this,currentStageIndex:this.get("currentStageIndex")}),r=this[t],r||CW.fatalError("There is no method defined for the current stage",{target:this,stage:t}),this.stageWillBegin(t),r&&r.call(this,this.get("params")),
i=CW.RequestManagement.sharedInstance(),s=i.pendingRequestsForCycle(this),o=i.outstandingResponsesForCycle(this),u=s?s.length:0,a=o?o.length:0,f=u+a,f===0?(n&&SC.debug("We can automatically advance from the '%@' stage to the next stage…",t),this.advanceToNextStage()):n&&(f===1?SC.debug("We cannot advance from the '%@' stage to the next stage yet, because there is 1 pending/outstanding request…",t):SC.debug("We cannot advance from the '%@' stage to the next stage yet, because there are %@ pending/outstanding requests…",t,f))},toString:function(){var e=arguments.callee.base.apply(this,arguments),t=this.get("type");return t&&(e=t+" cycle ("+e+")"),e}}),CW.StorageCycle.mixin({stages:null,priority:50,isPreemptible:NO,shouldBeCoalesced:NO,shouldLogLifetime:YES,createCycle:function(e){e||CW.fatalError("createCycle():  You must specify a cycle type");var t=this._typeToClassMapping,n=CW.StorageCycle,r;return t&&(r=t[e]),r||CW.fatalError("There is no registered storage cycle class for the specified type",{type:e}),r.create()},registerClassForCycleType:function(e,t){e||CW.fatalError("registerClassForCycleType():  You must specify a cycle type"),t||CW.fatalError("registerClassForCycleType():  You must specify a storage cycle subclass",{type:e}),t.isClass||CW.fatalError("registerClassForCycleType():  The specified storage cycle subclass is not a class",{type:e,klass:t});var n=this._typeToClassMapping;n||(n=this._typeToClassMapping={}),n[e]=t},scheduleOrderForStage:function(e){e||CW.fatalError("scheduleOrderForStage():  You must specify a stage");var t=this.stages,n=t.indexOf(e);return n===-1&&
CW.fatalError("scheduleOrderForStage():  Invalid stage specified",{stage:e}),n},COMMIT_CYCLE:"commit",READ_CYCLE:"read",IDLE_CYCLE:"idle",DATA_CHANGE_STAGE:"data change",_typeToClassMapping:null}),CW.CommitCycle=CW.StorageCycle.extend({extendedLogging:NO,type:CW.StorageCycle.COMMIT_CYCLE,changelog:null,dataHashesCheckpointBeforeCycle:null,statusesCheckpointBeforeCycle:null,dataHashesCheckpointBeforeCycleStage:null,statusesCheckpointBeforeCycleStage:null,determineChangelog:function(e){var t=SC.Set.create(),n=e.changelog,r={},i={},s={},o=NO,u=this,a=this.get("extendedLogging");n&&n.forEach(function(f){if(r[f])return;var l=e.materializeRecord(f),c;l||CW.fatalError("Could not determine data dependencies because there was an error materializing a record",{store:e,storeKey:f}),a&&SC.debug("Looking at ancestors of storeKey %@:  %@",f,l.shortString());var h=NO,p,d,v,m;d=p=l;while((d=d.get("owner"))&&!h){a&&SC.debug("  >  ancestor:  %@",d.shortString()),v=d.storeKey;if(p.get("isAggregate")){n.contains(v)||CW.fatalError("The ancestor is the aggregate of the child record, but is not in the changelog along with the child",{ancestor:d,child:p}),a&&SC.debug("  >  ancestor %@ is the aggregate of the child %@, so there’s no need to consider the child when scheduling",d.shortString(),p.shortString()),s[f]=d;break}if(n.contains(v)&&!r[v]){m=u._operationOrder(d),a&&SC.debug("  >  Ordering between child %@ and ancestor %@:  %@",l.shortString(),d.shortString(),m);if(m===-1){a&&SC.debug("  >  We must handle ancestor %@ before child %@…",d.shortString(),p.shortString()),r[f]=YES,h=YES;break}m!==0&&
(m===1?(a&&SC.debug("  >  We must handle child %@ before ancestor %@…",p.shortString(),d.shortString()),r[v]=YES):CW.fatalError("Unexpected ordering for ancestor and child",{ordering:m,storeKey:f,ancestorStoreKey:v}))}p=d}if(!h){var g=l.get("rootOwner"),y=YES,b=NO;if(g){b=g===l,b&&o&&(a&&SC.debug("We cannot include %@ in the current commit cycle because a different root ancestor is already being included",l.shortString()),y=NO);if(y){var w=g.get("id"),E=s[f];!E&&i[w]&&(a&&SC.debug("We cannot include %@ in the current commit cycle because a different record from the same root ancestor is already being included (%@)",l.shortString(),i[w].shortString()),y=NO)}}y&&(b&&(o=YES),a&&SC.debug("We can include %@ in the current commit cycle",l.shortString()),E||(i[w]=l),t.add(f))}else a&&SC.debug("We cannot include %@ in the current commit cycle because an ancestor must be handled first",l.shortString())});if(a){var f=t.get("length"),l=f===1?"record is":"records are",c;SC.debug("%@ %@ being included in this commit cycle:",f,l),t.forEach(function(t){var n="",r=s[t];r&&(n="  [sent as part of parent %@]".fmt(r.shortString())),c=e.materializeRecord(t),SC.debug("  *  %@%@",c.shortString(),n)});var h=SC.Set.create();n.forEach(function(e){t.contains(e)||h.add(e)}),f=h.get("length"),f>0&&(l=f===1?"record":"records",SC.debug("%@ %@ will have to wait for a later commit cycle:",f,l),h.forEach(function(t){c=e.materializeRecord(t),SC.debug("  *  %@",c.shortString())}))}return t},_operationOrder:function(e){var t=SC.Record,n=e.get("status");switch(n){case t.READY_NEW:return-1;case t.DESTROYED_DIRTY:
return 1;default:return 0}},prepareDataCheckpointForCycle:function(){var e,t;e=this.dataHashesCheckpointBeforeCycle={},t=this.statusesCheckpointBeforeCycle={},this._saveDataCheckpoint(e,t)},prepareDataCheckpointForCycleStage:function(){var e,t;e=this.dataHashesCheckpointBeforeCycleStage={},t=this.statusesCheckpointBeforeCycleStage={},this._saveDataCheckpoint(e,t)},resetCheckpointData:function(){this.dataHashesCheckpointBeforeCycle=null,this.statusesCheckpointBeforeCycle=null,this.dataHashesCheckpointBeforeCycleStage=null,this.statusesCheckpointBeforeCycleStage=null},_saveDataCheckpoint:function(e,t){var n=this.get("changelog"),r=this.getMainStore();n&&n.forEach(function(n){var i=r.readDataHash(n),s,o,u,a,f,l;e[n]=SC.clone(i,YES),t[n]=r.peekStatus(n),s=r.materializeRecord(n),o=s.get("aggregates");if(o)for(u=0,a=o.length;u<a;++u)f=o[u],l=f.storeKey,i=r.readDataHash(l),e[l]=SC.clone(i,YES),t[l]=r.peekStatus(l)})},removeFromStoreChangelog:function(e){var t=this.get("currentStage"),n=CW.StorageCycle;n.scheduleOrderForStage(t)>=n.scheduleOrderForStage(CW.CommitCycle.COMMIT_STAGE)&&CW.fatalError("You must call removeFromStoreChangelog() before the commit cycle’s commit stage");var r=this.getMainStore(),i=r.changelog;i&&i.remove(e)},restoreDataToPreCycleCheckpoint:function(e){e||CW.fatalError("You must specify a storeKey");var t=this.get("changelog"),n,r,i,s;t||CW.fatalError("restoreDataToPreCycleCheckpoint():  There is no changelog defined, so we cannot restore the previous data",{storeKey:e}),t.contains(e)||CW.fatalError("restoreDataToPreCycleCheckpoint():  The changelog does not include the specified storeKey, so we cannot restore the previous data for it"
,{storeKey:e}),n=this.getMainStore(),r=this.get("dataHashesCheckpointBeforeCycle"),i=r[e],s=n.recordTypeFor(e),SC.info("Restoring previous data for storeKey %@, which is a record of type %@, as it was at the beginning of this commit cycle…",e,s.typeString),i&&(i=SC.clone(i)),n.writeDataHash(e,i),n.dataHashDidChange(e)},begin:function(){var e=this.get("storageManager"),t=e.get("managedStore"),n=t.get("parentStore"),r=this.get("params"),i=r?r.force:NO,s=CW.StorageCycle,o=this.get("extendedLogging"),u,a,f,l;o&&SC.debug("%@:  Committing data from managed store (%@) down to main store (%@)…",this,t,n),u=t.changelog,u?(a=this.determineChangelog(t),a.get("length")!==u.get("length")&&(f=s.COMMIT_CYCLE,l=e.pendingCycleOfType(f),l||(l=s.createCycle(f,e),e.scheduleCycle(l))),this.set("changelog",a),this.prepareDataCheckpointForCycle(),this.prepareDataCheckpointForCycleStage(),CW.NestedStore.prototype.commitChanges.call(t,i,undefined,a)):t.get("hasChanges")&&(SC.debug("Simply resetting the managed store because there are 'chainedChanges' but nothing in the changelog."),t.reset()),arguments.callee.base.apply(this,arguments)},stageWillBegin:function(e){arguments.callee.base.apply(this,arguments);var t=this.getMainStore();t.flush(),this.prepareDataCheckpointForCycleStage()},"commit data":function(e){var t=this.getMainStore(),n=this.get("changelog"),r=n?n.get("length"):0,i;if(r>0){var s=SC.Record.ERROR,o,u,a,f;for(o=0;o<r;++o)u=n[o],a=t.peekStatus(u),a===s&&(f=t.materializeRecord(u),CW.fatalError("Trying to call commitRecords on a record that has status ERROR",{recordType:f.get("shortTypeString"
),storeKey:u}));i=t.commitRecords(null,null,n),i===NO&&SC.debug("No records were committed to the main store.  This usually means that something was in the changelog but was marked as clean.")}},"data change":function(){arguments.callee.base.apply(this,arguments);var e=this.getPath("storageManager.errorController");e&&e.addActions(this.get("actions"))},end:function(){var e=this.getMainStore(),t=e.commitAgents,n;t&&(n=this.get("changelog"),n&&n.forEach(function(e){delete t[e]})),this.resetCheckpointData(),arguments.callee.base.apply(this,arguments)}}),CW.CommitCycle.mixin({stages:["commit data",CW.StorageCycle.DATA_CHANGE_STAGE],priority:2,shouldBeCoalesced:YES,COMMIT_STAGE:"commit data"}),CW.StorageCycle.registerClassForCycleType(CW.StorageCycle.COMMIT_CYCLE,CW.CommitCycle),CW.IdleCycle=CW.StorageCycle.extend({type:CW.StorageCycle.IDLE_CYCLE,"issue request":function(e){CW.fatalError("idle cycle 'issue request' stage:  You must implement this method")}}),CW.IdleCycle.mixin({stages:["issue request",CW.StorageCycle.DATA_CHANGE_STAGE],priority:1,shouldBeCoalesced:YES,isPreemptible:YES}),CW.StorageCycle.registerClassForCycleType(CW.StorageCycle.IDLE_CYCLE,CW.IdleCycle),CW.ReadCycle=CW.StorageCycle.extend({type:CW.StorageCycle.READ_CYCLE,requests:null,addRequest:function(e){e||CW.fatalError("addRequest():  You must specify a request");var t=this.get("requests");this.propertyWillChange("requests"),t.push(e),this.propertyDidChange("requests")},removeRequest:function(e){e||CW.fatalError("removeRequest():  You must specify a request");var t=this.get("requests"),n=t.indexOf(e);n!==-1&&
t.removeAt(n,1)},"issue requests":function(e){var t=this.get("requests"),n,r,i;for(n=0,r=t.length;n<r;++n)i=t[n],i.set("cycle",this),i.send()},init:function(){arguments.callee.base.apply(this,arguments),this.set("requests",[])}}),CW.ReadCycle.mixin({stages:["issue requests",CW.StorageCycle.DATA_CHANGE_STAGE],priority:10,shouldBeCoalesced:NO}),CW.StorageCycle.registerClassForCycleType(CW.StorageCycle.READ_CYCLE,CW.ReadCycle),CW.StorageManager=SC.Object.extend({extendedLogging:NO,name:null,managedStore:null,mainStore:function(){return this.getPath("managedStore.parentStore")}.property("managedStore").cacheable(),currentCycle:null,pendingCycles:null,cyclesAreSuspended:function(){return this._suspendCount>0}.property(),hasOutstandingCommitCycle:function(){var e=this.get("currentCycle"),t=CW.StorageCycle,n;return e&&e.get("type")===t.COMMIT_CYCLE?YES:(n=this.pendingCycleOfType(t.COMMIT_CYCLE),n?YES:NO)}.property("currentCycle","*pendingCycles.[]").cacheable(),scheduleCycle:function(e){e||CW.fatalError("scheduleCycle():  You must specify a cycle");var t=e.get("storageManager"),n=this.get("currentCycle"),r=this._suspendCount>0,i=YES,s=e.get("type"),o=e.constructor,u=o.priority,a,f,l,c,h,p,d,v,m,g,y,b;t&&(t===this?CW.fatalError("scheduleCycle():  The specified cycle is already registered with this storage manager",{cycle:e,target:this}):CW.fatalError("scheduleCycle():  The specified cycle is already registered with a different storage manager",{cycle:e,target:this,storageManager:t})),e.set("storageManager",this),!n&&!r?(this.beginCycle(e),i=NO,a=YES):r?SC.debug("Enqueuing new %@ cycle because cycles are suspended…"
,s):n&&(f=n.constructor,l=f.isPreemptible,l&&(c=f.priority,u>c?(SC.debug("Canceling current %@ cycle because a new %@ cycle has been scheduled…",n.get("type"),s),h=YES):SC.debug("Enqueuing new %@ cycle because there is a %@ cycle in progress…",s,n.get("type"))));if(i){p=o.shouldBeCoalesced,d=this.get("pendingCycles"),m=d.length,g=0;for(v=m-1;v>=0;--v){y=d[v];if(p&&s===y.get("type")){SC.debug("Ignoring registration of %@ cycle because we already have a pending %@ cycle in the queue…",s,s),g=-1;break}b=y.constructor.priority;if(b<=u){g=v+1;break}}g>=0?(d.insertAt(g,e),a=YES):a=NO}return h&&this.cancelCycle(n),a},pendingCycleOfType:function(e){var t=CW.StorageCycle,n=this.get("pendingCycles"),r,i,s;for(r=0,i=n.length;r<i;++r){s=n[r];if(s.get("type")===e)return s}return null},beginCycle:function(e){var t=this.get("currentCycle"),n,r;t?CW.fatalError("beginCycle():  Cannot begin a new cycle because there is already a cycle in progress.",{target:this,currentCycle:t,newCycle:e}):(r=e.constructor.shouldLogLifetime,n=this.get("pendingCycles"),!n||n.length===0?r&&SC.Logger.debugGroup("Beginning %@  (no pending cycles)…",e):r&&SC.Logger.debugGroup("Beginning %@  (pending cycles:  %@)…",e,n),this.set("currentCycle",e),e.begin())},cancelCycle:function(e){var t=this.get("currentCycle"),n,r,i,s,o,u,a,f,l,c,h;if(t===e){SC.debug("Canceling current %@ and associated pending/outstanding requests…",t),n=SC.Request.manager,r=CW.RequestManagement.sharedInstance(),i=r.pendingRequestsForCycle(e),s=r.outstandingResponsesForCycle(e);if(i)for(o=0,u=i.length;o<u;++o)a=i[o],SC.debug("  >  canceling pending request %@…"
,a),a.set("isCancelled",YES),r.removePendingRequest(a);if(s)for(o=0,u=s.length;o<u;++o)f=s[o],SC.debug("  >  canceling outstanding request %@…",f),n.cancel(f),r.removeOutstandingResponse(f);window.status=" ",e.end()}else{l=this.get("pendingCycles");for(o=0,u=l.length;o<u;++o){c=l[o];if(c===e){SC.debug("Canceling pending %@ cycle…",e.get("type")),l.removeAt(o,1),h=YES;break}}h||CW.fatalError("cancelCycle():  Requested to cancel a cycle that is neither in progress nor in the pending queue",{target:this,cycle:e})}},suspendCycles:function(){var e=this._suspendCount>0;++this._suspendCount,e||(this.notifyPropertyChange("cyclesAreSuspended"),SC.debug("%@:  Cycles are suspended",this))},resumeCycles:function(){var e=this._suspendCount;--e,e<0?(SC.warn("CW.StorageManager#resumeCycles was called without a paired suspendCycles invocation; ignoring…"),this._suspendCount=0):(this._suspendCount=e,e===0&&(this.notifyPropertyChange("cyclesAreSuspended"),SC.debug("%@:  Cycles have been resumed",this),this._beginFirstPendingCycle()))},init:function(){arguments.callee.base.apply(this,arguments),this.set("pendingCycles",[]);var e=this.get("managedStore"),t;e||CW.fatalError("You must specify a managed store for the storage manager",{target:this}),t=this.get("mainStore"),t||CW.fatalError("The storage manager cannot determine the main store",{target:this,managedStore:e}),e.get("storageManager")&&CW.fatalError("The managed store is already registered to a different storage manager",{target:this,managedStore:e}),t.get("storageManager")&&CW.fatalError("The main store is already registered to a different storage manager"
,{target:this,mainStore:t}),e.set("storageManager",this),t.set("storageManager",this);var n=CW.RequestManagement.sharedInstance();n.addObserver("pendingRequests.[]",this,this.outstandingRequestsDidChange),n.addObserver("outstandingResponses.[]",this,this.outstandingRequestsDidChange)},cycleDidEnd:function(e){var t=this.get("currentCycle");t||CW.fatalError("cycleDidEnd() was invoked but there is no current cycle",{target:this,cycle:e}),t!==e&&CW.fatalError("cycleDidEnd() was invoked on a cycle that is not the current cycle",{target:this,cycle:e,currentCycle:t}),this.set("currentCycle",null),SC.Logger.debugGroupEnd(),this._suspendCount||this._beginFirstPendingCycle()},outstandingRequestsDidChange:function(){var e=this._previousNumberOfPendingOrOutstandingRequests,t=this.get("currentCycle"),n=CW.RequestManagement.sharedInstance(),r=n.get("pendingRequests"),i=n.get("outstandingResponses"),s=this.get("extendedLogging"),o,u,a,f,l,c,h,p;if(t){o=n.pendingRequestsForCycle(t),u=n.outstandingResponsesForCycle(t),a=o?o.length:0,a+=u?u.length:0;if(e!==undefined&&e!==a){if(a===0)t.constructor.shouldLogLifetime&&SC.debug("%@:  There are no more pending/outstanding requests",t);else{f=n.numberOfPendingOrOutstandingReadsForCycle(t),a===1?(c=f>0?"read":"write",t.constructor.shouldLogLifetime&&SC.debug("%@:  There is 1 pending/outstanding request  (a %@)…",t,c)):(l=n.numberOfPendingOrOutstandingWritesForCycle(t),SC.debug("%@:  There are %@ pending/outstanding requests (%@ read, %@ write)…",t,a,f,l));if(s){SC.debug("Outstanding responses:");for(h=0;h<a;++h)p=u[h],SC.debug("  [%@]  %@",h,p)}}a===0&&
(t.get("_hasEnded")&&CW.fatalError("The number of pending/outstanding requests for the current storage cycle unexpectedly changed to 0 after it ended",{target:this,currentCycle:t,previousNumber:e}),s&&SC.debug("Advancing to next stage (%@+1) because there are no outstanding requests…",t.get("currentStage")),t.invokeLast(function(){t.advanceToNextStage()}))}}this._previousNumberOfPendingOrOutstandingRequests=a},_beginFirstPendingCycle:function(){var e=this.get("pendingCycles"),t,n;e&&(t=e.length,t>0&&(n=e.shift(),this.beginCycle(n),this.get("pendingCycles").enumerableContentDidChange()))},toString:function(){var e=arguments.callee.base.apply(this,arguments),t=this.get("name");return t&&(e=t+" ("+e+")"),e},_suspendCount:0}),CW.Store=SC.Store.extend(CW.StoreCommon,SC.DelegateSupport,{isCoreWebStore:YES,readEditableDataHash:function(e){return this._savePreviousDataHashForNotify(e),arguments.callee.base.apply(this,arguments)},writeDataHash:function(e,t,n){return t&&this._savePreviousDataHashForNotify(e),arguments.callee.base.apply(this,arguments)},placeHolderRecord:function(e,t,n){var r=e.storeKeyFor(t),i;return i=this.materializeRecord(r),r&&(this.writeDataHash(r,n?n:{}),this.writeStatus(r,SC.Record.READY_CLEAN),i.allPropertiesDidChange()),i},pushRetrieve:function(e,t,n,r,i){var s=SC.Record,o;r===undefined&&(r=e.storeKeyFor(t)),o=this.readStatus(r);if(o==s.EMPTY||o==s.ERROR||o==s.READY_CLEAN||o==s.DESTROYED_CLEAN){o=s.READY_CLEAN;if(n===undefined)this.writeStatus(r,s.EMPTY),this.dataHashDidChange(r);else{var u=this.getCurrentCommitCycle(),a=u?u.get("changelog"):null;if(a&&a.contains
(r)){var f=SC.clone(this.readDataHash(r),YES),l=u.dataHashesCheckpointBeforeCycleStage[r],c=this.mergeHashesAsPossible;if(f&&l&&c){SC.debug("pushRetrieve():  Merging newly-loaded data for storeKey %@ into main store…",r);var h=c.call(this,n,f,l,e.propertyMergeGroups,YES,"server-retrieved data",this.get("name")),p=h.changedKeys.concat(h.addedKeys,h.removedKeys),d=h.mergeConflictKeys;if(p.length||d.length)this.writeDataHash(r,f,o),this.dataHashDidChange(r);if(d.length>0){var v=this.get("delegate"),m=NO;v&&(m=this.invokeDelegateMethod(v,"mergeConflictDuringNotify",this,null,r,p,d))}}else this.writeDataHash(r,n,o),this.dataHashDidChange(r)}else this.writeDataHash(r,n,o),this.dataHashDidChange(r)}return r}return NO},_savePreviousDataHashForNotify:function(e,t){var n=this.get("nestedStores");n&&n.length>0&&(this.previousDataHashesForNotify[e]||(this.previousDataHashesForNotify[e]=SC.clone(this.dataHashes[e],YES)))},reset:function(){return this.previousDataHashesForNotify={},this.commitAgents=null,arguments.callee.base.apply(this,arguments)},commitChangesFromNestedStore:function(e,t,n){var r=e.commitAgents,i,s,o,u,a,f;if(r){i=this.commitAgents,i||(i=this.commitAgents={});for(s in r)s=parseInt(s,10),t.contains(s)&&(o=i[s],u=r[s],o?o=o.concat(u):i[s]=u)}n||this._verifyLockRevisions(t,e.locks,e);var l=t.length,c,h,p,d,v,m,g,y;v=this.revisions,h=this.dataHashes,p=this.statuses,d=this.editables,d||(d=this.editables=[]),m=e.dataHashes,y=e.revisions,g=e.statuses;for(c=0;c<l;c++)s=t[c],p[s]=g[s],v[s]=y[s],d[s]=0,this._savePreviousDataHashForCommit&&this._savePreviousDataHashForCommit(s),h[
s]=m[s],this._notifyRecordPropertyChange(s,NO),this.notifyCommitAgents(s,"recordWasCommittedToStore",this);var b=this.changelog,w=e.changelog;return w&&(b||(b=this.changelog=SC.CoreSet.create()),b.addEach(w)),this.changelog=b,this.get("parentStore")||this.flush(),this}}),CoreFamily=SC.Object.create({NAMESPACE:"CoreFamily",VERSION:"1.0.0",currentFamily:null,loggedInFamilyMember:null,currentUserDSID:null,mainStore:null,managedStore:null,storageManager:null,appleMusic:null,storage:null,purchase:null,location:null,exampleDataSource:"CoreFamily.FamilyDataSource",prefetchFamilyDetails:!0,setup:function(){if(this._hasBeenSetUp){SC.warn("Called CoreFamily.setup() twice. Ignoring…");return}var e=this._initializeDataSource(),t=CW.Store.create({name:"CoreFamily main store"}).from(e);this.set("mainStore",t);var n=t.chain({name:"CoreFamily managed store",delegate:CW.AutoMergingNestedStoreDelegate.create()},CoreFamily.ManagedNestedStore),r=CW.StorageManager.create({managedStore:n,name:"CoreFamily storage manager"});n.set("storageManager",r),this.set("managedStore",n),this.set("storageManager",r),CoreFamily.statechart.initStatechart()},callErrorDelegateMethod:function(e){var t=this.getPath("errorDelegate."+e),n=[];if(t){for(var r=1,i=arguments.length;r<i;r++)n.push(arguments[r]);return t.apply(this,n)}CW.fatalError("Tried calling delegate method CoreFamily.delegate.%@ but it was not implemented".fmt(e))},_initializeDataSource:function(){var e=this.get("exampleDataSource");return e||CW.fatalError("You must provide an `exampleDataSource` in order to use CoreFamily"),e=SC.objectForPropertyPath
(e),SC.typeOf(e)!==SC.T_CLASS&&CW.fatalError("The `exampleDataSource` should be a class",{value:e}),e.create()},_hasBeenSetUp:!1,displayNameFor:function(e,t,n,r,i){var s,o=i||e;return o&&t?CW.stringIsCJK(o)&&CW.stringIsCJK(t)?s=t+o:s="CoreFamily.Name.Display.FirstAndLastNames".loc({firstName:o,lastName:t}):o?s=o:t?s=t:r&&(s=r),s||(s=n||""),s},informalNameFor:function(e,t,n){return n||e||""}}),CoreFamily.dataSourceErrorsController=SC.Object.create({handleError:function(e){var t=e.response,n=t&&t.get("body"),r=n&&n.title||e.title,i=n&&n["status-message"]||e.description;switch(t.status){case 401:this.handleAuthenticationIssue(t.get("request"),t,r,i);break;default:this.showAlert(r,i,e.shouldExit,e.buttons)}},handleAuthenticationIssue:function(e,t,n,r){CoreFamily.storageManager.suspendCycles(),CoreFamily.callErrorDelegateMethod("reauthenticate","",function(t){if(!t)CoreFamily.callErrorDelegateMethod("exit");else if(e.get("cycle")===null)e.send();else{SC.debug("setting up to re-run current cycle");var n=CoreFamily.storageManager,r=n.get("currentCycle"),i=r.getMainStore();r.get("changelog").forEach(function(e){var t=SC.Record,n=i.peekStatus(e),r;n&t.BUSY_CREATING?r=t.READY_NEW:n&t.DESTROYED?r=t.DESTROYED_DIRTY:r=t.READY_DIRTY,i.writeStatus(e,r)}),n.resumeCycles(),r.currentStageDidChange()}})},showAlert:function(e,t,n,r){e=e||"CoreFamily.Error.GenericRequestError.Title".loc(),t=t||"CoreFamily.Error.GenericRequestError.Description".loc(),n=n||NO;if(!r){var i=function(e){n&&CoreFamily.callErrorDelegateMethod("exit")};r=[{title:"CoreFamily.Button.OK".loc(),action:i}]}CoreFamily.callErrorDelegateMethod
("showAlert",{messageText:e,informativeText:t,style:2,buttons:r}),CoreFamily.callErrorDelegateMethod("log","error",e)}}),CoreFamily.FamilyDataSource=SC.DataSource.extend({exampleRequest:"CW.Request",exampleFamily:"CoreFamily.Family",exampleFamilyMember:"CoreFamily.FamilyMember",exampleFamilyInvitation:"CoreFamily.FamilyInvitation",exampleIncomingTransferRequest:"CoreFamily.IncomingTransferRequest",exampleOutgoingTransferRequest:"CoreFamily.OutgoingTransferRequest",examplePaymentMethod:"CoreFamily.PaymentMethod",exampleMusic:"CoreFamily.MemberMusic",examplePurchase:"CoreFamily.MemberPurchase",exampleLocation:"CoreFamily.MemberLocation",exampleStorage:"CoreFamily.MemberStorage",suppressFamilyDetailsError:!1,BASE_URL:"https://setup.icloud.com/setup/mac/family/",FAMILY_DETAILS_ENDPOINT:"getFamilyDetails",CREATE_FAMILY_ENDPOINT:"createFamily",TRANSFER_FAMILY_ENDPOINT:"transferFamilyOwnership",LEAVE_FAMILY_ENDPOINT:"leaveFamily",ADD_FAMILY_MEMBER_ENDPOINT:"addFamilyMember",UPDATE_FAMILY_MEMBER_ENDPOINT:"updateFamilyMember",REMOVE_FAMILY_MEMBER_ENDPOINT:"removeFamilyMember",SEND_INVITATION_ENDPOINT:"sendInvitation",CANCEL_INVITATION_ENDPOINT:"cancelInvitation",CREATE_CHILD_ACCOUNT_ENDPOINT:"createChildAccount",SEND_TRANSFER_REQUEST_ENDPOINT:"sendTransferRequest",CANCEL_TRANSFER_REQUEST_ENDPOINT:"cancelTransferRequest",ACCEPT_TRANSFER_REQUEST_ENDPOINT:"acceptTransferRequest",REJECT_TRANSFER_REQUEST_ENDPOINT:"rejectTransferRequest",ITUNES_PAYMENT_INFO_ENDPOINT:"getiTunesAccountPaymentInfo",PAYMENT_METHOD_FOREIGN_KEY_SUFFIX:"__paymentMethod",DISPATCH_ACTION_RETRIEVE:"retrieve",DISPATCH_ACTION_CREATE
:"create",DISPATCH_ACTION_UPDATE:"update",DISPATCH_ACTION_DESTROY:"destroy",BASE_URL_V2:"https://setup.icloud.com/setup/family/v2/macos/",APPS_AND_SERVICES:"getAppsAndSevrvices",MUSIC_URL:"music",STORAGE_URL:"storage",PURCHASE_SHARING_URL:"purchaseSharing",LOCATION_URL:"location",UPDATE_MEMBER_PURCHASE:"updateSharePurchase",UPDATE_MEMBER_STORAGE:"updateStorage",CREATE_FAMILY_V2:"initiateFamily",MEMBER_MUSIC_FOREIGN_KEY:"_musicId",MEMBER_LOCATION_FOREIGN_KEY:"_locationId",MEMBER_STORAGE_FOREIGN_KEY:"_storageId",MEMBER_PURCHASE_FOREIGN_KEY:"_purchaseId",CANCEL_INVITATION_ENDPOINT_V2:"cancelMemberInvitation",getStorageInfo:function(e,t){var n={};n.familyId=CoreFamily.currentFamily.get("familyId"),n.appleId=CoreFamily.loggedInFamilyMember.get("appleIdForPurchases");var r=this._createRequest({method:"POST",endpoint:this.BASE_URL_V2+this.STORAGE_URL,body:n,store:e,onSuccess:"_didReceiveStorageInfo",onError:"storageError",associateWithCurrentCycle:!1,includeEtagCheck:!1});return t?t.addRequest(r):r.send(),YES},storageError:function(e,t,n,r){var i={error:!0},s=SC.objectForPropertyPath(this.get("exampleStorage")),r=n.loadRecord(s,i);CoreFamily.set("storage",CoreFamily.managedStore.materializeRecord(r))},_didReceiveStorageInfo:function(e,t,n,r){return t?this._loadStorage(n,t):this._getFamilyDetailsError(e,t,n,r),YES},getLocationInfo:function(e,t){var n={};n.familyId=CoreFamily.currentFamily.get("familyId"),n.appleId=CoreFamily.loggedInFamilyMember.get("appleIdForPurchases");var r=this._createRequest({method:"POST",endpoint:this.BASE_URL_V2+this.LOCATION_URL,body:n,store:e,onSuccess:"_didReceiveLocationinfo"
,onError:"locationError",associateWithCurrentCycle:!1,includeEtagCheck:!1});return t?t.addRequest(r):r.send(),YES},locationError:function(e,t,n,r){var i={error:!0},s=SC.objectForPropertyPath(this.get("exampleLocation")),r=n.loadRecord(s,i);CoreFamily.set("location",CoreFamily.managedStore.materializeRecord(r))},_didReceiveLocationinfo:function(e,t,n,r){return t?this._loadLocation(n,t):this._getFamilyDetailsError(e,t,n,r),YES},getPurchaseSharingInfo:function(e,t){var n={};n.familyId=CoreFamily.currentFamily.get("familyId"),n.appleId=CoreFamily.loggedInFamilyMember.get("appleIdForPurchases");var r=this._createRequest({method:"POST",endpoint:this.BASE_URL_V2+this.PURCHASE_SHARING_URL,store:e,body:n,onSuccess:"_didReceivePurchaseSharinginfo",onError:"purchaseSharingError",associateWithCurrentCycle:!1,includeEtagCheck:!1});return t?t.addRequest(r):r.send(),YES},purchaseSharingError:function(e,t,n,r){var i={error:!0},s=SC.objectForPropertyPath(this.get("examplePurchase")),r=n.loadRecord(s,i);CoreFamily.set("purchase",CoreFamily.managedStore.materializeRecord(r))},_didReceivePurchaseSharinginfo:function(e,t,n,r){return t?this._loadPurchase(n,t):this._getFamilyDetailsError(e,t,n,r),YES},getMusicInfo:function(e,t){var n={};n.familyId=CoreFamily.currentFamily.get("familyId"),n.appleId=CoreFamily.loggedInFamilyMember.get("appleIdForPurchases");var r=this._createRequest({method:"POST",endpoint:this.BASE_URL_V2+this.MUSIC_URL,body:n,store:e,onSuccess:"_didReceiveMusicInfo",onError:"musicError",associateWithCurrentCycle:!1,includeEtagCheck:!1});return t?t.addRequest(r):r.send(),YES},musicError
:function(e,t,n,r){var i={error:!0},s=SC.objectForPropertyPath(this.get("exampleMusic")),r=n.loadRecord(s,i);CoreFamily.set("appleMusic",CoreFamily.managedStore.materializeRecord(r))},_didReceiveMusicInfo:function(e,t,n,r){return t?this._loadMusic(n,t):this._getFamilyDetailsError(e,t,n,r),YES},getAppsAndSevrvices:function(e,t){var n=this._createRequest({method:"GET",endpoint:this.APPS_AND_SERVICES,store:e,onSuccess:"_didReceiveAppsAndServices",onError:"_appsAndServicesError"});return t?t.addRequest(n):n.send(),YES},_didReceiveAppsAndServices:function(e,t,n,r){return t?this._loadAppsAndServices(n,t):this._getFamilyDetailsError(e,t,n,r),YES},getFamilyDetails:function(e,t){var n=this._createRequest({method:"GET",endpoint:this.BASE_URL+this.FAMILY_DETAILS_ENDPOINT,store:e,onSuccess:"_didReceiveFamilyDetails",onError:"_getFamilyDetailsError"});return t?t.addRequest(n):n.send(),YES},_getFamilyDetailsError:function(e,t,n,r){if(t||!this.get("suppressFamilyDetailsError"))CoreFamily.dataSourceErrorsController.handleError({title:"CoreFamily.Error.GetFamilyDetails.Title".loc(),description:"CoreFamily.Error.GetFamilyDetails.Description".loc(),response:e,shouldExit:YES}),SC.error("There was an error getting the details for the family. Status code: %@,  body: %@",e.get("status"),e.get("encodedBody"));CW.notificationCenter.postNotification("CoreFamily.DidNotLoadFamily")},createFamily:function(e,t){return this._createRequest({method:"POST",endpoint:this.BASE_URL+this.CREATE_FAMILY_ENDPOINT,store:e,body:t,onSuccess:"_didReceiveFamilyDetails",onError:"_createFamilyError",associateWithCurrentCycle
:!1,includeEtagCheck:!1}).send(),YES},createFamilyV2:function(e,t){return this._createRequest({method:"POST",endpoint:this.BASE_URL_V2+this.CREATE_FAMILY_V2,store:e,body:t,onSuccess:"_didReceiveFamilyV2Details",onError:"_createFamilyError",associateWithCurrentCycle:!1,includeEtagCheck:!1}).send(),YES},_didReceiveFamilyV2Details:function(e,t,n,r){return console.log("response ",e),console.log("body ",t),CW.notificationCenter.postNotification("CoreFamily.DidCreateFamily",n,t),YES},_createFamilyError:function(e,t,n,r){CoreFamily.dataSourceErrorsController.handleError({title:"CoreFamily.Error.CreateFamily.Title".loc(),description:"CoreFamily.Error.CreateFamily.Description".loc(),response:e,shouldExit:YES}),SC.error("There was an error creating the family. Status code: %@,  body: %@",e.get("status"),e.get("encodedBody"))},leaveFamily:function(e,t,n){var r=this._createRequest({method:"POST",endpoint:this.BASE_URL+this.LEAVE_FAMILY_ENDPOINT,onSuccess:"_leaveFamilySuccess",onError:"_leaveFamilyError",includeEtagCheck:!1,associateWithCurrentCycle:!1});return r._target=e,r._successAction=t,r._failureAction=n,r.send(),YES},_leaveFamilySuccess:function(e,t){return this._invokeLeaveFamilyAction(e,"_successAction"),YES},_leaveFamilyError:function(e,t){return CoreFamily.dataSourceErrorsController.handleError({title:"CoreFamily.Error.LeaveFamily.Title".loc(),description:"CoreFamily.Error.LeaveFamily.Description".loc(),response:e}),this._invokeLeaveFamilyAction(e,"_failureAction"),YES},_invokeLeaveFamilyAction:function(e,t){var n=e.getPath("request.source"),r,i;n&&(r=n.get("_target"),i=n.get(
t),i&&(SC.typeOf(i)===SC.T_FUNCTION?i.call(r):SC.RootResponder.responder.sendAction(i,r)))},_didReceiveFamilyDetails:function(e,t,n,r){return t?t.isMemberOfFamily?this._loadFamilyDetails(n,t):this._familyMemberError(e,t,n,r):this._getFamilyDetailsError(e,t,n,r),YES},_familyMemberError:function(e,t,n,r){var i=t["status-message"];CoreFamily.dataSourceErrorsController.handleError({title:"CoreFamily.Error.GetFamilyDetails.Title".loc(),description:i,response:e,shouldExit:YES}),SC.error("There was an error getting the details for the family. Status code: %@,  body: %@",e.get("status"),e.get("encodedBody")),CW.notificationCenter.postNotification("CoreFamily.DidNotLoadFamily")},getiTunesPaymentInfo:function(e){return this._createRequest({method:"POST",endpoint:this.BASE_URL+this.ITUNES_PAYMENT_INFO_ENDPOINT,includeEtagCheck:!1,associateWithCurrentCycle:!1,body:e,onSuccess:"_getiTunesPaymentInfoSuccess",onError:"_getiTunesPaymentInfoError"}).send(),YES},_getiTunesPaymentInfoSuccess:function(e,t){return SC.debug("Successfully received iTunes payment info"),t.skipPayment=!1,CW.notificationCenter.postNotification("CoreFamily.DidLoadiTunesPaymentInfo",t),YES},_getiTunesPaymentInfoError:function(e,t){InternetAccount2.log("error",t.userAction),CM.configurationController.isFamilyV2Enabled&&CM.nativeClientController.isLoboOrHigher()?t.userAction!=="ADDING_FAMILY_MEMBER"?this._throwItunesPaymentInfoError(e,t):(t.skipPayment=!0,console.log("body is ",t),CW.notificationCenter.postNotification("CoreFamily.DidLoadiTunesPaymentInfo",t)):this._throwItunesPaymentInfoError(e,t)},_throwItunesPaymentInfoError
:function(e,t){var n="organizerDSID"in e.getPath("request.body"),r;t.status===56&&(r=[{title:"CoreFamily.Button.Add".loc(),action:function(){CoreFamily.callErrorDelegateMethod("openURL","CoreFamily.URL.iTunesAddPayment".loc())}},{title:"CoreFamily.Button.Cancel".loc()}]),CoreFamily.dataSourceErrorsController.handleError({title:"CoreFamily.Error.GetItunesPaymentInfo.Title".loc(),description:"CoreFamily.Error.GetItunesPaymentInfo.Generic.Description".loc(),response:e,shouldExit:n,buttons:r}),CW.notificationCenter.postNotification("CoreFamily.CouldNotLoadiTunesPaymentInfo",e,t)},retrieveRecord:function(e,t,n){return this._dispatchToProperTypeSpecificMethod("_retrieve",e,t,n,this.DISPATCH_ACTION_RETRIEVE)},_retrievePaymentMethod:function(e,t,n){if(SC.empty(n))return NO;n=n.split(this.PAYMENT_METHOD_FOREIGN_KEY_SUFFIX)[0];var r=this._createRequest({method:"POST",endpoint:this.BASE_URL+this.ITUNES_PAYMENT_INFO_ENDPOINT,includeEtagCheck:!1,associateWithCurrentCycle:!1,store:e,storeKey:t,body:{organizerDSID:n},onSuccess:"_retrievePaymentMethodSuccess",onError:"_retrievePaymentMethodError"});return r.set("organizerDSID",n),r.send(),YES},_retrievePaymentMethodSuccess:function(e,t,n,r){var i=e.getPath("request.source.organizerDSID");t.paymentMethodId||(t.paymentMethodId=i+this.PAYMENT_METHOD_FOREIGN_KEY_SUFFIX);var s=SC.objectForPropertyPath(this.get("examplePaymentMethod"));return n.dataSourceDidComplete(r,t),YES},_retrievePaymentMethodError:function(e,t,n,r){return CoreFamily.dataSourceErrorsController.handleError({title:"CoreFamily.Error.GetItunesPaymentInfo.Title".loc(),description
:"CoreFamily.Error.GetItunesPaymentInfo.Description".loc(),response:e}),YES},createRecord:function(e,t,n){return this._dispatchToProperTypeSpecificMethod("_create",e,t,n,this.DISPATCH_ACTION_CREATE)},_createFamilyMember:function(e,t,n){var r=e.readDataHash(t),i=e.lastCommitAgentWithParam(t,"verificationToken");r.verificationToken=i&&i.getPath("params.verificationToken");var s=e.lastCommitAgentWithParam(t,"preferredAppleId");return r.preferredAppleId=s&&s.getPath("params.preferredAppleId"),this._createRequest({method:"POST",endpoint:this.BASE_URL+this.ADD_FAMILY_MEMBER_ENDPOINT,store:e,storeKey:t,body:r,onSuccess:"_createFamilyMemberSuccess",onError:"_createFamilyMemberError"}).send(),YES},_createFamilyMemberSuccess:function(e,t,n,r){var i=n.materializeRecord(r);return this._loadFamilyDetails(n,t),n.notifyCommitAgents(r,"recordWasCommittedToServer",i),YES},_createFamilyMemberError:function(e,t,n,r){var i=!t||t.status!==23;return this._handleCreateError(i,e,n,r),YES},_createFamilyInvitation:function(e,t,n){var r=e.readDataHash(t),i=e.lastCommitAgentWithParam(t,"verificationToken");return r.verificationToken=i&&i.getPath("params.verificationToken"),this._createRequest({method:"POST",endpoint:this.BASE_URL+this.SEND_INVITATION_ENDPOINT,store:e,storeKey:t,body:r,onSuccess:"_createFamilyInvitationSuccess",onError:"_createFamilyInvitationError"}).send(),YES},_createFamilyInvitationSuccess:function(e,t,n,r){var i=n.materializeRecord(r);return SC.debug("Successfully added family invitation “%@”",i.get("informalName")),this._loadFamilyDetails(n,t),n.notifyCommitAgents(r,"recordWasCommittedToServer"
,i),YES},_createFamilyInvitationError:function(e,t,n,r){var i=YES;return this._handleCreateError(i,e,n,r),YES},resendInvitation:function(e,t,n,r){var i=CoreFamily.mainStore,s=e.get("storeKey"),o=i.readDataHash(s);o.isResend=YES;var u=this._createRequest({method:"POST",endpoint:this.BASE_URL+this.SEND_INVITATION_ENDPOINT,store:i,storeKey:s,body:o,associateWithCurrentCycle:NO,onSuccess:"_resendInvitationSuccess",onError:"_resendInvitationError"});u.set("target",t).set("successAction",n).set("errorAction",r).set("invitation",e),u.send()},_resendInvitationSuccess:function(e,t,n,r){var i=e.getPath("request.source"),s=i.get("invitation"),o=i.get("successAction");return SC.debug("Successfully re-sent family invitation to “%@”",s.get("informalName")),this._loadFamilyDetails(n,t),this._invokeResendInvitationCallback(e,t,n,r,o),YES},_resendInvitationError:function(e,t,n,r){var i=e.getPath("request.source"),s=i.get("invitation"),o=i.get("errorAction");SC.error("Error re-sending invitation to “%@”,  response=%@,  status=%@,  body=%@",s.get("informalName"),e,e.get("status"),t);var u=n.materializeRecord(r),a={informalName:u.get("informalName"),firstName:u.get("firstName"),fullName:u.get("displayName")};return CoreFamily.dataSourceErrorsController.handleError({title:"CoreFamily.Error.ResendFamilyInvitation.Title".loc(a),description:"CoreFamily.Error.ResendFamilyInvitation.Description".loc(a),shouldExit:NO,response:e}),this._invokeResendInvitationCallback(e,t,n,r,o),YES},_invokeResendInvitationCallback:function(e,t,n,r,i){var s=e.getPath("request.source"),o=s.get("invitation"),u=s.get("target"
);u&&i&&u[i].call(u,o)},resendChildTransferRequest:function(e,t,n,r){var i=CoreFamily.mainStore,s=e.get("storeKey"),o={appleId:e.get("requestedAppleId"),isResend:!0},u=this._createRequest({method:"POST",endpoint:this.BASE_URL+this.SEND_TRANSFER_REQUEST_ENDPOINT,store:i,storeKey:s,body:o,associateWithCurrentCycle:NO,onSuccess:"_resendChildTransferRequestSuccess",onError:"_resendChildTransferRequestError"});u.set("target",t).set("successAction",n).set("errorAction",r).set("childTransferRequest",e),u.send()},_resendChildTransferRequestSuccess:function(e,t,n,r){var i=e.getPath("request.source"),s=i.get("childTransferRequest"),o=i.get("successAction");return SC.debug("Successfully re-sent child transfer request to “%@”",s.get("requestedInformalName")),this._loadFamilyDetails(n,t),this._invokeResendChildTransferRequestCallback(e,t,n,r,o),YES},_resendChildTransferRequestError:function(e,t,n,r){var i=e.getPath("request.source"),s=i.get("childTransferRequest"),o=i.get("errorAction");SC.error("Error re-sending child transfer request to “%@”,  response=%@,  status=%@,  body=%@",s.get("requestedInformalName"),e,e.get("status"),t);var u=n.materializeRecord(r),a={requestedInformalName:s.get("requestedInformalName"),requestedFirstName:s.get("localOrRequestedFirstName"),requestedFullName:s.get("requestedDisplayName")};return CoreFamily.dataSourceErrorsController.handleError({title:"CoreFamily.Error.ResendTransferRequest.Title".loc(a),description:"CoreFamily.Error.ResendTransferRequest.Description".loc(a),shouldExit:NO,response:e}),this._invokeResendChildTransferRequestCallback(e,t,n,r,o),YES
},_invokeResendChildTransferRequestCallback:function(e,t,n,r,i){var s=e.getPath("request.source"),o=s.get("childTransferRequest"),u=s.get("target");u&&i&&u[i].call(u,o)},_createChildAccount:function(e,t,n){var r=this._createRequest({method:"POST",endpoint:this.BASE_URL+this.CREATE_CHILD_ACCOUNT_ENDPOINT,store:e,storeKey:t,body:e.readDataHash(t),onSuccess:"_createChildAccountSuccess",onError:"_createChildAccountError"}),i=e.lastCommitAgentWithParam(t,"nasToken"),s=i&&i.getPath("params.nasToken");return s?r.header("X-Mme-Nas-Qualify",s):CW.fatalError("No NAS token. This is required to create iCloud accounts."),r.send(),YES},_createChildAccountSuccess:function(e,t,n,r){this._loadFamilyDetails(n,t);var i=n.materializeRecord(r);return SC.debug("Successfully added child account “%@”",i.get("informalName")),n.notifyCommitAgents(r,"recordWasCommittedToServer",i),YES},_createChildAccountError:function(e,t,n,r){var i=YES;return this._handleCreateError(i,e,n,r),YES},updateRecord:function(e,t,n){return this._dispatchToProperTypeSpecificMethod("_update",e,t,n,this.DISPATCH_ACTION_UPDATE)},getAction:function(e){console.log("storage info supdate ",e);var t=e.isParticipatingInFamilyStorage,n=Family.MemberAppDetailsController.get("isParticipatingFlagSet"),r=Family.MemberAppDetailsController.get("isPurchaserFlagSet");if(n)return t?"JOIN_FAMILY":"LEAVE_FAMILY_SHARING";if(r){var i=e.isPurchaser;return i?"START_FAMILY_SHARING":"STOP_FAMILY_SHARING"}},_updateStorage:function(e,t,n){var r=e.readDataHash(t),i=this.getAction(r),s=Family.familyController.content.get("familyId"),o=Family.familyController
.getPath("organizer.dsid"),u={action:i,path:"APP_ICLOUD_STORAGE",familyId:s,organizerDsId:o};this._createRequest({method:"POST",endpoint:this.BASE_URL_V2+this.UPDATE_MEMBER_STORAGE,store:e,storeKey:t,body:u,onSuccess:"_updateStorageSuccess",onError:"_updateStorageError"}).send()},_updateStorageSuccess:function(e,t,n,r){return t["status-message"]?(CoreFamily.dataSourceErrorsController.handleError({title:"CoreFamily.Error.UpdateFamily.Title".loc(),description:"CoreFamily.Error.UpdateFamily.Description".loc(),response:e}),YES):(this._loadStorage(n,t),YES)},_updateStorageError:function(e,t,n,r){return CoreFamily.dataSourceErrorsController.handleError({title:"CoreFamily.Error.UpdateFamily.Title".loc(),description:"CoreFamily.Error.UpdateFamily.Description".loc(),response:e}),YES},_updatePurchase:function(e,t,n){var r=e.readDataHash(t),i=Family.familyController.content.get("familyId"),s={enableFlag:r.isEnabled,familyId:i};this._createRequest({method:"POST",endpoint:this.BASE_URL_V2+this.UPDATE_MEMBER_PURCHASE,store:e,storeKey:t,body:s,onSuccess:"_updatePurchaseSuccess",onError:"_updatePurchaseError"}).send()},_updatePurchaseSuccess:function(e,t,n,r){return this._loadPurchase(n,t),YES},_updatePurchaseError:function(e,t,n,r){return CoreFamily.dataSourceErrorsController.handleError({title:"CoreFamily.Error.UpdateFamily.Title".loc(),description:"CoreFamily.Error.UpdateFamily.Description".loc(),response:e}),YES},_updateFamily:function(e,t,n){var r=this._getPreviousData(e,t),i=e.readDataHash(t);return i.organizer!==r.organizer?this._createRequest({method:"POST",endpoint:this.BASE_URL+this
.TRANSFER_FAMILY_ENDPOINT,store:e,storeKey:t,body:e.readDataHash(t),onSuccess:"_updateFamilySuccess",onError:"_updateFamilyError"}).send():SC.warn("We were asked to update the family record, but the organizer did not change"),YES},_updateFamilySuccess:function(e,t,n,r){return this._loadFamilyDetails(n,t),YES},_updateFamilyError:function(e,t,n,r){return CoreFamily.dataSourceErrorsController.handleError({title:"CoreFamily.Error.UpdateFamily.Title".loc(),description:"CoreFamily.Error.UpdateFamily.Description".loc(),response:e}),YES},_updateFamilyMember:function(e,t,n){var r=e.readDataHash(t),i=e.lastCommitAgentWithParam(t,"iTunesTermsVersion");r.iTunesTosVersion=i&&i.getPath("params.iTunesTermsVersion");var s=e.lastCommitAgentWithParam(t,"verificationToken");return r.verificationToken=s&&s.getPath("params.verificationToken"),this._createRequest({method:"POST",endpoint:this.BASE_URL+this.UPDATE_FAMILY_MEMBER_ENDPOINT,store:e,storeKey:t,body:r,onSuccess:"_updateFamilyMemberSuccess",onError:"_updateFamilyMemberError"}).send(),YES},_updateFamilyMemberSuccess:function(e,t,n,r){var i=n.materializeRecord(r);return SC.debug("Successfully updated “%@”",i.get("informalName")),this._loadFamilyDetails(n,t),n.notifyCommitAgents(r,"recordWasCommittedToServer",i),YES},_updateFamilyMemberError:function(e,t,n,r){var i=n.materializeRecord(r),s=i.get("informalName");return CoreFamily.dataSourceErrorsController.handleError({title:"CoreFamily.Error.UpdateFamilyMember.Title".loc({informalName:s}),description:"CoreFamily.Error.UpdateFamilyMember.Description".loc({informalName:s}),response:e,store:n,storeKey
:r}),n.notifyCommitAgents(r,"commitToServerFailed"),YES},_updateIncomingTransferRequest:function(e,t,n){var r=e.readDataHash(t),i=r.isAccepted,s;return i?s=this.BASE_URL+this.ACCEPT_TRANSFER_REQUEST_ENDPOINT:s=this.BASE_URL+this.REJECT_TRANSFER_REQUEST_ENDPOINT,this._createRequest({method:"POST",endpoint:s,store:e,storeKey:t,body:r,onSuccess:"_updateTransferRequestSuccess",onError:"_updateTransferRequestError"}).send(),YES},_updateTransferRequestSuccess:function(e,t,n,r){var i=n.materializeRecord(r),s=i.get("isAccepted")?"accepted":"declined";return SC.debug("Successfully %@ %@’s transfer request for %@",s,i.get("requestorDisplayName"),i.getPath("requestedFamilyMember.displayName")),this._loadFamilyDetails(n,t),n.notifyCommitAgents(r,"recordWasCommittedToServer",i),YES},_updateTransferRequestError:function(e,t,n,r){var i=n.materializeRecord(r),s=i.getPath("requestedFamilyMember.informalName"),o=i.getPath("requestedFamilyMember.firstName"),u=i.getPath("requestedFamilyMember.displayName"),a=i.get("requestorInformalName"),f=i.get("requestorFirstName"),l=i.get("requestorDisplayName");return CoreFamily.dataSourceErrorsController.handleError({title:"CoreFamily.Error.UpdateTransferRequest.Title".loc({requestedInformalName:s,requestedFirstName:o,requestedFullName:u,requestorInformalName:a,requestorFirstName:f,requestorFullName:l}),description:"CoreFamily.Error.UpdateTransferRequest.Description".loc(),response:e,store:n,storeKey:r}),n.notifyCommitAgents(r,"commitToServerFailed"),YES},destroyRecord:function(e,t,n){return this._dispatchToProperTypeSpecificMethod("_destroy",e,t,n,this.DISPATCH_ACTION_DESTROY
)},_destroyFamilyMember:function(e,t,n){var r=this._getPreviousData(e,t);return this._createRequest({method:"POST",endpoint:this.BASE_URL+this.REMOVE_FAMILY_MEMBER_ENDPOINT,store:e,storeKey:t,body:r,onSuccess:"_destroyFamilyMemberSuccess",onError:"_destroyFamilyMemberError"}).send(),YES},_destroyFamilyMemberSuccess:function(e,t,n,r){return SC.debug("Successfully removed family member with storeKey %@",r),this._loadFamilyDetails(n,t),YES},_destroyFamilyMemberError:function(e,t,n,r){var i=n.materializeRecord(r),s=i?i.get("informalName"):undefined;return CoreFamily.dataSourceErrorsController.handleError({title:"CoreFamily.Error.DestroyFamilyMember.Title".loc({informalName:s}),description:"CoreFamily.Error.DestroyFamilyMember.Description".loc({informalName:s}),response:e}),YES},_destroyFamilyInvitation:function(e,t,n){var r=this._getPreviousData(e,t),i={email:r.email,familyId:r.familyId};return r.isFamilyLevelInvite?(console.log("data ",r),this._createRequest({method:"POST",endpoint:this.BASE_URL_V2+this.CANCEL_INVITATION_ENDPOINT_V2,store:e,storeKey:t,body:i,onSuccess:"_destroyFamilyInvitationSuccess",onError:"_destroyFamilyInvitationError"}).send()):(console.log("data ",r),this._createRequest({method:"POST",endpoint:this.BASE_URL+this.CANCEL_INVITATION_ENDPOINT,store:e,storeKey:t,body:i,onSuccess:"_destroyFamilyInvitationSuccessV2",onError:"_destroyFamilyInvitationError"}).send()),YES},_destroyFamilyInvitationSuccess:function(e,t,n,r){return SC.debug("Successfully removed family member with storeKey %@",r),this._loadFamilyDetails(n,t),YES},_destroyFamilyInvitationSuccessV2:function(
e,t,n,r){SC.debug("Successfully removed family member with storeKey %@",r);var i=CW.ReadCycle.create();return this.getFamilyDetails(n,i),YES},_destroyFamilyInvitationError:function(e,t,n,r){var i=n.materializeRecord(r),s=i.get("informalName"),o=i.get("firstName"),u=i.get("displayName");return CoreFamily.dataSourceErrorsController.handleError({title:"CoreFamily.Error.DestroyFamilyInvitation.Title".loc({informalName:s,firstName:o,fullName:u}),description:"CoreFamily.Error.DestroyFamilyInvitation.Description".loc({informalName:s,firstName:o,fullName:u}),response:e}),YES},_destroyOutgoingTransferRequest:function(e,t,n){var r=this._getPreviousData(e,t),i={appleId:r.requestedAppleId};return this._createRequest({method:"POST",endpoint:this.BASE_URL+this.CANCEL_TRANSFER_REQUEST_ENDPOINT,store:e,storeKey:t,body:i,onSuccess:"_destroyOutgoingTransferRequestSuccess",onError:"_destroyOutgoingTransferRequestError"}).send(),YES},_destroyOutgoingTransferRequestSuccess:function(e,t,n,r){return SC.debug("Successfully removed child with storeKey %@",r),this._loadFamilyDetails(n,t),YES},_destroyOutgoingTransferRequestError:function(e,t,n,r){var i=n.materializeRecord(r),s=i.get("requestedInformalName");return requestedFirstName=i.get("requestedFirstName"),requestedDisplayName=i.get("requestedDisplayName"),CoreFamily.dataSourceErrorsController.handleError({title:"CoreFamily.Error.DestroyChildTransferRequest.Title".loc({informalName:s,firstName:requestedFirstName,fullName:requestedDisplayName}),description:"CoreFamily.Error.DestroyChildTransferRequest.Description".loc({informalName:s,firstName:requestedFirstName
,fullName:requestedDisplayName}),response:e}),YES},_getRequestClass:function(){return SC.objectForPropertyPath(this.get("exampleRequest"))},_createRequest:function(e){var t=e.method||"GET",n=t!=="GET",r=e.endpoint,i=e.store,s=e.storeKey,o=e.body,u=e.onSuccess,a=e.onError,f=e.includeEtagCheck,l=e.associateWithCurrentCycle,c;console.log("method ",t),console.log("looksLikeItChangesData ",n),SC.none(f)&&(f=n),SC.none(l)&&(l=n),r||CW.fatalError("You must specify an endpoint",{params:e}),c=this._getRequestClass().create({type:t,address:r,isJSON:YES}),o&&c.set("body",o);var h=this,p,d;u&&(SC.typeOf(u)===SC.T_STRING&&(u=this[u]),p=function(e){return u.call(h,e,e.get("body"),i,s)},c.notify(200,this,p)),d=function(t){t.get("request").set("originalParams",e);if(t.get("status")!==401){var n=CoreFamily.storageManager.get("currentCycle");n&&n.restoreDataToPreCycleCheckpoint(s);var r=SC.Record;if(i&&s){var o=i.peekStatus(s);o&r.BUSY?i.dataSourceDidError(s):o&r.DESTROYED&&i.writeStatus(s,r.READY_CLEAN)}}if(a)return SC.typeOf(a)===SC.T_STRING&&(a=h[a]),a.call(h,t,t.get("body"),i,s)},c.notify(0,this,d),f&&c.header("If-Match",this._getEtag(i,s));if(l){i||CW.fatalError("You cannot associate a request with the current storage cycle unless you provide a store",{request:this});var v=i.getPath("storageManager.currentCycle");v||CW.fatalError("Requested to associate request with the current storage cycle, but there is none",{request:this}),c.set("cycle",v)}return c},_getEtag:function(e,t){t||CW.fatalError("Cannot determine the appropriate etag without a storeKey");var n=e.materializeRecord(t),r;return n
.kindOf(CoreFamily.Family)?r=n.get("etag"):n.kindOf(CoreFamily.FamilyMember)&&(r=n.getPath("family.etag")),r},_loadAppsAndServices:function(e,t){var n=t.dsid;t.memberMusicId||(t.memberMusicId=n+this.MEMBER_MUSIC_FOREIGN_KEY),t.memberPurchaseId||(t.memberPurchaseId=n+this.MEMBER_PURCHASE_FOREIGN_KEY),t.locationId||(t.locationId=n+this.MEMBER_LOCATION_FOREIGN_KEY),t.storageId||(t.storageId=n+this.MEMBER_STORAGE_FOREIGN_KEY);var r=t.appleMusic,i=t.location,s=t.storage,o=t.purchase;r&&this._loadMusic(e,r),i&&this._loadLocation(e,i),s&&this._loadStorage(e,s),o&&this._loadPurchase(e,o)},_loadLocation:function(e,t){var n=SC.objectForPropertyPath(this.get("exampleLocation")),r=e.loadRecord(n,t);CoreFamily.set("location",CoreFamily.managedStore.materializeRecord(r)),this.invokeLast(function(){CW.notificationCenter.postNotification("CoreFamily.DidLoadLocation",e,t)})},_loadStorage:function(e,t){var n=SC.objectForPropertyPath(this.get("exampleStorage")),r=e.loadRecord(n,t);CoreFamily.set("storage",CoreFamily.managedStore.materializeRecord(r))},_loadPurchase:function(e,t){var n=SC.objectForPropertyPath(this.get("examplePurchase")),r=e.loadRecord(n,t),i=CoreFamily.managedStore.materializeRecord(r);console.log("purchaseRecord ",i),CoreFamily.set("purchase",i),this.invokeLast(function(){CW.notificationCenter.postNotification("CoreFamily.DidLoadPurchase",e,i)})},_loadMusic:function(e,t){var n=SC.objectForPropertyPath(this.get("exampleMusic")),r=e.loadRecord(n,t);CoreFamily.set("appleMusic",CoreFamily.managedStore.materializeRecord(r))},_loadFamilyDetails:function(e,t){var n=t.family;n&&this
._loadFamily(e,n);var r=t.familyMembers;if(r){var i=n&&n.organizer;if(i){var s=r.findProperty("dsid",i);s&&(s.paymentMethodId=i+this.PAYMENT_METHOD_FOREIGN_KEY_SUFFIX)}this._loadFamilyMembers(e,r)}var o=t.familyInvitations;o&&this._loadFamilyInvitations(e,o);var u=t.transferRequests;u&&this._loadIncomingTransferRequests(e,u);var a=t.outgoingTransferRequests;a&&this._loadOutgoingTransferRequests(e,a)},_loadFamily:function(e,t){var n=SC.objectForPropertyPath(this.get("exampleFamily")),r=e.loadRecord(n,t),i=CoreFamily.managedStore.materializeRecord(r);this._garbageCollectStaleRecords(e,n,[r]),CoreFamily.set("currentFamily",i),this.invokeLast(function(){CW.notificationCenter.postNotification("CoreFamily.DidLoadFamily",e,i)})},_loadFamilyMembers:function(e,t){var n=SC.objectForPropertyPath(this.get("exampleFamilyMember")),r=e.loadRecords(n,SC.A(t));console.log("exampleFamilyMember ",n),this._garbageCollectStaleRecords(e,n,r);var i=CoreFamily.get("currentUserDSID");console.log("currentUserDSID ",i),i&&(console.log("setting loggedInFamilyMember ",CoreFamily.managedStore.find(n,i)),CoreFamily.set("loggedInFamilyMember",CoreFamily.managedStore.find(n,i)))},_loadFamilyInvitations:function(e,t){var n=SC.objectForPropertyPath(this.get("exampleFamilyInvitation")),r=e.loadRecords(n,SC.A(t));this._garbageCollectStaleRecords(e,n,r)},_loadIncomingTransferRequests:function(e,t){var n=SC.objectForPropertyPath(this.get("exampleIncomingTransferRequest")),r=e.loadRecords(n,SC.A(t));this._garbageCollectStaleRecords(e,n,r)},_loadOutgoingTransferRequests:function(e,t){var n=SC.objectForPropertyPath(
this.get("exampleOutgoingTransferRequest")),r=e.loadRecords(n,SC.A(t));this._garbageCollectStaleRecords(e,n,r)},_stringifyRecordTypeForStoreKey:function(e,t){var n=e.recordTypeFor(t);n||CW.fatalError("Could not determine record type",{store:e,storeKey:t,params:params});if(n.kindOf(CoreFamily.FamilyMember))return"FamilyMember";if(n.kindOf(CoreFamily.FamilyInvitation))return"FamilyInvitation";if(n.kindOf(CoreFamily.ChildAccount))return"ChildAccount";if(n.kindOf(CoreFamily.Family))return"Family";if(n.kindOf(CoreFamily.PaymentMethod))return"PaymentMethod";if(n.kindOf(CoreFamily.IncomingTransferRequest))return"IncomingTransferRequest";if(n.kindOf(CoreFamily.OutgoingTransferRequest))return"OutgoingTransferRequest";if(n.kindOf(CoreFamily.MemberMusic))return"appleMusic";if(n.kindOf(CoreFamily.MemberStorage))return"Storage";if(n.kindOf(CoreFamily.MemberPurchase))return"Purchase";if(n.kindOf(CoreFamily.MemberLocation))return"location"},_dispatchToProperTypeSpecificMethod:function(e,t,n,r,i){var s=this._stringifyRecordTypeForStoreKey(t,n);if(s){var o=e+s,u=this[o];if(u)return i===this.DISPATCH_ACTION_DESTROY?t.dataSourceDidDestroy(n):i===this.DISPATCH_ACTION_UPDATE&&t.dataSourceDidComplete(n),u.call(this,t,n,r)}return NO},_getPreviousData:function(e,t){e||CW.fatalError("_getPreviousData():  You must specify a store"),t||CW.fatalError("_getPreviousData():  You must specify a storeKey");var n=e.getPath("storageManager.currentCycle");return n||CW.fatalError("_getPreviousData():  We are not in a commit cycle"),n.dataHashesCheckpointBeforeCycle[t]},_garbageCollectStaleRecords:function(e,t,n
){var r=CW.invertArray(n),i=e.find(t).reload(),s=i.get("storeKeys"),o,u,a;for(o=0,u=s.get("length");o<u;++o)a=s.objectAt(o),r[a]||(SC.debug("Garbage-collecting record %@…",e.materializeRecord(a)),e.pushDestroy(null,null,a));i.destroy()},_handleCreateError:function(e,t,n,r){var i=n.materializeRecord(r),s={informalName:i.get("informalName"),firstName:i.get("firstName"),fullName:i.get("displayName")},o="CoreFamily.Error.Create"+this._stringifyRecordTypeForStoreKey(n,r),u=(o+".Title").loc(s),a=(o+".Description").loc(s);CoreFamily.dataSourceErrorsController.handleError({title:u,description:a,shouldExit:e,response:t}),t.get("status")!==401&&n.notifyCommitAgents(r,"commitToServerFailed")}}),CoreFamily.ManagedNestedStore=CW.ManagedNestedStore.extend({automaticallyCommitRecords:YES,dataHashDidChange:function(e,t,n,r){var i=arguments.callee.base.apply(this,arguments);return this.get("automaticallyCommitRecords")&&this.get("hasChanges")&&this.invokeLast("commitChanges"),i}}),CoreFamily.CommitCycle=CW.CommitCycle.extend({determineChangelog:function(e){var t=SC.Set.create(),n=e.changelog,r=n?n.get("firstObject"):null;return r&&t.add(r),t}}),CW.StorageCycle.prototype.advanceToNextStage=function(){if(this._hasEnded)return;if(this.getPath("storageManager.cyclesAreSuspended")){SC.debug("Did not advance to the next stage because cycles are currently suspended.");return}var e=CW.StorageCycle,t=this.constructor.stages,n=this.get("currentStageIndex"),r;SC.none(n)?r=0:r=n+1,r>=t.length?this.end():(this.get("extendedLogging")&&SC.debug("Transitioning ongoing %@ cycle from '%@' to '%@' stage…",this
.get("type"),this.get("currentStage"),t[r]),this.set("currentStageIndex",r),this.currentStageDidChange())},CW.StorageCycle.registerClassForCycleType(CW.StorageCycle.COMMIT_CYCLE,CoreFamily.CommitCycle),CoreFamily.ChildAccount=SC.Record.extend({primaryKey:"appleId",appleId:SC.Record.attr(String),password:SC.Record.attr(String),firstName:SC.Record.attr(String),lastName:SC.Record.attr(String),birthday:SC.Record.attr(String),question1:SC.Record.attr(Number,{key:"securityQuestionSelector1"}),question1Answer:SC.Record.attr(String,{key:"securityAnswerField1"}),question2:SC.Record.attr(Number,{key:"securityQuestionSelector2"}),question2Answer:SC.Record.attr(String,{key:"securityAnswerField2"}),question3:SC.Record.attr(Number,{key:"securityQuestionSelector3"}),question3Answer:SC.Record.attr(String,{key:"securityAnswerField3"}),termsVersion:SC.Record.attr(String,{key:"tosVersion"}),verificationToken:SC.Record.attr(Number,{key:"securityToken"}),askToBuy:SC.Record.attr(Boolean,{defaultValue:!0}),shareMyLocationEnabledDefault:SC.Record.attr(Boolean),displayName:function(){var e=this.get("firstName"),t=this.get("lastName"),n=this.get("appleId");return CoreFamily.displayNameFor(e,t,n)}.property("appleId","firstName","lastName").cacheable(),informalName:function(){var e=this.get("firstName"),t=this.get("lastName");return CoreFamily.informalNameFor(e,t)}.property("appleId","firstName","lastName").cacheable()}),CoreFamily.Family=SC.Record.extend({primaryKey:"familyId",familyId:SC.Record.attr(String),organizer:SC.Record.toOne("CoreFamily.FamilyMember"),members:SC.Record.toMany("CoreFamily.FamilyMember"
,{inverse:"family",isMaster:NO}),invitations:SC.Record.toMany("CoreFamily.FamilyInvitation",{inverse:"family",isMaster:NO})}),CoreFamily.FamilyInvitation=SC.Record.extend({primaryKey:"email",email:SC.Record.attr(String),membershipStatus:SC.Record.attr(String),hasAskToBuyEnabled:SC.Record.attr(Boolean),family:SC.Record.toOne("CoreFamily.Family",{key:"familyId",inverse:"invitations",isMaster:YES}),nickname:null,displayName:function(){return this.get("email")}.property("email").cacheable(),informalName:function(){return this.get("displayName")}.property("displayName").cacheable(),isOutstanding:function(){return this.get("membershipStatus")===this.constructor.INVITATION_SENT}.property("membershipStatus").cacheable(),isRejected:function(){return this.get("membershipStatus")===this.constructor.INVITATION_REJECTED}.property("membershipStatus").cacheable(),hasExpired:function(){return this.get("membershipStatus")===this.constructor.INVITATION_EXPIRED}.property("membershipStatus").cacheable()}),CoreFamily.FamilyInvitation.mixin({INVITATION_SENT:"INVITE_SENT",INVITATION_EXPIRED:"INVITE_EXPIRED",INVITATION_REJECTED:"INVITE_REJECTED"}),CoreFamily.FamilyMember=SC.Record.extend({primaryKey:"dsid",dsid:SC.Record.attr(String),appleId:SC.Record.attr(String),password:SC.Record.attr(String),family:SC.Record.toOne("CoreFamily.Family",{key:"familyId",inverse:"members",isMaster:YES}),firstName:SC.Record.attr(String),lastName:SC.Record.attr(String),age:SC.Record.attr(Number),ageInMonths:SC.Record.attr(Number),ageClassification:SC.Record.attr(String),hasAskToBuyEnabled:SC.Record.attr(Boolean),hasRestrictionsEnabled
:SC.Record.attr(Boolean),hasParentalPrivileges:SC.Record.attr(Boolean),hasSharePurchasesEnabled:SC.Record.attr(Boolean),shareMyLocationEnabledDefault:SC.Record.attr(Boolean),originalInvitationEmail:SC.Record.attr(String),dsidForPurchases:SC.Record.attr(String),appleIdForPurchases:SC.Record.attr(String),appleIdForPurchasesPassword:SC.Record.attr(String),paymentMethod:SC.Record.toOne("CoreFamily.PaymentMethod",{key:"paymentMethodId"}),nickname:null,displayName:function(){var e=this.get("firstName"),t=this.get("lastName"),n=this.get("appleId");return CoreFamily.displayNameFor(e,t,n)}.property("firstName","lastName","appleId"),informalName:function(){return this.get("nickname")||this.get("firstName")||this.get("displayName")}.property("nickname","firstName","displayName").cacheable(),displayAppleId:function(){return this.get("appleId")}.property("appleId"),isAdult:function(){var e=this.get("ageClassification");return e?e.toLowerCase()==="adult":!1}.property("ageClassification"),isChild:function(){var e=this.get("ageClassification");return e?e.toLowerCase()==="child":!0}.property("ageClassification"),isOrganizer:function(){return this.get("dsid")===this.getPath("family.organizer.dsid")}.property("dsid","family"),isBothMeAndOrganizer:function(){return this.get("isMe")&&this.get("isOrganizer")}.property("isMe","isOrganizer"),hasParentalPrivilegesDidChange:function(){this.get("hasParentalPrivileges")&&this.setIfChanged("hasAskToBuyEnabled",!1)}.observes("hasParentalPrivileges")}),CoreFamily.IncomingTransferRequest=SC.Record.extend({primaryKey:"requestId",requestId:SC.Record.attr(String
),requestorAppleId:SC.Record.attr(String),requestorFirstName:SC.Record.attr(String),requestorLastName:SC.Record.attr(String),requestedFamilyMember:SC.Record.toOne("CoreFamily.FamilyMember",{key:"familyMemberDSID"}),isAccepted:SC.Record.attr(Boolean),requestorDisplayName:function(){var e=this.get("requestorFirstName"),t=this.get("requestorLastName"),n=this.get("requestorAppleId");return CoreFamily.displayNameFor(e,t,n)}.property("requestorFirstName","requestorLastName","requestorAppleId"),requestorInformalName:function(){var e=this.get("requestorFirstName"),t=this.get("requestorLastName");return CoreFamily.informalNameFor(e,t)}.property("requestorFirstName","requestorLastName").cacheable()}),CoreFamily.MemberAppsAndServices=SC.Record.extend({primaryKey:"dsid",dsid:SC.Record.attr(String),appleMusic:SC.Record.toOne("CoreFamily.MemberMusic",{inverse:"memberMusic",isMaster:NO}),storage:SC.Record.toOne("CoreFamily.memberStorageInfo",{inverse:"memberStorage",isMaster:NO}),purchase:SC.Record.toOne("CoreFamily.MemberPurchase",{inverse:"memberPurchase",isMaster:NO}),location:SC.Record.toOne("CoreFamily.MemberLocation",{inverse:"memberLocation",isMaster:NO})}),CoreFamily.MemberLocation=SC.Record.extend({primaryKey:"locationId",sharingDeviceName:SC.Record.attr(String),isEnabled:SC.Record.attr(Boolean),isLocationSharingEnabled:SC.Record.attr(Boolean),membersList:SC.Record.attr(Array),memberLocation:SC.Record.toOne("CoreFamily.MemberAppsAndServices",{key:"dsid",inverse:"location",isMaster:YES}),error:SC.Record.attr(Boolean)}),CoreFamily.MemberMusic=SC.Record.extend({primaryKey:"memberMusicId"
,memberMusicId:SC.Record.attr(String),isEnabled:SC.Record.attr(Boolean),subscriptionType:SC.Record.attr(String),renewalDate:SC.Record.attr(String),subscriptionCharges:SC.Record.attr(String),ownerFirstName:SC.Record.attr(String),ownerLastName:SC.Record.attr(String),ownerFullName:SC.Record.attr(String),error:SC.Record.attr(Boolean),isOwner:SC.Record.attr(Boolean),memberMusic:SC.Record.toOne("CoreFamily.MemberAppsAndServices",{key:"dsid",inverse:"appleMusic",isMaster:YES}),getIsEnabled:function(){return this.get("isEnabled")},getSubscriptionType:function(){return this.get("subscriptionType")},getRenews:function(){return this.get("renews")},getRenewalData:function(){return this.get("renewalDate")},getSusbscriptionCharges:function(){return this.get("subscriptionCharges")},getOwnerFirstName:function(){return this.get("ownerFirstName")},getOwnerFullName:function(){return this.get("ownerFullName")},getOwnerLastName:function(){return this.get("ownerLastName")}}),CoreFamily.MemberPurchase=SC.Record.extend({primaryKey:"memberPurchaseId",memberPurchaseId:SC.Record.attr(String),isEnabled:SC.Record.attr(Boolean),isSharingPurchasesWithFamily:SC.Record.attr(Boolean),appleIdForPurchases:SC.Record.attr(String),isPurchaseUser:SC.Record.attr(Boolean),memberPurchase:SC.Record.toOne("CoreFamily.MemberAppsAndServices",{key:"dsid",inverse:"purchase",isMaster:YES}),error:SC.Record.attr(Boolean)}),CoreFamily.MemberStorage=SC.Record.extend({primaryKey:"storageId",storageId:SC.Record.attr(String),storageInBytes:SC.Record.attr(Number),storagePrice:SC.Record.attr(String),usedStorageInBytes:SC.Record.attr
(Number),currentCommercePlan:SC.Record.attr(Number),storageRenewalDate:SC.Record.attr(String),isEnabled:SC.Record.attr(Boolean),isPurchaser:SC.Record.attr(Boolean),familyStorageAvailable:SC.Record.attr(Boolean),isParticipatingInFamilyStorage:SC.Record.attr(Boolean),memberStorage:SC.Record.attr(Array),error:SC.Record.attr(Boolean),memberStorageInfo:SC.Record.toOne("CoreFamily.MemberAppsAndServices",{key:"dsid",inverse:"storage",isMaster:YES}),getStorageInGB:function(){var e=this.get("storageInBytes");return e},getStoragePrice:function(){return this.get("storagePrice")},getUsedStorage:function(){return this.get("usedStorageInBytes")},getStorageRenewalDate:function(){return this.get("storageRenewalDate")},getIsEnabled:function(){return this.get("isEnabled")},getIsPurchaser:function(){return this.get("isPurchaser")},getIsFamilyStorageAvailable:function(){return this.get("familyStorageAvailable")}}),CoreFamily.OutgoingTransferRequest=SC.Record.extend({primaryKey:"requestedAppleId",requestedAppleId:SC.Record.attr(String),requestedFirstName:SC.Record.attr(String),requestedLastName:SC.Record.attr(String),familyId:SC.Record.attr(String),membershipStatus:SC.Record.attr(String),hasAskToBuyEnabled:SC.Record.attr(Boolean),requestedDisplayName:function(){var e=this.get("requestedFirstName"),t=this.get("requestedLastName"),n=this.get("requestedAppleId");return CoreFamily.displayNameFor(e,t,n)}.property("requestedFirstName","requestedLastName","requestedAppleId"),requestedInformalName:function(){var e=this.get("requestedFirstName"),t=this.get("requestedLastName");return CoreFamily.informalNameFor
(e,t)}.property("requestedFirstName","requestedLastName").cacheable(),isOutstanding:function(){return this.get("membershipStatus")===this.constructor.CHILD_TRANSFER_SENT}.property("membershipStatus").cacheable(),isRejected:function(){return this.get("membershipStatus")===this.constructor.CHILD_TRANSFER_REJECTED}.property("membershipStatus").cacheable(),hasTransferExpired:function(){return this.get("membershipStatus")===this.constructor.CHILD_TRANSFER_EXPIRED}.property("membershipStatus").cacheable()}),CoreFamily.OutgoingTransferRequest.mixin({CHILD_TRANSFER_SENT:"CHILD_TRANSFER_SENT",CHILD_TRANSFER_EXPIRED:"CHILD_TRANSFER_EXPIRED",CHILD_TRANSFER_REJECTED:"CHILD_TRANSFER_REJECTED"}),CoreFamily.PaymentMethod=CW.Record.extend({primaryKey:"paymentMethodId",paymentMethodId:SC.Record.attr(String),creditCardId:SC.Record.attr(String),creditCardType:SC.Record.attr(String),lastFourDigits:SC.Record.attr(String,{key:"creditCardLastFourDigits"}),verificationType:SC.Record.attr(String),smsPhoneNumber:SC.Record.attr(String),billingType:SC.Record.attr(String),creditCardImageUrl:SC.Record.attr(String)}),CoreFamily.statechart=SC.Statechart.create({rootState:SC.State.design({initialSubstate:"waitingForInitialData",waitingForInitialData:SC.State.design({enterState:function(){if(CoreFamily.get("prefetchFamilyDetails")){CoreFamily.get("storageManager").suspendCycles(),CW.notificationCenter.subscribeToNotification("CoreFamily.DidLoadFamily",this.get("statechart"),"initialDataHasLoaded");var e=CoreFamily.get("mainStore"),t=e.get("dataSource");t.getFamilyDetails(e)}else this.gotoState("readyToUse")}
,initialDataHasLoaded:function(){return this.gotoState("readyToUse"),YES}}),readyToUse:SC.State.design({enterState:function(){CoreFamily.get("storageManager").resumeCycles()}}),couldNotLoadInitialData:SC.State.design({})}),initialDataHasLoaded:function(){this.sendEvent("initialDataHasLoaded")}}),window.CreateFamily=SC.Application.create({NAMESPACE:"CreateFamily",VERSION:"1.0.0",run:function(){CoreFamily.set("errorDelegate",CM.errorDelegate),CM.nativeClientController.webClientHasLoaded(),CM.currentUser.prefetchPhotoData();var e=CreateFamily.statechart;e.initStatechart()}}),CreateFamily.UpdateWorkflowValue=AssemblyLine.WorkflowAction.design({action:function(){var e=this.getPath("parentState.parentState.form");e||CW.fatalError("No form found:",this),CreateFamily.workflowController.updateSubject(e.get("value"))}}),CreateFamily.FormAction=AssemblyLine.FormAction.design({postActions:[CreateFamily.UpdateWorkflowValue]}),CreateFamily.SubmitiTunesAccount=AssemblyLine.WorkflowAction.extend({VALIDATE_ITUNES_ACCOUNT_URL:"https://setup.icloud.com/setup/mac/family/validateiTunesAccount",isSynchronous:!1,action:function(){var e=CreateFamily.workflowController.get("subject");if(CM.configurationController.isAuthKitEnabled){var t=this;CM.nativeClientController.showSpinner();var n={username:e.organizerAppleIdForPurchases,password:e.organizerAppleIdForPurchasesPassword,title:"",message:"",defaultButtonTitle:"CreateFamily.MacOSX.Buttons.Continue".loc(),cancelButtonTitle:"CreateFamily.MacOSX.Buttons.Cancel".loc(),shouldPromptForPasswordOnly:!1,isEphemeral:!0,callback:function(n){if(n)if(n.authenticateUserResults
){var r=n.authenticateUserResults,i={appleIdForPurchasesPassword:r.AKPassword};i.appleIdForPurchases=e.organizerAppleIdForPurchases;var s=CM.Request.create({type:"POST",address:t.VALIDATE_ITUNES_ACCOUNT_URL,isJSON:YES,body:i});s.notify(200,t,t._didSubmitiTunesAccount),s.notify(0,t,t._didNotSubmitiTunesAccount),s.send()}else if(n.authenticateUserErrorCode){CM.nativeClientController.hideSpinner();var o=n.authenticateUserErrorCode;o===-7006?CM.nativeClientController.showAlert({messageText:"CreateFamily.Errors.Wrong.Password.Title".loc(),informativeText:"CreateFamily.Errors.Wrong.Password.Description".loc(),buttons:[{title:"CreateFamily.MacOSX.Buttons.OK".loc(),action:function(){CreateFamily.statechart.sendEvent("restartAction")}}]}):CreateFamily.statechart.sendEvent("fatalError")}else CreateFamily.statechart.sendEvent("fatalError");else CreateFamily.statechart.sendEvent("fatalError")}};CM.nativeClientController.authenticateUser(n)}else{var r=CM.Request.create({type:"POST",address:this.VALIDATE_ITUNES_ACCOUNT_URL,isJSON:YES,body:{appleIdForPurchases:e.organizerAppleIdForPurchases,appleIdForPurchasesPassword:e.organizerAppleIdForPurchasesPassword}});r.notify(200,this,this._didSubmitiTunesAccount),r.notify(0,this,this._didNotSubmitiTunesAccount),CM.nativeClientController.showSpinner(),r.send()}},_didSubmitiTunesAccount:function(e){var t=e.get("body");return t.isAuthenticated?(this._didAuthenicateiTunesAccount(t.isValidAccount,t.needsUpdatedTerms),CreateFamily.statechart.sendEvent("actionCompleted")):(CM.nativeClientController.showAlert({messageText:"CreateFamily.Error.iTunesAccount.Invalid.Title"
,buttons:[{title:"CreateFamily.MacOSX.Buttons.OK".loc()}]}),CreateFamily.statechart.gotoState(this.getPath("parentState.parentState"))),CM.nativeClientController.hideSpinner(),YES},_didAuthenicateiTunesAccount:function(e,t){CreateFamily.workflowController.updateSubject({isValidiTunesAccount:e,needsUpdatediTunesTerms:t})},_didNotSubmitiTunesAccount:function(){CM.nativeClientController.showAlert({messageText:"CreateFamily.MacOSX.Errors.iTunesAccount.Title".loc(),informativeText:"CreateFamily.MacOSX.Errors.iTunesAccount.Description".loc(),buttons:[{title:"CoreFamily.Button.OK".loc(),action:function(){CreateFamily.statechart.sendEvent("restartAction")}}]}),CM.nativeClientController.hideSpinner()}}),CreateFamily.ShowAuthorizePurchases=CreateFamily.FormAction.design({postActions:[CreateFamily.SubmitiTunesAccount],init:function(){var e=arguments.callee.base.apply(this,arguments);return e},actionReversed:function(){var e=this.get("form");return arguments.callee.base.apply(this,arguments)},form:"CreateFamily.AuthorizePurchasesForm"}),CreateFamily.ShowConfirmAccount=CreateFamily.FormAction.design({form:"CreateFamily.ConfirmAccountForm"}),CreateFamily.GetiTunesPaymentInfo=AssemblyLine.WorkflowAction.extend({isSynchronous:!1,action:function(){CW.notificationCenter.subscribeToNotification("CoreFamily.DidLoadiTunesPaymentInfo",this,"didLoadPaymentInfo"),CW.notificationCenter.subscribeToNotification("CoreFamily.CouldNotLoadiTunesPaymentInfo",this,"didNotLoadPaymentInfo");var e=CoreFamily.mainStore,t=e.get("dataSource"),n=CreateFamily.workflowController.get("subject");t.getiTunesPaymentInfo
({organizerAppleIdForPurchases:n.organizerAppleIdForPurchases,organizerAppleIdForPurchasesPassword:n.organizerAppleIdForPurchasesPassword,userAction:"CREATING_FAMILY"}),CM.nativeClientController.showSpinner()},didLoadPaymentInfo:function(e){CreateFamily.workflowController.updateSubject(e),CreateFamily.statechart.sendEvent("actionCompleted"),CM.nativeClientController.hideSpinner()},didNotLoadPaymentInfo:function(e){CreateFamily.statechart.sendEvent("actionReversed"),CreateFamily.statechart.sendEvent("actionReversed"),CM.nativeClientController.hideSpinner()}}),CreateFamily.ShowConfirmAuthorizePurchases=AssemblyLine.FormAction.design({preActions:[CreateFamily.GetiTunesPaymentInfo],form:"CreateFamily.ConfirmAuthorizePurchasesForm"}),CreateFamily.ShowIntroduction=AssemblyLine.FormAction.design({form:"CreateFamily.IntroductionForm"}),CreateFamily.GetiTunesTerms=AssemblyLine.WorkflowAction.extend({TERMS_URL:"https://setup.icloud.com/setup/tos?tosType=iTunes",isSynchronous:!1,shouldPerform:function(){return!CreateFamily.workflowController.getPath("subject.iTunesTerms")},action:function(){var e=CM.Request.create({type:"POST",address:this.TERMS_URL,isJSON:YES,body:{country:navigator.language,under13:NO}});e.notify(200,this,this.didLoadTerms),e.notify(0,this,this.didNotLoadTerms),CM.nativeClientController.showSpinner(),e.send()},didLoadTerms:function(e){var t=e.get("body"),n=t.tosObjects[0],r=this._decode;return n.title=r(n.title),n.summary=r(n.summary),n.content=r(n.content),CreateFamily.workflowController.updateSubject({iTunesTermsVersion:n.version,iTunesTerms:n}),CreateFamily.statechart
.sendEvent("actionCompleted"),CM.nativeClientController.hideSpinner(),YES},didNotLoadTerms:function(){CreateFamily.statechart.sendEvent("fatalError"),CM.nativeClientController.hideSpinner()},_decode:function(e){return decodeURIComponent(escape(atob(e.replace(/\s/gi,""))))}}),CreateFamily.ShowiTunesTerms=AssemblyLine.FormAction.design({preActions:[CreateFamily.GetiTunesTerms],form:"CreateFamily.iTunesTermsForm"}),CreateFamily.ShareMyLocation=CreateFamily.FormAction.design({form:"CreateFamily.ShareMyLocationForm"}),CreateFamily.SharePurchases=CreateFamily.FormAction.design({postActions:[CreateFamily.SubmitiTunesAccount],form:"CreateFamily.SharePurchasesForm"}),CreateFamily.CheckEligibility=AssemblyLine.WorkflowAction.extend({CHECK_ELIGIBILITY_URL:"https://setup.icloud.com/setup/mac/family/checkEligibility",isSynchronous:!1,action:function(){var e=CM.Request.create({type:"POST",address:this.CHECK_ELIGIBILITY_URL,isJSON:YES});e.notify(0,this,this._didReceiveResponse),CM.nativeClientController.showSpinner(),e.send()},_didReceiveResponse:function(e){var t=e.get("body");return t&&t.isEligible?this._didPassEligibility():this._didNotPassEligibility(t.reasons,e),YES},_didPassEligibility:function(){return CreateFamily.statechart.sendEvent("actionCompleted"),CM.nativeClientController.hideSpinner(),YES},_didNotPassEligibility:function(e,t){var n=["MEMBER_OF_ANOTHER_FAMILY","PAYMENT_ACCOUNT_ANOTHER_FAMILY","AGE_RESTRICTED","NO_AGE_ON_RECORD","FAMILY_LIMIT_PER_YEAR_HIT"],r="CreateFamily.Error.CheckEligibility.",i;if(e)for(var s=0,o=e.length;s<o;s++){var u=e[s];if(n.indexOf(u)>-1){i=r+u;break}
SC.info("Unknown ineligibility constant: `%@`",u)}i||(i=r+"UNKNOWN_REASON");var a=CM.nativeClientController.getAppleId();return CoreFamily.dataSourceErrorsController.handleError({title:(i+".Title").loc(),description:(i+".Description").loc({appleId:a}),response:t,shouldExit:YES}),CM.nativeClientController.hideSpinner(),YES}}),CreateFamily.SubmitFamily=AssemblyLine.WorkflowAction.extend({isSynchronous:!1,action:function(){var e=CoreFamily.mainStore,t=e.get("dataSource"),n=CreateFamily.workflowController.get("subject");CW.notificationCenter.subscribeToNotification("CoreFamily.DidLoadFamily",this,"didSubmitFamily"),CM.nativeClientController.showSpinner(),t.createFamily(e,{organizerAppleId:n.organizerAppleId,organizerAppleIdForPurchases:n.organizerAppleIdForPurchases,organizerAppleIdForPurchasesPassword:n.organizerAppleIdForPurchasesPassword,organizerShareMyLocationEnabledDefault:n.organizerShareMyLocationEnabledDefault,iTunesTosVersion:n.iTunesTermsVersion,organizerShareMyPurchasesEnabledDefault:n.organizerShareMyPurchasesEnabledDefault})},didSubmitFamily:function(){CreateFamily.statechart.sendEvent("actionCompleted"),CM.nativeClientController.hideSpinner()}}),CreateFamily.SubmitFamilyV2=AssemblyLine.WorkflowAction.extend({isSynchronous:!1,action:function(){var e=CoreFamily.mainStore,t=e.get("dataSource"),n=CreateFamily.workflowController.get("subject");CW.notificationCenter.subscribeToNotification("CoreFamily.DidCreateFamily",this,"didSubmitFamily"),CM.nativeClientController.showSpinner(),t.createFamilyV2(e,{organizerAppleId:n.organizerAppleId,organizerAppleIdForPurchases:n.organizerAppleIdForPurchases
,organizerAppleIdForPurchasesPassword:n.organizerAppleIdForPurchasesPassword,organizerShareMyLocationEnabledDefault:n.organizerShareMyLocationEnabledDefault,iTunesTosVersion:n.iTunesTermsVersion,organizerShareMyPurchasesEnabledDefault:n.organizerShareMyPurchasesEnabledDefault})},didSubmitFamily:function(){CreateFamily.statechart.sendEvent("actionCompleted"),CM.nativeClientController.hideSpinner()}}),CreateFamily.AuthorizePurchases=CreateFamily.FormAction.design({postActions:[CreateFamily.SubmitiTunesAccount],init:function(){var e=arguments.callee.base.apply(this,arguments);return e},actionReversed:function(){var e=this.get("form");return arguments.callee.base.apply(this,arguments)},form:"CreateFamily.NewAuthorizePurchasesForm"}),CreateFamily.ShowConfirmAuthorizePurchasesNew=AssemblyLine.FormAction.design({preActions:[CreateFamily.GetiTunesPaymentInfo],form:"CreateFamily.ConfirmAuthorizePurchasesFormNew"}),CreateFamily.Introduction=AssemblyLine.FormAction.design({form:"CreateFamily.NewIntroductionForm"}),CreateFamily.ShareLocation=CreateFamily.FormAction.design({form:"CreateFamily.ShareLocationForm"}),CreateFamily.NewSharePurchases=CreateFamily.FormAction.design({postActions:[CreateFamily.SubmitiTunesAccount],form:"CreateFamily.NewSharePurchasesForm"}),CreateFamily.errorController=WorkflowKit.ErrorController.create({loadErrors:function(e){this.resetErrors();var t=this._fieldNamesToFields,n;for(var r in e){var i=t[r];n||(n=i.get("form"));var s=e[r];this._renderError(i,s.message,s.targetParent,s.targetBeforeView)}if(n){var o=n.get("workflowAction");CreateFamily.statechart.gotoState
(o)}},_generateErrorLabel:function(e){return CreateFamily.ErrorLabelView.create({text:e})}}),CreateFamily.validateController=SC.Object.create({validate:function(e){this._errors=null;var t=e&&e.constructor.toString().split(".")[1],n=this["_validate"+t];return n&&n.call(this,e),this._errors},_recordErrorMessage:function(e,t,n,r){var i=this._errors;i||(i=this._errors={}),i[e.get("fieldName")]||(i[e.get("fieldName")]={message:t,targetBeforeView:r,targetParent:n})}}),CreateFamily.workflowController=SC.Object.create({load:function(e){this.notifyPropertyChange("updateImage"),this.set("subject",e)},subject:null,updateSubject:function(e){var t=this.get("subject");t||CW.fatalError("No subject set on the workflow controller");var n=SC.typeOf(t);n===SC.T_HASH?(SC.mixin(t,e),this.get("triggerPaymentChanged")?this.set("triggerPaymentChanged",!1):this.set("triggerPaymentChanged",!0),this.get("updateImage")?this.set("updateImage",!1):this.set("updateImage",!0),this.notifyPropertyChange("updateImage"),this.notifyPropertyChange("subject")):(t.set(e),this.get("updateImage")?this.set("updateImage",!1):this.set("updateImage",!0),this.notifyPropertyChange("updateImage"),this.notifyPropertyChange("subject"))},triggerPaymentChanged:!1,useDifferentAccount:!1,updateImage:!1,isNotCarrierBilling:function(){return"CBXX"!==CreateFamily.workflowController.subject.creditCardId?!0:!1}.property()}),CreateFamily.Constants=SC.Object.create({SMS_VERIFICATION_TYPE:"sms",CVV_VERIFICATION_TYPE:"cvv",CARD_BILLING_TYPE:"Card",CARRIER_BILLING_TYPE:"Carrier"}),CreateFamily.FamilyDataSource=CoreFamily.FamilyDataSource.
extend({exampleRequest:"CM.Request"}),CreateFamily.CompleteButton=WorkflowKit.Button.extend({type:"default",isEnabledBinding:SC.Binding.oneWay("*form.isValid"),title:"CreateFamily.MacOSX.Buttons.Continue".loc(),callback:function(){CreateFamily.statechart.sendEvent("actionCompleted")}}),CreateFamily.validationCompleteButton=WorkflowKit.Button.extend({type:"default",isEnabledBinding:SC.Binding.oneWay("*form.isValid"),title:"CreateFamily.MacOSX.Buttons.Continue".loc(),callback:function(){var e=CreateFamily.validateController.validate(this.get("form"));e?CreateFamily.errorController.loadErrors(e):CreateFamily.statechart.sendEvent("actionCompleted")}}),CreateFamily.BackButton=WorkflowKit.Button.extend({title:"CreateFamily.MacOSX.Buttons.Back".loc(),callback:function(){CreateFamily.statechart.sendEvent("actionReversed")}}),CreateFamily.CancelButton=WorkflowKit.Button.extend({title:"CreateFamily.MacOSX.Buttons.Cancel".loc(),type:"cancel",callback:function(){CreateFamily.statechart.sendEvent("userWantsToCancel")}}),CreateFamily.ErrorLabelView=CM.LabelView.extend({classNames:["error-label"],hasError:YES,_hasErrorDidChange:function(){this.get("hasError")===NO&&this.removeFromParent()}.observes("hasError")}),CreateFamily.FormView=WorkflowKit.FormView.extend({init:function(){var e=arguments.callee.base.apply(this,arguments),t=SC.clone(this.get("fields"));return CreateFamily.errorController.registerFields(t),e}}),CreateFamily.AuthorizePurchasesForm=CreateFamily.FormView.extend({classNames:["authorize-purchases-form"],title:function(){return"CreateFamily.MacOSX.Forms.AuthorizePurchases.Title"
.loc({appleId:CM.nativeClientController.getAppleId()})}.property(),content:CM.View.extend({childViews:["body","appleId","useOtherAccountButton"],body:CM.TextView.extend({text:function(){return"CreateFamily.MacOSX.Forms.AuthorizePurchases.Description".loc({appleId:CM.nativeClientController.getAppleId()})}.property()}),appleId:CM.FieldView.extend({fieldName:"organizerAppleIdForPurchases",value:CM.nativeClientController.getAppleId()}),useOtherAccountButton:CM.ButtonView.extend({value:"CreateFamily.MacOSX.Buttons.UseDifferentAccount".loc(),action:function(){CreateFamily.workflowController.set("useDifferentAccount",!0),CreateFamily.statechart.sendEvent("actionCompleted")}})}),buttons:[CreateFamily.CompleteButton.create(),CreateFamily.BackButton.create()]}),CreateFamily.ConfirmAccountForm=CreateFamily.FormView.extend({title:"CreateFamily.MacOSX.Forms.ConfirmAccount.Title".loc(),escapeTitleHTML:NO,content:CM.View.extend({childViews:["account","description"],account:CM.View.extend({childViews:["photo","id"],classNames:["account"],photo:CM.AccountPhotoView.design({contentBinding:SC.Binding.oneWay("CM.nativeClientController.currentUser")}),id:CM.View.extend({childViews:["name","appleId"],name:CM.LabelView.extend({tagName:"h1",classNames:["account-name"],textBinding:"CM.nativeClientController.currentUser.displayName"}),appleId:CM.LabelView.design({tagName:"small",classNames:["account-apple-id"],textBinding:"CM.nativeClientController.currentUser.appleId",isField:!0,fieldName:"organizerAppleId",valueBinding:SC.Binding.oneWay(".text")})})}),description:CM.TextView.extend({text:"CreateFamily.MacOSX.Forms.ConfirmAccount.Description"
.loc()})}),buttons:[CreateFamily.CompleteButton.create(),CreateFamily.BackButton.create()]}),CreateFamily.ConfirmAuthorizePurchasesForm=CreateFamily.FormView.extend({classNames:["confirm-authorize-purchases-form"],title:"CreateFamily.MacOSX.Forms.ConfirmAuthorizePurchases.Title".loc(),content:CM.View.extend({childViews:["creditCard","description","descriptionChildrenNote","learnMoreButton"],creditCard:CM.View.extend({classNames:["credit-card"],childViews:["img","billingDetail"],img:CM.ImageView.extend({isVisible:YES,updateImage:function(){var e=CreateFamily.workflowController.getPath("subject.creditCardImageUrl");this.set("value",e),this.set("prevImageURL",e),SC.imageQueue.loadImage(e,this,this.imageDidLoad,!1)}.observes("CreateFamily.workflowController.updateImage"),imageDidLoad:function(e,t){var n=this.get("prevImageURL");this.set("value",e),this.set("prevImageURL",e)},imageDidRelease:function(e,t){this.set("prevImageURL","")},loadImage:function(){return this.updateImage(),"imgUrl"}.property(".parentView.parentView.paymentMethod"),classNameBindings:["loadImage"],isVisibleBinding:SC.Binding.oneWay("CreateFamily.workflowController.isNotCarrierBilling")}),billingDetail:CM.View.extend({classNames:["billingDetails"],childViews:["cardInfo","carrierBilling"],cardInfo:CM.LabelView.extend({text:function(){var e=CreateFamily.workflowController.get("subject");if(e){var t=e.verificationType.toLowerCase(),n=e.billingType;if("cvv"===t)return"CreateFamily.MacOSX.Forms.ConfirmAuthorizePurchases.CreditCard".loc({cardType:e.creditCardType,lastDigits:e.creditCardLastFourDigits});if("sms"===t
){if("Carrier"===n)return"CreateFamily.MacOSX.Forms.ConfirmAuthorizePurchases.CarrierBilling.SMSPhoneNumber".loc({smsPhoneNumber:e.smsPhoneNumber});if("Card"===n)return e.creditCardId==="APWC"?"CreateFamily.MacOSX.Forms.ConfirmAuthorizePurchases.AliPay".loc({cardType:e.creditCardType,lastDigits:e.alipayLoginId}):"CreateFamily.MacOSX.Forms.ConfirmAuthorizePurchases.CreditCard".loc({cardType:e.creditCardType,lastDigits:e.creditCardLastFourDigits})}}}.property(".parentView.parentView.parentView.paymentMethod")}),carrierBilling:CM.LabelView.extend({text:function(){var e=CreateFamily.mainPage.mainPane.childViews[0].contentView.content.creditCard.billingDetail.carrierBilling.layer(),t=CreateFamily.workflowController.get("subject"),n=CreateFamily.workflowController.getPath("subject.verificationType").toLowerCase();return"sms"===n&&"Carrier"===t.billingType?t.creditCardType:""}.property(".parentView.parentView.parentView.paymentMethod")})})}),paymentMethodBinding:SC.Binding.oneWay("CreateFamily.workflowController.triggerPaymentChanged"),description:CM.TextView.extend({text:"CreateFamily.MacOSX.Forms.ConfirmAuthorizePurchases.Description".loc()}),descriptionChildrenNote:CM.TextView.extend({maximumAskToBuyAgeBinding:SC.Binding.oneWay("CM.configurationController.maximumAskToBuyAge"),text:function(){return"CreateFamily.MacOSX.Forms.ConfirmAuthorizePurchases.Description.ChildrenNote".loc({maximumAskToBuyAge:this.get("maximumAskToBuyAge")})}.property("maximumAskToBuyAge").cacheable()}),learnMoreButton:CM.ButtonView.design({value:"CreateFamily.MacOSX.Buttons.ManagingFamilyPurchases".loc(),
action:function(){InternetAccount2.openExternalURL("CreateFamily.MacOSX.Forms.ConfirmAuthorizePurchases.ManagingFamilyPurchasesLink".loc())}})}),buttons:[CreateFamily.CompleteButton.create(),CreateFamily.BackButton.create({callback:function(){var e=CreateFamily.mainPage.mainPane.childViews[0].getPath("contentView.content.password.field");e&&e.set("value",""),CreateFamily.statechart.sendEvent("actionReversed")}})]}),CreateFamily.mainWorkflow=AssemblyLine.Workflow.design({actions:[AssemblyLine.DecisionAction.extend({branches:{CreateFamilyV1Branch:function(){return CM.configurationController.isFamilyV2Enabled?CM.nativeClientController.isLoboOrHigher()?!1:!0:!0},CreateFamilyV2Branch:function(){return CM.configurationController.isFamilyV2Enabled?CM.nativeClientController.isLoboOrHigher()?!0:!1:!1}},CreateFamilyV2Branch:AssemblyLine.Workflow.design({actions:[CreateFamily.CheckEligibility.extend({shouldPerform:function(){return console.log("starting v2 flow"),!0}}),CreateFamily.Introduction,CreateFamily.ShowConfirmAccount,CreateFamily.AuthorizePurchases.extend({}),CreateFamily.ShowConfirmAuthorizePurchasesNew,CreateFamily.ShowiTunesTerms.extend({shouldPerform:function(){return CreateFamily.workflowController.getPath("subject.needsUpdatediTunesTerms")}}),CreateFamily.ShareLocation.extend({shouldPerform:function(){return CM.configurationController.get("allowShareLocation")}}),CreateFamily.SubmitFamilyV2]}),CreateFamilyV1Branch:AssemblyLine.Workflow.design({actions:[CreateFamily.CheckEligibility,CreateFamily.ShowIntroduction,CreateFamily.ShowConfirmAccount,CreateFamily.ShowAuthorizePurchases
.extend({shouldPerform:function(){return CM.nativeClientController.preferredSharedPurchasesAccountIsNotiCloudAccount()?(CreateFamily.workflowController.set("useDifferentAccount",!0),!1):!0},shouldPerformPostAction:function(){return CreateFamily.workflowController.get("useDifferentAccount")?!1:!0}}),CreateFamily.SharePurchases.extend({shouldPerform:function(){return CreateFamily.workflowController.get("useDifferentAccount")}}),CreateFamily.ShowConfirmAuthorizePurchases,CreateFamily.ShowiTunesTerms.extend({shouldPerform:function(){return CreateFamily.workflowController.getPath("subject.needsUpdatediTunesTerms")}}),CreateFamily.ShareMyLocation.extend({shouldPerform:function(){return CM.configurationController.get("allowShareLocation")}}),CreateFamily.SubmitFamily]})})]}),CreateFamily.statechart=SC.Statechart.create({rootState:SC.State.design({initialSubstate:"loadingState",loadingState:SC.State.design({enterState:function(){CoreFamily.setup(),CreateFamily.workflowController.load({});var e=CreateFamily.getPath("mainPage.mainPane");e.append(),this.gotoState("runningState")}}),runningState:SC.State.design({initialSubstate:"workflowState",workflowState:CreateFamily.mainWorkflow,changeCurrentView:function(e){var t=CreateFamily.getPath("mainPage.mainPane");t.changeCurrentView(e),CM.nativeClientController.webClientIsReady()},actionCompleted:function(){this.gotoState("completedState")},userWantsToCancel:function(){InternetAccount2.exit({didCreateFamily:!1})}}),completedState:SC.State.extend({enterState:function(){var e=this.get("statechart");e.sendAction("readyToHandOffToClient")},readyToHandOffToClient
:function(){InternetAccount2.exit({didCreateFamily:!0})}})})}),CreateFamily.IntroductionBulletView=CM.LabelView.extend({classNames:["bullet"],tagName:"li",textKeyPrefix:"CreateFamily.MacOSX.Forms.Introduction.Bullet.",textKeySuffix:null,text:function(){var e=this.get("textKeyPrefix")+this.get("textKeySuffix");return e?e.loc():""}.property("textKeyPrefix","textKeySuffix").cacheable()}),CreateFamily.IntroductionForm=CreateFamily.FormView.extend({classNames:["introduction-form"],title:"CreateFamily.MacOSX.Forms.Introduction.Title".loc(),content:CM.View.extend({childViews:["body","bullets","learnMoreButton"],body:CM.TextView.design({classNames:["introduction-form-body"],text:"CreateFamily.MacOSX.Forms.Introduction.Description".loc()}),bullets:CM.View.design({classNames:["bullets"],tagName:"ul",childViews:["iTunesBullet","fuseBullet","photosBullet","calendarBullet","locationBullet","fmipBullet"],iTunesBullet:CreateFamily.IntroductionBulletView.design({textKeySuffix:"iTunes"}),fuseBullet:CreateFamily.IntroductionBulletView.design({textKeySuffix:"Fuse"}),photosBullet:CreateFamily.IntroductionBulletView.design({textKeySuffix:"Photos"}),calendarBullet:CreateFamily.IntroductionBulletView.design({textKeySuffix:"Calendar"}),locationBullet:CreateFamily.IntroductionBulletView.design({textKeySuffix:"Location"}),fmipBullet:CreateFamily.IntroductionBulletView.design({textKeySuffix:"FMiP"})}),learnMoreButton:CM.ButtonView.design({value:"CreateFamily.MacOSX.Buttons.Details".loc(),action:function(){InternetAccount2.openExternalURL("CreateFamily.MacOSX.Forms.Introduction.DetailsLink".loc())}})})
,buttons:[CreateFamily.CompleteButton.create(),CreateFamily.CancelButton.create({title:"CreateFamily.MacOSX.Buttons.Back".loc()})]}),CreateFamily.iTunesTermsForm=CreateFamily.FormView.extend({classNames:["terms-form"],title:"CreateFamily.MacOSX.Forms.iTunesTerms.Title".loc(),escapeTitleHTML:NO,content:CM.View.extend({childViews:["terms","accept"],terms:CM.TermsBox.extend({text:function(){var e=CreateFamily.workflowController.get("subject").iTunesTerms;return e.content}.property("CreateFamily.workflowController.subject").cacheable()}),accept:CM.LabelledCheckboxView.extend({text:"CreateFamily.MacOSX.Forms.iTunesTerms.Agree".loc()})}),isValidBinding:SC.Binding.bool(".contentView.content.accept.value"),buttons:[CreateFamily.CompleteButton.create({title:"CreateFamily.MacOSX.Buttons.Agree".loc()}),CreateFamily.BackButton.create()]}),CreateFamily.ShareMyLocationForm=CreateFamily.FormView.extend({classNames:["share-my-location-form"],title:"CreateFamily.MacOSX.Forms.ShareMyLocation.Title".loc(),content:CM.View.extend({childViews:["directions","options"],directions:CM.LabelView.extend({text:"CreateFamily.MacOSX.Forms.ShareMyLocation.Description".loc()}),options:CM.RadioGroupView.extend({childViews:["onOption","offOption"],fieldName:"organizerShareMyLocationEnabledDefault",onOption:CM.LabelledRadioView.extend({value:YES,fieldName:"_organizerShareMyLocationEnabledDefault",text:"CreateFamily.MacOSX.Forms.ShareMyLocation.Option.On".loc()}),offOption:CM.LabelledRadioView.extend({value:NO,fieldName:"_organizerShareMyLocationEnabledDefault",text:"CreateFamily.MacOSX.Forms.ShareMyLocation.Option.Off"
.loc()})})}),isValid:function(){return!SC.empty(this.getPath("contentView.content.options.value"))}.property(),_fieldValueChanged:function(){this.notifyPropertyChange("isValid")}.observes("contentView.content.options.value","isVisibleInWindow"),buttons:[CreateFamily.CompleteButton.create({title:"CreateFamily.MacOSX.Buttons.Continue".loc()}),CreateFamily.BackButton.create()]}),CreateFamily.SharePurchasesForm=CreateFamily.FormView.extend({classNames:["share-purchases-form"],title:"CreateFamily.MacOSX.Forms.SharePurchases.Title".loc(),content:CM.View.extend({childViews:["body","appleId","password"],body:CM.TextView.extend({text:"CreateFamily.MacOSX.Forms.SharePurchases.Description".loc()}),appleId:CM.View.extend({classNames:["form-field"],childViews:["label","field"],isValidBinding:SC.Binding.bool(".field.value"),label:CM.LabelView.extend({text:"CreateFamily.MacOSX.Forms.SharePurchases.AppleId.Label".loc()}),field:CM.TextFieldView.extend({fieldName:"organizerAppleIdForPurchases",ariaLabelBinding:SC.Binding.oneWay(".parentView.label.text"),init:function(){var e=arguments.callee.base.apply(this,arguments),t=CM.nativeClientController.getPreferredAccountForSharedPurchases(),n=t.appleId,r=CM.nativeClientController.getAppleId();return n!==r&&this.set("value",n),e}})}),password:CM.View.extend({classNames:["form-field"],childViews:["label","field","forgotLink"],isValidBinding:SC.Binding.bool(".field.value"),label:CM.LabelView.extend({text:"CreateFamily.MacOSX.Forms.SharePurchases.Password.Label".loc()}),field:CM.TextFieldView.extend({fieldName:"organizerAppleIdForPurchasesPassword",isPassword
:!0,ariaLabelBinding:SC.Binding.oneWay(".parentView.label.text")}),forgotLink:CM.LinkView.extend({href:"CreateFamily.MacOSX.Forms.SharePurchases.ForgotPassword.URL".loc(),text:"CreateFamily.MacOSX.Forms.SharePurchases.ForgotPassword.Label".loc()})})}),findInitiallyFocusedField:function(){var e=this.getPath("contentView.content"),t=e.getPath("appleId.field");return SC.empty(t.get("value"))||(t=e.getPath("password.field")),t},isValid:NO,_fieldsDidChange:function(){var e=this.getPath("contentView.content"),t=e.getPath("appleId.field.value"),n=e.getPath("password.field.value");this.set("isValid",!SC.empty(t)&&!SC.empty(n))}.observes("contentView.content.appleId.field.value","contentView.content.password.field.value"),buttons:[CreateFamily.CompleteButton.create(),CreateFamily.BackButton.create({callback:function(){CreateFamily.workflowController.set("useDifferentAccount",!1);var e=CreateFamily.workflowController.get("subject");delete e.organizerAppleIdForPurchasesPassword;var t=CreateFamily.mainPage.mainPane.childViews[0].getPath("contentView.content.password.field");CreateFamily.statechart.sendEvent("actionReversed")}})]}),CreateFamily.NewAuthorizePurchasesForm=CreateFamily.FormView.extend({classNames:["authorize-purchases-form"],title:function(){return"CreateFamily.MacOSX.Forms.AuthorizePurchases.Title".loc({appleId:CM.nativeClientController.getAppleId()})}.property(),content:CM.View.extend({childViews:["body","appleId","useOtherAccountButton","options"],body:CM.TextView.extend({text:function(){return"CreateFamily.MacOSX.Forms.AuthorizePurchases.Description".loc({appleId:CM.nativeClientController
.getAppleId()})}.property()}),appleId:CM.FieldView.extend({fieldName:"organizerAppleIdForPurchases",value:CM.nativeClientController.getAppleId()}),useOtherAccountButton:CM.ButtonView.extend({value:"CreateFamily.MacOSX.Buttons.UseDifferentAccount".loc(),action:function(){CreateFamily.workflowController.set("useDifferentAccount",!0),CreateFamily.statechart.sendEvent("actionCompleted")}}),options:CM.RadioGroupView.extend({childViews:["shareOption","notNowOption"],fieldName:"organizerShareMyPurchasesEnabledDefault",shareOption:CM.LabelledRadioView.extend({value:YES,isSelected:YES,fieldName:"_organizerShareMyPurchasesEnabledDefault",text:"CreateFamily.MacOSX.Forms.ConfirmAuthorizePurchases.SharePurchases.Radio".loc()}),notNowOption:CM.LabelledRadioView.extend({value:NO,isSelected:NO,fieldName:"_organizerShareMyPurchasesEnabledDefault",text:"CreateFamily.MacOSX.Forms.ShareMyLocation.Option.Off".loc()})})}),buttons:[CreateFamily.CompleteButton.create(),CreateFamily.BackButton.create()]}),CreateFamily.NewAuthorizePurchasesForm=CreateFamily.FormView.extend({classNames:["authorize-purchases-form"],title:function(){return"CreateFamily.MacOSX.Forms.AuthorizePurchases.Title".loc({appleId:CM.nativeClientController.getAppleId()})}.property(),content:CM.View.extend({childViews:["body","appleId","useOtherAccountButton","options"],body:CM.TextView.extend({text:function(){return"CreateFamily.MacOSX.Forms.AuthorizePurchases.Description".loc({appleId:CM.nativeClientController.getAppleId()})}.property()}),appleId:CM.FieldView.extend({fieldName:"organizerAppleIdForPurchases",value:CM.nativeClientController
.getAppleId()}),useOtherAccountButton:CM.ButtonView.extend({value:"CreateFamily.MacOSX.Buttons.UseDifferentAccount".loc(),action:function(){CM.nativeClientController.openURL("https://support.apple.com/en-us/ht201079")}}),options:CM.RadioGroupView.extend({childViews:["shareOption","notNowOption"],fieldName:"organizerShareMyPurchasesEnabledDefault",shareOption:CM.LabelledRadioView.extend({value:YES,isSelected:YES,fieldName:"_organizerShareMyPurchasesEnabledDefault",text:"CreateFamily.MacOSX.Forms.ConfirmAuthorizePurchases.SharePurchases.Radio".loc()}),notNowOption:CM.LabelledRadioView.extend({value:NO,isSelected:NO,fieldName:"_organizerShareMyPurchasesEnabledDefault",text:"CreateFamily.MacOSX.Forms.ShareMyLocation.Option.Off".loc()})})}),buttons:[CreateFamily.CompleteButton.create(),CreateFamily.BackButton.create()]}),CreateFamily.ConfirmAccountForm=CreateFamily.FormView.extend({title:"CreateFamily.MacOSX.Forms.ConfirmAccount.Title".loc(),escapeTitleHTML:NO,content:CM.View.extend({childViews:["account","description"],account:CM.View.extend({childViews:["photo","id"],classNames:["account"],photo:CM.AccountPhotoView.design({contentBinding:SC.Binding.oneWay("CM.nativeClientController.currentUser")}),id:CM.View.extend({childViews:["name","appleId"],name:CM.LabelView.extend({tagName:"h1",classNames:["account-name"],textBinding:"CM.nativeClientController.currentUser.displayName"}),appleId:CM.LabelView.design({tagName:"small",classNames:["account-apple-id"],textBinding:"CM.nativeClientController.currentUser.appleId",isField:!0,fieldName:"organizerAppleId",valueBinding:SC.Binding.oneWay
(".text")})})}),description:CM.TextView.extend({text:"CreateFamily.MacOSX.Forms.v2.ConfirmAccount.Description".loc()})}),buttons:[CreateFamily.CompleteButton.create(),CreateFamily.BackButton.create()]}),CreateFamily.ConfirmAuthorizePurchasesFormNew=CreateFamily.FormView.extend({classNames:["confirm-authorize-purchases-form"],title:"CreateFamily.MacOSX.Forms.ConfirmAuthorizePurchases.Title".loc(),content:CM.View.extend({childViews:["creditCard","description","descriptionChildrenNote"],creditCard:CM.View.extend({classNames:["purchaseForm"],childViews:["billingDetail","learnMoreButton"],billingDetail:CM.View.extend({classNames:["billingDetails"],childViews:["img","cardInfo","carrierBilling"],img:CM.ImageView.extend({isVisible:YES,updateImage:function(){var e=CreateFamily.workflowController.getPath("subject.creditCardImageUrl");this.set("value",e),this.set("prevImageURL",e),SC.imageQueue.loadImage(e,this,this.imageDidLoad,!1)}.observes("CreateFamily.workflowController.updateImage"),imageDidLoad:function(e,t){var n=this.get("prevImageURL");this.set("value",e),this.set("prevImageURL",e)},imageDidRelease:function(e,t){this.set("prevImageURL","")},loadImage:function(){return this.updateImage(),"imgUrl"}.property(".parentView.parentView.paymentMethod"),classNameBindings:["loadImage"],isVisibleBinding:SC.Binding.oneWay("CreateFamily.workflowController.isNotCarrierBilling")}),cardInfo:CM.LabelView.extend({text:function(){var e=CreateFamily.workflowController.get("subject");if(e){var t=e.verificationType.toLowerCase(),n=e.billingType;if("cvv"===t)return"CreateFamily.MacOSX.Forms.ConfirmAuthorizePurchases.CreditCard"
.loc({cardType:e.creditCardType,lastDigits:e.creditCardLastFourDigits});if("sms"===t){if("Carrier"===n)return"CreateFamily.MacOSX.Forms.ConfirmAuthorizePurchases.CarrierBilling.SMSPhoneNumber".loc({smsPhoneNumber:e.smsPhoneNumber});if("Card"===n)return e.creditCardId==="APWC"?"CreateFamily.MacOSX.Forms.ConfirmAuthorizePurchases.AliPay".loc({cardType:e.creditCardType,lastDigits:e.alipayLoginId}):"CreateFamily.MacOSX.Forms.ConfirmAuthorizePurchases.CreditCard".loc({cardType:e.creditCardType,lastDigits:e.creditCardLastFourDigits})}}}.property(".parentView.parentView.parentView.paymentMethod")}),carrierBilling:CM.LabelView.extend({isVisible:SC.Binding.oneWay("CreateFamily.workflowController.isNotCarrierBilling"),text:function(){var e=CreateFamily.mainPage.mainPane.childViews[0].contentView.content.creditCard.billingDetail.carrierBilling.layer(),t=CreateFamily.workflowController.get("subject"),n=CreateFamily.workflowController.getPath("subject.verificationType").toLowerCase();return"sms"===n&&"Carrier"===t.billingType?t.creditCardType:""}.property(".parentView.parentView.parentView.paymentMethod")})}),learnMoreButton:CM.ButtonView.design({classNames:["useDifferentPayment"],value:"CreateFamily.MacOSX.Buttons.Use.Different.Payment".loc(),action:function(){InternetAccount2.openExternalURL("CreateFamily.MacOSX.Forms.ConfirmAuthorizePurchases.ManagingFamilyPurchasesLink".loc())}})}),paymentMethodBinding:SC.Binding.oneWay("CreateFamily.workflowController.triggerPaymentChanged"),description:CM.TextView.extend({text:"CreateFamily.MacOSX.Forms.ConfirmAuthorizePurchases.Description".loc()}
),descriptionChildrenNote:CM.TextView.extend({maximumAskToBuyAgeBinding:SC.Binding.oneWay("CM.configurationController.maximumAskToBuyAge"),text:function(){return"CreateFamily.MacOSX.Forms.ConfirmAuthorizePurchases.Description.ChildrenNote".loc({maximumAskToBuyAge:this.get("maximumAskToBuyAge")})}.property("maximumAskToBuyAge").cacheable()})}),buttons:[CreateFamily.CompleteButton.create(),CreateFamily.BackButton.create({callback:function(){var e=CreateFamily.mainPage.mainPane.childViews[0].getPath("contentView.content.password.field");e&&e.set("value",""),CreateFamily.statechart.sendEvent("actionReversed")}})]}),CreateFamily.NewIntroductionForm=CreateFamily.FormView.extend({classNames:["introduction-form"],title:"CreateFamily.MacOSX.Forms.Introduction.Title".loc(),content:CM.View.extend({childViews:["body","bullets"],body:CM.TextView.design({classNames:["introduction-form-body"],text:"CreateFamily.MacOSX.Forms.V2.Introduction.Description".loc()}),bullets:CM.View.design({classNames:["bullets"],tagName:"ul",childViews:["musicBullet","storageBullet","purchaseBullet","calendarBullet","locationBullet","fmipBullet"],musicBullet:CreateFamily.IntroductionBulletView.design({textKeySuffix:"V2.Music"}),storageBullet:CreateFamily.IntroductionBulletView.design({textKeySuffix:"V2.Storage"}),purchaseBullet:CreateFamily.IntroductionBulletView.design({textKeySuffix:"V2.Purchase"}),calendarBullet:CreateFamily.IntroductionBulletView.design({textKeySuffix:"V2.Calendar"}),locationBullet:CreateFamily.IntroductionBulletView.design({textKeySuffix:"V2.Location"}),fmipBullet:CreateFamily.IntroductionBulletView
.design({textKeySuffix:"V2.Photos"})})}),buttons:[CreateFamily.CompleteButton.create(),CreateFamily.CancelButton.create({title:"CreateFamily.MacOSX.Forms.ShareMyLocation.Option.Off".loc()}),CreateFamily.CompleteButton.create({type:"cancel",title:"CreateFamily.MacOSX.Forms.Introduction.Learn.More.Button".loc(),callback:function(){CreateFamily.statechart.sendEvent("restartAction"),CM.nativeClientController.openURL("http://www.apple.com/icloud/family-sharing")}})]}),CreateFamily.ShareLocationForm=CreateFamily.FormView.extend({classNames:["share-my-location-form"],title:"CreateFamily.MacOSX.Forms.ShareMyLocation.Title".loc(),content:CM.View.extend({childViews:["directions","options"],directions:CM.LabelView.extend({text:"CreateFamily.MacOSX.Forms.ShareLocation.Description".loc()}),options:CM.RadioGroupView.extend({childViews:["onOption","offOption"],fieldName:"organizerShareMyLocationEnabledDefault",onOption:CM.LabelledRadioView.extend({value:YES,fieldName:"_organizerShareMyLocationEnabledDefault",text:"CreateFamily.MacOSX.Forms.ShareMyLocation.Option.On".loc()}),offOption:CM.LabelledRadioView.extend({value:NO,fieldName:"_organizerShareMyLocationEnabledDefault",text:"CreateFamily.MacOSX.Forms.ShareMyLocation.Option.Off".loc()})})}),isValid:function(){return!SC.empty(this.getPath("contentView.content.options.value"))}.property(),_fieldValueChanged:function(){this.notifyPropertyChange("isValid")}.observes("contentView.content.options.value","isVisibleInWindow"),buttons:[CreateFamily.CompleteButton.create({title:"CreateFamily.MacOSX.Buttons.Continue".loc()}),CreateFamily.BackButton
.create()]}),CreateFamily.NewSharePurchasesForm=CreateFamily.FormView.extend({classNames:["share-purchases-form"],title:"CreateFamily.MacOSX.Forms.SharePurchases.Title".loc(),content:CM.View.extend({childViews:["body","appleId","password"],body:CM.TextView.extend({text:"CreateFamily.MacOSX.Forms.SharePurchases.Description".loc()}),appleId:CM.View.extend({classNames:["form-field"],childViews:["label","field"],isValidBinding:SC.Binding.bool(".field.value"),label:CM.LabelView.extend({text:"CreateFamily.MacOSX.Forms.SharePurchases.AppleId.Label".loc()}),field:CM.TextFieldView.extend({fieldName:"organizerAppleIdForPurchases",ariaLabelBinding:SC.Binding.oneWay(".parentView.label.text"),init:function(){var e=arguments.callee.base.apply(this,arguments),t=CM.nativeClientController.getPreferredAccountForSharedPurchases(),n=t.appleId,r=CM.nativeClientController.getAppleId();return n!==r&&this.set("value",n),e}})}),password:CM.View.extend({classNames:["form-field"],childViews:["label","field","forgotLink"],isValidBinding:SC.Binding.bool(".field.value"),label:CM.LabelView.extend({text:"CreateFamily.MacOSX.Forms.SharePurchases.Password.Label".loc()}),field:CM.TextFieldView.extend({fieldName:"organizerAppleIdForPurchasesPassword",isPassword:!0,ariaLabelBinding:SC.Binding.oneWay(".parentView.label.text")}),forgotLink:CM.LinkView.extend({href:"CreateFamily.MacOSX.Forms.SharePurchases.ForgotPassword.URL".loc(),text:"CreateFamily.MacOSX.Forms.SharePurchases.ForgotPassword.Label".loc()})})}),findInitiallyFocusedField:function(){var e=this.getPath("contentView.content"),t=e.getPath("appleId.field"
);return SC.empty(t.get("value"))||(t=e.getPath("password.field")),t},isValid:NO,_fieldsDidChange:function(){var e=this.getPath("contentView.content"),t=e.getPath("appleId.field.value"),n=e.getPath("password.field.value");this.set("isValid",!SC.empty(t)&&!SC.empty(n))}.observes("contentView.content.appleId.field.value","contentView.content.password.field.value"),buttons:[CreateFamily.CompleteButton.create(),CreateFamily.BackButton.create({callback:function(){CreateFamily.workflowController.set("useDifferentAccount",!1);var e=CreateFamily.workflowController.get("subject");delete e.organizerAppleIdForPurchasesPassword;var t=CreateFamily.mainPage.mainPane.childViews[0].getPath("contentView.content.password.field");CreateFamily.statechart.sendEvent("actionReversed")}}),CreateFamily.BackButton.create({title:"CreateFamily.MacOSX.Forms.Dont.Share.Purchase.Button".loc(),callback:function(){CreateFamily.workflowController.updateSubject({isSharingPurchase:!1}),CreateFamily.statechart.sendEvent("actionCompleted")}})]}),CreateFamily.mainPage=SC.Page.design({mainPane:SC.MainPane.design({_currentView:null,layout:{},useStaticLayout:YES,changeCurrentView:function(e){var t=this.get("_currentView");e!==t&&(t&&this.removeChild(t),e&&this.appendChild(e),this.set("_currentView",e),this.innerContentSizeDidChange()),e&&e.notifyPropertyChange("isVisibleInWindow")},innerContentSizeDidChange:function(){this.invokeLast(function(){var e=this.getPath("_currentView.layer");if(e){var t=e.offsetHeight;if(t!==this._previousHeight){var n=window.innerHeight,r=CM.nativeClientController;(n<t||!r.get("resizeHasBeenCalled"
))&&CM.nativeClientController.resize(e.offsetWidth,t),this._previousHeight=t}}})},_previousHeight:undefined})});
